/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var qe=Object.defineProperty;var It=Object.getOwnPropertyDescriptor;var Rt=Object.getOwnPropertyNames;var Mt=Object.prototype.hasOwnProperty;var K=(c,t)=>()=>(c&&(t=c(c=0)),t);var ut=(c,t)=>{for(var e in t)qe(c,e,{get:t[e],enumerable:!0})},kt=(c,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Rt(t))!Mt.call(c,i)&&i!==e&&qe(c,i,{get:()=>t[i],enumerable:!(r=It(t,i))||r.enumerable});return c};var Ot=c=>kt(qe({},"__esModule",{value:!0}),c);var V,me,X,pt,ne,Z=K(()=>{"use strict";V={GEMINI:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent",GROQ:"https://api.groq.com/openai/v1/chat/completions",HUGGINGFACE:"https://api-inference.huggingface.co/models",OPENROUTER:"https://openrouter.ai/api/v1/chat/completions",YOUTUBE_OEMBED:"https://www.youtube.com/oembed",CORS_PROXY:"https://api.allorigins.win/raw"},me={GEMINI:"gemini-2.0-flash",GROQ:"llama-3.3-70b-versatile",HUGGINGFACE:"Qwen/Qwen3-8B",OPENROUTER:"meta-llama/llama-3.1-8b-instruct:free"},X={"Google Gemini":[{name:"gemini-3-pro-preview",supportsAudioVideo:!0},{name:"gemini-3-pro-image-preview",supportsAudioVideo:!1},{name:"gemini-3-flash-preview",supportsAudioVideo:!0},{name:"gemini-2.5-pro",supportsAudioVideo:!0},{name:"gemini-2.5-pro-preview-tts",supportsAudioVideo:!1},{name:"gemini-2.5-flash",supportsAudioVideo:!0},{name:"gemini-2.5-flash-preview-09-2025",supportsAudioVideo:!0},{name:"gemini-2.5-flash-lite",supportsAudioVideo:!0},{name:"gemini-2.5-flash-lite-preview-09-2025",supportsAudioVideo:!0},{name:"gemini-2.5-flash-exp:free",supportsAudioVideo:!0},{name:"gemini-2.5-flash-image",supportsAudioVideo:!1},{name:"gemini-2.5-flash-native-audio-preview-12-2025",supportsAudioVideo:!0},{name:"gemini-2.5-flash-preview-tts",supportsAudioVideo:!1},{name:"gemini-2.0-flash",supportsAudioVideo:!0},{name:"gemini-2.0-flash-001",supportsAudioVideo:!0},{name:"gemini-2.0-flash-exp",supportsAudioVideo:!0},{name:"gemini-2.0-flash-lite",supportsAudioVideo:!0},{name:"gemini-2.0-flash-lite-001",supportsAudioVideo:!0},{name:"gemini-2.0-flash-thinking-exp:free",supportsAudioVideo:!0},{name:"gemini-2.0-flash-thinking-exp-01-21",supportsAudioVideo:!0},{name:"gemini-2.0-flash-preview-image-generation",supportsAudioVideo:!1},{name:"gemini-2.0-pro",supportsAudioVideo:!0},{name:"gemini-2.0-pro-exp",supportsAudioVideo:!0},{name:"gemini-1.5-pro",supportsAudioVideo:!0},{name:"gemini-1.5-pro-001",supportsAudioVideo:!0},{name:"gemini-1.5-pro-002",supportsAudioVideo:!0},{name:"gemini-1.5-flash",supportsAudioVideo:!0},{name:"gemini-1.5-flash-001",supportsAudioVideo:!0},{name:"gemini-1.5-flash-002",supportsAudioVideo:!0},{name:"gemini-1.5-flash-8b",supportsAudioVideo:!0},{name:"gemini-1.5-flash-exp:free",supportsAudioVideo:!0},{name:"gemini-exp-1206",supportsAudioVideo:!0},{name:"gemini-exp-latest",supportsAudioVideo:!0}],Groq:[{name:"llama-3.3-70b-versatile"},{name:"llama-3.3-8b-instant"},{name:"llama-3.1-8b-instant"},{name:"llama-3.1-70b-versatile"},{name:"deepseek-r1"},{name:"deepseek-r1-distill-llama-70b"},{name:"deepseek-r1-distill-qwen-32b"},{name:"mixtral-8x7b-32768"},{name:"gemma2-9b-it"},{name:"qwen-2.5-32b"},{name:"qwen-2.5-coder-32b"}],Ollama:[{name:"deepseek-v3.2",supportsAudioVideo:!0},{name:"deepseek-v3.2:latest",supportsAudioVideo:!0},{name:"deepseek-v3.2:32b",supportsAudioVideo:!0},{name:"deepseek-v3.2:70b",supportsAudioVideo:!0},{name:"deepseek-v3.2:instruct",supportsAudioVideo:!0},{name:"deepseek-v3.2:coder",supportsAudioVideo:!0},{name:"llama3.2",supportsAudioVideo:!0},{name:"llama3.2:3b",supportsAudioVideo:!0},{name:"llama3.2:1b",supportsAudioVideo:!0},{name:"llama3.2-vision",supportsAudioVideo:!0},{name:"llama3.2-vision:11b",supportsAudioVideo:!0},{name:"llama3.2-vision:90b",supportsAudioVideo:!0},{name:"llama3.1",supportsAudioVideo:!0},{name:"llama3.1:405b",supportsAudioVideo:!0},{name:"llama3.1:70b",supportsAudioVideo:!0},{name:"llama3.1:8b",supportsAudioVideo:!0},{name:"llama3.1-instant",supportsAudioVideo:!0},{name:"llama3",supportsAudioVideo:!0},{name:"llama3:70b",supportsAudioVideo:!0},{name:"llama3:8b",supportsAudioVideo:!0},{name:"llama2:70b",supportsAudioVideo:!0},{name:"llama2:13b",supportsAudioVideo:!0},{name:"llama2:7b",supportsAudioVideo:!0},{name:"mistral",supportsAudioVideo:!0},{name:"mistral:7b",supportsAudioVideo:!0},{name:"mistral:7b-instruct-v0.3",supportsAudioVideo:!0},{name:"mixtral",supportsAudioVideo:!0},{name:"mixtral:8x7b",supportsAudioVideo:!0},{name:"mixtral:8x22b",supportsAudioVideo:!0},{name:"mixtral:8x7b-instruct-v0.1",supportsAudioVideo:!0},{name:"qwen2",supportsAudioVideo:!0},{name:"qwen2:72b",supportsAudioVideo:!0},{name:"qwen2:7b",supportsAudioVideo:!0},{name:"qwen2:1.5b",supportsAudioVideo:!0},{name:"qwen2:0.5b",supportsAudioVideo:!0},{name:"qwen2-vl",supportsAudioVideo:!0},{name:"qwen2.5",supportsAudioVideo:!0},{name:"qwen2.5:72b",supportsAudioVideo:!0},{name:"qwen2.5:32b",supportsAudioVideo:!0},{name:"qwen2.5:14b",supportsAudioVideo:!0},{name:"qwen2.5:7b",supportsAudioVideo:!0},{name:"qwen2.5:3b",supportsAudioVideo:!0},{name:"qwen2.5-coder:32b",supportsAudioVideo:!0},{name:"qwen3",supportsAudioVideo:!0},{name:"qwen3:32b",supportsAudioVideo:!0},{name:"qwen3:14b",supportsAudioVideo:!0},{name:"qwen3:8b",supportsAudioVideo:!0},{name:"qwen3:4b",supportsAudioVideo:!0},{name:"qwen3-coder",supportsAudioVideo:!0},{name:"qwen3-coder:32b",supportsAudioVideo:!0},{name:"qwen3-coder:14b",supportsAudioVideo:!0},{name:"qwen3-coder:480b-cloud",supportsAudioVideo:!0},{name:"gemma2",supportsAudioVideo:!0},{name:"gemma2:27b",supportsAudioVideo:!0},{name:"gemma2:9b",supportsAudioVideo:!0},{name:"gemma",supportsAudioVideo:!0},{name:"gemma:7b",supportsAudioVideo:!0},{name:"gemma:2b",supportsAudioVideo:!0},{name:"phi3",supportsAudioVideo:!0},{name:"phi3:14b",supportsAudioVideo:!0},{name:"phi3:mini",supportsAudioVideo:!0},{name:"phi3:4k",supportsAudioVideo:!0},{name:"phi3-vision",supportsAudioVideo:!0},{name:"phi3.5",supportsAudioVideo:!0},{name:"phi3.5:3.8b",supportsAudioVideo:!0},{name:"phi3.5-instruct",supportsAudioVideo:!0},{name:"deepseek-r1",supportsAudioVideo:!0},{name:"deepseek-r1:32b",supportsAudioVideo:!0},{name:"deepseek-r1:14b",supportsAudioVideo:!0},{name:"deepseek-r1:8b",supportsAudioVideo:!0},{name:"deepseek-r1-distill-llama-70b",supportsAudioVideo:!0},{name:"deepseek-r1-distill-qwen-32b",supportsAudioVideo:!0},{name:"deepseek-coder-v2",supportsAudioVideo:!0},{name:"deepseek-coder",supportsAudioVideo:!0},{name:"deepseek-coder-v2:16b",supportsAudioVideo:!0},{name:"llava",supportsAudioVideo:!0},{name:"llava:13b",supportsAudioVideo:!0},{name:"llava:7b",supportsAudioVideo:!0},{name:"llava-llama3",supportsAudioVideo:!0},{name:"llava-llama3:8b",supportsAudioVideo:!0},{name:"bakllava",supportsAudioVideo:!0},{name:"moondream",supportsAudioVideo:!0},{name:"moondream:2b",supportsAudioVideo:!0},{name:"nvidia-llama3-1-vision",supportsAudioVideo:!0},{name:"minicpm-v",supportsAudioVideo:!0},{name:"minicpm-v:2.6",supportsAudioVideo:!0},{name:"minicpm-l",supportsAudioVideo:!0},{name:"codellama",supportsAudioVideo:!0},{name:"codellama:13b",supportsAudioVideo:!0},{name:"codellama:34b",supportsAudioVideo:!0},{name:"codellama:70b",supportsAudioVideo:!0},{name:"codegemma",supportsAudioVideo:!0},{name:"codegemma:7b",supportsAudioVideo:!0},{name:"starcoder2",supportsAudioVideo:!0},{name:"starcoder2:15b",supportsAudioVideo:!0},{name:"starcoder2:7b",supportsAudioVideo:!0},{name:"command-r",supportsAudioVideo:!0},{name:"command-r:35b",supportsAudioVideo:!0},{name:"command-r:7b",supportsAudioVideo:!0},{name:"command-r-plus",supportsAudioVideo:!0},{name:"command-r-zephyr",supportsAudioVideo:!0},{name:"neural-chat",supportsAudioVideo:!0},{name:"openchat",supportsAudioVideo:!0},{name:"openchat:7b",supportsAudioVideo:!0},{name:"openchat:8b",supportsAudioVideo:!0},{name:"wizardlm2",supportsAudioVideo:!0},{name:"wizardlm2:8x22b",supportsAudioVideo:!0},{name:"wizardlm2:7b",supportsAudioVideo:!0},{name:"yi",supportsAudioVideo:!0},{name:"yi:34b",supportsAudioVideo:!0},{name:"yi:6b",supportsAudioVideo:!0},{name:"yi:1.5-9b",supportsAudioVideo:!0}],"Ollama Cloud":[{name:"deepseek-v3.2",supportsAudioVideo:!0},{name:"deepseek-v3.2:latest",supportsAudioVideo:!0},{name:"deepseek-v3.2:32b",supportsAudioVideo:!0},{name:"deepseek-v3.2:70b",supportsAudioVideo:!0},{name:"deepseek-v3.2:instruct",supportsAudioVideo:!0},{name:"deepseek-v3.2:coder",supportsAudioVideo:!0},{name:"deepseek-r1",supportsAudioVideo:!0},{name:"deepseek-r1:32b",supportsAudioVideo:!0},{name:"deepseek-r1:70b",supportsAudioVideo:!0},{name:"deepseek-r1:distill-llama-70b",supportsAudioVideo:!0},{name:"deepseek-r1:distill-qwen-32b",supportsAudioVideo:!0},{name:"llama3.2",supportsAudioVideo:!0},{name:"llama3.2:3b",supportsAudioVideo:!0},{name:"llama3.2:1b",supportsAudioVideo:!0},{name:"llama3.2-vision",supportsAudioVideo:!0},{name:"llama3.2-vision:11b",supportsAudioVideo:!0},{name:"llama3.2-vision:90b",supportsAudioVideo:!0},{name:"qwen3:32b",supportsAudioVideo:!0},{name:"qwen3:14b",supportsAudioVideo:!0},{name:"qwen3:8b",supportsAudioVideo:!0},{name:"qwen3-coder:480b-cloud",supportsAudioVideo:!0},{name:"qwen3-coder:32b",supportsAudioVideo:!0},{name:"mixtral:8x7b",supportsAudioVideo:!0},{name:"mixtral:8x22b",supportsAudioVideo:!0},{name:"mixtral:8x7b-instruct-v0.1",supportsAudioVideo:!0}],"Hugging Face":[{name:"Qwen/Qwen2-VL-7B-Instruct",supportsAudioVideo:!0},{name:"Qwen/Qwen2-VL-2B-Instruct",supportsAudioVideo:!0},{name:"meta-llama/Llama-3.2-11B-Vision-Instruct",supportsAudioVideo:!0},{name:"meta-llama/Llama-3.2-90B-Vision-Instruct",supportsAudioVideo:!0},{name:"microsoft/Phi-3.5-vision-instruct",supportsAudioVideo:!0},{name:"google/paligemma-3b-mix-448",supportsAudioVideo:!0},{name:"HuggingFaceM4/idefics2-8b",supportsAudioVideo:!0},{name:"Qwen/Qwen3-8B"},{name:"Qwen/Qwen2.5-7B-Instruct"},{name:"Qwen/Qwen3-4B-Instruct-2507"},{name:"meta-llama/Llama-3.2-3B-Instruct"},{name:"meta-llama/Llama-3.2-1B-Instruct"},{name:"deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B"},{name:"mistralai/Mistral-7B-Instruct-v0.2"},{name:"llava-hf/llava-1.5-7b",supportsAudioVideo:!0},{name:"llava-hf/llava-1.5-13b",supportsAudioVideo:!0}],OpenRouter:[{name:"meta-llama/llama-3.1-8b-instruct:free"},{name:"google/gemma-2-9b-it:free"},{name:"qwen/qwen-2.5-7b-instruct:free"},{name:"anthropic/claude-3.5-sonnet",supportsAudioVideo:!0},{name:"anthropic/claude-3.5-sonnet:beta",supportsAudioVideo:!0},{name:"anthropic/claude-3.5-haiku",supportsAudioVideo:!0},{name:"anthropic/claude-3.5-haiku:beta",supportsAudioVideo:!0},{name:"openai/gpt-4o",supportsAudioVideo:!0},{name:"openai/gpt-4o-mini",supportsAudioVideo:!0},{name:"openai/o1-mini"},{name:"openai/o1-preview"},{name:"google/gemini-2.5-pro-exp:free",supportsAudioVideo:!0},{name:"google/gemini-2.5-flash-exp:free",supportsAudioVideo:!0},{name:"google/gemini-2.0-flash-exp:free",supportsAudioVideo:!0},{name:"meta-llama/llama-3.2-11b-vision-instruct",supportsAudioVideo:!0},{name:"meta-llama/llama-3.2-90b-vision-instruct",supportsAudioVideo:!0},{name:"qwen/qwen-2-vl-7b-instruct",supportsAudioVideo:!0},{name:"qwen/qwen-2-vl-72b-instruct",supportsAudioVideo:!0},{name:"qwen/qwen-2.5-72b-instruct"},{name:"qwen/qwq-32b-preview"},{name:"meta-llama/llama-3.3-70b-instruct"},{name:"meta-llama/llama-3.1-70b-instruct"},{name:"meta-llama/llama-3.1-8b-instruct"},{name:"mistralai/mistral-large"},{name:"deepseek/deepseek-r1"},{name:"deepseek/deepseek-chat"},{name:"cohere/command-r-plus"},{name:"cohere/command-r-08-2024"}]},pt={MAX_TOKENS:8e3,TEMPERATURE:.7,DESCRIPTION_MAX_LENGTH:1e3,TITLE_MAX_LENGTH:100},ne={FILE_CREATION_WAIT:300,MODAL_DELAY:100,FALLBACK_MODAL_CHECK:500,FOCUS_DELAY:150,REPAINT_DELAY:50}});var f,ht=K(()=>{"use strict";f={PROCESSING:"Processing YouTube video...",SUCCESS:c=>`Successfully processed: ${c}`,OPENED_FILE:c=>`Opened: ${c}`,ERRORS:{INVALID_URL:"Invalid YouTube URL. Please provide a valid YouTube video URL (e.g., https://www.youtube.com/watch?v=VIDEO_ID)",MISSING_API_KEYS:"No valid Gemini or Groq API key configured. Please set one in plugin settings.",GEMINI_INVALID_KEY:"Gemini API key is invalid or missing. Please check your key.",GROQ_MODEL_NOT_FOUND:"Groq API error: Model not found or you do not have access. Please check your API key and model name.",FETCH_VIDEO_DATA:c=>`Failed to fetch video metadata: ${c}`,SAVE_FILE:c=>`Failed to save file: ${c}`,AI_PROCESSING:c=>`AI processing failed: ${c}`,FILE_NOT_EXISTS:"File no longer exists",COULD_NOT_OPEN:c=>`Could not open file: ${c}`,ENTER_URL:"Please enter a YouTube URL",VIDEO_ID_EXTRACTION:"Could not extract video ID from URL. Please check the URL format.",NETWORK_ERROR:"Network error occurred. Please check your internet connection and try again.",TIMEOUT_ERROR:"Request timed out. The server may be overloaded. Please try again.",CONNECTION_REFUSED:"Could not connect to the AI service. Please check if the service is running.",INVALID_RESPONSE:"Received an invalid response from the AI service. Please try again.",TRANSCRIPT_UNAVAILABLE:"Video transcript is not available. This video may not have captions enabled.",VIDEO_PRIVATE:"This video is private or unavailable. Please check the URL.",VIDEO_REGION_BLOCKED:"This video is not available in your region.",QUOTA_EXCEEDED:c=>`${c} API quota exceeded. Please check your plan and billing details, or try again later.`,RATE_LIMITED:c=>`${c} API rate limit reached. Please wait a moment and try again.`,BILLING_REQUIRED:c=>`${c} requires a paid plan. Please check your billing settings.`,CREDIT_EXHAUSTED:c=>`${c} API credits exhausted. Please top up your account or upgrade your plan.`,PROVIDER_UNAVAILABLE:c=>`${c} is currently unavailable. Try a different provider.`,MODEL_ACCESS_DENIED:(c,t)=>`Access denied to model "${c}" on ${t}. Check your API tier.`,CONTEXT_TOO_LONG:c=>`Content too long for ${c}. Try a shorter video or use a different format.`},WARNINGS:{CORS_RESTRICTIONS:"Description not available due to CORS restrictions",EXTRACTION_FAILED:"Description extraction failed",AUTO_EXTRACTION:"Video description could not be extracted automatically.",SLOW_PROCESSING:"Processing is taking longer than expected. Please wait...",LARGE_TRANSCRIPT:"This video has a long transcript. Processing may take a while."},SUCCESS_MESSAGES:{NOTE_CREATED:"Note created successfully!",PROCESSING_COMPLETE:"Video processed successfully!",CLIPBOARD_COPIED:"Path copied to clipboard",SETTINGS_SAVED:"Settings saved"},MODALS:{YOUTUBE_PROCESSED:"YouTube Video Processed",CONFIRM_OPEN:c=>`Successfully processed YouTube video and saved as "${c}". Would you like to open the note now?`,CLOSE_CONFIRMATION:"Close without opening the note?",PROCESS_VIDEO:"YouTube Clipper",YES_OPEN:"Yes, open note",NO_THANKS:"No, thanks",CANCEL:"Cancel",PROCESS:"Process"},PLACEHOLDERS:{YOUTUBE_URL:"https://www.youtube.com/watch?v=...",GEMINI_KEY:"AIza...",GROQ_KEY:"gsk_...",OUTPUT_PATH:"YouTube/Processed Videos"},HELP:{API_KEY_HELP:"Get your API key from the provider's developer console",FORMAT_BRIEF:"A concise summary with key points",FORMAT_EXECUTIVE:"A comprehensive overview with main takeaways",FORMAT_DETAILED:"An in-depth guide with full details and examples",FORMAT_CUSTOM:"Use your own custom prompt template"}}});var z,ge,mt=K(()=>{"use strict";z={zIndex:"10000",display:"flex",header:{marginBottom:"20px",color:"#ffa500",fontSize:"28px",fontWeight:"700",textAlign:"center"},message:{marginBottom:"20px",lineHeight:"1.5"},buttonContainer:{marginTop:"20px",display:"flex",gap:"10px",justifyContent:"flex-end"},button:{padding:"8px 16px",minWidth:"100px"}},ge={width:"100%",marginTop:"8px",padding:"8px",border:"1px solid var(--background-modifier-border)",borderRadius:"4px"}});var gt=K(()=>{"use strict"});var S=K(()=>{"use strict";Z();ht();mt();gt()});var k,vt=K(()=>{"use strict";S();k=class c{static applyStyles(t,e){Object.assign(t.style,e)}static createButtonContainer(t){let e=t.createDiv();return this.applyStyles(e,z.buttonContainer),e}static createStyledButton(t,e,r=!1,i){let s=t.createEl("button",{text:e});return r&&s.classList.add("mod-cta"),this.applyStyles(s,z.button),i&&s.addEventListener("click",i),s}static createStyledInput(t,e,r,i=""){let s=t.createEl("input",{type:e,placeholder:r,value:i});return this.applyStyles(s,ge),s}static setupModalStyling(t){this.applyStyles(t,{zIndex:z.zIndex,display:z.display})}static createModalHeader(t,e){let r=t.createEl("h2",{text:e});return this.applyStyles(r,z.header),r}static createModalMessage(t,e){let r=t.createEl("p");return r.setText(e),this.applyStyles(r,z.message),r}static setupModalKeyHandlers(t,e,r){t.addEventListener("keydown",i=>{i.key==="Enter"&&(i.preventDefault(),i.stopPropagation(),e()),i.key==="Escape"&&r&&(i.preventDefault(),i.stopPropagation(),r())})}applyStyles(t,e){c.applyStyles(t,e)}createButtonContainer(t){return c.createButtonContainer(t)}createStyledButton(t,e,r=!1,i){return c.createStyledButton(t,e,r,i)}}});var Ce={};ut(Ce,{ConfirmationModal:()=>Qe});var Qe,le=K(()=>{"use strict";te();Qe=class extends D{constructor(e,r){super(e);this.options=r;this.result=!1}onOpen(){this.createModalContent(),this.setupEventHandlers(),this.focusConfirmButton()}createModalContent(){var a,l,d;this.createHeader(this.options.title).setAttribute("id","confirmation-modal-title");let r=this.contentEl.createDiv("confirmation-message");r.setAttribute("id","confirmation-modal-description"),r.textContent=this.options.message;let i=this.createButtonContainer();i.style.marginTop="20px";let s=(a=this.options.confirmText)!=null?a:"Confirm",n=(l=this.options.cancelText)!=null?l:"Cancel";((d=this.options.isDangerous)!=null?d:!1)?(this.cancelButton=this.createButton(i,n,!1,()=>this.handleCancel()),this.cancelButton.setAttribute("aria-label",`Cancel: ${n}`),this.confirmButton=this.createButton(i,s,!0,()=>this.handleConfirm()),this.confirmButton.setAttribute("aria-label",`Confirm: ${s}`)):(this.confirmButton=this.createButton(i,s,!0,()=>this.handleConfirm()),this.confirmButton.setAttribute("aria-label",`Confirm: ${s}`),this.cancelButton=this.createButton(i,n,!1,()=>this.handleCancel()),this.cancelButton.setAttribute("aria-label",`Cancel: ${n}`)),this.contentEl.setAttribute("aria-labelledby","confirmation-modal-title"),this.contentEl.setAttribute("aria-describedby","confirmation-modal-description"),this.contentEl.setAttribute("role","alertdialog")}setupEventHandlers(){this.scope.register([],"Enter",()=>(this.handleConfirm(),!1)),this.scope.register([],"Escape",()=>(this.handleCancel(),!1))}focusConfirmButton(){this.confirmButton&&setTimeout(()=>{var e;(e=this.confirmButton)==null||e.focus()},50)}handleConfirm(){this.result=!0,this.resolver&&this.resolver(!0),this.close()}handleCancel(){this.result=!1,this.resolver&&this.resolver(!1),this.close()}openAndWait(){return new Promise(e=>{this.resolver=e,this.open()})}getResult(){return this.result}}});var yt,re,D,te=K(()=>{"use strict";vt();S();S();yt=require("obsidian"),re={modal:"ytc-modal",header:"ytc-modal-header",content:"ytc-modal-content",button:"ytc-modal-button",input:"ytc-modal-input"},D=class extends yt.Modal{constructor(e){super(e);this.events={};this.isDisposed=!1;this.setupModalStyling(),this.setupConflictPrevention()}setupModalStyling(){k.setupModalStyling(this.modalEl),this.modalEl.addClass(re.modal),this.contentEl.addClass(re.content)}setupConflictPrevention(){this.modalEl.setAttribute("data-plugin","youtube-clipper"),this.modalEl.style.zIndex="9999"}createHeader(e){let r=k.createModalHeader(this.contentEl,e);return r.addClass(re.header),r}createMessage(e){return k.createModalMessage(this.contentEl,e)}createButtonContainer(){return k.createButtonContainer(this.contentEl)}createButton(e,r,i=!1,s){let n=k.createStyledButton(e,r,i,s);return n.addClass(re.button),n.setAttribute("data-plugin","youtube-clipper"),n.setAttribute("role","button"),n.getAttribute("aria-label")||n.setAttribute("aria-label",r),n}createInput(e,r,i){let s=e.createEl("input",{type:r,placeholder:i});return k.applyStyles(s,ge),s.addClass(re.input),s.setAttribute("data-plugin","youtube-clipper"),i&&s.setAttribute("aria-label",i),s}setupKeyHandlers(e,r){let i=async()=>{try{await e()}catch(n){}},s=r?async()=>{try{await r()}catch(n){}}:void 0;k.setupModalKeyHandlers(this.contentEl,i,s)}focusElement(e,r=ne.FOCUS_DELAY){setTimeout(()=>{e.focus()},r)}setEvents(e){this.events=e}confirmClose(e){return confirm(e)}async showConfirmationModal(e,r,i="Confirm",s="Cancel",n=!1){let{ConfirmationModal:o}=await Promise.resolve().then(()=>(le(),Ce));return new o(this.app,{title:e,message:r,confirmText:i,cancelText:s,isDangerous:n}).openAndWait()}forceVisible(){setTimeout(()=>{k.setupModalStyling(this.modalEl)},ne.REPAINT_DELAY)}onClose(){if(this.isDisposed)return;this.isDisposed=!0;let{contentEl:e}=this;e.empty(),this.modalEl.removeClass(re.modal),this.modalEl.removeAttribute("data-plugin")}}});var jt={};ut(jt,{default:()=>Ye});module.exports=Ot(jt);var We=(s=>(s[s.DEBUG=0]="DEBUG",s[s.INFO=1]="INFO",s[s.WARN=2]="WARN",s[s.ERROR=3]="ERROR",s[s.SILENT=4]="SILENT",s))(We||{}),ze=class c{constructor(t={}){this.logs=[];this.config={level:1,enableConsole:!0,enableFile:!1,maxLogEntries:1e3,enableTimestamps:!0,...t}}static getInstance(t){return c.instance||(c.instance=new c(t)),c.instance}static resetInstance(){c.instance=void 0}shouldLog(t){return t>=this.config.level}formatMessage(t){let e=We[t.level].padEnd(5),r=this.config.enableTimestamps?`[${t.timestamp.toISOString()}] `:"",i=t.context?` [${t.context}]`:"",s=t.data?` ${JSON.stringify(t.data)}`:"";return`${r}${e}${i} ${t.message}${s}`}addLogEntry(t,e,r,i){if(!this.shouldLog(t))return;let s={timestamp:new Date,level:t,message:e,context:r,data:i};if(this.logs.push(s),this.logs.length>this.config.maxLogEntries&&(this.logs=this.logs.slice(-this.config.maxLogEntries)),this.config.enableConsole){let n=this.formatMessage(s);switch(t){case 0:break;case 1:console.log(n);break;case 2:console.warn(n);break;case 3:console.error(n);break}}}debug(t,e,r){this.addLogEntry(0,t,e,r)}info(t,e,r){this.addLogEntry(1,t,e,r)}warn(t,e,r){this.addLogEntry(2,t,e,r)}error(t,e,r){this.addLogEntry(3,t,e,r)}getLogs(t,e){let r=this.logs;return t!==void 0&&(r=r.filter(i=>i.level===t)),e&&(r=r.filter(i=>i.context===e)),r}clearLogs(){this.logs=[]}setLevel(t){this.config.level=t}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t}}plugin(t,e){this.info(t,"Plugin",e)}aiService(t,e){this.info(t,"AIService",e)}videoService(t,e){this.info(t,"VideoService",e)}fileService(t,e){this.info(t,"FileService",e)}modal(t,e){this.info(t,"Modal",e)}performance(t,e){this.debug(t,"Performance",e)}},h=ze.getInstance();var M=class{static checkForPotentialConflicts(){let t=[];return['div[data-plugin="web-clipper"]',".web-clipper-modal"].forEach(r=>{let i=document.querySelectorAll(r);Array.from(i).filter(n=>!n.hasAttribute("data-plugin")||n.getAttribute("data-plugin")!==this.PLUGIN_ID).length>0&&t.push(`Detected potential plugin conflict: ${r}`)}),t}static markElement(t,e){t.setAttribute("data-plugin",this.PLUGIN_ID),t.setAttribute("data-ytc-type",e),t.addClass(`${this.CSS_PREFIX}-${e}`)}static unmarkElement(t){t.removeAttribute("data-plugin"),t.removeAttribute("data-ytc-type"),Array.from(t.classList).forEach(r=>{r.startsWith(this.CSS_PREFIX)&&t.removeClass(r)})}static createUniqueId(t){return`${this.CSS_PREFIX}-${t}-${Date.now()}`}static cleanupAllElements(){document.querySelectorAll(`[data-plugin="${this.PLUGIN_ID}"]`).forEach(e=>{e instanceof HTMLElement&&this.unmarkElement(e)})}static getStorageKey(t){return`${this.PLUGIN_ID}-${t}`}static log(t,e="info"){let r=new Date().toISOString(),i=`[${this.PLUGIN_ID}] ${r} - ${t}`;switch(e){case"warn":h.warn(i,"ConflictPrevention");break;case"error":h.error(i,"ConflictPrevention");break;default:h.info(i,"ConflictPrevention")}}static isSafeToOperate(){let t=this.checkForPotentialConflicts();return t.length>0?(this.log(`Potential conflicts detected: ${t.join(", ")}`,"warn"),!1):!0}static async safeOperation(t,e){try{this.log(`Starting ${e}`);let r=await t();return this.log(`Completed ${e}`),r}catch(r){throw this.log(`Error in ${e}: ${r}`,"error"),r}}};M.PLUGIN_ID="youtube-clipper",M.CSS_PREFIX="ytc";S();var oe=require("obsidian");var w=class c{static classifyError(t){let e=t.message.toLowerCase();if(e.includes("network")||e.includes("fetch")||e.includes("connection")||e.includes("timeout")||e.includes("econnrefused")||e.includes("enotfound"))return{category:"network",message:f.ERRORS.NETWORK_ERROR,retryable:!0,retryDelay:2e3,userGuidance:"Check your internet connection and try again."};if(this.isQuotaError(t)){let r=this.extractProviderName(t);return{category:"quota",message:e.includes("rate")?f.ERRORS.RATE_LIMITED(r):f.ERRORS.QUOTA_EXCEEDED(r),retryable:e.includes("rate"),retryDelay:e.includes("rate")?6e4:void 0,userGuidance:e.includes("rate")?"Wait a minute before trying again.":"Check your API plan or try a different provider."}}return e.includes("401")||e.includes("403")||e.includes("unauthorized")||e.includes("invalid key")||e.includes("invalid api key")||e.includes("authentication")?{category:"auth",message:"API key is invalid or expired. Please check your settings.",retryable:!1,userGuidance:"Verify your API key in the plugin settings."}:e.includes("invalid url")||e.includes("video id")||e.includes("not found")||e.includes("unavailable")?{category:"validation",message:t.message,retryable:!1,userGuidance:"Check the video URL and try again."}:e.includes("model")||e.includes("context length")||e.includes("too long")||e.includes("token")?{category:"provider",message:t.message,retryable:!1,userGuidance:"Try a different model or shorter video."}:{category:"unknown",message:t.message,retryable:!0,retryDelay:3e3,userGuidance:"An unexpected error occurred. Please try again."}}static handle(t,e,r=!0){r&&new oe.Notice(`Error: ${t.message}`)}static handleWithGuidance(t,e){let r=this.classifyError(t),i=r.userGuidance?`${r.message}

\u{1F4A1} ${r.userGuidance}`:r.message,s=r.retryable?5e3:8e3;return new oe.Notice(i,s),r}static async withErrorHandling(t,e,r=!0){try{return await t()}catch(i){return this.handle(i,e,r),null}}static withSyncErrorHandling(t,e,r=!0){try{return t()}catch(i){return this.handle(i,e,r),null}}static createAPIError(t,e,r,i){let s=`${t} API error: ${e} ${r}${i?`. ${i}`:""}`;return new Error(s)}static async handleAPIError(t,e,r){var s,n,o,a;let i=r!=null?r:"";try{let l=await t.json();i=(a=(o=(n=(s=l.error)==null?void 0:s.message)!=null?n:l.message)!=null?o:r)!=null?a:""}catch(l){}throw this.createAPIError(e,t.status,t.statusText,i)}static validateConfiguration(t,e){let r=e.filter(i=>!t[i]);if(r.length>0)throw new Error(`Missing required configuration: ${r.join(", ")}`)}static createUserFriendlyError(t,e){let r=`Failed to ${e}: ${t.message}`;return new Error(r)}static handleQuotaError(t,e){let r=t.message.toLowerCase(),i="",s=!1;if(r.includes("quota")||r.includes("limit")||r.includes("exceeded")?r.includes("rate")||r.includes("too many requests")?(i=f.ERRORS.RATE_LIMITED(e),s=!0):r.includes("billing")||r.includes("payment")?i=f.ERRORS.BILLING_REQUIRED(e):r.includes("credit")||r.includes("balance")?i=f.ERRORS.CREDIT_EXHAUSTED(e):(i=f.ERRORS.QUOTA_EXCEEDED(e),s=!0):i=f.ERRORS.QUOTA_EXCEEDED(e),s){let n=new oe.Notice(i,0);setTimeout(()=>{let a=n.noticeEl.createEl("button",{text:"Retry",cls:"mod-cta"});a.style.marginLeft="10px",a.onclick=()=>{n.hide(),window.dispatchEvent(new CustomEvent("yt-clipper-retry-processing"))}},100)}else new oe.Notice(i,8e3)}static isQuotaError(t){let e=t.message.toLowerCase(),r=["quota exceeded","rate limit","rate_limit","too many requests","billing required","payment required","credit exhausted","insufficient credits","insufficient balance","usage limit","api limit exceeded","requests per minute","requests per second","resource_exhausted"];return e.includes("429")?!0:r.some(i=>e.includes(i))}static extractProviderName(t,e="AI Service"){let r=t.message.toLowerCase();return r.includes("gemini")||r.includes("google")?"Google Gemini":r.includes("groq")?"Groq":r.includes("openai")?"OpenAI":e}static handleEnhanced(t,e,r=!0){if(this.isQuotaError(t)){let i=this.extractProviderName(t);this.handleQuotaError(t,i);return}this.handle(t,e,r)}handle(t,e,r=!0){c.handle(t,e,r)}async withErrorHandling(t,e){return c.withErrorHandling(t,e)}};var fe=class{constructor(){this.state={isModalOpen:!1}}canOpenModal(t){return this.state.isModalOpen?t&&t!==this.state.pendingModalUrl?{canOpen:!1,reason:"Modal already open with different URL"}:{canOpen:!1,reason:"Modal already open with same URL"}:{canOpen:!0}}async openModal(t,e,r){let i=Math.random().toString(36).substring(2,9);this.state.lastCallId=i,h.info("Modal opening requested","ModalManager",{callId:i,url:t,currentState:{...this.state}});let{canOpen:s,reason:n}=this.canOpenModal(t);if(!s)return h.warn(`Modal open rejected: ${n}`,"ModalManager",{callId:i,url:t,reason:n,pendingUrl:this.state.pendingModalUrl}),t&&t!==this.state.pendingModalUrl&&(h.info("Updating pending modal URL","ModalManager",{oldUrl:this.state.pendingModalUrl,newUrl:t}),this.state.pendingModalUrl=t),null;this.state.isModalOpen=!0,this.state.pendingModalUrl=t,h.info("Modal state set to open","ModalManager",{callId:i,url:t});try{h.info("About to open modal","ModalManager",{callId:i,url:t});let o=await e(),a=setTimeout(()=>{this.state.isModalOpen&&this.state.pendingModalUrl===t&&(h.warn("Fallback modal state reset triggered","ModalManager",{callId:i,url:t}),this.resetModalState())},1e4);return o&&typeof o=="object"?o._fallbackTimeout=a:(h.debug("Modal result is not an object, clearing fallback timeout","ModalManager",{callId:i,url:t,resultType:typeof o}),clearTimeout(a)),setTimeout(()=>{h.debug("Modal state after 100ms","ModalManager",{callId:i,isModalOpen:this.state.isModalOpen})},100),o}catch(o){throw h.error("Error opening modal","ModalManager",{callId:i,url:t,error:o instanceof Error?o.message:String(o)}),this.resetModalState(),o}}resetModalState(){h.debug("Resetting modal state","ModalManager",{previousState:{...this.state}}),this.state.isModalOpen=!1,this.state.pendingModalUrl=void 0}forceResetModalState(){h.warn("Force resetting modal state","ModalManager",{previousState:{...this.state}}),this.state={isModalOpen:!1}}getState(){return{...this.state}}isModalOpen(){return this.state.isModalOpen}getPendingModalUrl(){return this.state.pendingModalUrl}clear(){this.forceResetModalState(),h.info("Modal manager cleared","ModalManager")}};S();var y=class{static cleanYouTubeUrl(t){if(!t||typeof t!="string")return"";let e=t.trim();return e=e.replace(/[\u200B-\u200D\uFEFF]/g,""),!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`https://${e}`),(e.startsWith("http://youtube.com")||e.startsWith("http://www.youtube.com"))&&(e=e.replace("http://","https://")),e}static extractVideoId(t){if(!t||typeof t!="string")return null;if(this.URL_CACHE.has(t)){let n=this.URL_CACHE.get(t);return n!=null?n:null}let e=this.cleanYouTubeUrl(t),r=null,i=this.URL_PATTERNS[0],s=i?e.match(i):null;if(s!=null&&s[1]&&this.VIDEO_ID_REGEX.test(s[1]))r=s[1];else for(let n=1;n<this.URL_PATTERNS.length&&!r;n++){let o=this.URL_PATTERNS[n];s=o?e.match(o):null,s!=null&&s[1]&&this.VIDEO_ID_REGEX.test(s[1])&&(r=s[1])}return this.URL_CACHE.size>100&&this.URL_CACHE.clear(),this.URL_CACHE.set(t,r),r}static isValidYouTubeUrl(t){return this.extractVideoId(t)!==null}static sanitizeFilename(t,e=100){return t.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim().substring(0,e)}static isValidAPIKey(t,e){if(!t||typeof t!="string")return!1;switch(e){case"gemini":return t.startsWith("AIza")&&t.length>10;case"groq":return t.startsWith("gsk_")&&t.length>10;default:return!1}}static validateSettings(t){let e=[],r=!!t.useEnvironmentVariables;return!(this.isNonEmptyString(t.geminiApiKey)||this.isNonEmptyString(t.groqApiKey))&&!r&&e.push(f.ERRORS.MISSING_API_KEYS),this.isNonEmptyString(t.geminiApiKey)&&!this.isValidAPIKey(t.geminiApiKey,"gemini")&&e.push("Invalid Gemini API key format"),this.isNonEmptyString(t.groqApiKey)&&!this.isValidAPIKey(t.groqApiKey,"groq")&&e.push("Invalid Groq API key format"),r&&!this.isNonEmptyString(t.environmentPrefix)&&e.push("Environment variable prefix is required when using environment variables"),(!t.outputPath||typeof t.outputPath!="string")&&e.push("Output path is required"),{isValid:e.length===0,errors:e}}static isValidPath(t){return typeof t=="string"&&t.trim().length>0}static isNonEmptyString(t){return typeof t=="string"&&t.trim().length>0}static truncateText(t,e){return t.length<=e?t:`${t.substring(0,e-3)}...`}static cleanText(t){return t.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\u([0-9a-fA-F]{4})/g,(e,r)=>String.fromCharCode(parseInt(r,16)))}};y.URL_PATTERNS=[/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]{11})(?:[&?#].*)?$/,/(?:https?:\/\/)?(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]{11})(?:[?#].*)?$/,/(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]{11})(?:[?#].*)?$/,/(?:https?:\/\/)?(?:www\.)?youtube\.com\/v\/([a-zA-Z0-9_-]{11})(?:[?#].*)?$/,/(?:https?:\/\/)?(?:m\.)?youtube\.com\/watch\?.*v=([a-zA-Z0-9_-]{11})(?:[&?#].*)?$/,/(?:https?:\/\/)?(?:www\.|m\.)?youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})(?:[?#].*)?$/],y.VIDEO_ID_REGEX=/^[a-zA-Z0-9_-]{11}$/,y.URL_CACHE=new Map;var ve={MAX_TRANSCRIPT_LENGTH:1e5,MAX_PROMPT_LENGTH:5e4,MIN_PROMPT_LENGTH:10},N={TITLE:"{{TITLE}}",URL:"{{URL}}",DESCRIPTION:"{{DESCRIPTION}}",TRANSCRIPT_SECTION:"{{TRANSCRIPT_SECTION}}",USER_INSTRUCTIONS:"{{USER_INSTRUCTIONS}}",AI_PROVIDER:"__AI_PROVIDER__",AI_MODEL:"__AI_MODEL__"},je={VIDEO_ID:"unknown",PROVIDER:"unknown",MODEL:"unknown"},ye={BASE_URL:"https://www.youtube-nocookie.com/embed/",IFRAME_WIDTH:640,IFRAME_HEIGHT:360,IFRAME_ATTRIBUTES:['allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"',"allowfullscreen",'frameborder="0"','referrerpolicy="strict-origin-when-cross-origin"'].join(" ")},be;(e=>(e.frontmatter=(r,i,s,n,o,a)=>`---
title: ${r}
source: ${i}
created: "${new Date().toISOString().split("T")[0]}"
type: ${n==="complete-transcription"?"youtube-transcript":"youtube-note"}
format: ${n}
tags: [youtube${n==="complete-transcription"?", transcript":""}]
video_id: "${s}"
ai_provider: "${o}"
ai_model: "${a}"
---`,e.videoIframe=(r,i)=>{let s=`${ye.BASE_URL}${r}`;return`<div style="text-align: center; margin-bottom: 24px;">
<iframe width="${ye.IFRAME_WIDTH}" height="${ye.IFRAME_HEIGHT}" src="${s}" title="${i}" ${ye.IFRAME_ATTRIBUTES}></iframe>
</div>`}))(be||(be={}));var Lt={fast:`Analyze this YouTube video efficiently:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}
{{TRANSCRIPT_SECTION}}

**OUTPUT FORMAT RULES:**
- DO NOT add line numbers to any part of the output
- Use markdown headers (##, ###) for structure, not numbered lines
- Numbered lists are for content only (steps, items), not for line references

Focus on key insights. Process video with \`use_audio_video_tokens=True\` for comprehensive analysis.`,balanced:`Analyze this YouTube video:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}
{{TRANSCRIPT_SECTION}}

**OUTPUT FORMAT RULES:**
- DO NOT add line numbers to any part of the output
- Use markdown headers (##, ###) for structure, not numbered lines
- Numbered lists are for content only (steps, items), not for line references

Extract practical insights. Process video multimodally (visual/audio) for complete analysis.`,quality:`Analyze this YouTube video comprehensively:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}
{{TRANSCRIPT_SECTION}}

**OUTPUT FORMAT RULES:**
- DO NOT add line numbers to any part of the output
- Use markdown headers (##, ###) for structure, not numbered lines
- Numbered lists are for content only (steps, items), not for line references
- Process multimodally (visual/audio) for complete understanding including on-screen text and non-verbal cues`},_t={"concise-summary":`# Concise Summary

## Core Summary (<150 words)
- **Main Point**: Central thesis or key message
- **Key Takeaway**: Primary insight or value proposition
- **Immediate Application**: Quick action item or use case

## Power Takeaways (5 points)
- **[Insight 1]**: Actionable takeaway
- **[Insight 2]**: Strategic point
- **[Insight 3]**: Practical application
- **[Insight 4]**: Resource or tool mentioned
- **[Insight 5]**: Mindset shift or perspective

## Quick Actions
- [ ] **[Action 1]**: Implementation step
- [ ] **[Action 2]**: Resource to explore
- [ ] **[Action 3]**: Concept to research further`,"executive-summary":`# Executive Summary

## Strategic Insights (3-5 high-impact takeaways)
- **[Category]**: Actionable intelligence with measurable impact
- **Business Implication**: Competitive or operational effect
- **Risk Factor**: Potential challenges to consider
- **Opportunity Window**: Timing-sensitive opportunity

## Executive Summary (200-250 words)
**Core Value**: [Central thesis]

**Analysis**:
- **Market Context**: Industry positioning
- **Competitive Advantage**: Key differentiators
- **Implementation**: Adoption considerations
- **Success Metrics**: Measurement approach

## Strategic Action Plan
- [ ] **[Initiative 1]**: Implementation with timeline
- [ ] **[Initiative 2]**: Risk mitigation or opportunity
- [ ] **[Initiative 3]**: Capability building
- [ ] **[Monitor]**: Key success indicators

## Intelligence Repository
**Cited**: Technologies, research, experts, external links
**Related**: Adjacent opportunities, future trends`,"step-by-step-tutorial":`# Step-by-Step Tutorial

## Overview (200-250 words)
- **Objective**: What you'll accomplish
- **Scope**: What's covered and what's not
- **Outcome**: Final result
- **Time Investment**: Estimated duration

## Prerequisites
- **Tools Required**: Software/hardware needed
- **Knowledge Needed**: Foundational skills
- **Setup**: Configuration requirements
- **Resources**: Materials to download

## Step-by-Step Implementation

### Phase 1: Foundation
1. **[Step Name]**: Action with specific details
   - **Expected Result**: Success indicator
   - **Troubleshooting**: Common issues and fixes

### Phase 2: Implementation
2. **[Step Name]**: Core action with dependencies
   - **Verification**: How to confirm it works
   - **Integration**: Connection to previous steps

### Phase 3: Refinement
3. **[Step Name]**: Enhancement or optimization
   - **Performance**: What to monitor
   - **Scaling**: Expansion considerations

## Critical Success Factors
- **Common Pitfalls**: Mistakes to avoid
- **Key Decisions**: Important choice points
- **Timing**: When to take action
- **Resources**: Effort allocation

## Resources
- **Links**: Tools, documentation, references
- **Templates**: Reusable components
- **Further Learning**: Advanced topics`,"technical-analysis":`# Technical Analysis

**Constraint**: Ignore intros, sponsors, "like and subscribe". Extract technical substance only.

## Tech Stack & Tools
- **Languages/Frameworks**: All with specific versions
- **Libraries**: Dependencies with versions
- **Environment**: Hardware, cloud, or configuration

## Architecture & Design
- **Structure**: System architecture overview
- **Patterns**: Design patterns used (CQRS, Event Sourcing, etc.)
- **Data Flow**: Client to database movement

## Implementation Details
- **Commands/Config**: Specific commands or settings
- **Pseudo-code**: Generated logic when described but not shown
- **Refactoring**: Before/After optimizations

## Engineering Trade-offs
- **Problem Solved**: Specific technical challenge addressed
- **Hot Takes**: Strong technical opinions
- **Trade-offs**: Performance/cost/complexity decisions

## Reproduction Steps
1. **[Action]**: Specific command or action
2. **[Action]**: Next step with dependencies
3. **[Action]**: Verification step`,"3c-accelerated-learning":`# 3C Accelerated Learning

**Compress \u2192 Compile \u2192 Consolidate**: Transform video into lasting knowledge.

## \u{1F539} COMPRESS (80/20 Rule)
The vital 20% delivering 80% value:
- **Core Thesis**: Fundamental message in 1-2 sentences
- **Key Concepts** (5-7): Precise definitions
- **Mental Models**: Visual analogies and metaphors
- **Visuals**: Descriptions of diagrams/demonstrations

## \u{1F538} COMPILE (Active Application)
- **Framework**: Organized understanding structure
- **Workflow**: Step-by-step implementation checklist
- **Tools/Resources**: Every app, book, site, hardware mentioned
- **Connections**: How concepts relate to each other

## \u{1F539} CONSOLIDATE (Retention & Transfer)
- **Master Model**: Unifying framework integrating all concepts
- **Recall Anchors**: 6-8 challenging comprehension questions
- **Action Roadmap**: 4-6 measurable next steps with timelines
- **Cross-References**: Related concepts and adjacent fields
- **Success Metrics**: Quantifiable impact indicators

**Transfer Acceleration**:
- **Adaptation**: How to modify for different scenarios
- **Obstacles**: Anticipated challenges and solutions
- **Compound Effect**: How small changes create disproportionate impact`,"complete-transcription":`# Complete Transcription

**CRITICAL**:
- If transcript provided: Include FULL transcript below
- If NO transcript: State "Transcript Not Available: Based on title/description, this video covers:" followed by analysis
- **DO NOT include line numbers, timestamps, or numbering in the transcript**
- Process multimodally (visual/audio) for complete extraction

## Summary (<250 words)
[Core message and main value points]

## Full Transcript

**Structure Guidelines**:
- **NO line numbers, timestamps, or numbering**
- **Sections**: Logical topic segments with ### headers
- **Clean dialogue**: Remove filler words ("um", "uh", "like")
- **Speaker labels**: Format as **[Name]:** with dialogue
- **Readability**: Paragraph breaks between thoughts
- **Emphasis**: **Bold** for key terms, *italics* for visual descriptions
- **Code**: Inline \`code\` for commands/URLs
- **Resources**: Link as [Name](URL)

**Example Format**:
### Introduction
**[Speaker]:** Opening remarks and topic introduction.

**Key Point:** Main thesis statement.

### Main Content
1. First point with explanation
2. Second point with details

*[Visual: Diagram description]*

### Resources
- [Resource 1](https://example.com)

### Conclusion
Final thoughts and key takeaways`},ee=class{createAnalysisPrompt(t){var u;let{videoData:e,videoUrl:r,format:i="step-by-step-tutorial",transcript:s,performanceMode:n="balanced"}=t,o=(u=y.extractVideoId(r))!=null?u:je.VIDEO_ID,a=N.AI_PROVIDER,l=N.AI_MODEL,d=this.buildBaseContent(e,r,s,n);return this.buildFullPrompt(d,e,r,o,i,a,l)}buildBaseContent(t,e,r,i="balanced"){let s=Lt[i],n=this.buildTranscriptSection(r);return this.replacePlaceholders(s,{[N.TITLE]:t.title,[N.URL]:e,[N.DESCRIPTION]:t.description,[N.TRANSCRIPT_SECTION]:n})}buildTranscriptSection(t){return t!=null&&t.trim()?`
VIDEO CONTENT/TRANSCRIPT:
${t.length>ve.MAX_TRANSCRIPT_LENGTH?`${t.slice(0,ve.MAX_TRANSCRIPT_LENGTH)}... [transcript truncated]`:t}`:""}buildFullPrompt(t,e,r,i,s,n,o,a){let l=be.frontmatter(e.title,r,i,s,n,o),d=be.videoIframe(i,e.title),u=`---

`,p=this.buildFormatTemplate(s,a);return`${l}

${d}

${u}${t}

${p}`}buildFormatTemplate(t,e){return _t[t]}replacePlaceholders(t,e){let r=t;for(let[i,s]of Object.entries(e)){let n=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");r=r.replace(new RegExp(n,"g"),s)}return r}processAIResponse(t,e,r,i,s,n){if(!t)return t;let o=e!=null?e:je.PROVIDER,a=r!=null?r:je.MODEL,l=this.replacePlaceholders(t,{[N.AI_PROVIDER]:o,[N.AI_MODEL]:a});return l=this.ensureFrontMatterValue(l,"ai_provider",o),l=this.ensureFrontMatterValue(l,"ai_model",a),n&&(l=this.appendResourcesSection(l,n,o,a)),l}appendResourcesSection(t,e,r,i){let s=new Date().toISOString().split("T")[0],n=`

## Resources
- Video URL: ${e}
- Processing Date: ${s}
- Provider: ${r} ${i}
`;return t.trimEnd()+n}ensureFrontMatterValue(t,e,r){let i=new RegExp(`(${e}\\s*:\\s*)(["'])?([^"'\\n]*)(["'])?`,"i");return i.test(t)?t.replace(i,(s,n,o,a,l)=>{let d=(o!=null?o:l)?'"':"";return`${n}${d}${r}${d}`}):t.startsWith("---")?t.replace(/^---\s*\n/,`---
${e}: "${r}"
`):t}createSummaryPrompt(t,e){return`Create a concise summary for this YouTube video:

Title: ${t.title}
URL: ${e}
Description: ${t.description}

Please provide:
1. A 2-paragraph summary (max 250 words)
2. 3-5 key takeaways
3. Main actionable insights

Format as markdown with clear headings.`}validatePrompt(t){return!!t&&typeof t=="string"&&t.trim().length>=ve.MIN_PROMPT_LENGTH&&t.length<=ve.MAX_PROMPT_LENGTH}};ee.FRONTMATTER_KEY_PATTERN=/(\w+)\s*:\s*(["'])?([^"'\n]*)(["'])?/gi,ee.PLACEHOLDER_PATTERN=/__(AI_PROVIDER|AI_MODEL)__/g;Z();var Ee=class{constructor(t,e){this.settings=e;this.providerMap=new Map;if(!t||t.length===0)throw new Error("At least one AI provider is required");t.forEach(r=>this.providerMap.set(r.name,r))}async process(t,e){if(!t||typeof t!="string")throw new Error("Valid prompt is required");let r=this.getFirstProvider();return{content:await r.process(t),provider:r.name,model:r.model||"default"}}async processWith(t,e,r,i,s=!0){let n=this.providerMap.get(t);if(!n)throw new Error(`Provider "${t}" not found`);r&&n.setModel&&n.setModel(r);try{return{content:await n.process(e),provider:n.name,model:n.model||"default"}}catch(o){if(s){for(let[a,l]of this.providerMap)if(a!==t)try{return{content:await l.process(e),provider:l.name,model:l.model||"default"}}catch(d){continue}}throw o}}getProviderNames(){return Array.from(this.providerMap.keys())}hasAvailableProviders(){return this.providerMap.size>0}getProviderModels(t){var r;return((r=X[t])!=null?r:[]).map(i=>typeof i=="string"?i:i.name)}async fetchLatestModels(){let t={};for(let e of this.getProviderNames())t[e]=this.getProviderModels(e);return t}async fetchLatestModelsForProvider(t,e){return this.getProviderModels(t)}updateSettings(t){this.settings=t}addProvider(t){this.providerMap.set(t.name,t)}removeProvider(t){return this.providerMap.delete(t)}getPerformanceMetrics(){return{providerCount:this.providerMap.size,providers:this.getProviderNames()}}cleanup(){for(let t of this.providerMap.values())if(typeof t.cleanup=="function")try{t.cleanup()}catch(e){}this.providerMap.clear()}getFirstProvider(){let t=this.providerMap.values().next().value;if(!t)throw new Error("No AI providers available");return t}};S();var C=class{constructor(t,e,r){this.apiKey=t;this._timeout=3e4;this._maxTokens=2048;this._temperature=.7;this._model=e!=null?e:"",r&&(this._timeout=r)}get model(){return this._model}get timeout(){return this._timeout}get maxTokens(){return this._maxTokens}get temperature(){return this._temperature}setModel(t){this._model=t}setTimeout(t){this._timeout=t}setMaxTokens(t){this._maxTokens=t}setTemperature(t){this._temperature=t}async processWithTimeout(t,e){let r=e!=null?e:this._timeout,i=new Promise((n,o)=>{setTimeout(()=>{o(new Error(`${this.name} request timed out after ${r}ms`))},r)}),s=this.process(t);return Promise.race([s,i])}validateResponse(t,e){let r=t;for(let i of e){if(!r||typeof r!="object"||!(i in r))return!1;r=r[i]}return r!=null}async safeJsonParse(t){try{return await t.json()}catch(e){return null}}async handleAPIError(t){return w.handleAPIError(t,this.name)}};S();function Dt(c){let t=[/retry in ([\d.]+)s/i,/retry in ([\d.]+) seconds?/i,/(\d+)\s*seconds?/i];for(let e of t){let r=c.match(e);if(r!=null&&r[1])return` Retry in ${Math.ceil(parseFloat(r[1]))}s.`}return""}function we(c,t){return t.some(e=>c.includes(e))}function ae(c,t){let e=Dt(c),r=c.toLowerCase();return we(r,["free tier","free_tier","limit: 0"])?`${t} free tier quota exhausted.${e} Upgrade your plan or wait for quota reset.`:we(r,["tokens per minute","tokens per second"])?`${t} rate limit reached.${e} Try a shorter video or wait.`:we(r,["requests per minute","requests per second"])?`${t} request limit reached.${e}`:we(r,["quota exceeded","quota"])?`${t} API quota exceeded.${e} Check your usage.`:r.includes("rate limit")?`${t} rate limit reached.${e} Wait a moment before retrying.`:`${t} API limit reached.${e}`}function Te(c,t){switch(c){case 400:return`${t}: Invalid request. Check model configuration.`;case 401:return`${t}: Invalid API key. Check your credentials.`;case 403:return`${t}: Access denied. Check your API key permissions.`;case 404:return`${t}: Model not found. Check the model name.`;case 429:return`${t}: Rate limit exceeded. Wait before retrying.`;case 500:case 502:case 503:return`${t}: Service temporarily unavailable. Try again.`;default:return`${t}: HTTP error ${c}.`}}var Pe=class extends C{constructor(e,r,i){super(e,r!=null?r:me.GEMINI,i);this.name="Google Gemini"}async process(e){var r,i,s,n,o,a,l;try{if(!this.apiKey||this.apiKey.trim().length===0)throw new Error(f.ERRORS.GEMINI_INVALID_KEY);let d=await fetch(`${V.GEMINI}?key=${this.apiKey}`,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e))});if(d.status===400){let p=await this.safeJsonParse(d),m=(i=(r=p==null?void 0:p.error)==null?void 0:r.message)!=null?i:"Bad request";throw new Error(`Gemini API error: ${m}. Try checking the model configuration.`)}if(d.status===401)throw new Error(f.ERRORS.GEMINI_INVALID_KEY);if(d.status===403){let p=await this.safeJsonParse(d),m=(n=(s=p==null?void 0:p.error)==null?void 0:s.message)!=null?n:"";throw m.toLowerCase().includes("quota")||m.toLowerCase().includes("billing")?new Error(ae(m,"Gemini")):new Error("Gemini API access denied. Please verify your API key has access to this model.")}if(d.status===429){let p=await this.safeJsonParse(d),m=(a=(o=p==null?void 0:p.error)==null?void 0:o.message)!=null?a:"";throw new Error(ae(m,"Gemini"))}if(!d.ok)throw new Error(Te(d.status,"Gemini"));let u=await d.json();if(!((l=u.candidates)!=null&&l.length))throw new Error("No response candidates returned from Gemini API");if(u.candidates[0].finishReason==="SAFETY")throw new Error("Response blocked by Gemini safety filters. Try rephrasing.");if(!this.validateResponse(u,["candidates","0","content","parts","0","text"]))throw new Error("Invalid response format from Gemini API");return this.extractContent(u)}catch(d){throw d instanceof Error?d:new Error(`Gemini processing failed: ${d}`)}}createHeaders(){return{"Content-Type":"application/json"}}createRequestBody(e){var n,o;let r=e.toLowerCase(),i=r.includes("youtube video")||r.includes("youtu.be/")||r.includes("youtube.com/"),s={contents:[{parts:[{text:e}]}],generationConfig:{temperature:this._temperature,maxOutputTokens:this._maxTokens,candidateCount:1}};if(i){let a=(n=X["Google Gemini"])!=null?n:[],l=String((o=this.model)!=null?o:"").toLowerCase();a.find(p=>{let m=typeof p=="string"?p:p!=null&&p.name?p.name:"";return String(m).toLowerCase()===l});let d={...s,systemInstruction:{parts:[{text:`You are an expert video content analyzer. Provide comprehensive, multimodal analysis using:
\u2022 AUDIO STREAM: Transcribe all spoken content, identify speakers, capture tone/emphasis/emotion
\u2022 VIDEO STREAM: Analyze visual elements, text overlays, diagrams, slides, gestures, scene changes, and visual demonstrations
\u2022 INTEGRATED INSIGHTS: Synthesize audio and visual data to provide complete understanding

For best results:
- Prioritize accuracy in transcription and speaker identification- Extract and explain key concepts shown visually
- Note timing relationships between audio and visual elements
- Identify visual cues that reinforce or clarify spoken content`}]}},u=e.match(/(gs:\/\/[\w-./]+\.(?:mp4|mov|mkv|webm))/i);if(u!=null&&u[1]){let p=u[1];d.contents=d.contents||[],d.contents.push({parts:[{fileData:{fileUri:p,mimeType:"video/mp4"}}]})}return d}return s}extractContent(e){var i,s,n;let r=(n=(s=(i=e.candidates[0])==null?void 0:i.content)==null?void 0:s.parts[0])==null?void 0:n.text;return r?r.trim():""}};S();S();var Se=class extends C{constructor(e,r,i){super(e,r!=null?r:me.GROQ,i);this.name="Groq"}async process(e){var s,n,o;let r=await fetch(V.GROQ,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e))});if(r.status===401)throw new Error("Groq API key is invalid or missing. Please check your key.");if(r.status===402)throw new Error("Groq API requires a paid plan. Please check your billing settings.");if(r.status===404)throw new Error(f.ERRORS.GROQ_MODEL_NOT_FOUND);if(r.status===429){let a="";try{let l=await r.json();a=(o=(n=(s=l==null?void 0:l.error)==null?void 0:s.message)!=null?n:l==null?void 0:l.message)!=null?o:""}catch(l){}throw new Error(ae(a,"Groq"))}if(!r.ok)throw new Error(Te(r.status,"Groq"));let i=await r.json();if(!this.validateResponse(i,["choices","0","message"]))throw new Error("Invalid response format from Groq API");return this.extractContent(i)}createHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`}}createRequestBody(e){return{model:this.model,messages:[{role:"system",content:"You are an expert content analyzer specializing in extracting practical value and creating actionable guides from video content. Focus on clarity, practicality, and immediate implementability. Even with limited information, provide maximum value through structured analysis and practical recommendations."},{role:"user",content:e}],temperature:this._temperature,max_tokens:this._maxTokens,stream:!1}}extractContent(e){var i,s;let r=(s=(i=e.choices[0])==null?void 0:i.message)==null?void 0:s.content;return r?r.trim():""}};var Ft="https://router.huggingface.co/hf-inference/models";function ft(c){var r;let t=(r=c.match(/retry in ([\d.]+)/i))!=null?r:c.match(/(\d+)\s*seconds?/i),e=t?` Retry in ${Math.ceil(parseFloat(t[1]))}s.`:"";return c.toLowerCase().includes("rate limit")?`Hugging Face rate limit reached.${e}`:c.toLowerCase().includes("loading")?"Model is loading. Wait ~20s and try again.":c.toLowerCase().includes("paused")?"Model endpoint is paused. Try a different model like Qwen/Qwen3-8B":c.toLowerCase().includes("quota")?`Hugging Face quota exceeded.${e}`:c||"Hugging Face API error"}var Ae=class extends C{constructor(e,r,i){super(e,r!=null?r:"Qwen/Qwen3-8B",i);this.name="Hugging Face"}async process(e){var r,i,s;try{if(!this.apiKey||this.apiKey.trim().length===0)throw new Error("Hugging Face API key is required. Get one at huggingface.co/settings/tokens");if(!((r=this._model)!=null&&r.includes("/")))throw new Error(`Invalid model format: ${this._model}. Use format: owner/model-name`);let n=new AbortController,o=setTimeout(()=>n.abort(),(i=this._timeout)!=null?i:6e4),a=await fetch(`${Ft}/${this._model}`,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e)),signal:n.signal});if(clearTimeout(o),((s=a.headers.get("content-type"))!=null?s:"").includes("text/html"))throw a.status===401?new Error("Hugging Face API key is invalid or expired."):new Error(`Hugging Face returned an error page (${a.status}). Check your API key.`);if(a.status===401)throw new Error("Hugging Face API key is invalid. Please check your token.");if(a.status===400){let u=await this.safeJsonParse(a),p=(u==null?void 0:u.error)||"";throw new Error(ft(p))}if(a.status===403)throw new Error("Hugging Face access denied. Accept model terms at huggingface.co");if(a.status===404)throw new Error(`Model not found: ${this._model}. Check the model name at huggingface.co`);if(a.status===429){let u=await this.safeJsonParse(a),p=(u==null?void 0:u.error)||"";throw new Error(ft(p))}if(a.status===503){let u=await this.safeJsonParse(a),p=(u==null?void 0:u.estimated_time)||20;throw new Error(`Model is loading. Wait ${Math.ceil(p)}s and try again.`)}if(!a.ok){let u=await this.safeJsonParse(a),p=(u==null?void 0:u.error)||a.statusText;throw typeof p=="string"&&p.includes("router.huggingface.co")?new Error("HuggingFace API endpoint changed. Please update the plugin."):new Error(`Hugging Face error (${a.status}): ${p}`)}let d=await a.json();return this.extractContent(d)}catch(n){throw n instanceof Error?n.name==="AbortError"?new Error("Hugging Face request timed out. Try a smaller model."):n:new Error(`Hugging Face processing failed: ${n}`)}}createHeaders(){return{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"}}createRequestBody(e){return{inputs:e,parameters:{max_new_tokens:this._maxTokens,temperature:this._temperature,do_sample:!0},options:{wait_for_model:!0,use_cache:!0}}}extractContent(e){var r;if(Array.isArray(e)){let i=(r=e[0])==null?void 0:r.generated_text;return i?i.trim():""}if(e!=null&&e.generated_text)return String(e.generated_text).trim();throw new Error("Invalid response format from Hugging Face API")}};var Ut={maxSize:100,defaultTTL:3e5,cleanupInterval:6e4},xe=class{constructor(t={}){this.cache=new Map;this.accessOrder=new Map;this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0};this.accessCounter=0;this.config={...Ut,...t},this.config.cleanupInterval&&this.config.cleanupInterval>0&&(this.cleanupTimer=setInterval(()=>{this.cleanup()},this.config.cleanupInterval))}get(t){let e=this.cache.get(t);return e?Date.now()>e.expiresAt?(this.cache.delete(t),this.accessOrder.delete(t),this.metrics.misses++,this.metrics.size=this.cache.size,this.updateMetrics(),null):(e.lastAccessed=Date.now(),e.accessCount++,this.accessOrder.set(t,++this.accessCounter),this.metrics.hits++,this.updateMetrics(),e.data):(this.metrics.misses++,this.updateMetrics(),null)}set(t,e,r){let i=Date.now()+(r!=null?r:this.config.defaultTTL);if(this.cache.has(t)){this.cache.set(t,{data:e,expiresAt:i,lastAccessed:Date.now(),accessCount:1}),this.accessOrder.set(t,++this.accessCounter),this.metrics.size=this.cache.size;return}this.cache.size>=this.config.maxSize&&this.evictLRU(),this.cache.set(t,{data:e,expiresAt:i,lastAccessed:Date.now(),accessCount:1}),this.accessOrder.set(t,++this.accessCounter),this.metrics.size=this.cache.size}delete(t){let e=this.cache.delete(t);return this.accessOrder.delete(t),e&&(this.metrics.size=this.cache.size),e}clear(){this.cache.clear(),this.accessOrder.clear(),this.accessCounter=0,this.metrics.size=0}getMetrics(){return{...this.metrics}}getStats(){let t=1/0,e=0;for(let r of this.cache.values())r.lastAccessed<t&&(t=r.lastAccessed),r.lastAccessed>e&&(e=r.lastAccessed);return{metrics:this.getMetrics(),itemCount:this.cache.size,oldestAccess:t===1/0?0:t,newestAccess:e}}evictLRU(){let t=null,e=1/0;for(let[r,i]of this.accessOrder)i<e&&(e=i,t=r);t&&(this.cache.delete(t),this.accessOrder.delete(t),this.metrics.evictions++)}cleanup(){let t=Date.now(),e=[];for(let[r,i]of this.cache)t>i.expiresAt&&e.push(r);for(let r of e)this.cache.delete(r),this.accessOrder.delete(r);e.length>0&&(this.metrics.size=this.cache.size)}updateMetrics(){let t=this.metrics.hits+this.metrics.misses;this.metrics.hitRate=t>0?this.metrics.hits/t:0}destroy(){this.cleanupTimer&&clearInterval(this.cleanupTimer),this.clear()}};te();le();te();var Vt="A note with this title already exists. Choose how to proceed.",Ie=class extends D{constructor(e,r){super(e);this.file=r;this.decision="cancel"}onOpen(){this.createHeader("Note Already Exists"),this.createMessage(`${Vt}

Existing note: ${this.file.path}`),this.createButtons()}openAndWait(){return new Promise(e=>{this.resolve=e,this.forceVisible(),this.open()})}onClose(){this.resolve&&this.resolve(this.decision),super.onClose()}createButtons(){let e=this.createButtonContainer();this.createButton(e,"Cancel",!1,()=>{this.closeWithDecision("cancel")}),this.createButton(e,"Save as Numbered Copy",!1,()=>{this.closeWithDecision("new-name")}),this.createButton(e,"Overwrite Existing",!0,()=>{this.closeWithDecision("overwrite")})}closeWithDecision(e){this.decision=e,this.close()}};S();S();var Re=require("obsidian"),Me=class{constructor(t){this.app=t}async saveToFile(t,e,r){try{let i=this.createSafeFilename(t),s=this.normalizePath(r);await this.ensureDirectoryExists(s);let n=this.getDailyFolderPath(s);await this.ensureDirectoryExists(n);let o=`${n}/${i}`;return await this.handleFileConflicts(o,e)}catch(i){throw new Error(f.ERRORS.SAVE_FILE(i.message))}}async openFileWithConfirmation(t){await this.waitForFileCreation();try{let e=this.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof Re.TFile))throw new Error(f.ERRORS.FILE_NOT_EXISTS);await this.app.workspace.getLeaf(!1).openFile(e)}catch(e){throw new Error(f.ERRORS.COULD_NOT_OPEN(e.message))}}createSafeFilename(t){return`${y.sanitizeFilename(t)}.md`}async ensureDirectoryExists(t){try{await this.app.vault.createFolder(t)}catch(e){}}getDailyFolderPath(t){let e=t.replace(/\/+$/,""),r=new Date().toISOString().split("T")[0];return`${e}/${r}`}async handleFileConflicts(t,e){let r=this.app.vault.getAbstractFileByPath(t);if(r instanceof Re.TFile)switch(await this.promptConflictResolution(r)){case"overwrite":return await this.app.vault.modify(r,e),r.path;case"new-name":return this.createVersionedCopy(r.path,e);default:throw new Error("Save cancelled by user")}return await this.app.vault.create(t,e),t}async waitForFileCreation(){return new Promise(t=>setTimeout(t,ne.FILE_CREATION_WAIT))}getFileByPath(t){let e=this.app.vault.getAbstractFileByPath(t);return e instanceof Re.TFile?e:null}fileExists(t){return this.getFileByPath(t)!==null}async createUniqueFile(t,e){let r=1,i=t;for(;this.fileExists(i);){let s=t.split("/"),n=s.pop();if(!n)throw new Error("Invalid file path");let a=`${n.replace(".md","")} (${r}).md`;i=[...s,a].join("/"),r++}return await this.app.vault.create(i,e),i}async promptConflictResolution(t){return await new Ie(this.app,t).openAndWait()}async createVersionedCopy(t,e){let r=t.split("/"),i=r.pop();if(!i)throw new Error("Invalid file path");let s=i.replace(".md",""),n=1,o;do o=[...r,`${s} (${n}).md`].join("/"),n++;while(this.fileExists(o));return await this.app.vault.create(o,e),o}normalizePath(t){if(!t)return"";let e=t.trim();for(e.startsWith("./")&&(e=e.slice(2));e.startsWith("/");)e=e.slice(1);return e=e.replace(/\/+/g,"/"),e}};var ke=class extends C{constructor(e="",r,i,s){super(e,r!=null?r:"llama3.2",i);this.name="Ollama";s?s.includes("ollama.com")||s.includes("cloud")?this.apiBaseUrl="https://ollama.com/api":s.endsWith("/api")?this.apiBaseUrl=s:this.apiBaseUrl=`${s}/api`:this.apiBaseUrl="http://localhost:11434/api"}getApiUrl(e){return`${this.apiBaseUrl}${e}`}async process(e){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");let r={model:this._model,prompt:e,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},i=await fetch(this.getApiUrl("/generate"),{method:"POST",headers:this.createHeaders(),body:JSON.stringify(r)});if(!i.ok){if(i.status===404)throw(this._model.includes("-cloud")||this._model.includes(":cloud"))&&!this.apiBaseUrl.includes("ollama.com")?new Error(`Cloud model "${this._model}" requires Ollama Cloud configuration. Either:
1. Switch to a local model (e.g., "llama3.2:latest")
2. Configure Ollama Cloud in settings with endpoint "https://ollama.com" and your API key`):new Error(`Ollama model not found: ${this._model}. Please make sure the model is pulled in Ollama using 'ollama pull ${this._model}'.`);if(i.status===401)throw this._model.includes("-cloud")||this._model.includes(":cloud")?new Error(`Cloud model "${this._model}" requires authentication. Please configure your Ollama Cloud API key in plugin settings (get it from https://ollama.com/settings)`):new Error("Ollama authentication failed. Check if your Ollama instance requires authentication.");if(i.status===500){let n=await this.safeJsonParse(i),o=(n==null?void 0:n.error)||"Ollama server error";throw new Error(`Ollama error: ${o}`)}throw new Error(`Ollama API error: ${i.status} - ${i.statusText}`)}let s=await i.json();if(!this.validateResponse(s,["response"]))throw new Error("Invalid response format from Ollama API");return this.extractContent(s)}catch(r){throw r instanceof Error?r.message.includes("fetch")||r.message.includes("network")||r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND")?new Error("Ollama server is not running or unreachable. Please ensure Ollama is installed and running on your system."):r:new Error(`Ollama processing failed: ${r}`)}}async processWithImage(e,r){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");let i=[{role:"user",content:e}];if(r&&r.length>0){let a=this.processImages(r);a.length>0&&(i[0].images=a)}let s={model:this._model,messages:i,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},n=await fetch(this.getApiUrl("/chat"),{method:"POST",headers:this.createHeaders(),body:JSON.stringify(s)});if(!n.ok){if(n.status===404)throw(this._model.includes("-cloud")||this._model.includes(":cloud"))&&!this.apiBaseUrl.includes("ollama.com")?new Error(`Cloud model "${this._model}" requires Ollama Cloud configuration. Either:
1. Switch to a local model (e.g., "llama3.2:latest")
2. Configure Ollama Cloud in settings with endpoint "https://ollama.com" and your API key`):new Error(`Ollama model not found: ${this._model}. Please make sure the model is pulled in Ollama using 'ollama pull ${this._model}'.`);if(n.status===401)throw this._model.includes("-cloud")||this._model.includes(":cloud")?new Error(`Cloud model "${this._model}" requires authentication. Please configure your Ollama Cloud API key in plugin settings (get it from https://ollama.com/settings)`):new Error("Ollama authentication failed. Check if your Ollama instance requires authentication.");if(n.status===500){let a=await this.safeJsonParse(n),l=(a==null?void 0:a.error)||"Ollama server error";throw new Error(`Ollama error: ${l}`)}throw new Error(`Ollama API error: ${n.status} - ${n.statusText}`)}let o=await n.json();if(!this.validateResponse(o,["message","content"]))throw new Error("Invalid response format from Ollama API");return this.extractContentFromChat(o)}catch(i){throw i instanceof Error?i.message.includes("fetch")||i.message.includes("network")||i.message.includes("ECONNREFUSED")||i.message.includes("ENOTFOUND")?new Error("Ollama server is not running or unreachable. Please ensure Ollama is installed and running on your system."):i:new Error(`Ollama processing failed: ${i}`)}}processImages(e){let r=[];for(let i of e)typeof i=="string"?r.push(i):i instanceof ArrayBuffer&&r.push(this.arrayBufferToBase64(i));return r}arrayBufferToBase64(e){let r=new Uint8Array(e),i="";for(let s=0;s<r.length;s++)i+=String.fromCharCode(r[s]);return btoa(i)}async checkAvailability(){try{return(await fetch(this.getApiUrl("/tags"),{method:"GET",headers:this.createHeaders()})).ok}catch(e){return!1}}async checkModelAvailability(e){try{let r=await fetch(this.getApiUrl("/tags"),{method:"GET",headers:this.createHeaders()});if(!r.ok)return!1;let i=await r.json();return i!=null&&i.models?i.models.some(s=>{var n,o;return s.name===e||s.name.startsWith(`${e}:`)||((o=(n=s.id)==null?void 0:n.includes(e))!=null?o:!1)}):!1}catch(r){return!1}}createHeaders(){let e={"Content-Type":"application/json"};return this.apiKey&&(e.Authorization=`Bearer ${this.apiKey}`),e}createRequestBody(e){return{model:this._model,prompt:e,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}}}extractContent(e){return e&&typeof e=="object"&&"response"in e?String(e.response).trim():""}extractContentFromChat(e){if(e&&typeof e=="object"&&"message"in e){let r=e.message;if("content"in r)return String(r.content).trim()}return""}};var Oe=class extends C{constructor(e,r,i){super(e,r!=null?r:"deepseek-r1:32b",i);this.name="Ollama Cloud";this.apiBaseUrl="https://ollama.com/api"}getApiUrl(e){return`${this.apiBaseUrl}${e}`}async process(e){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");if(!this.apiKey||this.apiKey.trim().length===0)throw new Error("Ollama Cloud requires an API key. Please configure it in plugin settings (get it from https://ollama.com/settings)");let r={model:this._model,prompt:e,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},i=await fetch(this.getApiUrl("/generate"),{method:"POST",headers:this.createHeaders(),body:JSON.stringify(r)});if(!i.ok){if(i.status===404)throw new Error(`Ollama Cloud model not found: ${this._model}. Please check available models at https://ollama.com/library.`);if(i.status===401)throw new Error("Ollama Cloud authentication failed. Please check your API key in plugin settings (get it from https://ollama.com/settings)");if(i.status===403)throw new Error("Ollama Cloud access denied. Your API key may not have access to this model or the service.");if(i.status===429)throw new Error("Ollama Cloud rate limit exceeded. Please try again later or upgrade your plan.");if(i.status===500){let n=await this.safeJsonParse(i),o=(n==null?void 0:n.error)||"Ollama Cloud server error";throw new Error(`Ollama Cloud error: ${o}`)}throw new Error(`Ollama Cloud API error: ${i.status} - ${i.statusText}`)}let s=await i.json();if(!this.validateResponse(s,["response"]))throw new Error("Invalid response format from Ollama Cloud API");return this.extractContent(s)}catch(r){throw r instanceof Error?r.message.includes("fetch")||r.message.includes("network")||r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND")?new Error("Ollama Cloud is unreachable. Please check your internet connection and https://ollama.com status."):r:new Error(`Ollama Cloud processing failed: ${r}`)}}async processWithImage(e,r){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");if(!this.apiKey||this.apiKey.trim().length===0)throw new Error("Ollama Cloud requires an API key. Please configure it in plugin settings (get it from https://ollama.com/settings)");let i=[{role:"user",content:e}];if(r&&r.length>0){let a=this.processImages(r);a.length>0&&(i[0].images=a)}let s={model:this._model,messages:i,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},n=await fetch(this.getApiUrl("/chat"),{method:"POST",headers:this.createHeaders(),body:JSON.stringify(s)});if(!n.ok){if(n.status===404)throw new Error(`Ollama Cloud model not found: ${this._model}. Please check available models at https://ollama.com/library.`);if(n.status===401)throw new Error("Ollama Cloud authentication failed. Please check your API key in plugin settings (get it from https://ollama.com/settings)");if(n.status===403)throw new Error("Ollama Cloud access denied. Your API key may not have access to this model or the service.");if(n.status===429)throw new Error("Ollama Cloud rate limit exceeded. Please try again later or upgrade your plan.");if(n.status===500){let a=await this.safeJsonParse(n),l=(a==null?void 0:a.error)||"Ollama Cloud server error";throw new Error(`Ollama Cloud error: ${l}`)}throw new Error(`Ollama Cloud API error: ${n.status} - ${n.statusText}`)}let o=await n.json();if(!this.validateResponse(o,["message","content"]))throw new Error("Invalid response format from Ollama Cloud API");return this.extractContentFromChat(o)}catch(i){throw i instanceof Error?i.message.includes("fetch")||i.message.includes("network")||i.message.includes("ECONNREFUSED")||i.message.includes("ENOTFOUND")?new Error("Ollama Cloud is unreachable. Please check your internet connection and https://ollama.com status."):i:new Error(`Ollama Cloud processing failed: ${i}`)}}processImages(e){let r=[];for(let i of e)typeof i=="string"?r.push(i):i instanceof ArrayBuffer&&r.push(this.arrayBufferToBase64(i));return r}arrayBufferToBase64(e){let r=new Uint8Array(e),i="";for(let s=0;s<r.length;s++)i+=String.fromCharCode(r[s]);return btoa(i)}createHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`}}createRequestBody(e){return{model:this._model,prompt:e,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}}}extractContent(e){return e&&typeof e=="object"&&"response"in e?String(e.response).trim():""}extractContentFromChat(e){if(e&&typeof e=="object"&&"message"in e){let r=e.message;if("content"in r)return String(r.content).trim()}return""}};var Bt="https://openrouter.ai/api/v1/chat/completions";function $t(c){var r;let t=(r=c.match(/retry in ([\d.]+)/i))!=null?r:c.match(/(\d+)\s*seconds?/i),e=t?` Retry in ${Math.ceil(parseFloat(t[1]))}s.`:"";return c.toLowerCase().includes("rate limit")?`OpenRouter rate limit reached.${e}`:c.toLowerCase().includes("insufficient")||c.toLowerCase().includes("credits")?"OpenRouter credits exhausted. Add credits at openrouter.ai/credits":c.toLowerCase().includes("quota")?`OpenRouter quota exceeded.${e}`:`OpenRouter API error.${e}`}var Le=class extends C{constructor(e,r,i){super(e,r!=null?r:"meta-llama/llama-3.1-8b-instruct:free",i);this.name="OpenRouter";this.siteUrl="https://github.com/user/yt-clipper",this.siteName="YouTube Clipper Obsidian Plugin"}async process(e){var r;try{if(!this.apiKey||this.apiKey.trim().length===0)throw new Error("OpenRouter API key is required. Get one at openrouter.ai/keys");let i=await fetch(Bt,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e))});if(i.status===401)throw new Error("OpenRouter API key is invalid. Please check your key at openrouter.ai/keys");if(i.status===402)throw new Error("OpenRouter credits exhausted. Add credits at openrouter.ai/credits");if(i.status===403)throw new Error("OpenRouter access denied. Your key may not have access to this model.");if(i.status===429){let n=await this.safeJsonParse(i),o=((r=n==null?void 0:n.error)==null?void 0:r.message)||"";throw new Error($t(o))}i.ok||await this.handleAPIError(i);let s=await i.json();if(!this.validateResponse(s,["choices","0","message","content"]))throw new Error("Invalid response format from OpenRouter API");return this.extractContent(s)}catch(i){throw i instanceof Error?i:new Error(`OpenRouter processing failed: ${i}`)}}createHeaders(){return{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":this.siteUrl,"X-Title":this.siteName}}createRequestBody(e){return{model:this._model,messages:[{role:"system",content:"You are an expert content analyzer specializing in extracting practical value and creating actionable guides from video content. Focus on clarity, practicality, and immediate implementability."},{role:"user",content:e}],temperature:this._temperature,max_tokens:this._maxTokens,stream:!1}}extractContent(e){var i,s;let r=(s=(i=e.choices[0])==null?void 0:i.message)==null?void 0:s.content;return r?r.trim():""}};Z();S();Z();var Ht={namespace:"ytc",maxItems:100,defaultTTL:864e5},_e=class{constructor(t={}){this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0};this.config={...Ht,...t},this.cleanupExpired()}getStorageKey(t){return`${this.config.namespace}-${t}`}getIndex(){try{let t=localStorage.getItem(`${this.config.namespace}-index`);return t?JSON.parse(t):[]}catch(t){return[]}}setIndex(t){try{localStorage.setItem(`${this.config.namespace}-index`,JSON.stringify(t)),this.metrics.size=t.length}catch(e){}}get(t){try{let e=this.getStorageKey(t),r=localStorage.getItem(e);if(!r)return this.metrics.misses++,this.updateMetrics(),null;let i=JSON.parse(r);return Date.now()>i.expiresAt?(this.delete(t),this.metrics.misses++,this.updateMetrics(),null):(this.metrics.hits++,this.updateMetrics(),i.data)}catch(e){return this.metrics.misses++,this.updateMetrics(),null}}set(t,e,r){try{let i=this.getIndex();for(;i.length>=this.config.maxItems;){let n=i.shift();n&&(localStorage.removeItem(this.getStorageKey(n)),this.metrics.evictions++)}let s={data:e,expiresAt:Date.now()+(r!=null?r:this.config.defaultTTL)};localStorage.setItem(this.getStorageKey(t),JSON.stringify(s)),i.includes(t)||i.push(t),this.setIndex(i)}catch(i){if(i.name==="QuotaExceededError"){this.evictOldest(10);try{this.set(t,e,r)}catch(s){}}}}delete(t){try{let e=this.getStorageKey(t),r=localStorage.getItem(e)!==null;if(r){localStorage.removeItem(e);let i=this.getIndex().filter(s=>s!==t);this.setIndex(i)}return r}catch(e){return!1}}clear(){try{this.getIndex().forEach(e=>{localStorage.removeItem(this.getStorageKey(e))}),this.setIndex([]),this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0}}catch(t){}}getMetrics(){return{...this.metrics}}evictOldest(t){let e=this.getIndex();e.slice(0,t).forEach(i=>{localStorage.removeItem(this.getStorageKey(i)),this.metrics.evictions++}),this.setIndex(e.slice(t))}cleanupExpired(){try{let t=this.getIndex(),e=Date.now(),r=[];t.forEach(i=>{let s=this.getStorageKey(i),n=localStorage.getItem(s);if(n)try{let o=JSON.parse(n);e<=o.expiresAt?r.push(i):localStorage.removeItem(s)}catch(o){localStorage.removeItem(s)}}),this.setIndex(r)}catch(t){}}updateMetrics(){let t=this.metrics.hits+this.metrics.misses;this.metrics.hitRate=t>0?this.metrics.hits/t:0}destroy(){this.clear()}},Je=new _e({namespace:"ytc-transcript",maxItems:50,defaultTTL:10080*60*1e3}),ai=new _e({namespace:"ytc-metadata",maxItems:200,defaultTTL:1440*60*1e3});var De=class{constructor(t){this.cache=t;this.transcriptTTL=1e3*60*60*24*7}async getTranscript(t){var s,n,o;if(!t)throw new Error("Video ID is required");let e=`transcript-${t}`,r=(s=this.cache)==null?void 0:s.get(e);if(r)return r;let i=Je.get(t);if(i)return(n=this.cache)==null||n.set(e,i,this.transcriptTTL),i;try{let a=await this.fetchTranscriptWithFallback(t);return a?((o=this.cache)==null||o.set(e,a,this.transcriptTTL),Je.set(t,a,this.transcriptTTL),a):null}catch(a){return null}}async fetchTranscriptWithFallback(t){try{let e=await this.fetchFromYouTubeAPI(t);if(e)return e}catch(e){}try{let e=await this.scrapeTranscriptFromPage(t);if(e)return e}catch(e){}try{let e=await this.fetchFromThirdParty(t);if(e)return e}catch(e){}return null}async fetchFromYouTubeAPI(t){let e=`https://video.google.com/timedtext?lang=en&v=${t}`,r=await fetch(e);if(!r.ok)throw new Error(`Transcript API failed: ${r.status}`);let i=await r.text();return this.parseXMLTranscript(i,t)}async scrapeTranscriptFromPage(t){let e=`https://www.youtube.com/watch?v=${t}`,r=`${V.CORS_PROXY}?url=${encodeURIComponent(e)}`,i=await fetch(r);if(!i.ok)throw new Error("Failed to fetch video page");let s=await i.text(),n=await this.extractTranscriptFromHTML(s);return n?this.createTranscript(n,t,!0):null}async fetchFromThirdParty(t){return null}parseXMLTranscript(t,e){var a,l,d;let s=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("text"),n=[],o="";for(let u=0;u<s.length;u++){let p=s[u];if(!p)continue;let m=(a=p.textContent)!=null?a:"",v=parseFloat((l=p.getAttribute("start"))!=null?l:"0"),E=parseFloat((d=p.getAttribute("dur"))!=null?d:"0");m.trim()&&(n.push({text:m.trim(),start:v,duration:E}),o+=`${m.trim()} `)}return{segments:n,fullText:o.trim(),language:"en",autoGenerated:!0}}async extractTranscriptFromHTML(t){let e=/"captions":\s*{[^}]*"playerCaptionsTracklistRenderer":\s*{[^}]*"captionTracks":\s*\[([^\]]+)\]/,r=t.match(e);if(!(r!=null&&r[1]))return null;try{let i=r[1],n=JSON.parse(`[${i}]`).find(o=>o.languageCode==="en"||o.languageCode.startsWith("en"));return n!=null&&n.baseUrl?fetch(n.baseUrl).then(o=>{if(!o.ok)throw new Error("Failed to fetch caption track");return o.text()}).then(o=>this.parseXMLTranscript(o,"").segments).catch(()=>null):null}catch(i){return null}}createTranscript(t,e,r=!1){Array.isArray(t)||(t=[t]);let i=t.map(n=>{var o;return{text:n.text,start:n.start,duration:(o=n.duration)!=null?o:0}}),s=i.map(n=>n.text).join(" ").trim();return{segments:i,fullText:s,language:"en",autoGenerated:r}}async getTranscriptSummary(t,e=2e3){let r=await this.getTranscript(t);if(!r)return null;if(r.fullText.length<=e)return r.fullText;let i=r.segments.filter(s=>s.text.length>20).slice(0,10).map(s=>s.text).join(" ");return i.length>e?`${i.substring(0,e)}...`:i}async extractKeyMoments(t,e=5){let r=await this.getTranscript(t);if(!r||r.segments.length===0)return null;let i=r.segments.filter(a=>a.text.length>30);if(i.length===0)return null;let s=i.length,n=Math.max(1,Math.floor(s/e)),o=[];for(let a=0;a<s&&o.length<e;a+=n){let l=i[a];l&&o.push({time:l.start,text:l.text})}return o}async isTranscriptAvailable(t){let e=await this.getTranscript(t);return e!==null&&e.segments.length>0}};var Fe=class{constructor(t){this.cache=t;this.metadataTTL=1e3*60*30;this.descriptionTTL=1e3*60*30;this.transcriptService=new De(t)}async getTranscript(t){try{let e=await this.transcriptService.getTranscript(t);return e?{fullText:e.fullText}:null}catch(e){return null}}extractVideoId(t){return y.extractVideoId(t)}async getVideoData(t){var i,s,n,o;if(!t)throw new Error("Video ID is required");let e=this.getCacheKey("video-data",t),r=(i=this.cache)==null?void 0:i.get(e);if(r)return r;try{let a=await this.getVideoMetadata(t),l={title:(s=a.title)!=null?s:"Unknown Title",description:(n=a.description)!=null?n:"No description available",duration:a.duration,thumbnail:a.thumbnail,channelName:a.channelName};return l.duration&&l.duration<1800&&this.checkTranscriptAvailability(t).then(d=>{var u;l.hasTranscript=d,(u=this.cache)==null||u.set(e,l,this.metadataTTL)}),(o=this.cache)==null||o.set(e,l,this.metadataTTL),l}catch(a){throw w.createUserFriendlyError(a,"fetch video data")}}async getVideoMetadata(t){var s,n;let e=this.getCacheKey("metadata",t),r=(s=this.cache)==null?void 0:s.get(e);if(r)return r;let i=`${V.YOUTUBE_OEMBED}?url=https://www.youtube.com/watch?v=${t}&format=json`;try{let o=new AbortController,a=setTimeout(()=>o.abort(),15e3),l=await fetch(i,{headers:{"User-Agent":"Obsidian YoutubeClipper Plugin"},signal:o.signal});if(clearTimeout(a),!l.ok){if(l.status===400)throw new Error(`Invalid YouTube video ID: ${t}. Please check the URL and try again.`);if(l.status===401)return await this.getMetadataWithFallback(t);throw l.status===404?new Error(`YouTube video not found: ${t}. The video may be private, deleted, or the ID is incorrect.`):l.status===403?new Error(`Access denied to YouTube video: ${t}. The video may be private or restricted.`):new Error(f.ERRORS.FETCH_VIDEO_DATA(l.status))}let d=await l.json(),u={title:d.title||"Unknown Title",thumbnail:d.thumbnail_url,author_name:d.author_name};try{let m=await this.scrapeAdditionalMetadata(t);u={...u,...m}}catch(m){}let p={title:u.title,description:u.description,duration:u.duration,thumbnail:u.thumbnail,channelName:u.author_name};return(n=this.cache)==null||n.set(e,p,this.metadataTTL),p}catch(o){throw o instanceof DOMException&&o.name==="AbortError"?new Error("Request timed out. Please check your internet connection and try again."):o instanceof TypeError?new Error(f.ERRORS.NETWORK_ERROR):o instanceof Error&&o.message.includes("JSON")?new Error("Failed to parse YouTube response. The service may be temporarily unavailable."):o}}async getMetadataWithFallback(t){var e,r;h.warn(`Attempting fallback metadata retrieval for ${t}`,"VideoData");try{let i=await this.scrapeAdditionalMetadata(t);if((e=i.description)!=null?e:i.duration)return{title:`YouTube Video (${t})`,description:(r=i.description)!=null?r:"",duration:i.duration,thumbnail:`https://img.youtube.com/vi/${t}/maxresdefault.jpg`,channelName:void 0}}catch(i){}return{title:`YouTube Video (${t})`,description:`Video URL: https://www.youtube.com/watch?v=${t}`,duration:void 0,thumbnail:`https://img.youtube.com/vi/${t}/maxresdefault.jpg`,channelName:void 0}}async scrapeAdditionalMetadata(t){try{let e=await this.fetchVideoPageHTML(t),r=e.match(/"lengthSeconds":"(\d+)"/),i=r!=null&&r[1]?parseInt(r[1]):void 0,s=e.match(/"shortDescription":"([^"]+)"/);return{description:s!=null&&s[1]?s[1].replace(/\\u0026/g,"&").replace(/\\n/g,`
`):void 0,duration:i}}catch(e){return{}}}async checkTranscriptAvailability(t){try{return await this.transcriptService.isTranscriptAvailable(t)}catch(e){return!1}}async getVideoDescription(t){var i,s,n;let e=this.getCacheKey("description",t),r=(i=this.cache)==null?void 0:i.get(e);if(r)return r;try{let o=await this.fetchVideoPageHTML(t),a=this.extractDescriptionFromHTML(o);return(s=this.cache)==null||s.set(e,a,this.descriptionTTL),a}catch(o){let a=f.WARNINGS.EXTRACTION_FAILED;return(n=this.cache)==null||n.set(e,a,this.descriptionTTL),a}}async fetchVideoPageHTML(t){let e=`https://www.youtube.com/watch?v=${t}`,r=`${V.CORS_PROXY}?url=${encodeURIComponent(e)}`,i=new AbortController,s=setTimeout(()=>i.abort(),2e4);try{let n=await fetch(r,{signal:i.signal});if(clearTimeout(s),!n.ok)throw new Error(f.WARNINGS.CORS_RESTRICTIONS);return n.text()}finally{clearTimeout(s)}}extractDescriptionFromHTML(t){let e=[/"shortDescription":"([^"]*?)"/,/"description":{"simpleText":"([^"]*?)"}/,/<meta name="description" content="([^"]*?)">/,/<meta property="og:description" content="([^"]*?)">/];for(let r of e){let i=t.match(r);if(i!=null&&i[1]){let s=y.cleanText(i[1]);return y.truncateText(s,pt.DESCRIPTION_MAX_LENGTH)}}return f.WARNINGS.AUTO_EXTRACTION}validateAndExtractVideoId(t){if(!y.isValidYouTubeUrl(t))throw new Error(f.ERRORS.INVALID_URL);let e=this.extractVideoId(t);if(!e)throw new Error(f.ERRORS.INVALID_URL);return e}getCacheKey(t,e){return`youtube-video-service:${t}:${e}`}};var Xe=class c{constructor(t){this.value=t}isOk(){return!0}isErr(){return!1}map(t){return new c(t(this.value))}mapErr(t){return this}unwrap(){return this.value}unwrapOr(t){return this.value}async unwrapOrPromise(t){return this.value}},Ze=class c{constructor(t){this.error=t}isOk(){return!1}isErr(){return!0}map(t){return this}mapErr(t){return new c(t(this.error))}unwrap(){throw this.error}unwrapOr(t){return t}async unwrapOrPromise(t){return t}};function ce(c){return new Xe(c)}function B(c){return new Ze(c)}var ie=2;var T=class{static isAvailable(){var t;return typeof window!="undefined"&&((t=window.crypto)==null?void 0:t.subtle)!==void 0}static async encrypt(t){if(!this.isAvailable())return B({type:"encryption_failed",message:"Web Crypto API not available"});try{let e=window.crypto.getRandomValues(new Uint8Array(this.SALT_LENGTH)),r=window.crypto.getRandomValues(new Uint8Array(this.IV_LENGTH)),i=await this.deriveKey(e),s=new TextEncoder().encode(t),n=await window.crypto.subtle.encrypt({name:this.ALGORITHM,iv:r},i,s);return ce({encrypted:this.bufferToBase64(n),version:ie,salt:this.bufferToBase64(e),iv:this.bufferToBase64(r)})}catch(e){return B({type:"encryption_failed",message:e instanceof Error?e.message:"Unknown encryption error"})}}static async decrypt(t){if(!this.isAvailable())return B({type:"decryption_failed",message:"Web Crypto API not available"});try{if(t.version!==ie)return B({type:"unsupported_version",version:t.version,message:`Unsupported encryption version: ${t.version}`});let e=this.base64ToBuffer(t.salt),r=this.base64ToBuffer(t.iv),i=this.base64ToBuffer(t.encrypted),s=await this.deriveKey(e),n=await window.crypto.subtle.decrypt({name:this.ALGORITHM,iv:r},s,i),o=new TextDecoder().decode(n);return ce({plaintext:o,wasLegacy:!1})}catch(e){return B({type:"decryption_failed",message:e instanceof Error?e.message:"Unknown decryption error"})}}static serialize(t){return JSON.stringify(t)}static parse(t){try{let e=JSON.parse(t);return this.isValidEncryptionResult(e)?ce(e):B({type:"invalid_format",message:"Invalid encryption result format"})}catch(e){return B({type:"invalid_format",message:"Failed to parse encrypted data"})}}static isEncrypted(t){try{let e=JSON.parse(t);return this.isValidEncryptionResult(e)}catch(e){return!1}}static isLegacyEncrypted(t){if(!t||t.length<10)return!1;try{return atob(t),!("version"in JSON.parse(t))}catch(e){return!1}}static async deriveKey(t){let e=await this.getDeviceKeyMaterial(),r=await window.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]);return window.crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:this.PBKDF2_ITERATIONS,hash:"SHA-256"},r,{name:this.ALGORITHM,length:this.KEY_LENGTH},!1,["encrypt","decrypt"])}static async getDeviceKeyMaterial(){let t=[navigator.userAgent,navigator.language,screen.width.toString(),screen.height.toString(),new Date().getTimezoneOffset().toString(),this.getVaultPath()].join("|"),e=new TextEncoder().encode(t),r=await window.crypto.subtle.digest("SHA-256",e);return new Uint8Array(r)}static getVaultPath(){var t,e,r;try{let i=window.app;return(r=(e=(t=i==null?void 0:i.vault)==null?void 0:t.adapter)==null?void 0:e.basePath)!=null?r:"default-vault"}catch(i){return"default-vault"}}static bufferToBase64(t){let e=t instanceof Uint8Array?t:new Uint8Array(t),r="";for(let i=0;i<e.byteLength;i++){let s=e[i];s!==void 0&&(r+=String.fromCharCode(s))}return btoa(r)}static base64ToBuffer(t){let e=atob(t),r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i);return r}static isValidEncryptionResult(t){if(typeof t!="object"||t===null)return!1;let e=t;return typeof e.encrypted=="string"&&typeof e.version=="number"&&typeof e.salt=="string"&&typeof e.iv=="string"}};T.ALGORITHM="AES-GCM",T.KEY_LENGTH=256,T.IV_LENGTH=12,T.SALT_LENGTH=16,T.PBKDF2_ITERATIONS=1e5;var F=class{static deobfuscate(t){if(!t)return"";try{let e=this.generateObfuscationKey(),r=this.stringToBytes(e),i=atob(t),s=new Array(i.length);for(let o=0;o<i.length;o++)s[o]=i.charCodeAt(o);let n=s.map((o,a)=>{var d;let l=(d=r[a%r.length])!=null?d:0;return o^l});return String.fromCharCode(...n)}catch(e){return""}}static isLegacy(t){if(!t||t.length<10)return!1;try{return atob(t),JSON.parse(t),!1}catch(e){return!0}}static generateObfuscationKey(){let t=[navigator.userAgent,navigator.language,screen.width.toString(),screen.height.toString(),this.getVaultPath()],e=0,r=`${t.join("|")}1.0.0`;for(let i=0;i<r.length;i++){let s=r.charCodeAt(i);e=(e<<5)-e+s,e=e&e}return this.OBFUSCATION_KEY_PREFIX+Math.abs(e).toString(16)}static getVaultPath(){var t,e,r;try{let i=window.app;return(r=(e=(t=i==null?void 0:i.vault)==null?void 0:t.adapter)==null?void 0:e.basePath)!=null?r:"default"}catch(i){return"default"}}static stringToBytes(t){let e=[];for(let r=0;r<t.length;r++)e.push(t.charCodeAt(r));return e}};F.OBFUSCATION_KEY_PREFIX="ytc_sec_";var de=class{static async migrateLegacyKey(t){let e=F.deobfuscate(t);if(!e)return B({type:"decryption_failed",message:"Failed to decrypt legacy key"});let r=await T.encrypt(e);return r.isErr()?r:ce(T.serialize(r.value))}static needsMigration(t){return t?F.isLegacy(t)&&!T.isEncrypted(t):!1}};var Kt={maxEvents:1e3,retentionMs:2592e6,alertThresholds:{maxDecryptionFailures:5,maxSuspiciousAccess:3,windowMs:36e5}},W=class W{constructor(t={}){this.events=[];this.storageKey="ytc_security_audit";this.config={...Kt,...t},this.loadEvents()}static getInstance(t){return W.instance||(W.instance=new W(t)),W.instance}log(t,e,r){var s;let i={type:t,timestamp:Date.now(),severity:(s=r==null?void 0:r.severity)!=null?s:this.getDefaultSeverity(t),keyType:r==null?void 0:r.keyType,provider:r==null?void 0:r.provider,message:e,metadata:r==null?void 0:r.metadata};this.events.push(i),this.pruneEvents(),this.saveEvents(),this.checkAlertThresholds(i)}logKeyAccess(t,e,r){this.log(e?"key_access":"decryption_failure",e?`API key accessed: ${t}`:`Failed to access API key: ${t}`,{severity:e?"info":"warning",keyType:t,provider:r})}logKeySet(t,e){this.log("key_set",`API key set: ${t}`,{severity:"info",keyType:t,provider:e})}logKeyClear(t){this.log("key_clear",`API key cleared: ${t}`,{severity:"info",keyType:t})}logDecryption(t,e,r){this.log(t?"decryption_success":"decryption_failure",t?"Key decryption successful":`Key decryption failed: ${r!=null?r:"Unknown error"}`,{severity:t?"info":"warning",keyType:e,metadata:t?void 0:{error:r}})}logMigration(t,e,r,i){this.log(t?"migration_success":"migration_failure",t?`Key migrated from v${r} to v${i}`:`Key migration failed from v${r} to v${i}`,{severity:t?"info":"error",keyType:e,metadata:{fromVersion:r,toVersion:i}})}logSuspiciousActivity(t,e){this.log("suspicious_access",t,{severity:"warning",metadata:e})}getRecentEvents(t=50){return this.events.slice(-t)}getEventsByType(t){return this.events.filter(e=>e.type===t)}getEventsInWindow(t){let e=Date.now()-t;return this.events.filter(r=>r.timestamp>=e)}getSummary(){let e=this.getEventsInWindow(36e5);return{totalEvents:this.events.length,decryptionFailures:this.getEventsByType("decryption_failure").length,suspiciousActivities:this.getEventsByType("suspicious_access").length,recentActivity:e.length>0,lastEvent:this.events[this.events.length-1]}}checkSecurityConcerns(){let t=[],e=this.config.alertThresholds.windowMs,r=this.getEventsInWindow(e),i=r.filter(n=>n.type==="decryption_failure").length;i>=this.config.alertThresholds.maxDecryptionFailures&&t.push({concern:`${i} decryption failures in the last hour`,severity:"warning",recommendation:"Consider re-entering your API keys to ensure they are correctly stored."});let s=r.filter(n=>n.type==="suspicious_access").length;return s>=this.config.alertThresholds.maxSuspiciousAccess&&t.push({concern:`${s} suspicious access patterns detected`,severity:"critical",recommendation:"Review your API key security and consider rotating keys."}),t}clearLogs(){this.events=[],this.saveEvents()}exportLogs(){return JSON.stringify(this.events,null,2)}getDefaultSeverity(t){var r;return(r={key_access:"info",key_set:"info",key_clear:"info",decryption_success:"info",decryption_failure:"warning",migration_success:"info",migration_failure:"error",suspicious_access:"warning",rate_limit_exceeded:"warning"}[t])!=null?r:"info"}pruneEvents(){let t=Date.now()-this.config.retentionMs;this.events=this.events.filter(e=>e.timestamp>=t),this.events.length>this.config.maxEvents&&(this.events=this.events.slice(-this.config.maxEvents))}checkAlertThresholds(t){let e=this.config.alertThresholds.windowMs,r=this.getEventsInWindow(e);if(t.type==="decryption_failure"){let i=r.filter(s=>s.type==="decryption_failure").length;i===this.config.alertThresholds.maxDecryptionFailures&&console.warn(`[Security] Alert: ${i} decryption failures detected in the last hour`)}if(t.type==="suspicious_access"){let i=r.filter(s=>s.type==="suspicious_access").length;i>=this.config.alertThresholds.maxSuspiciousAccess&&console.error(`[Security] Critical: ${i} suspicious access patterns detected`)}}loadEvents(){try{let t=localStorage.getItem(this.storageKey);if(t){let e=JSON.parse(t);Array.isArray(e)&&(this.events=e)}}catch(t){this.events=[]}}saveEvents(){try{localStorage.setItem(this.storageKey,JSON.stringify(this.events))}catch(t){this.events=this.events.slice(-100);try{localStorage.setItem(this.storageKey,JSON.stringify(this.events))}catch(e){console.warn("[Security] Failed to save audit logs")}}}};W.instance=null;var et=W,R=et.getInstance();var bt=20,Et=200,tt=class{constructor(){this.storageKey="ytc_api_keys_meta"}async encryptKey(t){if(!t)return"";let e=await T.encrypt(t);if(e.isErr())throw new Error(`Encryption failed: ${e.error.message}`);return T.serialize(e.value)}async decryptKey(t){if(!t)return"";if(de.needsMigration(t))return this.migrateAndDecrypt(t);let e=T.parse(t);if(e.isErr()){let i=F.deobfuscate(t);if(i)return i;throw new Error(`Failed to parse encrypted key: ${e.error.message}`)}let r=await T.decrypt(e.value);if(r.isErr())throw new Error(`Decryption failed: ${r.error.message}`);return r.value.plaintext}async migrateAndDecrypt(t){let e=await de.migrateLegacyKey(t);if(e.isErr()){let i=F.deobfuscate(t);return R.logMigration(!1,"unknown",1,ie),i}R.logMigration(!0,"unknown",1,ie);let r=T.parse(e.value);if(r.isOk()){let i=await T.decrypt(r.value);if(i.isOk())return i.value.plaintext}return F.deobfuscate(t)}isEncrypted(t){return!t||t.length<10?!1:T.isEncrypted(t)||F.isLegacy(t)}storeMetadata(t,e){let r={lastModified:Date.now(),isEncrypted:!0,encryptionVersion:ie,keyType:e};try{let i=this.getAllMetadata();i[t]=r,localStorage.setItem(this.storageKey,JSON.stringify(i))}catch(i){console.warn("Failed to store key metadata:",i)}}getAllMetadata(){try{let t=localStorage.getItem(this.storageKey);return t?JSON.parse(t):{}}catch(t){return{}}}clearMetadata(t){try{let e=this.getAllMetadata();delete e[t],localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.warn("Failed to clear key metadata:",e)}}clearAllMetadata(){try{localStorage.removeItem(this.storageKey)}catch(t){console.warn("Failed to clear all metadata:",t)}}},Ue=class Ue{validateKeyFormat(t,e){if(!e||e.trim().length===0)return{valid:!1,message:"API key is empty"};let r=e.trim();if(r.length<bt)return{valid:!1,message:`API key is too short (minimum ${bt} characters)`};if(r.length>Et)return{valid:!1,message:`API key is too long (maximum ${Et} characters)`};let i=["your-api-key-here","your_key_here","placeholder","example-key","xxx","...","<insert>"],s=r.toLowerCase();for(let o of i)if(s.includes(o))return{valid:!1,message:"This appears to be a placeholder API key. Please enter your actual API key."};let n=Ue.PATTERNS[t];return n&&!n.test(r)?{valid:!1,message:`${t.toUpperCase()} API key format doesn't match expected pattern. This may be okay if the format has changed.`}:{valid:!0}}checkKeyHealth(t,e){let r=[],i=!0,s=e.trim();return s.length>10&&new Set(s).size===1&&(r.push("API key appears to be invalid (all same character)"),i=!1),["sk-test","test-key","demo-key","sample-key"].some(o=>s.toLowerCase().includes(o))&&(r.push("This appears to be a test/demo API key"),i=!1),{isHealthy:i,warnings:r}}maskKey(t){if(!t||t.length<12)return"***";let e=t.substring(0,8),r=t.substring(t.length-4),i=Math.max(8,t.length-12);return`${e}${"*".repeat(i)}${r}`}isMasked(t){return t.includes("*")&&t.length>=12}};Ue.PATTERNS={gemini:/^AIza[A-Za-z0-9_-]{35}$/,groq:/^gsk_[A-Za-z0-9_-]{48,52}$/,openai:/^sk-[A-Za-z0-9_-]{48,}$/};var rt=Ue,j=class{constructor(t){this.keyStorage=new tt;this.validator=new rt;this.keyCache=new Map;this.settings=t}async getApiKey(t){let e=this.keyCache.get(t);if(e)return R.logKeyAccess(t,!0),e;let r=this.settings[t];if(!r||r.length===0)return this.getFromEnvironment(t);if(this.keyStorage.isEncrypted(r))try{let i=await this.keyStorage.decryptKey(r);if(i)return this.keyCache.set(t,i),R.logKeyAccess(t,!0),i}catch(i){R.logDecryption(!1,t,i instanceof Error?i.message:"Unknown error"),R.logKeyAccess(t,!1),console.warn("Failed to decrypt key:",i)}return R.logKeyAccess(t,!0),r}getApiKeySync(t){let e=this.keyCache.get(t);if(e)return e;let r=this.settings[t];return!r||r.length===0?this.getFromEnvironment(t):this.keyStorage.isEncrypted(r)?(console.warn(`Key ${t} requires async decryption. Use getApiKey() instead.`),""):r}async setApiKey(t,e){var n;let r=e.trim(),i=this.validator.validateKeyFormat(t,r);if(!i.valid)throw new Error((n=i.message)!=null?n:"Invalid API key format");let s=await this.keyStorage.encryptKey(r);return this.keyStorage.storeMetadata(t,t),this.keyCache.set(t,r),R.logKeySet(t),s}async getMaskedApiKey(t){let e=await this.getApiKey(t);return!e||e.length===0?"Not set":this.validator.maskKey(e)}async hasApiKey(t){let e=await this.getApiKey(t);return!!(e&&e.length>0)}clearApiKey(t){this.keyCache.delete(t),this.settings[t]="",this.keyStorage.clearMetadata(t),R.logKeyClear(t)}clearAllApiKeys(){let t=["geminiApiKey","groqApiKey","ollamaApiKey","huggingFaceApiKey","openRouterApiKey"];for(let e of t)this.clearApiKey(e);this.keyStorage.clearAllMetadata(),this.keyCache.clear()}clearCache(){this.keyCache.clear()}getFromEnvironment(t){var i,s,n;if(!this.settings.useEnvironmentVariables)return"";let r=`${(i=this.settings.environmentPrefix)!=null?i:"YTC"}_${t.toUpperCase().replace("APIKEY","_API_KEY")}`;try{if(typeof process!="undefined"&&process.env)return(s=process.env[r])!=null?s:"";if(typeof window!="undefined"){let o=window.env;if(o!=null&&o[r])return(n=o[r])!=null?n:""}}catch(o){}return""}async validateSecurityConfiguration(){let t={isValid:!0,warnings:[],errors:[],suggestions:[]};if(this.settings.useEnvironmentVariables)return t.suggestions.push("\u2705 Using environment variables - this is the most secure method","Make sure to set environment variables before starting Obsidian"),t;let e=["geminiApiKey","groqApiKey","ollamaApiKey","huggingFaceApiKey","openRouterApiKey"],r=!1;for(let i of e){let s=await this.getApiKey(i);if(!s||s.length===0)continue;r=!0;let n=this.validator.validateKeyFormat(i.replace("ApiKey",""),s);n.valid||(t.warnings.push(`${i}: ${n.message}`),t.isValid=!1);let o=this.validator.checkKeyHealth(i.replace("ApiKey",""),s);o.isHealthy||(t.warnings.push(`${i}: ${o.warnings.join(", ")}`),t.isValid=!1);let a=this.settings[i];a&&!this.keyStorage.isEncrypted(a)&&t.warnings.push(`${i}: Key is stored in plain text. Consider re-entering your key to enable encryption.`)}return r||(t.warnings.push("No API keys configured"),t.suggestions.push("Add API keys in settings to enable AI features","Consider using environment variables for better security")),t.suggestions.push("\u{1F512} Security Best Practices:","\u2022 Use environment variables when possible","\u2022 Rotate API keys regularly","\u2022 Never commit API keys to version control","\u2022 Use scoped keys with minimal permissions","\u2022 Monitor API usage for unusual activity"),t}getRotationRecommendations(){let t=[],e=this.keyStorage.getAllMetadata(),r=Date.now(),i=90,s=i*24*60*60*1e3,n=["geminiApiKey","groqApiKey","ollamaApiKey","huggingFaceApiKey","openRouterApiKey"];for(let o of n){let a=e[o];if(!(a!=null&&a.lastModified)){t.push({keyType:o,lastRotated:0,shouldRotate:!1,reason:"No rotation history available"});continue}let l=r-a.lastModified,d=l>s;t.push({keyType:o,lastRotated:a.lastModified,shouldRotate:d,reason:d?`Key is ${Math.round(l/(720*60*60*1e3))} days old (recommend rotating every ${i} days)`:"Key is within recommended rotation period"})}return t}getEnvironmentTemplate(){let t=this.settings.environmentPrefix||"YTC";return`# YouTube Clipper - Environment Variables for Secure API Key Management
#
# Add these to your shell profile (~/.bashrc, ~/.zshrc, ~/.config/environment)
# or set them in your system's environment before starting Obsidian

# ============================================================================
# AI PROVIDER API KEYS
# ============================================================================

# Google Gemini API Key
# Get your key at: https://ai.google.dev/
${t}_GEMINI_API_KEY=your_gemini_api_key_here

# Groq API Key
# Get your key at: https://groq.com/
${t}_GROQ_API_KEY=your_groq_api_key_here

# Ollama Cloud API Key (if using cloud instead of local)
${t}_OLLAMA_API_KEY=your_ollama_api_key_here

# Hugging Face API Key
${t}_HUGGINGFACE_API_KEY=your_huggingface_api_key_here

# OpenRouter API Key
${t}_OPENROUTER_API_KEY=your_openrouter_api_key_here

# ============================================================================
# USAGE INSTRUCTIONS
# ============================================================================

# 1. Set these variables in your environment
# 2. Enable "Use Environment Variables" in plugin settings
# 3. Set the Environment Variable Prefix to match (default: YTC)
# 4. Restart Obsidian to pick up the environment variables

# ============================================================================
# SECURITY NOTES
# ============================================================================

# \u2022 Never commit .env files or shell profiles with real API keys to version control
# \u2022 Use different API keys for development and production
# \u2022 Rotate API keys regularly (recommended: every 90 days)
# \u2022 Monitor your API usage for unusual activity
# \u2022 Revoke keys that are no longer in use

# ============================================================================
# TESTING CONFIGURATION
# ============================================================================

# Test that environment variables are loaded:
# echo $${t}_GEMINI_API_KEY

# You should see your API key printed (don't share this output)
`}async exportSafeSettings(){let t={outputPath:this.settings.outputPath,useEnvironmentVariables:this.settings.useEnvironmentVariables,environmentPrefix:this.settings.environmentPrefix,performanceMode:this.settings.performanceMode,enableParallelProcessing:this.settings.enableParallelProcessing,enableAutoFallback:this.settings.enableAutoFallback,preferMultimodal:this.settings.preferMultimodal,defaultMaxTokens:this.settings.defaultMaxTokens,defaultTemperature:this.settings.defaultTemperature,customPrompts:this.settings.customPrompts,customTimeouts:this.settings.customTimeouts,modelOptionsCache:this.settings.modelOptionsCache,modelCacheTimestamps:this.settings.modelCacheTimestamps},e=["geminiApiKey","groqApiKey","ollamaApiKey","huggingFaceApiKey","openRouterApiKey"];for(let r of e)await this.hasApiKey(r)&&(t[r]=await this.getMaskedApiKey(r));return t}getSecuritySummary(){return R.getSummary()}getSecurityConcerns(){return R.checkSecurityConcerns()}};var ue=class{constructor(t,e){this.settings=t;this.app=e;this._initialized=!1}get secureConfig(){return this._secureConfig||(this._secureConfig=new j(this.settings)),this._secureConfig}async initialize(){var o;if(this._initialized)return;let t=[],e=await this.secureConfig.getApiKey("geminiApiKey");e&&t.push(new Pe(e));let r=await this.secureConfig.getApiKey("groqApiKey");r&&t.push(new Se(r));let i=await this.secureConfig.getApiKey("huggingFaceApiKey");i&&t.push(new Ae(i));let s=await this.secureConfig.getApiKey("openRouterApiKey");s&&t.push(new Le(s));let n=await this.secureConfig.getApiKey("ollamaApiKey");t.push(new ke(n!=null?n:"",void 0,void 0,(o=this.settings.ollamaEndpoint)!=null?o:"http://localhost:11434")),n&&t.push(new Oe(n,"deepseek-r1:32b")),this._aiService=new Ee(t,this.settings),this._initialized=!0}get aiService(){if(!this._initialized||!this._aiService)throw new Error("ServiceContainer not initialized. Call initialize() first.");return this._aiService}get videoService(){return this._videoService||(this._videoService=new Fe(this.cacheService)),this._videoService}get fileService(){return this._fileService||(this._fileService=new Me(this.app)),this._fileService}get cacheService(){return this._cacheService||(this._cacheService=new xe),this._cacheService}get promptService(){return this._promptService||(this._promptService=new ee),this._promptService}async updateSettings(t){this.settings=t,this._secureConfig=void 0,this._aiService=void 0,this._videoService=void 0,this._initialized=!1,await this.initialize()}isInitialized(){return this._initialized}clearServices(){this._aiService&&typeof this._aiService.cleanup=="function"&&this._aiService.cleanup(),this._videoService&&typeof this._videoService.cleanup=="function"&&this._videoService.cleanup(),this._cacheService&&typeof this._cacheService.destroy=="function"&&this._cacheService.destroy(),this._aiService=void 0,this._videoService=void 0,this._fileService=void 0,this._cacheService=void 0,this._promptService=void 0}cleanup(){this.clearServices()}};var Ve=class{constructor(t,e,r,i={noteMarker:"<!-- ytc-extension:youtube-clipper -->",urlHandlerDelay:500,maxHandledFiles:100,tempFileAgeThreshold:5e3}){this.app=t;this.settings=e;this.onUrlDetected=r;this.config=i;this.handledTempFiles=new Set;this.pendingUrls=new Map}isTempFile(t,e){var r,i;try{if(e!=null&&e.includes(this.config.noteMarker))return h.debug("File identified as temp file via marker","UrlHandler",{filePath:t.path,hasMarker:!0}),!0;if((r=t.name)!=null&&r.startsWith("YouTube Clip -"))return h.debug("File identified as temp file via name","UrlHandler",{filePath:t.path,fileName:t.name}),!0;let n=e.trim().split(`
`).filter(l=>l.trim().length>0),o=(i=n[0])!=null?i:"";if(n.length===1&&y.isValidYouTubeUrl(o)&&e.length<200){let l=Date.now()-t.stat.ctime,d=t.path.includes(this.settings.outputPath);if(l<this.config.tempFileAgeThreshold&&!d)return h.debug("File identified as temp file via content analysis","UrlHandler",{filePath:t.path,fileAge:l,isInOutputPath:d,contentLength:e.length}),!0}return!1}catch(s){return h.error("Error checking if file is temp file","UrlHandler",{filePath:t.path,error:s instanceof Error?s.message:String(s)}),!1}}extractUrl(t){var e;try{if(t!=null&&t.includes(this.config.noteMarker)){let o=t.replace(this.config.noteMarker,"").trim();return y.isValidYouTubeUrl(o)?o:null}let r=t.trim(),i=/https?:\/\/(?:www\.)?youtube\.com\/watch\?v=[A-Za-z0-9_-]+(?:&[^/\s]*)?/i,s=/https?:\/\/(?:www\.)?youtu\.be\/[A-Za-z0-9_-]+(?:\?[^/\s]*)?/i,n=(e=r.match(i))!=null?e:r.match(s);if(n!=null&&n[0]){let o=n[0].trim();return y.isValidYouTubeUrl(o)?o:null}return null}catch(r){return h.error("Error extracting URL from content","UrlHandler",{error:r instanceof Error?r.message:String(r),contentLength:t.length}),null}}handleUrlSafely(t){if(h.info("URL detected, processing safely","UrlHandler",{url:t.url,source:t.source,filePath:t.filePath}),t.file&&t.content&&!this.isTempFile(t.file,t.content)){h.warn("URL rejected - not in temp file","UrlHandler",{url:t.url,filePath:t.filePath});return}if(this.handledTempFiles.has(t.url)){h.debug("URL already handled, skipping","UrlHandler",{url:t.url});return}this.pendingUrls.has(t.url)&&(h.debug("Cancelling pending handler for URL","UrlHandler",{url:t.url}),clearTimeout(this.pendingUrls.get(t.url))),this.handledTempFiles.add(t.url),t.filePath&&this.handledTempFiles.add(t.filePath);let e=setTimeout(()=>{h.info("Processing URL after debounce","UrlHandler",{url:t.url}),this.onUrlDetected(t),this.pendingUrls.delete(t.url),this.cleanupHandledFiles()},this.config.urlHandlerDelay);this.pendingUrls.set(t.url,e)}cleanupHandledFiles(){if(this.handledTempFiles.size>this.config.maxHandledFiles){let t=Array.from(this.handledTempFiles);this.handledTempFiles.clear(),t.slice(-Math.floor(this.config.maxHandledFiles/2)).forEach(e=>{this.handledTempFiles.add(e)}),h.debug("Cleaned up handled temp files","UrlHandler",{oldSize:t.length,newSize:this.handledTempFiles.size})}}async handleFileCreate(t){try{if(!(t!=null&&t.path)||!t.stat)return;let e=await this.app.vault.read(t);if(!this.isTempFile(t,e)){h.debug("Ignoring non-temp file in create handler","UrlHandler",{filePath:t.path});return}let r=this.extractUrl(e);if(!r){h.debug("No URL extracted from temp file","UrlHandler",{filePath:t.path});return}let i={url:r,source:"create",filePath:t.path,file:t,content:e};h.info("CREATE EVENT - detected temp note","UrlHandler",{...i}),this.handleUrlSafely(i)}catch(e){h.error("Error handling file create","UrlHandler",{filePath:t.path,error:e instanceof Error?e.message:String(e)})}}async handleActiveLeafChange(){try{let t=this.app.workspace.getActiveFile();if(!t||!("stat"in t)||!("basename"in t)||!("extension"in t)||this.handledTempFiles.has(t.path))return;let e=await this.app.vault.read(t);if(!this.isTempFile(t,e)){h.debug("Ignoring non-temp file in active leaf handler","UrlHandler",{filePath:t.path});return}let r=this.extractUrl(e);if(!r){h.debug("No URL extracted from temp file in active leaf","UrlHandler",{filePath:t.path});return}let i={url:r,source:"active-leaf",filePath:t.path,file:t,content:e};h.info("ACTIVE-LEAF-CHANGE EVENT - detected temp note","UrlHandler",{...i}),this.handleUrlSafely(i)}catch(t){h.error("Error handling active leaf change","UrlHandler",{error:t instanceof Error?t.message:String(t)})}}handleProtocol(t){var e,r,i;try{let s=(i=(r=(e=t.url)!=null?e:t.content)!=null?r:t.path)!=null?i:"";if(s&&y.isValidYouTubeUrl(s)){let n={url:s,source:"protocol"};h.info("Protocol handler received valid URL","UrlHandler",{...n}),setTimeout(()=>{this.onUrlDetected(n)},200)}else h.debug("Protocol handler received no valid URL","UrlHandler",{params:t})}catch(s){h.error("Error in protocol handler","UrlHandler",{params:t,error:s instanceof Error?s.message:String(s)})}}async handleClipboardUrl(){var t,e;try{let r="";try{(t=navigator==null?void 0:navigator.clipboard)!=null&&t.readText&&(r=(e=await navigator.clipboard.readText())!=null?e:"")}catch(i){h.debug("Could not read clipboard","UrlHandler",{error:i instanceof Error?i.message:String(i)}),r=""}if(r&&y.isValidYouTubeUrl(r.trim())){let i={url:r.trim(),source:"clipboard"};h.info("URL found in clipboard","UrlHandler",{...i}),this.onUrlDetected(i);return}h.debug("No valid YouTube URL in clipboard","UrlHandler")}catch(r){h.error("Error handling clipboard URL","UrlHandler",{error:r instanceof Error?r.message:String(r)})}}clear(){this.pendingUrls.forEach(t=>clearTimeout(t)),this.pendingUrls.clear(),this.handledTempFiles.clear(),h.info("URL handler cleared","UrlHandler")}updateSettings(t){this.settings=t,h.debug("URL handler settings updated","UrlHandler")}};var L=require("obsidian");var U="ytc-settings",it="ytc-settings-drawer-states",Nt={get(c){try{let t=localStorage.getItem(it);if(t)return JSON.parse(t)[c]}catch(t){}},set(c,t){try{let e=localStorage.getItem(it),r=e?JSON.parse(e):{};r[c]=t,localStorage.setItem(it,JSON.stringify(r))}catch(e){}}},G=class{constructor(t){this.options=t;this.drawerEl=null;this.contentEl=null;this.headerEl=null;var r,i;this.stateStore=(r=t.stateStore)!=null?r:Nt;let e=this.stateStore.get(t.id);this.isOpen=(i=e!=null?e:t.isOpen)!=null?i:!1}render(){this.drawerEl=document.createElement("div"),this.drawerEl.className=`${U}-drawer${this.isOpen?" is-open":""}`,this.drawerEl.setAttribute("data-drawer-id",this.options.id),this.headerEl=this.drawerEl.createDiv({cls:`${U}-drawer-header`,attr:{role:"button",tabindex:"0","aria-expanded":String(this.isOpen),"aria-controls":`${this.options.id}-content`}}),this.headerEl.createSpan({cls:`${U}-drawer-icon`,text:this.options.icon}),this.headerEl.createEl("h3",{cls:`${U}-drawer-title`,text:this.options.title}),this.headerEl.createSpan({cls:`${U}-drawer-arrow`,text:"\u25BC"});let t=this.drawerEl.createDiv({cls:`${U}-drawer-content`,attr:{id:`${this.options.id}-content`,role:"region","aria-labelledby":`${this.options.id}-header`}});return this.options.description&&t.createDiv({cls:`${U}-section-desc`,text:this.options.description}),this.contentEl=t.createDiv({cls:`${U}-drawer-inner`}),this.headerEl.addEventListener("click",()=>this.toggle()),this.headerEl.addEventListener("keydown",e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),this.toggle())}),this.drawerEl}getContentElement(){if(!this.contentEl)throw new Error("Drawer must be rendered before accessing content");return this.contentEl}toggle(){var t,e;this.isOpen=!this.isOpen,this.applyState(),this.stateStore.set(this.options.id,this.isOpen),(e=(t=this.options).onToggle)==null||e.call(t,this.isOpen)}open(){this.isOpen||this.toggle()}close(){this.isOpen&&this.toggle()}getIsOpen(){return this.isOpen}show(){var t;(t=this.drawerEl)==null||t.classList.remove(`${U}-hidden`)}hide(){var t;(t=this.drawerEl)==null||t.classList.add(`${U}-hidden`)}matchesQuery(t){var s,n,o,a;if(!t)return!0;let e=this.options.title.toLowerCase(),r=((s=this.options.description)!=null?s:"").toLowerCase(),i=(a=(o=(n=this.contentEl)==null?void 0:n.textContent)==null?void 0:o.toLowerCase())!=null?a:"";return e.includes(t)||r.includes(t)||i.includes(t)}filterByQuery(t){this.matchesQuery(t)?(this.show(),t&&this.open()):this.hide()}getElement(){return this.drawerEl}applyState(){!this.drawerEl||!this.headerEl||(this.isOpen?this.drawerEl.classList.add("is-open"):this.drawerEl.classList.remove("is-open"),this.headerEl.setAttribute("aria-expanded",String(this.isOpen)))}destroy(){this.drawerEl=null,this.contentEl=null,this.headerEl=null}};var st="ytc-settings",wt="ytc-settings-tooltip-container",O=null;function Gt(){let c=document.getElementById(wt);return c||(c=document.createElement("div"),c.id=wt,c.style.cssText="position: absolute; top: 0; left: 0; width: 100%; pointer-events: none; z-index: 10001;",document.body.appendChild(c)),c}function Yt(c){var r;let t=document.createElement("div");t.className=`${st}-tooltip`,t.setAttribute("role","tooltip"),t.setAttribute("data-placement",(r=c.placement)!=null?r:"top"),t.style.pointerEvents="none",c.isHtml?t.innerHTML=c.content:t.textContent=c.content;let e=document.createElement("div");return e.className=`${st}-tooltip-arrow`,t.appendChild(e),t}function qt(c,t,e){let r=t.getBoundingClientRect(),i=c.getBoundingClientRect(),s=8,n,o;e==="top"?(n=r.top-i.height-s,o=r.left+(r.width-i.width)/2):(n=r.bottom+s,o=r.left+(r.width-i.width)/2);let a=window.innerWidth,l=window.innerHeight;o<10&&(o=10),o+i.width>a-10&&(o=a-i.width-10),e==="top"&&n<10?(n=r.bottom+s,c.setAttribute("data-placement","bottom")):e==="bottom"&&n+i.height>l-10&&(n=r.top-i.height-s,c.setAttribute("data-placement","top")),c.style.top=`${n}px`,c.style.left=`${o}px`}function zt(c,t){pe();let e=Gt(),r=Yt(t);e.appendChild(r),requestAnimationFrame(()=>{var i;qt(r,c,(i=t.placement)!=null?i:"top")}),O={element:r,trigger:c,hideTimeout:null}}function pe(){O&&(O.hideTimeout&&clearTimeout(O.hideTimeout),O.element.remove(),O=null)}function Tt(c,t){var a,l;let e=(a=t.showDelay)!=null?a:300,r=(l=t.hideDelay)!=null?l:100,i=null,s=null,n=()=>{s&&(clearTimeout(s),s=null),i||(i=setTimeout(()=>{zt(c,t),i=null},e))},o=()=>{i&&(clearTimeout(i),i=null),s||(s=setTimeout(()=>{pe(),s=null},r))};c.addEventListener("mouseenter",n),c.addEventListener("mouseleave",o),c.addEventListener("focus",n),c.addEventListener("blur",o),c.addEventListener("mouseenter",()=>{O!=null&&O.hideTimeout&&(clearTimeout(O.hideTimeout),O.hideTimeout=null)})}function nt(c){let t=document.createElement("span");return t.className=`${st}-info-icon`,t.textContent="?",t.setAttribute("role","img"),t.setAttribute("aria-label","More information"),t.setAttribute("tabindex","0"),Tt(t,{content:c,placement:"top"}),t}var g="ytc-settings",Be=class extends L.PluginSettingTab{constructor(e,r){super(e,r.plugin);this.options=r;this.validationErrors=[];this.providerStatuses=new Map;this.drawers=new Map;this.providerCards=new Map;this.settings={...r.plugin.settings},this.secureConfig=new j(this.settings)}display(){let{containerEl:e}=this;e.empty(),e.addClass(`${g}-container`),pe(),this.settings={...this.options.plugin.settings},this.secureConfig=new j(this.settings),this.drawers.clear(),this.providerCards.clear(),this.createHeader(),this.createPresets(),this.createSearchBar(),this.createProviderStatusDashboard(),this.createQuickActions(),this.createAPISection(),this.createAISection(),this.createOutputSection(),this.createAdvancedSection()}createHeader(){let{containerEl:e}=this,r=e.createDiv({cls:`${g}-header`}),i=r.createDiv({cls:`${g}-title`});i.createSpan({text:"\u{1F3AC}"}),i.createSpan({text:"YT Clipper"});let s=this.validateConfiguration();this.headerBadge=r.createDiv({cls:`${g}-badge ${s?`${g}-badge-ready`:`${g}-badge-setup`}`}),this.headerBadge.textContent=s?"READY":"SETUP REQUIRED"}updateHeaderBadge(e){if(this.headerBadge){let r=e?`${g}-badge-ready`:`${g}-badge-setup`;this.headerBadge.className=`${g}-badge ${r}`,this.headerBadge.textContent=e?"\u2713 Ready":"\u26A0 Setup Required"}}createPresets(){var s;let e=this.containerEl.createDiv({cls:`${g}-presets`}),r=[{id:"fast",icon:"\u26A1",label:"Fast",desc:"Quick results",settings:{performanceMode:"fast",defaultMaxTokens:2048,defaultTemperature:.3,enableParallelProcessing:!0}},{id:"balanced",icon:"\u2696\uFE0F",label:"Balanced",desc:"Good speed & quality",settings:{performanceMode:"balanced",defaultMaxTokens:4096,defaultTemperature:.5,enableParallelProcessing:!0}},{id:"quality",icon:"\u2728",label:"Quality",desc:"Best results",settings:{performanceMode:"quality",defaultMaxTokens:8192,defaultTemperature:.7,enableParallelProcessing:!1}}],i=(s=this.settings.performanceMode)!=null?s:"balanced";r.forEach(n=>{let o=e.createEl("button",{cls:`${g}-preset-btn${i===n.id?" active":""}`,attr:{type:"button","aria-pressed":String(i===n.id)}});o.createSpan({cls:"preset-icon",text:n.icon}),o.createSpan({cls:"preset-label",text:n.label}),o.createSpan({cls:"preset-desc",text:n.desc}),o.addEventListener("click",async()=>{Object.entries(n.settings).forEach(([a,l])=>{this.settings[a]=l}),await this.validateAndSaveSettings(),this.display(),this.showToast(`Applied ${n.label} preset`,"success")})})}createSearchBar(){let e=this.containerEl.createDiv({cls:`${g}-search-bar`});e.createSpan({cls:`${g}-search-icon`,text:"\u{1F50D}"}),this.searchInput=e.createEl("input",{attr:{placeholder:"Search settings... (Ctrl+K)","aria-label":"Search settings"}}),this.searchInput.addEventListener("input",()=>{var r,i;this.filterSettings((i=(r=this.searchInput)==null?void 0:r.value)!=null?i:"")}),this.searchInput.addEventListener("keydown",r=>{var i;r.key==="k"&&r.ctrlKey&&(r.preventDefault(),(i=this.searchInput)==null||i.focus())})}filterSettings(e){let r=e.toLowerCase().trim();this.drawers.forEach((i,s)=>{i.filterByQuery(r)})}createProviderStatusDashboard(){let e=this.containerEl.createDiv({cls:`${g}-status-dashboard`});e.createDiv({cls:`${g}-status-title`,text:"Providers"});let r=e.createDiv({cls:`${g}-status-grid`});[{id:"gemini",name:"Gemini",key:"geminiApiKey"},{id:"groq",name:"Groq",key:"groqApiKey"},{id:"huggingface",name:"HuggingFace",key:"huggingFaceApiKey"},{id:"openrouter",name:"OpenRouter",key:"openRouterApiKey"},{id:"ollama",name:"Ollama",key:"ollamaApiKey"}].forEach(s=>{var l,d;let n=!!((l=this.settings[s.key])!=null&&l.trim()),o=(d=this.providerStatuses.get(s.id))!=null?d:"untested",a=r.createDiv({cls:`${g}-status-chip ${n?o:"untested"}`,attr:{role:"button",tabindex:n?"0":"-1","aria-label":`${s.name}: ${n?o:"not configured"}`}});a.createDiv({cls:`${g}-status-dot`}),a.createDiv({cls:`${g}-status-name`,text:s.name}),n?(a.title="Click to test connection",a.addEventListener("click",()=>{this.testProvider(s.id,s.name,s.key)}),a.addEventListener("keydown",u=>{(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),this.testProvider(s.id,s.name,s.key))})):(a.style.opacity="0.5",a.style.cursor="default")})}async testProvider(e,r,i){var n,o;this.providerStatuses.set(e,"testing"),this.display();let s=(n=this.settings[i])==null?void 0:n.trim();if(!s){this.providerStatuses.set(e,"untested"),this.display();return}try{switch(e){case"gemini":await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${s}`);break;case"groq":await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${s}`}});break;case"huggingface":await fetch("https://huggingface.co/api/whoami-v2",{headers:{Authorization:`Bearer ${s}`}});break;case"openrouter":await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${s}`}});break;case"ollama":{let a=(o=this.settings.ollamaEndpoint)!=null?o:"http://localhost:11434";await fetch(`${a}/api/tags`);break}}this.providerStatuses.set(e,"valid"),this.showToast(`${r} API key is valid!`,"success")}catch(a){this.providerStatuses.set(e,"invalid"),this.showToast(`${r} API key validation failed`,"error")}this.display()}createQuickActions(){let e=this.containerEl.createDiv({cls:`${g}-quick-actions`}),r=e.createEl("button",{cls:`${g}-action-btn primary`,attr:{type:"button","aria-label":"Test all provider connections"}});r.innerHTML="<span>\u{1F9EA}</span> Test Connections",r.addEventListener("click",()=>this.testAllProviders());let i=e.createEl("button",{cls:`${g}-action-btn`,attr:{type:"button","aria-label":"Manage settings"}});i.innerHTML="<span>\u2699\uFE0F</span> Manage Settings",i.addEventListener("click",n=>this.showSettingsPopup(n));let s=e.createEl("button",{cls:`${g}-action-btn danger`,attr:{type:"button","aria-label":"Reset settings to defaults"}});s.innerHTML="<span>\u{1F504}</span> Reset",s.addEventListener("click",async()=>this.resetToDefaults())}showSettingsPopup(e){let r=e.currentTarget,i=document.createElement("div");i.className=`${g}-popup`,i.setAttribute("role","menu");let s=document.createElement("div");s.style.cssText=`
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            z-index: 999;
        `;let n=(a,l,d)=>{let u=document.createElement("button");return u.className=`${g}-popup-item`,u.setAttribute("role","menuitem"),u.innerHTML=`<span>${l}</span> ${a}`,u.onclick=()=>{d(),i.remove(),s.remove()},u};i.appendChild(n("Export Settings","\u{1F4E4}",()=>this.exportSettings())),i.appendChild(n("Import Settings","\u{1F4E5}",()=>this.importSettings()));let o=r.getBoundingClientRect();i.style.top=`${o.bottom+5}px`,i.style.left=`${o.left}px`,i.style.position="fixed",s.onclick=()=>{i.remove(),s.remove()},document.body.appendChild(s),document.body.appendChild(i)}async testAllProviders(){var r;let e=[{id:"gemini",name:"Google Gemini",key:"geminiApiKey"},{id:"groq",name:"Groq",key:"groqApiKey"},{id:"huggingface",name:"Hugging Face",key:"huggingFaceApiKey"},{id:"openrouter",name:"OpenRouter",key:"openRouterApiKey"},{id:"ollama",name:"Ollama",key:"ollamaApiKey"}];for(let i of e)(r=this.settings[i.key])!=null&&r.trim()&&(await this.testProvider(i.id,i.name,i.key),await new Promise(s=>setTimeout(s,500)))}exportSettings(){let e=JSON.stringify(this.settings,null,2),r=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=`yt-clipper-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),this.showToast("Settings exported successfully!","success")}importSettings(){let e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",async r=>{var s;let i=(s=r.target.files)==null?void 0:s[0];if(i)try{let n=await i.text(),o=JSON.parse(n),a=y.validateSettings(o);if(!a.isValid){this.showToast(`Invalid settings file: ${a.errors.join(", ")}`,"error");return}let{ConfirmationModal:l}=await Promise.resolve().then(()=>(le(),Ce));await new l(this.app,{title:"Import Settings",message:"This will overwrite your current settings."}).openAndWait()&&(await this.options.onSettingsChange(o),this.settings={...o},this.display(),this.showToast("Settings imported successfully!","success"))}catch(n){this.showToast("Failed to import settings. Check file format.","error")}}),e.click()}async resetToDefaults(){let{ConfirmationModal:e}=await Promise.resolve().then(()=>(le(),Ce));if(await new e(this.app,{title:"Reset to Defaults",message:"This action cannot be undone.",confirmText:"Reset",isDangerous:!0}).openAndWait()){let n={...{geminiApiKey:this.settings.geminiApiKey,groqApiKey:this.settings.groqApiKey,huggingFaceApiKey:this.settings.huggingFaceApiKey,openRouterApiKey:this.settings.openRouterApiKey,ollamaApiKey:this.settings.ollamaApiKey,ollamaEndpoint:this.settings.ollamaEndpoint},outputPath:"YouTube/Processed Videos",useEnvironmentVariables:!1,environmentPrefix:"YTC",performanceMode:"balanced",enableParallelProcessing:!0,enableAutoFallback:!0,preferMultimodal:!0,defaultMaxTokens:4096,defaultTemperature:.5};this.settings=n,this.options.onSettingsChange(n),this.display(),this.showToast("Settings reset to defaults","info")}}showToast(e,r){let i=document.createElement("div");i.className=`${g}-toast ${r}`;let s=r==="success"?"\u2705":r==="error"?"\u274C":"\u2139\uFE0F";i.createSpan({text:s}),i.createSpan({text:` ${e}`}),document.body.appendChild(i),setTimeout(()=>{i.style.animation="ytc-settings-slideIn 0.3s ease reverse",setTimeout(()=>i.remove(),300)},3e3)}createAPISection(){let e=new G({id:"api-keys",title:"API Keys",icon:"\u{1F511}",description:"Configure your API keys for AI providers. Keys are stored securely and encrypted.",isOpen:!1});this.containerEl.appendChild(e.render()),this.drawers.set("api-keys",e);let r=e.getContentElement();this.createAPIKeySetting(r,{name:"Google Gemini API Key",desc:"Primary AI provider for video analysis.",placeholder:"Enter your Gemini API key (AIzaSy...)",settingKey:"geminiApiKey",infoTooltip:"Get a free API key from Google AI Studio (aistudio.google.com)",validateFn:async i=>{let s=await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${i}`);if(!s.ok)throw new Error(`HTTP ${s.status}`)}}),this.createAPIKeySetting(r,{name:"Groq API Key",desc:"Fast alternative AI provider.",placeholder:"Enter your Groq API key (gsk_...)",settingKey:"groqApiKey",infoTooltip:"Get a free API key from Groq Console (console.groq.com)",validateFn:async i=>{let s=await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${i}`}});if(!s.ok)throw new Error(`HTTP ${s.status}`)}}),this.createAPIKeySetting(r,{name:"Hugging Face API Key",desc:"Alternative AI provider with free tier.",placeholder:"hf_...",settingKey:"huggingFaceApiKey",infoTooltip:"Get a token from huggingface.co/settings/tokens",validateFn:async i=>{let s=await fetch("https://huggingface.co/api/whoami-v2",{headers:{Authorization:`Bearer ${i}`}});if(!s.ok)throw new Error(`HTTP ${s.status}`)}}),this.createAPIKeySetting(r,{name:"OpenRouter API Key",desc:"Access multiple AI models through one API.",placeholder:"sk-or-...",settingKey:"openRouterApiKey",infoTooltip:"Get a key from openrouter.ai/keys",validateFn:async i=>{let s=await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${i}`}});if(!s.ok)throw new Error(`HTTP ${s.status}`)}}),this.createAPIKeySetting(r,{name:"Ollama API Key",desc:"Required for Ollama Cloud. Not needed for local instances.",placeholder:"Optional - required for cloud only",settingKey:"ollamaApiKey",infoTooltip:"Get a key from ollama.com/settings (cloud only)",optional:!0,validateFn:async i=>{let s=this.settings.ollamaEndpoint||"http://localhost:11434",n=s.includes("ollama.com")||s.includes("cloud"),o=n?"https://ollama.com/api":`${s}/api`,a={"Content-Type":"application/json"};n&&i&&(a.Authorization=`Bearer ${i}`);let l=await fetch(`${o}/tags`,{headers:a});if(!l.ok){let d=await l.text().catch(()=>"Unknown error");throw new Error(`HTTP ${l.status}: ${d}`)}}}),new L.Setting(r).setName("Ollama Endpoint").setDesc("Ollama API endpoint. Local: http://localhost:11434 | Cloud: https://ollama.com").addText(i=>{i.setPlaceholder("http://localhost:11434").setValue(this.settings.ollamaEndpoint||"http://localhost:11434").onChange(async s=>{await this.updateSetting("ollamaEndpoint",s.trim())})})}createAPIKeySetting(e,r){let i=new L.Setting(e).setName(r.name).setDesc(r.desc),s=nt(r.infoTooltip);i.nameEl.appendChild(s),i.addText(u=>{u.inputEl.type="password",u.inputEl.autocomplete="off",u.inputEl.style.width="300px",this.secureConfig.getApiKey(r.settingKey).then(async p=>{let m=p?await this.secureConfig.getMaskedApiKey(r.settingKey):"";u.setValue(m)}),u.setPlaceholder(r.placeholder).onChange(async p=>{await this.updateSetting(r.settingKey,p.trim())})});let n=i.controlEl,o=n.createEl("button",{cls:`${g}-password-toggle`,text:"\u{1F441}\uFE0F",attr:{type:"button",title:"Toggle visibility","aria-label":"Toggle password visibility"}}),a=!1,l="";o.addEventListener("click",async()=>{a=!a;let u=n.querySelector('input[type="password"], input[type="text"]');if(u)if(a){l=u.value;let p=await this.secureConfig.getApiKey(r.settingKey);u.value=p||"",u.type="text",o.textContent="\u{1F648}",o.title="Hide key"}else{let p=await this.secureConfig.getMaskedApiKey(r.settingKey);u.value=l||p||"",u.type="password",o.textContent="\u{1F441}\uFE0F",o.title="Show key"}});let d=n.createEl("button",{cls:`${g}-validate-btn`,text:"\u2713 Test",attr:{type:"button","aria-label":`Test ${r.name}`}});d.addEventListener("click",async()=>{let u=await this.secureConfig.getApiKey(r.settingKey);if(!u&&!r.optional){this.showToast(`No ${r.name} configured`,"info");return}d.disabled=!0,d.innerHTML='<span class="ytc-settings-spinner"></span>',d.removeClass("is-success","is-error");try{await r.validateFn(u),d.textContent="\u2713 Valid",d.addClass("is-success"),this.showToast(`${r.name} is valid!`,"success");let p=r.settingKey.replace("ApiKey","").toLowerCase();this.providerStatuses.set(p,"valid")}catch(p){d.textContent="\u2717 Invalid",d.addClass("is-error"),this.showToast(`${r.name} failed: ${p.message}`,"error");let m=r.settingKey.replace("ApiKey","").toLowerCase();this.providerStatuses.set(m,"invalid")}setTimeout(()=>{d.textContent="\u2713 Test",d.removeClass("is-success","is-error"),d.disabled=!1},3e3)})}createAISection(){var i;let e=new G({id:"ai-config",title:"AI Configuration",icon:"\u{1F916}",description:"Configure AI model behavior and output settings.",isOpen:!1});this.containerEl.appendChild(e.render()),this.drawers.set("ai-config",e);let r=e.getContentElement();this.createSlider(r,{label:"Maximum Output Tokens",desc:"Controls the length of generated notes. Higher values produce more detailed output.",min:512,max:8192,step:256,value:this.settings.defaultMaxTokens||4096,key:"defaultMaxTokens",format:s=>s.toLocaleString(),scale:["Short (512)","Long (8192)"]}),this.createSlider(r,{label:"Temperature",desc:"Controls AI creativity. Lower = more focused/factual, Higher = more creative.",min:0,max:1,step:.1,value:(i=this.settings.defaultTemperature)!=null?i:.5,key:"defaultTemperature",format:s=>s.toFixed(1),scale:["Precise (0)","Creative (1)"]}),new L.Setting(r).setName("Performance Mode").setDesc("Choose processing speed vs output quality tradeoff.").addDropdown(s=>s.addOption("fast","\u26A1 Fast \u2014 Quick results, basic analysis").addOption("balanced","\u2696\uFE0F Balanced \u2014 Good speed & quality").addOption("quality","\u2728 Quality \u2014 Best results, slower").setValue(this.settings.performanceMode||"balanced").onChange(async n=>{await this.updateSetting("performanceMode",n)}))}createOutputSection(){let e=new G({id:"output",title:"Output Settings",icon:"\u{1F41B}",description:"Configure where processed video notes are saved.",isOpen:!1});this.containerEl.appendChild(e.render()),this.drawers.set("output",e);let r=e.getContentElement();new L.Setting(r).setName("Output Folder").setDesc("Folder path where processed video notes will be saved.").addText(i=>i.setPlaceholder("YouTube/Processed Videos").setValue(this.settings.outputPath||"YouTube/Processed Videos").onChange(async s=>{await this.updateSetting("outputPath",s.trim()||"YouTube/Processed Videos")}))}async createAdvancedSection(){let e=new G({id:"advanced",title:"Advanced Settings",icon:"\u2699\uFE0F",description:"Advanced configuration options for power users.",isOpen:!1});this.containerEl.appendChild(e.render()),this.drawers.set("advanced",e);let r=e.getContentElement(),i=r.createDiv({cls:`${g}-security-status`});i.createEl("h3",{text:"\u{1F512} Security Status"});let s=i.createDiv(),n=await this.secureConfig.validateSecurityConfiguration();if(n.warnings.length>0||n.suggestions.length>0){if(n.warnings.length>0){let p=s.createEl("div",{cls:`${g}-security-warnings`});n.warnings.forEach(m=>{let v=p.createEl("div");v.textContent=`\u26A0\uFE0F ${m}`,v.style.margin="4px 0"})}if(n.suggestions.length>0){let p=s.createEl("div",{cls:`${g}-security-suggestions`});n.suggestions.forEach(m=>{let v=p.createEl("div");v.textContent=m,v.style.margin="4px 0",v.style.color="var(--text-muted)"})}let u=this.secureConfig.getRotationRecommendations().filter(p=>p.shouldRotate);if(u.length>0){let p=s.createEl("div",{cls:`${g}-rotation-alert`}),m=p.createEl("div",{text:"\u{1F504} Key Rotation Recommended"});m.style.fontWeight="bold",m.style.margin="8px 0 4px 0",p.appendChild(m),u.forEach(v=>{let E=p.createEl("div");E.style.marginLeft="16px",E.textContent=`\u2022 ${v.keyType}: ${v.reason}`})}}else{let d=s.createEl("div",{cls:`${g}-security-secure`});d.textContent="\u2705 All API keys are properly secured"}let o=s.createDiv({cls:`${g}-security-actions`});o.style.marginTop="12px";let a=o.createEl("button",{text:"\u{1F5D1}\uFE0F Clear All API Keys",cls:"mod-warning"});a.style.marginRight="8px",a.addEventListener("click",()=>{confirm("Are you sure you want to clear all API keys? This cannot be undone.")&&(this.secureConfig.clearAllApiKeys(),this.showToast("All API keys have been cleared","info"),this.display())}),o.createEl("button",{text:"\u{1F4E4} Export Settings (Masked)"}).addEventListener("click",()=>{let d=this.secureConfig.exportSafeSettings(),u=JSON.stringify(d,null,2),p=new Blob([u],{type:"application/json"}),m=URL.createObjectURL(p),v=document.createElement("a");v.href=m,v.download=`youtube-clipper-settings-${new Date().toISOString().split("T")[0]}.json`,v.click(),URL.revokeObjectURL(m),this.showToast("Settings exported (API keys are masked)","success")}),new L.Setting(r).setName("Parallel Processing").setDesc("Query multiple AI providers simultaneously for faster results.").addToggle(d=>{var u;return d.setValue((u=this.settings.enableParallelProcessing)!=null?u:!1).onChange(async p=>{await this.updateSetting("enableParallelProcessing",p)})}),new L.Setting(r).setName("Multimodal Video Analysis").setDesc("Enable audio + visual analysis for supported models (Gemini 2.5+).").addToggle(d=>{var u;return d.setValue((u=this.settings.preferMultimodal)!=null?u:!1).onChange(async p=>{await this.updateSetting("preferMultimodal",p)})}),new L.Setting(r).setName("Use Environment Variables").setDesc("Load API keys from environment variables (YTC_GEMINI_API_KEY, etc.).").addToggle(d=>{var u;return d.setValue((u=this.settings.useEnvironmentVariables)!=null?u:!1).onChange(async p=>{await this.updateSetting("useEnvironmentVariables",p)})}),new L.Setting(r).setName("Get Environment Variable Template").setDesc("Get a template file showing how to set up environment variables for secure key management.").addButton(d=>{d.setButtonText("\u{1F4CB} Copy Template"),d.onClick(()=>{let u=this.secureConfig.getEnvironmentTemplate();navigator.clipboard.writeText(u).then(()=>{this.showToast("Environment template copied to clipboard!","success")}).catch(()=>{this.showToast("Failed to copy template","error")})})})}createSlider(e,r){let i=e.createDiv({cls:`${g}-slider-wrap`}),s=i.createDiv({cls:`${g}-slider-top`});s.createSpan({cls:`${g}-slider-label`,text:r.label});let n=s.createSpan({cls:`${g}-slider-value`,text:r.format(r.value)}),o=i.createEl("input",{type:"range",cls:`${g}-slider`,attr:{"aria-label":r.label,"aria-valuemin":String(r.min),"aria-valuemax":String(r.max),"aria-valuenow":String(r.value)}});o.min=String(r.min),o.max=String(r.max),o.step=String(r.step),o.value=String(r.value);let a=i.createDiv({cls:`${g}-slider-scale`});a.createSpan({text:r.scale[0]}),a.createSpan({text:r.scale[1]}),i.createDiv({cls:`${g}-slider-desc`,text:r.desc}),o.addEventListener("input",()=>{let l=parseFloat(o.value);n.textContent=r.format(l),o.setAttribute("aria-valuenow",String(l))}),o.addEventListener("change",async()=>{let l=r.step<1?parseFloat(o.value):parseInt(o.value);await this.updateSetting(r.key,l)})}validateConfiguration(){var i,s;let e=((i=this.settings.geminiApiKey)==null?void 0:i.trim())||((s=this.settings.groqApiKey)==null?void 0:s.trim()),r=y.isValidPath(this.settings.outputPath);return!!(e&&r)}async updateSetting(e,r){try{if(this.isApiKeyField(e)&&typeof r=="string")if(r&&r!=="")try{let i=this.secureConfig.setApiKey(e,r);this.settings[e]=i}catch(i){w.handle(i,`API Key Validation: ${e}`,!0);return}else this.settings[e]="";else this.settings[e]=r;await this.validateAndSaveSettings()}catch(i){w.handle(i,`Settings update: ${e}`)}}isApiKeyField(e){return["geminiApiKey","groqApiKey","ollamaApiKey","huggingFaceApiKey","openRouterApiKey"].includes(e)}async validateAndSaveSettings(){let e=y.validateSettings(this.settings),r=this.validationErrors.length>0,i=e.errors.length>0;this.validationErrors=e.errors,e.isValid?(await this.options.onSettingsChange(this.settings),this.updateHeaderBadge(!0)):this.updateHeaderBadge(!1),r!==i&&this.display()}getSettings(){return{...this.settings}}updateSettings(e){this.settings={...e},this.display()}};var _=require("obsidian");var ot=require("obsidian");S();var $e=class{constructor(t,e,r){this.getSettings=t;this.getServiceContainer=e;this.isUnloading=r}async process(t){if(this.isUnloading())throw M.log("Plugin is unloading, cancelling video processing"),new Error("Plugin is shutting down");let e=this.getSettings(),r=this.getServiceContainer(),i=await M.safeOperation(async()=>{new ot.Notice(f.PROCESSING);let s=y.validateSettings(e);if(!s.isValid)throw new Error(`Configuration invalid: ${s.errors.join(", ")}`);if(!r)throw new Error("Service container not initialized");return await this.doProcess(t,e,r)},"YouTube Video Processing");if(i===null)throw new Error("Video processing was interrupted");return i}async doProcess(t,e,r){let{url:i,format:s="step-by-step-tutorial",providerName:n,model:o,maxTokens:a,temperature:l,enableAutoFallback:d}=t,u=r.videoService,p=r.aiService,m=r.fileService,v=r.promptService,E=u.extractVideoId(i);if(!E)throw new Error(f.ERRORS.VIDEO_ID_EXTRACTION);let A=await u.getVideoData(E),x=await this.fetchTranscript(u,E),H=v.createAnalysisPrompt({videoData:A,videoUrl:i,format:s,transcript:x});h.aiService("Processing video",{videoId:E,format:s,provider:n!=null?n:"Auto",model:o!=null?o:"Default",maxTokens:a!=null?a:2048,temperature:l!=null?l:.7}),this.configureProviders(p,a,l);let q=await this.getAIResponse(p,H,n,o,d),se=v.processAIResponse(q.content,q.provider,q.model,s,A,i),Q=await m.saveToFile(A.title,se,e.outputPath);return new ot.Notice(f.SUCCESS(A.title)),Q}async fetchTranscript(t,e){try{if(t.getTranscript){let r=await t.getTranscript(e);if(r!=null&&r.fullText)return h.info("Transcript fetched successfully","VideoProcessor",{videoId:e,transcriptLength:r.fullText.length}),r.fullText;h.debug("No transcript available for this video","VideoProcessor",{videoId:e})}}catch(r){h.debug("Could not fetch transcript, continuing without it","VideoProcessor",{error:r instanceof Error?r.message:String(r)})}}configureProviders(t,e,r){var s;let i=(s=t.providers)!=null?s:[];for(let n of i)e&&n.setMaxTokens&&n.setMaxTokens(e),r!==void 0&&n.setTemperature&&n.setTemperature(r)}async getAIResponse(t,e,r,i,s){try{if(r&&t.processWith){let n=s!=null?s:!0;return await t.processWith(r,e,i,void 0,n)}else return await t.process(e)}catch(n){throw h.error("AI Processing failed","VideoProcessor",{error:n instanceof Error?n.message:String(n)}),n instanceof Error&&w.handleEnhanced(n,"AI Processing"),n}}};te();S();Z();function Pt(c){var e;return(e={brief:"concise-summary","detailed-guide":"step-by-step-tutorial",transcript:"complete-transcription","3c-concept":"3c-accelerated-learning","accelerated-learning":"3c-accelerated-learning","executive-briefing":"executive-summary",custom:"concise-summary"}[c])!=null?e:null}var P=class{static loadPreferences(){var t,e;try{let r=localStorage.getItem(this.STORAGE_KEY);if(r){let i=JSON.parse(r),s=(t=i.formatUsage)!=null?t:{},n={};for(let[o,a]of Object.entries(s)){let l=Pt(o);l&&(n[l]=((e=n[l])!=null?e:0)+a)}if(i.formatUsage=n,i.lastFormat){let o=Pt(i.lastFormat);o&&(i.lastFormat=o)}return{...this.DEFAULT_PREFERENCES,...i}}}catch(r){}return{...this.DEFAULT_PREFERENCES}}static savePreferences(t){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){}}static getPreference(t){return this.loadPreferences()[t]}static setPreference(t,e){let r=this.loadPreferences();r[t]=e,this.savePreferences(r)}static updateLastUsed(t){var r,i,s;let e=this.loadPreferences();t.format&&(e.lastFormat=t.format,e.formatUsage||(e.formatUsage={}),e.formatUsage[t.format]=((r=e.formatUsage[t.format])!=null?r:0)+1),t.provider&&(e.lastProvider=t.provider,e.providerUsage||(e.providerUsage={}),e.providerUsage[t.provider]=((i=e.providerUsage[t.provider])!=null?i:0)+1),t.model&&(e.lastModel=t.model),t.maxTokens&&(e.lastMaxTokens=t.maxTokens),t.temperature&&(e.lastTemperature=t.temperature),t.performanceMode&&(e.lastPerformanceMode=t.performanceMode),t.parallelProcessing!==void 0&&(e.lastParallelProcessing=t.parallelProcessing),t.multimodal!==void 0&&(e.lastMultimodal=t.multimodal),t.autoFallback!==void 0&&(e.lastAutoFallback=t.autoFallback),e.lastUsed=new Date().toISOString(),e.totalProcessed=((s=e.totalProcessed)!=null?s:0)+1,this.savePreferences(e)}static getSmartDefaultFormat(){var s;let t=this.loadPreferences();if(t.preferredFormat)return t.preferredFormat;let e=(s=t.formatUsage)!=null?s:{},r=0,i="executive-summary";for(let[n,o]of Object.entries(e)){let a=typeof o=="number"?o:0;a>r&&(r=a,i=n)}return i}static getSmartDefaultProvider(){var s;let t=this.loadPreferences();if(t.preferredProvider)return t.preferredProvider;let e=(s=t.providerUsage)!=null?s:{},r=0,i;for(let[n,o]of Object.entries(e))o>r&&(r=o,i=n);return i}static getSmartDefaultModelParameters(){var e,r;let t=this.loadPreferences();return{maxTokens:(e=t.lastMaxTokens)!=null?e:4096,temperature:(r=t.lastTemperature)!=null?r:.5}}static getSmartDefaultPerformanceSettings(){var e,r,i,s;let t=this.loadPreferences();return{mode:(e=t.lastPerformanceMode)!=null?e:"balanced",parallel:(r=t.lastParallelProcessing)!=null?r:!1,multimodal:(i=t.lastMultimodal)!=null?i:!0,autoFallback:(s=t.lastAutoFallback)!=null?s:!0}}static getSmartDefaultAutoFallback(){var e;let t=this.loadPreferences();return t.preferredAutoFallback!==void 0?t.preferredAutoFallback:(e=t.lastAutoFallback)!=null?e:!0}static getUserInsights(){var u,p,m,v,E;let t=this.loadPreferences(),e=(u=t.formatUsage)!=null?u:{},r=(p=t.providerUsage)!=null?p:{},i="executive-summary",s=0;for(let[A,x]of Object.entries(e)){let H=typeof x=="number"?x:0;H>s&&(s=H,i=A)}let n="",o=0;for(let[A,x]of Object.entries(r)){let H=typeof x=="number"?x:0;H>o&&(o=H,n=A)}let a=(m=t.totalProcessed)!=null?m:0,l=a<5?"light":a<20?"moderate":"heavy",d=[];return l==="heavy"&&!t.showAdvancedSettings&&d.push("Consider enabling advanced settings for more control"),!t.autoSelectProvider&&Object.keys(r).length>1&&d.push("Enable auto-select provider to speed up your workflow"),!t.showPreview&&a>10&&d.push("Enable video preview for better context"),{favoriteFormat:i,favoriteProvider:n,averageTokens:(v=t.lastMaxTokens)!=null?v:4096,averageTemperature:(E=t.lastTemperature)!=null?E:.5,usageLevel:l,recommendations:d}}static resetPreferences(){localStorage.removeItem(this.STORAGE_KEY)}static exportPreferences(){let t=this.loadPreferences();return JSON.stringify(t,null,2)}static importPreferences(t){try{let e=JSON.parse(t);return this.savePreferences({...this.DEFAULT_PREFERENCES,...e}),!0}catch(e){return!1}}};P.STORAGE_KEY="yt-clipper-user-preferences",P.DEFAULT_PREFERENCES={autoSelectProvider:!0,showPreview:!0,enableKeyboardShortcuts:!0,enableAnimations:!0,autoFocusUrl:!0,showAdvancedSettings:!1,compactMode:!1,formatUsage:{"concise-summary":0,"executive-summary":0,"step-by-step-tutorial":0,"complete-transcription":0,"3c-accelerated-learning":0,"technical-analysis":0},providerUsage:{}};var Y=require("obsidian"),He=class extends D{constructor(e,r){var u,p,m,v,E,A,x;super(e);this.options=r;this.url="";this.format="executive-summary";this.fetchInProgress=!1;this.progressSteps=[];this.currentStepIndex=0;this.isProcessing=!1;this.isLightTheme=!1;this.autoFallbackEnabled=!0;this.url=(u=r.initialUrl)!=null?u:"";let i=localStorage.getItem("ytc-theme-mode");this.isLightTheme=i==="light";let s=P.getSmartDefaultPerformanceSettings(),n=(p=P.getSmartDefaultProvider())!=null?p:"Google Gemini",o=(m=P.getSmartDefaultFormat())!=null?m:"timestamped",a=(v=P.getSmartDefaultAutoFallback())!=null?v:!0,l=P.getPreference("preferredModel"),d=P.getPreference("lastModel");this.selectedProvider=n!=null?n:"Google Gemini",this.selectedModel=(E=l!=null?l:d)!=null?E:"gemini-2.5-pro",this.format=o,this.autoFallbackEnabled=a,P.updateLastUsed({format:o,provider:this.selectedProvider,model:this.selectedModel,maxTokens:(A=r.defaultMaxTokens)!=null?A:4096,temperature:(x=r.defaultTemperature)!=null?x:.5,performanceMode:s.mode,parallelProcessing:s.parallel,multimodal:s.multimodal})}onOpen(){h.debug("[YT-CLIPPER] YouTubeUrlModal.onOpen called","Modal");try{if(this.createModalContent(),h.debug("[YT-CLIPPER] Modal content created","Modal"),this.setupEventHandlers(),h.debug("[YT-CLIPPER] Event handlers set up","Modal"),this.setupKeyboardShortcuts(),h.debug("[YT-CLIPPER] Keyboard shortcuts set up","Modal"),this.fetchModelsForCurrentProvider(),this.options.initialUrl&&(this.setUrl(this.options.initialUrl),this.updateProcessButtonState(),y.isValidYouTubeUrl((this.options.initialUrl||"").trim())&&this.processButton)){this.processButton.focus();return}this.focusUrlInput()}catch(e){throw h.error("[YT-CLIPPER] Error in onOpen:","Modal",e),e}}async fetchModelsForCurrentProvider(){var e,r;if(!(!this.options.fetchModelsForProvider||!this.selectedProvider))try{h.debug("[YT-CLIPPER] Fetching models for provider:","Modal",this.selectedProvider);let i=await this.options.fetchModelsForProvider(this.selectedProvider,!0);if(h.debug("[YT-CLIPPER] Fetched models count:","Modal",(i==null?void 0:i.length)||0),i&&i.length>0){let s={...this.options.modelOptions,[this.selectedProvider]:i};this.options.modelOptions=s,this.updateModelDropdown(s),h.debug("[YT-CLIPPER] Updated dropdown with models","Modal",{count:i.length})}else h.warn("[YT-CLIPPER] No models returned from API, using fallback","Modal"),this.updateModelDropdown((e=this.options.modelOptions)!=null?e:{})}catch(i){h.error("[YT-CLIPPER] Auto-fetch models failed:","Modal",i),h.warn("[YT-CLIPPER] Falling back to cached or static models","Modal"),this.updateModelDropdown((r=this.options.modelOptions)!=null?r:{})}}createModalContent(){var e;h.debug("[YT-CLIPPER] createModalContent starting","Modal");try{this.contentEl.empty(),this.contentEl.addClass("ytc-modal-content-wrapper"),this.createTopBar(),h.debug("[YT-CLIPPER] Top bar created","Modal"),this.createUrlSection(),h.debug("[YT-CLIPPER] URL section created","Modal"),this.createSettingsSection(),h.debug("[YT-CLIPPER] Settings section created","Modal"),this.createProgressSection(),h.debug("[YT-CLIPPER] Progress section created","Modal"),this.createActionButtons(),h.debug("[YT-CLIPPER] Action buttons created","Modal"),this.updateModelDropdown((e=this.options.modelOptions)!=null?e:{}),this.applyTheme(this.isLightTheme),h.debug("[YT-CLIPPER] Theme applied","Modal")}catch(r){throw h.error("[YT-CLIPPER] Error in createModalContent:","Modal",r),r}}createTopBar(){let e=this.contentEl.createDiv("ytc-top-bar");e.style.cssText=`
            display: flex;
            justify-content: space-between;
            align-items: center;
        `;let r=e.createDiv(),i=r.createEl("h2");i.textContent="YouTube to Note",this.headerEl=i;let s=r.createDiv("subtitle");s.textContent="Generate AI summaries & notes";let n=e.createDiv();n.style.cssText=`
            display: flex;
            gap: 6px;
            align-items: center;
        `;let o=n.createEl("button"),a=()=>{o.innerHTML='<span style="font-size: 1.1em">\u{1F504}</span>',o.style.opacity=this.autoFallbackEnabled?"1":"0.4",o.style.borderColor=this.autoFallbackEnabled?"var(--ytc-accent)":"var(--ytc-border)",o.title=`Auto Fallback: ${this.autoFallbackEnabled?"ON":"OFF"}`};o.setAttribute("aria-label","Toggle Auto Fallback"),o.style.cssText=`
            background: transparent;
            border: 1px solid var(--ytc-border);
            border-radius: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--ytc-text-secondary);
        `,a(),o.onclick=()=>{this.autoFallbackEnabled=!this.autoFallbackEnabled,a(),P.updateLastUsed({autoFallback:this.autoFallbackEnabled})},o.onmouseenter=()=>{o.style.background="var(--ytc-bg-tertiary)",o.style.color="var(--ytc-text-primary)"},o.onmouseleave=()=>{o.style.background="transparent",o.style.color="var(--ytc-text-secondary)"};let l=n.createEl("button");l.innerHTML='<span style="font-size: 1.1em">\u{1F4E6}</span>',l.setAttribute("aria-label","Batch Process"),l.title="Batch Process Multiple Videos",l.style.cssText=`
            background: transparent;
            border: 1px solid var(--ytc-border);
            border-radius: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--ytc-text-secondary);
        `,l.onclick=()=>{var u,p;return(p=(u=this.options).onOpenBatchModal)==null?void 0:p.call(u)},l.onmouseenter=()=>{l.style.background="var(--ytc-bg-tertiary)",l.style.color="var(--ytc-text-primary)"},l.onmouseleave=()=>{l.style.background="transparent",l.style.color="var(--ytc-text-secondary)"};let d=n.createEl("button");d.innerHTML=this.isLightTheme?"\u{1F319}":"\u2600\uFE0F",d.setAttribute("aria-label","Toggle Theme"),d.title="Toggle Light/Dark Mode",d.style.cssText=`
            background: transparent;
            border: 1px solid var(--ytc-border);
            border-radius: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1em;
            color: var(--ytc-text-secondary);
        `,d.onclick=()=>{this.isLightTheme=!this.isLightTheme,this.applyTheme(this.isLightTheme),localStorage.setItem("ytc-theme-mode",this.isLightTheme?"light":"dark"),d.innerHTML=this.isLightTheme?"\u{1F319}":"\u2600\uFE0F"},d.onmouseenter=()=>{d.style.background="var(--ytc-bg-tertiary)",d.style.color="var(--ytc-text-primary)"},d.onmouseleave=()=>{d.style.background="transparent",d.style.color="var(--ytc-text-secondary)"}}createUrlSection(){let e=this.contentEl.createDiv();e.style.cssText=`
            margin: 0 0 20px 0;
            position: relative;
        `;let r=e.createDiv("ytc-input-group");r.style.cssText=`
            position: relative;
            display: flex;
            align-items: center;
        `,this.urlInput=r.createEl("input"),this.urlInput.type="url",this.urlInput.placeholder="Paste YouTube URL here...",this.urlInput.setAttribute("aria-label","YouTube URL Input"),this.pasteButton=r.createEl("button",{cls:"ytc-paste-btn-integrated"}),this.pasteButton.innerHTML="\u{1F4CB} Paste",this.pasteButton.setAttribute("aria-label","Paste URL from clipboard"),this.pasteButton.title="Paste from clipboard",this.pasteButton.addEventListener("click",i=>{i.preventDefault(),this.handleSmartPaste()}),this.validationMessage=e.createDiv(),this.validationMessage.setAttribute("aria-live","polite"),this.validationMessage.style.cssText=`
            position: absolute;
            bottom: -20px;
            left: 2px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            height: 20px;
            display: flex;
            align-items: center;
        `,this.createVideoPreviewSection(e)}createSettingsSection(){var lt;let e=this.contentEl.createDiv();e.addClass("ytc-settings-section"),e.style.cssText=`
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        `;let r=e.createDiv();r.style.cssText=`
            display: flex;
            gap: 12px;
            align-items: flex-end;
        `;let i=r.createDiv();i.style.flex="1";let s=i.createEl("label");s.textContent="OUTPUT FORMAT",s.htmlFor="ytc-format-select",s.style.cssText=`
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--ytc-text-muted);
            margin-bottom: 6px;
            letter-spacing: 0.05em;
            display: block;
        `,this.formatSelect=i.createEl("select"),this.formatSelect.id="ytc-format-select",[{value:"executive-summary",text:"\u{1F4CA} 1. Executive Summary"},{value:"step-by-step-tutorial",text:"\u{1F4D8} 2. Step-by-Step Tutorial"},{value:"concise-summary",text:"\u26A1 3. Concise Summary"},{value:"technical-analysis",text:"\u2699\uFE0F 4. Technical Analysis"},{value:"3c-accelerated-learning",text:"\u{1F9E0} 5. 3C Accelerated Learning"},{value:"complete-transcription",text:"\u{1F4DD} 6. Complete Transcription"}].forEach(b=>{if(!this.formatSelect)return;let I=this.formatSelect.createEl("option");I.value=b.value,I.textContent=b.text}),this.formatSelect.value=this.format,this.formatSelect.addEventListener("change",()=>{var b,I;this.format=(I=(b=this.formatSelect)==null?void 0:b.value)!=null?I:"executive-summary",P.setPreference("lastFormat",this.format)});let o=r.createDiv();o.style.flex="1";let a=o.createEl("label");a.textContent="AI CONFIGURATION",a.style.cssText=`
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--ytc-text-muted);
            margin-bottom: 6px;
            letter-spacing: 0.05em;
            display: block;
        `;let l=o.createDiv();l.addClass("ytc-ai-toggle-btn"),l.setAttribute("role","button"),l.setAttribute("tabindex","0"),l.style.cssText=`
            background: var(--ytc-bg-input);
            border: 1px solid var(--ytc-border);
            border-radius: 8px;
            height: 38px;
            padding: 0 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        `;let d=l.createDiv();d.style.cssText=`
            font-size: 0.9rem;
            color: var(--ytc-text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        `;let u=l.createDiv();u.innerHTML='<svg width="10" height="6" viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 1L5 5L9 1"/></svg>',u.style.cssText=`
            transition: transform 0.2s ease;
            opacity: 0.5;
            margin-left: 8px;
            flex-shrink: 0;
            color: var(--ytc-text-secondary);
        `;let p=e.createDiv("ytc-ai-content");p.style.cssText=`
            background: var(--ytc-bg-secondary);
            border: 1px solid var(--ytc-border);
            border-radius: 8px;
            padding: 16px;
            display: none;
            margin-top: -4px;
            animation: fadeIn 0.15s ease-out;
        `;let m=!1,v=()=>{var ct,dt;let b=(ct=this.selectedProvider)!=null?ct:"Google Gemini",I=(dt=this.selectedModel)!=null?dt:"Default";d.textContent=`${b}`,d.title=`${b} \u2022 ${this.formatModelName(I)}`},E=()=>{m=!m,p.style.display=m?"block":"none",l.classList.toggle("active",m),l.style.borderColor=m?"var(--ytc-accent)":"var(--ytc-border)",u.style.transform=m?"rotate(180deg)":"rotate(0deg)"};l.addEventListener("click",E),l.addEventListener("keydown",b=>{(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),E())});let A=p.createDiv(),x=A.createEl("label");x.textContent="AI PROVIDER",x.htmlFor="ytc-provider-select",x.style.cssText="font-size: 0.7rem; font-weight: 600; margin-bottom: 6px; color: var(--ytc-text-muted); letter-spacing: 0.05em; display: block;",this.providerSelect=A.createEl("select"),this.providerSelect.id="ytc-provider-select",[{value:"Google Gemini",text:"Google Gemini (Recommended)"},{value:"Groq",text:"Groq (Fastest)"},{value:"OpenRouter",text:"OpenRouter"},{value:"Hugging Face",text:"Hugging Face"},{value:"Ollama",text:"Ollama (Local)"},{value:"Ollama Cloud",text:"Ollama Cloud"}].forEach(b=>{if(!this.providerSelect)return;let I=this.providerSelect.createEl("option");I.value=b.value,I.textContent=b.text}),this.providerSelect.value=(lt=this.selectedProvider)!=null?lt:"Google Gemini";let q=p.createDiv();q.style.cssText="margin-top: 16px;";let se=q.createEl("label");se.textContent="MODEL",se.htmlFor="ytc-model-select",se.style.cssText="font-size: 0.7rem; font-weight: 600; color: var(--ytc-text-muted); letter-spacing: 0.05em; display: block; margin-bottom: 6px;";let Q=q.createDiv();Q.style.cssText="display: flex; gap: 8px; align-items: center;",this.modelSelect=Q.createEl("select"),this.modelSelect.id="ytc-model-select",this.modelSelect.style.cssText=`
            flex: 1;
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 8px;
            font-size: 0.95rem;
            background: var(--background-primary);
            height: 42px;
            cursor: pointer;
        `;let J=Q.createEl("button",{cls:"ytc-icon-btn"});J.innerHTML="\u{1F504}",J.title="Refresh Models",J.setAttribute("aria-label","Refresh Models"),J.onclick=async b=>{b.stopPropagation(),J.innerHTML="\u23F3",await this.fetchModelsForCurrentProvider(),J.innerHTML="\u{1F504}",v()};let he=Q.createEl("button",{cls:"ytc-icon-btn"});he.innerHTML="\u2B50",he.title="Save as Default Preference",he.setAttribute("aria-label","Save as Default Preference"),he.onclick=b=>{b.stopPropagation(),this.selectedModel&&(P.setPreference("preferredModel",this.selectedModel),new Y.Notice("\u2B50 Model saved as default!"))},this.providerSelect.addEventListener("change",async()=>{var b,I;this.selectedProvider=(I=(b=this.providerSelect)==null?void 0:b.value)!=null?I:"Google Gemini",await this.fetchModelsForCurrentProvider(),v()}),this.modelSelect.addEventListener("change",()=>{var b;this.selectedModel=(b=this.modelSelect)==null?void 0:b.value,v()}),v();let Ct=this.updateModelDropdown.bind(this);this.updateModelDropdown=b=>{Ct(b),v()}}createIconsRow(){}createVideoPreviewSection(e){this.videoPreviewContainer=e.createDiv(),this.videoPreviewContainer.style.cssText=`
            display: none;
            margin-top: 4px;
            padding: 6px;
            background: var(--background-secondary);
            border-radius: 4px;
            border: 1px solid var(--background-modifier-border);
        `;let r=this.videoPreviewContainer.createDiv();r.style.cssText=`
            display: flex;
            gap: 6px;
            align-items: center;
        `,this.thumbnailEl=r.createEl("img"),this.thumbnailEl.style.cssText=`
            width: 60px;
            height: 34px;
            border-radius: 3px;
            object-fit: cover;
            background: var(--background-modifier-border);
            flex-shrink: 0;
        `,this.thumbnailEl.alt="Video thumbnail";let i=r.createDiv();i.style.cssText=`
            flex: 1;
            min-width: 0;
        `,this.videoTitleEl=i.createDiv(),this.videoTitleEl.style.cssText=`
            font-weight: 500;
            font-size: 0.8rem;
            color: var(--text-normal);
            margin-bottom: 1px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        `;let s=i.createDiv();s.style.cssText=`
            display: flex;
            gap: 6px;
            font-size: 0.7rem;
            color: var(--text-muted);
        `,this.videoChannelEl=s.createSpan(),this.videoDurationEl=s.createSpan(),this.providerStatusEl=this.videoPreviewContainer.createDiv(),this.providerStatusEl.style.cssText=`
            margin-top: 3px;
            padding: 3px 6px;
            background: var(--background-primary);
            border-radius: 3px;
            font-size: 0.8rem;
            color: var(--text-muted);
            display: none;
        `}async showVideoPreview(e){if(!this.videoPreviewContainer||!this.thumbnailEl)return;this.videoPreviewContainer.style.display="block";let r=`
            @keyframes ytc-skeleton-pulse {
                0%, 100% { opacity: 0.4; }
                50% { opacity: 0.8; }
            }
        `;if(!document.getElementById("ytc-skeleton-styles")){let i=document.createElement("style");i.id="ytc-skeleton-styles",i.textContent=r,document.head.appendChild(i)}this.thumbnailEl.style.background="var(--background-modifier-border)",this.thumbnailEl.style.animation="ytc-skeleton-pulse 1.5s ease-in-out infinite",this.thumbnailEl.src="",this.videoTitleEl&&(this.videoTitleEl.textContent="\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588",this.videoTitleEl.style.color="var(--background-modifier-border)",this.videoTitleEl.style.animation="ytc-skeleton-pulse 1.5s ease-in-out infinite"),this.videoChannelEl&&(this.videoChannelEl.textContent="\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588",this.videoChannelEl.style.animation="ytc-skeleton-pulse 1.5s ease-in-out infinite"),this.videoDurationEl&&(this.videoDurationEl.textContent="\u2588\u2588:\u2588\u2588",this.videoDurationEl.style.animation="ytc-skeleton-pulse 1.5s ease-in-out infinite"),this.thumbnailEl.src=`https://img.youtube.com/vi/${e}/mqdefault.jpg`,this.thumbnailEl.onload=()=>{this.thumbnailEl&&(this.thumbnailEl.style.animation="none")};try{let i=await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${e}&format=json`);if(i.ok){let s=await i.json();this.videoTitleEl&&(this.videoTitleEl.textContent=s.title||"Unknown Title",this.videoTitleEl.style.color="var(--text-normal)",this.videoTitleEl.style.animation="none"),this.videoChannelEl&&(this.videoChannelEl.textContent=`\u{1F4FA} ${s.author_name||"Unknown Channel"}`,this.videoChannelEl.style.animation="none"),this.videoDurationEl&&(this.videoDurationEl.textContent="",this.videoDurationEl.style.animation="none")}}catch(i){this.videoTitleEl&&(this.videoTitleEl.textContent="Video Preview",this.videoTitleEl.style.color="var(--text-normal)",this.videoTitleEl.style.animation="none"),this.videoChannelEl&&(this.videoChannelEl.style.animation="none"),this.videoDurationEl&&(this.videoDurationEl.style.animation="none")}}hideVideoPreview(){this.videoPreviewContainer&&(this.videoPreviewContainer.style.display="none")}updateProviderStatus(e,r){if(this.providerStatusEl){this.providerStatusEl.style.display="block";let i=`<span style="color: var(--ytc-accent);">\u{1F916} ${e}</span>`;this.providerStatusEl.innerHTML=`${i} \u2014 ${r}`}}createFallbackToggle(e){var u;let r=e.createDiv();r.style.cssText=`
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 5px;
            padding: 4px 8px;
            background: var(--background-secondary);
            border-radius: 4px;
            font-size: 0.75rem;
        `;let i=r.createDiv();i.style.cssText=`
            display: flex;
            align-items: center;
            gap: 4px;
        `,i.createSpan({text:"\u{1F504}"});let s=i.createSpan({text:"Auto Fallback"});s.style.cssText=`
            color: var(--text-normal);
            font-weight: 500;
            font-size: 0.75rem;
        `;let n=i.createSpan({text:"(err)"});n.style.cssText=`
            color: var(--text-muted);
            font-size: 0.7rem;
        `;let o=r.createDiv();o.style.cssText=`
            position: relative;
            width: 30px;
            height: 16px;
            flex-shrink: 0;
        `,this.fallbackToggle=o.createEl("input",{type:"checkbox"}),this.fallbackToggle.checked=(u=this.options.enableAutoFallback)!=null?u:!0,this.autoFallbackEnabled=this.fallbackToggle.checked,this.fallbackToggle.style.cssText=`
            position: absolute;
            width: 30px;
            height: 16px;
            appearance: none;
            -webkit-appearance: none;
            background: var(--background-modifier-border);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
            outline: none;
        `;let a=()=>{var p;(p=this.fallbackToggle)!=null&&p.checked?(this.fallbackToggle.style.background="var(--ytc-accent)",this.fallbackToggle.style.boxShadow="0 0 10px rgba(45, 212, 191, 0.4)"):this.fallbackToggle&&(this.fallbackToggle.style.background="var(--ytc-border)",this.fallbackToggle.style.boxShadow="none")},l=o.createDiv();l.style.cssText=`
            position: absolute;
            top: 2px;
            left: 2px;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
            pointer-events: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        `;let d=()=>{var p;(p=this.fallbackToggle)!=null&&p.checked?l.style.transform="translateX(14px)":l.style.transform="translateX(0)"};a(),d(),this.fallbackToggle.addEventListener("change",()=>{var p,m;this.autoFallbackEnabled=(m=(p=this.fallbackToggle)==null?void 0:p.checked)!=null?m:!0,P.updateLastUsed({autoFallback:this.autoFallbackEnabled}),a(),d()})}updateModelDropdown(e){var d,u;if(!this.modelSelect||!this.providerSelect)return;let r=this.providerSelect.value;this.modelSelect.innerHTML='<option value="">Loading models...</option>',this.modelSelect.disabled=!0;let i=[],s="";if(e!=null&&e[r])i=(d=e[r])!=null?d:[],s=" (live)";else{let p=X[r];p?(i=p.map(m=>typeof m=="string"?m:m.name),s=" (cached)"):i=[]}if(this.modelSelect.innerHTML="",i.length>0){let p=this.modelSelect.createEl("option");p.value="",p.textContent=`\u{1F4CB} ${i.length} models${s}`,p.disabled=!0,p.style.cssText=`
                font-weight: 600;
                color: var(--text-muted);
                font-size: 12px;
                background: var(--background-secondary);
            `}i.forEach(p=>{if(!this.modelSelect)return;let m=this.modelSelect.createEl("option");m.value=p;let v=this.formatModelName(p),E=this.isMultimodalModel(r,p);m.textContent=E?`\u{1F441}\uFE0F ${v}`:v,E&&(m.title=`${v} - Supports vision and multimodal analysis`),m.style.cssText=`
                color: var(--text-normal);
                background: var(--background-primary);
            `}),this.modelSelect.disabled=!1;let n="",o=P.loadPreferences(),a=`lastModel_${r.replace(/\s+/g,"")}`,l=o[a];l&&i.includes(l)?n=l:this.selectedModel&&i.includes(this.selectedModel)?n=this.selectedModel:i.length>0&&(n=(u=i[0])!=null?u:""),this.modelSelect.value=n,this.selectedModel=n,i.length>0&&(this.modelSelect.style.transition="background 0.3s ease",this.modelSelect.style.background="var(--background-modifier-hover)",setTimeout(()=>{this.modelSelect&&(this.modelSelect.style.background="")},300))}formatModelName(e){return e==="gemini-2.5-pro"?"Gemini Pro 2.5":e==="gemini-2.5-flash"?"Gemini Flash 2.5":e==="gemini-1.5-pro"?"Gemini Pro 1.5":e==="gemini-1.5-flash"?"Gemini Flash 1.5":e==="qwen3-coder:480b-cloud"?"Qwen3-Coder 480B Cloud":e==="deepseek-v3.2"?"DeepSeek v3.2":e==="deepseek-v3.2:latest"?"DeepSeek v3.2 (Latest)":e==="deepseek-v3.2:32b"?"DeepSeek v3.2 32B":e==="deepseek-v3.2:70b"?"DeepSeek v3.2 70B":e==="deepseek-v3.2:instruct"?"DeepSeek v3.2 Instruct":e==="deepseek-v3.2:coder"?"DeepSeek v3.2 Coder":e==="llama-3.1-8b-instant"?"Llama 3.1 8B Instant \u26A1":e==="llama-3.1-8b-instruct"?"Llama 3.1 8B":e==="llama-3.1-70b-instruct"?"Llama 3.1 70B":e==="llama-3.1-405b-instruct"?"Llama 3.1 405B":e==="mixtral-8x7b-instruct-v0.1"?"Mixtral 8x7B Instruct v0.1":e==="mixtral-8x22b-instruct-v0.1"?"Mixtral 8x22B Instruct v0.1":e==="gemma2-9b-it"?"Gemma 2 9B IT":e==="gemma-7b-it"?"Gemma 7B IT":e==="deepseek-r1-distill-llama-70b"?"DeepSeek R1 Distill 70B":e==="deepseek-coder-v2-lite-instruct"?"DeepSeek Coder V2 Lite":e==="llama-guard-3-8b"?"Llama Guard 3 8B":e==="code-llama-34b-instruct"?"Code Llama 34B":e==="mixtral-8x7b-32768"?"Mixtral 8x7B 32K":e==="mixtral-8x7b-instruct-v0.1"?"Mixtral 8x7B Instruct v0.1":e==="gemma-7b-it"?"Gemma 7B IT":e==="gemma2-9b-it"?"Gemma 2 9B IT":e==="llama2-70b-4096"?"Llama 2 70B 4K":e==="llama2-70b-chat"?"Llama 2 70B Chat":e==="llama2-13b-chat"?"Llama 2 13B Chat":e==="llama2-7b-chat"?"Llama 2 7B Chat":e==="llama-3.2-11b-vision-instruct"?"Llama 3.2 11B Vision \u{1F441}\uFE0F":e==="llama-3.2-90b-vision-instruct"?"Llama 3.2 90B Vision \u{1F441}\uFE0F":e==="llama3.2-vision"?"Llama 3.2 Vision \u{1F441}\uFE0F":e==="llava"?"LLaVA \u{1F441}\uFE0F":e==="llava-llama3"?"LLaVA Llama 3 \u{1F441}\uFE0F":e==="bakllava"?"BakLLaVA \u{1F441}\uFE0F":e==="moondream"?"MoonDream \u{1F441}\uFE0F":e==="nvidia-llama3-1-vision"?"NVIDIA Llama 3.1 Vision \u{1F441}\uFE0F":e==="qwen2-vl"?"Qwen 2 VL \u{1F441}\uFE0F":e==="phi3-vision"?"Phi 3 Vision \u{1F441}\uFE0F":e==="fuyu-8b"?"Fuyu 8B \u{1F441}\uFE0F":e==="pixtral-12b"?"Pixtral 12B \u{1F441}\uFE0F":e==="qwen/qwen2-vl-7b-instruct"?"Qwen 2 VL 7B \u{1F441}\uFE0F":e==="qwen/qwen2-vl-2b-instruct"?"Qwen 2 VL 2B \u{1F441}\uFE0F":e==="microsoft/phi-3.5-vision-instruct"?"Phi 3.5 Vision \u{1F441}\uFE0F":e==="google/paligemma-3b-mix-448"?"PaliGemma 3B \u{1F441}\uFE0F":e==="huggingfacem4/idefics2-8b"?"Idefics 2 8B \u{1F441}\uFE0F":e==="anthropic/claude-3.5-sonnet"?"Claude 3.5 Sonnet \u{1F441}\uFE0F":e==="anthropic/claude-3.5-haiku"?"Claude 3.5 Haiku \u{1F441}\uFE0F":e==="openai/gpt-4o"?"GPT-4o \u{1F441}\uFE0F":e==="openai/gpt-4o-mini"?"GPT-4o Mini \u{1F441}\uFE0F":e==="google/gemini-2.0-flash-exp"?"Gemini 2.0 Flash Experimental \u{1F441}\uFE0F":e.charAt(0).toUpperCase()+e.slice(1).replace(/[-_]/g," ")}createThemeToggle(){let e=this.contentEl.createDiv();e.style.cssText=`
            display: flex;
            justify-content: flex-end;
            margin: 4px 0 8px 0;
        `;let r=e.createDiv();r.style.cssText=`
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.6;
            transition: opacity 0.2s ease;
            padding: 4px;
        `,r.innerHTML=this.isLightTheme?"\u2600\uFE0F":"\u{1F319}",r.title=this.isLightTheme?"Switch to dark mode":"Switch to light mode",r.addEventListener("mouseenter",()=>{r.style.opacity="1"}),r.addEventListener("mouseleave",()=>{r.style.opacity="0.6"});let i=s=>{this.isLightTheme=s,r.innerHTML=s?"\u2600\uFE0F":"\u{1F319}",r.title=s?"Switch to dark mode":"Switch to light mode",this.applyTheme(s),localStorage.setItem("ytc-theme-mode",s?"light":"dark")};r.addEventListener("click",()=>{i(!this.isLightTheme)}),this.themeElements={slider:r,knob:r,sunIcon:r,moonIcon:r,updateTheme:i}}applyTheme(e){var i,s,n;(i=this.modalEl)==null||i.classList.add("ytc-themed-modal"),(s=this.modalEl)==null||s.classList.toggle("ytc-modal-light",e),(n=this.modalEl)==null||n.classList.toggle("ytc-modal-dark",!e);let r=document.getElementById("ytc-theme-styles");r&&r.remove()}createProgressSection(){this.progressContainer=this.contentEl.createDiv(),this.progressContainer.setAttribute("role","region"),this.progressContainer.setAttribute("aria-label","Processing progress"),this.progressContainer.setAttribute("aria-live","polite"),this.progressContainer.style.marginTop="6px",this.progressContainer.style.display="none";let e=this.progressContainer.createDiv();e.style.cssText=`
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        `,this.progressText=e.createDiv(),this.progressText.id="progress-text",this.progressText.style.fontWeight="500",this.progressText.style.fontSize="13px",this.progressText.style.color="#00b894",this.progressText.textContent="Processing...",this.timerEl=e.createSpan(),this.timerEl.style.cssText=`
            font-family: monospace;
            font-variant-numeric: tabular-nums;
            font-size: 12px;
            color: var(--ytc-text-muted);
        `,this.timerEl.textContent="0.0s";let r=this.progressContainer.createDiv();r.setAttribute("role","progressbar"),r.setAttribute("aria-valuenow","0"),r.setAttribute("aria-valuemin","0"),r.setAttribute("aria-valuemax","100"),r.setAttribute("aria-labelledby","progress-text"),r.style.cssText=`
            width: 100%;
            height: 6px;
            background-color: var(--ytc-bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        `,this.progressBar=r.createDiv(),this.progressBar.style.cssText=`
            height: 100%;
            background: linear-gradient(90deg, var(--ytc-accent), #34d399);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        `;let i=this.progressBar.createDiv();if(i.style.cssText=`
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.15) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0.15) 75%,
                transparent 75%,
                transparent
            );
            background-size: 20px 20px;
            animation: ytc-progress-stripe 1s linear infinite;
            opacity: 0.6;
        `,!document.getElementById("ytc-progress-anim")){let s=document.createElement("style");s.id="ytc-progress-anim",s.textContent=`
                @keyframes ytc-progress-stripe {
                    0% { background-position: 0 0; }
                    100% { background-position: 20px 20px; }
                }
            `,document.head.appendChild(s)}}createActionButtons(){let e=this.contentEl.createDiv();e.style.cssText=`
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--ytc-border);
        `;let r=e.createEl("button",{cls:"ytc-action-btn ytc-ghost-btn"});r.textContent="Cancel",r.addEventListener("click",()=>this.close());let i=e.createDiv();i.style.flex="1",this.secondaryActionsRow=e.createDiv(),this.secondaryActionsRow.style.cssText=`
            display: none;
            gap: 8px;
        `,this.copyPathButton=this.secondaryActionsRow.createEl("button",{cls:"ytc-action-btn ytc-secondary-btn"}),this.copyPathButton.innerHTML="\u{1F4CB}",this.copyPathButton.title="Copy Path",this.copyPathButton.style.width="40px",this.copyPathButton.style.padding="0",this.copyPathButton.addEventListener("click",()=>this.handleCopyPath()),this.openButton=this.secondaryActionsRow.createEl("button",{cls:"ytc-action-btn ytc-secondary-btn"}),this.openButton.innerHTML="\u{1F4C4} Open",this.openButton.addEventListener("click",()=>this.handleOpenFile());let s=this.secondaryActionsRow.createEl("button",{cls:"ytc-action-btn ytc-primary-btn"});s.innerHTML="\u{1F504} New",s.addEventListener("click",()=>{this.showInputState()}),this.processAnotherButton=s,this.processButton=e.createEl("button",{cls:"ytc-action-btn ytc-primary-btn"}),this.processButton.innerHTML=`<span>\u2728</span> ${f.MODALS.PROCESS}`,this.processButton.style.minWidth="120px",this.processButton.addEventListener("click",()=>this.handleProcess()),this.updateProcessButtonState()}showInputState(){this.processButton&&(this.processButton.style.display="flex",this.processButton.disabled=!1,this.processButton.innerHTML=`<span>\u2728</span> ${f.MODALS.PROCESS}`),this.secondaryActionsRow&&(this.secondaryActionsRow.style.display="none"),this.urlInput&&(this.urlInput.disabled=!1,this.urlInput.value="",this.url=""),this.headerEl&&(this.headerEl.textContent=f.MODALS.PROCESS_VIDEO),this.processedFilePath="",this.updateProcessButtonState(),this.focusUrlInput()}setupEventHandlers(){this.scope.register([],"Enter",()=>(this.processButton&&!this.processButton.disabled&&this.processButton.click(),!1)),this.scope.register([],"Escape",()=>(this.close(),!1)),this.scope.register(["Ctrl"],"o",()=>(this.openButton&&this.openButton.style.display!=="none"&&this.handleOpenFile(),!1)),this.scope.register(["Ctrl"],"c",()=>document.activeElement!==this.urlInput&&this.processedFilePath?(this.handleCopyPath(),!1):!0),this.scope.register(["Ctrl","Shift"],"v",async()=>{try{let e=await navigator.clipboard.readText();this.urlInput&&y.isValidYouTubeUrl(e)&&(this.urlInput.value=e,this.url=e,this.updateProcessButtonState(),this.processButton&&!this.processButton.disabled&&this.processButton.click())}catch(e){}return!1}),this.urlInput&&this.urlInput.addEventListener("input",()=>{var e,r;this.url=(r=(e=this.urlInput)==null?void 0:e.value)!=null?r:"",this.updateProcessButtonState()})}focusUrlInput(){this.urlInput&&this.urlInput.focus()}updateProcessButtonState(){if(!this.processButton)return;let e=this.url.trim(),r=y.isValidYouTubeUrl(e);if(this.processButton.disabled=!r||this.isProcessing,this.processButton.style.opacity=this.processButton.disabled?"0.5":"1",e.length===0)this.setValidationMessage("Paste a YouTube link to begin processing.","info"),this.hideVideoPreview();else if(r){this.setValidationMessage("Ready to process this video.","success");let i=y.extractVideoId(e);i&&this.showVideoPreview(i)}else this.setValidationMessage("Enter a valid YouTube video URL.","error"),this.hideVideoPreview()}setValidationMessage(e,r="info"){if(!this.validationMessage)return;this.validationMessage.textContent=e;let i="var(--ytc-text-muted)";r==="error"?i="var(--ytc-error)":r==="success"&&(i="var(--ytc-success)"),this.validationMessage.style.color=i}async handleProcess(){var r,i,s,n,o,a,l,d,u;let e=this.url.trim();if(!e){new Y.Notice(f.ERRORS.ENTER_URL),this.focusUrlInput();return}if(!y.isValidYouTubeUrl(e)){new Y.Notice(f.ERRORS.INVALID_URL),this.focusUrlInput();return}try{if(this.showProcessingState(),this.updateProgress(0,"Starting..."),this.updateProgress(25,"Validating URL..."),!y.extractVideoId(e))throw new Error("Could not extract YouTube video ID");this.updateProgress(50,"Fetching video data..."),this.format=(i=(r=this.formatSelect)==null?void 0:r.value)!=null?i:"executive-summary",this.selectedProvider=(s=this.providerSelect)==null?void 0:s.value,this.selectedModel=(n=this.modelSelect)==null?void 0:n.value;let m=this.selectedProvider?this.selectedProvider.charAt(0).toUpperCase()+this.selectedProvider.slice(1):"AI";this.updateProgress(75,`Processing with ${m}...`);let v=(o=this.options.defaultMaxTokens)!=null?o:4096;this.format==="complete-transcription"&&(v=Math.max(v,16384));let E=await this.options.onProcess(e,this.format,this.selectedProvider,this.selectedModel,(a=this.options.performanceMode)!=null?a:"balanced",(l=this.options.enableParallelProcessing)!=null?l:!1,(d=this.options.preferMultimodal)!=null?d:!1,v,(u=this.options.defaultTemperature)!=null?u:.5,this.autoFallbackEnabled);this.updateProgress(100,"Complete!"),this.processedFilePath=E,this.showCompletionState()}catch(p){this.showErrorState(p),w.handle(p,"YouTube URL processing")}}showProcessingState(){this.isProcessing=!0,this.progressContainer&&(this.progressContainer.style.display="block"),this.urlInput&&(this.urlInput.disabled=!0),this.processButton&&(this.processButton.style.display="flex",this.processButton.disabled=!0,this.processButton.innerHTML="<span>\u23F3</span> Processing..."),this.secondaryActionsRow&&(this.secondaryActionsRow.style.display="none"),this.timerInterval&&window.clearInterval(this.timerInterval);let e=Date.now();this.timerEl&&(this.timerEl.textContent="0.0s"),this.timerInterval=window.setInterval(()=>{if(this.timerEl){let r=(Date.now()-e)/1e3;this.timerEl.textContent=`${r.toFixed(1)}s`}},100)}updateProgress(e,r){this.progressBar&&(this.progressBar.style.width=`${e}%`),this.progressText&&(this.progressText.textContent=r)}showCompletionState(){this.isProcessing=!1,this.timerInterval&&(window.clearInterval(this.timerInterval),this.timerInterval=void 0),this.urlInput&&(this.urlInput.disabled=!1,this.urlInput.value="",this.url=""),this.processButton&&(this.processButton.style.display="none"),this.secondaryActionsRow&&(this.secondaryActionsRow.style.display="flex"),this.headerEl&&(this.headerEl.textContent="\u2705 Video Processed Successfully!"),this.setValidationMessage("Note saved. You can open it now or process another video.","success"),this.focusUrlInput()}showErrorState(e){this.isProcessing=!1,this.timerInterval&&(window.clearInterval(this.timerInterval),this.timerInterval=void 0),this.urlInput&&(this.urlInput.disabled=!1),this.processButton&&(this.processButton.disabled=!1,this.processButton.textContent=f.MODALS.PROCESS),this.openButton&&(this.openButton.style.display="none"),this.copyPathButton&&(this.copyPathButton.style.display="none"),this.progressContainer&&(this.progressContainer.style.display="none"),this.headerEl&&(this.headerEl.textContent="\u274C Processing Failed"),this.setValidationMessage(e.message,"error")}async handleOpenFile(){if(this.processedFilePath&&this.options.onOpenFile)try{await this.options.onOpenFile(this.processedFilePath),this.close()}catch(e){w.handle(e,"Opening file")}}async handleCopyPath(){if(this.processedFilePath)try{if(await navigator.clipboard.writeText(this.processedFilePath),this.copyPathButton){let e=this.copyPathButton.textContent;this.copyPathButton.textContent="\u2705 Copied!",setTimeout(()=>{this.copyPathButton&&(this.copyPathButton.textContent=e)},1500)}}catch(e){w.handle(e,"Copying path to clipboard")}}setUrl(e){this.url=e,this.urlInput&&(this.urlInput.value=e),this.updateProcessButtonState()}async handleSmartPaste(){try{let r=(await navigator.clipboard.readText()).trim();if(y.isValidYouTubeUrl(r))this.setUrl(r),new Y.Notice("YouTube URL detected and pasted!");else{let i=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)/,s=/(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/,n=r.match(i),o=r.match(s),a=n!=null?n:o;if(a){let d=`https://www.youtube.com/watch?v=${a[1]}`;this.setUrl(d),new Y.Notice("YouTube URL extracted from clipboard!")}else new Y.Notice("No YouTube URL found in clipboard")}this.processButton&&!this.isProcessing&&y.isValidYouTubeUrl(r)?this.processButton.focus():this.focusUrlInput()}catch(e){new Y.Notice("Could not access clipboard")}}setupKeyboardShortcuts(){this.scope.register(["Ctrl"],"Enter",()=>(this.processButton&&!this.processButton.disabled&&this.processButton.click(),!1))}onClose(){this.validationTimer&&clearTimeout(this.validationTimer),super.onClose()}getCacheStatus(e){return["OpenRouter","Hugging Face","Ollama","Ollama Cloud"].includes(e)?{isCached:!0,ageMinutes:15}:{isCached:!1}}isMultimodalModel(e,r){return["vision","vl","v-","multimodal","pixtral","fuyu","llava","moondream","gemini-2.5","gemini-2.0","claude-3.5","gpt-4o","phi-3.5-vision","qwen2-vl"].some(s=>r.toLowerCase().includes(s.toLowerCase()))}isUsingCachedModels(e){return this.getCacheStatus(e).isCached}updateRefreshButtonTooltip(){var e;if(this.refreshButton){let r=(e=this.selectedProvider)!=null?e:"Google Gemini";["OpenRouter","Hugging Face","Ollama","Ollama Cloud"].includes(r)?this.refreshButton.title="Refresh models (Shift+Click to force refresh and bypass cache)":this.refreshButton.title="Refresh models (static list)"}}};var St=require("obsidian");te();var $={select:"ytc-video-select",selectContainer:"ytc-select-container",progressBar:"ytc-progress-bar",progressFill:"ytc-progress-fill",progressText:"ytc-progress-text",progressSteps:"ytc-progress-steps",stepItem:"ytc-step-item",stepActive:"ytc-step-active",stepCompleted:"ytc-step-completed",stepError:"ytc-step-error"},Wt=[{value:"executive-summary",label:"Executive Summary"},{value:"step-by-step-tutorial",label:"Step-by-Step Tutorial"},{value:"concise-summary",label:"Concise Summary"},{value:"technical-analysis",label:"Technical Analysis"},{value:"3c-accelerated-learning",label:"3C Accelerated Learning"},{value:"complete-transcription",label:"Complete Transcription"}],Ke=class extends D{constructor(e,r){var i,s;super(e);this.options=r;this.selectedFormat="executive-summary";this.isProcessing=!1;this.progressSteps=[];this.currentStepIndex=0;this.selectedProvider=(i=r.defaultProvider)!=null?i:"",this.selectedModel=(s=r.defaultModel)!=null?s:""}createProviderSelect(e,r="Provider"){var o;let i=e.createDiv({cls:$.selectContainer});i.createEl("label",{text:r,attr:{for:"provider-select"}});let s=i.createEl("select",{cls:$.select,attr:{id:"provider-select"}}),n=(o=this.options.providers)!=null?o:[];for(let a of n){let l=s.createEl("option",{value:a,text:a});a===this.selectedProvider&&(l.selected=!0)}return s.addEventListener("change",()=>{this.selectedProvider=s.value,this.onProviderChange(s.value)}),this.providerSelect=s,s}createModelSelect(e,r="Model"){let i=e.createDiv({cls:$.selectContainer});i.createEl("label",{text:r,attr:{for:"model-select"}});let s=i.createEl("select",{cls:$.select,attr:{id:"model-select"}});return this.updateModelOptions(s),this.modelSelect=s,s}createFormatSelect(e,r="Format"){let i=e.createDiv({cls:$.selectContainer});i.createEl("label",{text:r,attr:{for:"format-select"}});let s=i.createEl("select",{cls:$.select,attr:{id:"format-select"}});for(let n of Wt){let o=s.createEl("option",{value:n.value,text:n.label});n.value===this.selectedFormat&&(o.selected=!0)}return s.addEventListener("change",()=>{this.selectedFormat=s.value}),this.formatSelect=s,s}updateModelOptions(e){var i,s;e.empty();let r=(s=(i=this.options.modelOptions)==null?void 0:i[this.selectedProvider])!=null?s:[];for(let n of r){let o=e.createEl("option",{value:n,text:n});n===this.selectedModel&&(o.selected=!0)}r.length===0&&e.createEl("option",{value:"",text:"No models available",attr:{disabled:"true"}})}createProgressContainer(e){let r=e.createDiv({cls:$.progressBar});r.style.display="none";let i=r.createDiv({cls:$.progressFill});i.style.width="0%",this.progressBar=i;let s=r.createDiv({cls:$.progressText});return s.textContent="Ready",this.progressText=s,this.progressContainer=r,r}initProgressSteps(e){this.progressSteps=e.map(r=>({...r,status:"pending"})),this.currentStepIndex=0}updateProgress(e,r){let i=this.progressSteps.findIndex(n=>n.id===e);if(i===-1)return;for(let n=0;n<i;n++){let o=this.progressSteps[n];o&&(o.status==="pending"||o.status==="active")&&(o.status="completed")}let s=this.progressSteps[i];s&&(s.status=r),this.currentStepIndex=i,this.renderProgress()}renderProgress(){if(!this.progressContainer||!this.progressBar||!this.progressText)return;let e=this.progressSteps.filter(n=>n.status==="completed").length,r=this.progressSteps.length,i=r>0?e/r*100:0;this.progressBar&&(this.progressBar.style.width=`${i}%`);let s=this.progressSteps[this.currentStepIndex];s&&this.progressText&&(this.progressText.textContent=s.label)}showProgress(){this.progressContainer&&(this.progressContainer.style.display="block")}hideProgress(){this.progressContainer&&(this.progressContainer.style.display="none")}setProcessing(e){this.isProcessing=e,this.providerSelect&&(this.providerSelect.disabled=e),this.modelSelect&&(this.modelSelect.disabled=e),this.formatSelect&&(this.formatSelect.disabled=e)}showNotice(e,r="info"){let i=r==="error"?"\u274C ":r==="success"?"\u2705 ":"\u2139\uFE0F ";new St.Notice(`${i}${e}`)}onProviderChange(e){this.selectedProvider=e,this.modelSelect&&this.updateModelOptions(this.modelSelect),this.options.fetchModelsForProvider&&this.options.fetchModelsForProvider(e).then(r=>{r.length>0&&this.modelSelect&&(this.options.modelOptions={...this.options.modelOptions,[e]:r},this.updateModelOptions(this.modelSelect))}).catch(()=>{})}isValidVideoUrl(e){return!e||e.trim().length===0?!1:[/^(https?:\/\/)?(www\.)?youtube\.com\/watch\?v=[\w-]+/,/^(https?:\/\/)?(www\.)?youtu\.be\/[\w-]+/,/^(https?:\/\/)?(www\.)?youtube\.com\/embed\/[\w-]+/,/^(https?:\/\/)?(www\.)?youtube\.com\/v\/[\w-]+/].some(i=>i.test(e.trim()))}extractVideoId(e){let r=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/v\/)([\w-]+)/];for(let i of r){let s=e.match(i);if(s!=null&&s[1])return s[1]}return null}};var Ne=class extends Ke{constructor(e,r){super(e,{providers:r.providers,defaultProvider:r.defaultProvider,defaultModel:r.defaultModel,modelOptions:r.modelOptionsMap});this.batchOptions=r;this.urls=[]}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ytc-batch-modal"),this.addStyles(),e.createEl("h2",{text:"\u{1F4E6} Batch Video Processing",cls:"ytc-batch-title"}),e.createEl("p",{text:"Enter YouTube URLs (one per line) to process multiple videos at once.",cls:"ytc-batch-description"}),this.createUrlInput(),this.createOptions(),this.createItemsList(),this.createProgressSection(),this.createActionButtons()}addStyles(){let e=document.createElement("style");e.textContent=`
            .ytc-batch-modal {
                padding: 20px;
                min-width: 500px;
            }
            .ytc-batch-title {
                margin: 0 0 8px 0;
                font-size: 1.4em;
            }
            .ytc-batch-description {
                color: var(--text-muted);
                margin-bottom: 16px;
            }
            .ytc-batch-textarea {
                width: 100%;
                min-height: 120px;
                padding: 12px;
                border: 1px solid var(--background-modifier-border);
                border-radius: 8px;
                background: var(--background-secondary);
                color: var(--text-normal);
                font-family: var(--font-monospace);
                font-size: 13px;
                resize: vertical;
            }
            .ytc-batch-textarea:focus {
                border-color: var(--interactive-accent);
                outline: none;
            }
            .ytc-batch-items {
                max-height: 200px;
                overflow-y: auto;
                margin: 16px 0;
                border: 1px solid var(--background-modifier-border);
                border-radius: 8px;
            }
            .ytc-batch-item {
                display: flex;
                align-items: center;
                padding: 8px 12px;
                border-bottom: 1px solid var(--background-modifier-border);
                gap: 8px;
            }
            .ytc-batch-item:last-child {
                border-bottom: none;
            }
            .ytc-batch-item-status {
                width: 20px;
                text-align: center;
            }
            .ytc-batch-item-url {
                flex: 1;
                font-size: 12px;
                color: var(--text-muted);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .ytc-batch-item-remove {
                cursor: pointer;
                color: var(--text-muted);
                opacity: 0.6;
            }
            .ytc-batch-item-remove:hover {
                color: var(--text-error);
                opacity: 1;
            }
            .ytc-batch-progress {
                margin: 16px 0;
                display: none;
            }
            .ytc-batch-progress.visible {
                display: block;
            }
            .ytc-batch-progress-bar {
                height: 8px;
                background: var(--background-modifier-border);
                border-radius: 4px;
                overflow: hidden;
            }
            .ytc-batch-progress-fill {
                height: 100%;
                background: var(--interactive-accent);
                transition: width 0.3s ease;
            }
            .ytc-batch-progress-text {
                text-align: center;
                font-size: 12px;
                color: var(--text-muted);
                margin-top: 4px;
            }
            .ytc-batch-actions {
                display: flex;
                justify-content: flex-end;
                gap: 8px;
                margin-top: 16px;
            }
            .ytc-batch-btn {
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                border: none;
            }
            .ytc-batch-btn-primary {
                background: var(--interactive-accent);
                color: white;
            }
            .ytc-batch-btn-primary:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            .ytc-batch-btn-secondary {
                background: var(--background-secondary);
                color: var(--text-normal);
                border: 1px solid var(--background-modifier-border);
            }
            .ytc-batch-options {
                margin: 16px 0;
            }
            .ytc-select-container {
                margin-bottom: 12px;
            }
            .ytc-select-container label {
                display: block;
                margin-bottom: 4px;
                font-weight: 500;
            }
            .ytc-video-select {
                width: 100%;
                padding: 8px;
                border-radius: 6px;
                border: 1px solid var(--background-modifier-border);
                background: var(--background-secondary);
            }
        `,this.contentEl.appendChild(e)}createUrlInput(){let e=this.contentEl.createDiv({cls:"ytc-batch-input-container"});this.urlInput=e.createEl("textarea",{cls:"ytc-batch-textarea",attr:{placeholder:`https://youtube.com/watch?v=video1
https://youtube.com/watch?v=video2
https://youtu.be/video3`}}),this.urlInput.addEventListener("input",()=>this.parseUrls()),this.urlInput.addEventListener("paste",()=>{setTimeout(()=>this.parseUrls(),0)})}createOptions(){let e=this.contentEl.createDiv({cls:"ytc-batch-options"});this.createFormatSelect(e,"Output Format"),this.createProviderSelect(e,"AI Provider"),this.createModelSelect(e,"Model")}createItemsList(){this.itemsContainer=this.contentEl.createDiv({cls:"ytc-batch-items"}),this.itemsContainer.style.display="none"}createProgressSection(){this.batchProgressContainer=this.contentEl.createDiv({cls:"ytc-batch-progress"}),this.batchProgressContainer.createDiv({cls:"ytc-batch-progress-bar"}).createDiv({cls:"ytc-batch-progress-fill"}),this.batchProgressContainer.createDiv({cls:"ytc-batch-progress-text"})}createActionButtons(){let e=this.contentEl.createDiv({cls:"ytc-batch-actions"});e.createEl("button",{text:"Cancel",cls:"ytc-batch-btn ytc-batch-btn-secondary"}).addEventListener("click",()=>this.close()),this.processButton=e.createEl("button",{text:"Process All",cls:"ytc-batch-btn ytc-batch-btn-primary"}),this.processButton.disabled=!0,this.processButton.addEventListener("click",()=>this.processVideos())}parseUrls(){let r=this.urlInput.value.split(`
`).filter(i=>i.trim());this.urls=[];for(let i of r){let s=i.trim();this.isValidVideoUrl(s)&&this.urls.push({url:s,status:"pending"})}this.renderItems(),this.updateProcessButton()}renderItems(){if(this.itemsContainer.empty(),this.urls.length===0){this.itemsContainer.style.display="none";return}this.itemsContainer.style.display="block";for(let e=0;e<this.urls.length;e++){let r=this.urls[e];if(!r)continue;let i=this.itemsContainer.createDiv({cls:"ytc-batch-item"}),s=i.createSpan({cls:"ytc-batch-item-status"});s.textContent=this.getStatusIcon(r.status);let n=i.createSpan({cls:"ytc-batch-item-url"});n.textContent=r.url,n.title=r.url,this.isProcessing||i.createSpan({cls:"ytc-batch-item-remove",text:"\u2715"}).addEventListener("click",()=>this.removeItem(e))}}getStatusIcon(e){switch(e){case"pending":return"\u23F3";case"processing":return"\u{1F504}";case"completed":return"\u2705";case"failed":return"\u274C"}}removeItem(e){this.urls.splice(e,1),this.renderItems(),this.updateProcessButton()}updateProcessButton(){this.processButton.disabled=this.urls.length===0||this.isProcessing,this.processButton.textContent=this.isProcessing?"Processing...":`Process ${this.urls.length} Video${this.urls.length!==1?"s":""}`}async processVideos(){if(this.urls.length===0||this.isProcessing)return;this.setProcessing(!0),this.updateProcessButton(),this.batchProgressContainer.classList.add("visible");let e=this.batchProgressContainer.querySelector(".ytc-batch-progress-fill"),r=this.batchProgressContainer.querySelector(".ytc-batch-progress-text"),i=0,s=this.urls.length;try{for(let n=0;n<this.urls.length;n++)if(this.urls[n]){this.urls[n].status="processing",this.renderItems(),r.textContent=`Processing ${n+1} of ${s}...`,e.style.width=`${n/s*100}%`;try{let o=await this.batchOptions.onProcess([this.urls[n].url],this.selectedFormat,this.selectedProvider,this.selectedModel);this.urls[n].status="completed",this.urls[n].result=o[0],i++}catch(o){this.urls[n].status="failed",this.urls[n].error=o instanceof Error?o.message:String(o)}this.renderItems(),e.style.width=`${(n+1)/s*100}%`}r.textContent=`Completed: ${i}/${s} videos processed`,i===s?this.showNotice(`Successfully processed ${i} videos!`,"success"):this.showNotice(`Processed ${i}/${s} videos. Some failed.`,"error")}catch(n){this.showNotice(`Batch processing failed: ${n instanceof Error?n.message:String(n)}`,"error")}finally{this.setProcessing(!1),this.updateProcessButton()}}onClose(){this.contentEl.empty()}};var Ge=class{constructor(t,e,r){this.app=t,this.settings=e(),this.serviceContainer=r()}createYouTubeUrlModal(t){var o,a,l,d,u;let e=this.settings,r=this.serviceContainer,i=r.aiService,s=i?i.getProviderNames():[],n=(o=e.modelOptionsCache)!=null?o:{};return new He(this.app,{onProcess:t.onProcess,onOpenFile:t.onOpenFile,...t.initialUrl&&{initialUrl:t.initialUrl},providers:s,defaultProvider:"Google Gemini",defaultModel:"gemini-2.0-flash",defaultMaxTokens:e.defaultMaxTokens,defaultTemperature:e.defaultTemperature,modelOptions:n,fetchModels:async()=>this.fetchModels(r,e,n),fetchModelsForProvider:async(p,m=!1)=>this.fetchModelsForProvider(r,e,p,m),performanceMode:(a=e.performanceMode)!=null?a:"balanced",enableParallelProcessing:(l=e.enableParallelProcessing)!=null?l:!1,enableAutoFallback:(d=e.enableAutoFallback)!=null?d:!0,preferMultimodal:(u=e.preferMultimodal)!=null?u:!1,onPerformanceSettingsChange:t.onPerformanceSettingsChange,onOpenBatchModal:t.onOpenBatchModal})}createBatchVideoModal(t){var n;let e=this.settings,r=this.serviceContainer.aiService,i=r?r.getProviderNames():[],s=(n=e.modelOptionsCache)!=null?n:{};return new Ne(this.app,{onProcess:t.onProcess,onOpenFile:t.onOpenFile,providers:i,defaultProvider:"Google Gemini",defaultModel:"gemini-2.0-flash",modelOptionsMap:s})}async fetchModels(t,e,r){try{let s=await t.aiService.fetchLatestModels(),n=Date.now(),o={};return Object.keys(s).forEach(a=>{o[a]=n}),s}catch(i){return r}}async fetchModelsForProvider(t,e,r,i){try{let n=await t.aiService.fetchLatestModelsForProvider(r,i);return n!=null?n:[]}catch(s){return[]}}updateSettings(t){this.settings=t}updateServiceContainer(t){this.serviceContainer=t}};var at="ytp",At="1.3.5",xt={geminiApiKey:"",groqApiKey:"",ollamaApiKey:"",ollamaEndpoint:"http://localhost:11434",huggingFaceApiKey:"",openRouterApiKey:"",outputPath:"YouTube/Processed Videos",useEnvironmentVariables:!1,environmentPrefix:"YTC",performanceMode:"balanced",enableParallelProcessing:!0,enableAutoFallback:!0,preferMultimodal:!0,defaultMaxTokens:4096,defaultTemperature:.5},Ye=class extends _.Plugin{constructor(){super(...arguments);this._settings=xt;this.isUnloading=!1;this.operationCount=0}async onload(){this.manifest.version=At,h.info(`Initializing YoutubeClipper Plugin v${At}...`);try{await this.loadSettings(),this.setupLogger(),await this.initializeServices(),this.registerUIComponents(),this.setupUrlHandling(),this.setupProtocolHandler(),h.plugin("Plugin loaded successfully")}catch(e){h.error("Failed to load plugin","Plugin",{error:e instanceof Error?e.message:String(e)}),w.handle(e,"Plugin initialization"),new _.Notice("Failed to load YoutubeClipper Plugin. Check console for details.")}}onunload(){var e,r,i;h.plugin("Unloading YoutubeClipper Plugin..."),this.isUnloading=!0;try{(e=this.urlHandler)==null||e.clear(),(r=this.modalManager)==null||r.clear(),(i=this.serviceContainer)==null||i.clearServices(),this.cleanupUIElements(),M.cleanupAllElements(),h.plugin("Plugin unloaded successfully")}catch(s){h.error("Error during plugin unload","Plugin",{error:s instanceof Error?s.message:String(s)})}}setupLogger(){h.updateConfig({level:1,enableConsole:!0,enableFile:!1,maxLogEntries:1e3})}async initializeServices(){this.serviceContainer=new ue(this._settings,this.app),await this.serviceContainer.initialize(),this.modalManager=new fe,this.urlHandler=new Ve(this.app,this._settings,this.handleUrlDetection.bind(this)),this.videoProcessor=new $e(()=>this._settings,()=>this.serviceContainer,()=>this.isUnloading),this.modalFactory=new Ge(this.app,()=>this._settings,()=>this.serviceContainer)}setupUrlHandling(){if(!this.urlHandler)return;let e=this.urlHandler;this.registerEvent(this.app.vault.on("create",r=>{r instanceof _.TFile&&this.safeOperation(()=>e.handleFileCreate(r),"Handle file create")})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.safeOperation(()=>e.handleActiveLeafChange(),"Handle active leaf change")}))}setupProtocolHandler(){try{this.registerObsidianProtocolHandler("youtube-clipper",e=>{var r;h.info("[YT-Clipper] Protocol received:","Plugin",e),(r=this.urlHandler)==null||r.handleProtocol(e)}),h.info("[YT-Clipper] Protocol handler registered successfully","Plugin")}catch(e){h.error("[YT-Clipper] Protocol handler registration failed:","Plugin",e),h.debug("Protocol handler not available","Plugin")}}registerUIComponents(){this.ribbonIcon=this.addRibbonIcon("youtube","Process YouTube Video",()=>{h.info("[YT-CLIPPER] Ribbon icon clicked","Plugin"),this.safeShowUrlModal()}),h.plugin("Ribbon icon set successfully"),this.addCommand({id:`${at}-process-youtube-video`,name:"Process YouTube Video",callback:()=>{h.info("[YT-CLIPPER] Process command triggered","Plugin"),this.safeShowUrlModal()}}),this.addSettingTab(new Be(this.app,{plugin:this,onSettingsChange:this.handleSettingsChange.bind(this)})),this.addCommand({id:`${at}-open-url-from-clipboard`,name:"YouTube Clipper: Open URL Modal (from clipboard)",callback:async()=>{await this.handleClipboardUrl()}}),this.addCommand({id:`${at}-batch-process`,name:"YouTube Clipper: Batch Process Videos",callback:()=>{this.openBatchModal()}})}cleanupUIElements(){this.ribbonIcon&&(this.ribbonIcon.remove(),this.ribbonIcon=null)}handleUrlDetection(e){h.info("URL detected, opening modal","Plugin",{url:e.url,source:e.source,filePath:e.filePath}),this.safeShowUrlModal(e.url)}async handleClipboardUrl(){try{if(!this.urlHandler)return;await this.urlHandler.handleClipboardUrl();let e=window.prompt("Paste YouTube URL to open in YouTube Clipper:");e&&y.isValidYouTubeUrl(e.trim())?this.safeShowUrlModal(e.trim()):new _.Notice("No valid YouTube URL provided.")}catch(e){w.handle(e,"Open URL from clipboard")}}async safeShowUrlModal(e){if(h.debug("[YT-CLIPPER] safeShowUrlModal called","Plugin",{initialUrl:e,hasModalManager:!!this.modalManager,hasServiceContainer:!!this.serviceContainer}),!this.modalManager||!this.serviceContainer){h.error("[YT-CLIPPER] Cannot show modal - missing services","Plugin");return}try{await this.openYouTubeUrlModal(e)}catch(r){h.error("[YT-CLIPPER] Failed to open modal:","Plugin",r)}}async openYouTubeUrlModal(e){if(h.debug("[YT-CLIPPER] openYouTubeUrlModal called","Plugin",{initialUrl:e}),this.isUnloading){M.log("Plugin is unloading, ignoring modal request");return}M.safeOperation(async()=>{if(!this.serviceContainer||!this.modalFactory)return;this.modalFactory.updateSettings(this._settings),this.modalFactory.updateServiceContainer(this.serviceContainer),this.modalFactory.createYouTubeUrlModal({onProcess:async(i,s,n,o,a,l,d,u,p,m)=>this.processYouTubeVideo({url:i,format:s,providerName:n,model:o,performanceMode:a,enableParallel:l,preferMultimodal:d,maxTokens:u,temperature:p,enableAutoFallback:m}),onOpenFile:this.openFileByPath.bind(this),initialUrl:e,onPerformanceSettingsChange:async(i,s,n)=>{this._settings.performanceMode=i,this._settings.enableParallelProcessing=s,this._settings.preferMultimodal=n,await this.saveSettings(),this.serviceContainer=new ue(this._settings,this.app),await this.serviceContainer.initialize()},onOpenBatchModal:this.openBatchModal.bind(this)}).open()},"YouTube URL Modal").catch(r=>{w.handle(r,"Opening YouTube URL modal")})}async openBatchModal(){if(this.isUnloading||!this.serviceContainer||!this.modalFactory)return;this.modalFactory.updateSettings(this._settings),this.modalFactory.updateServiceContainer(this.serviceContainer),this.modalFactory.createBatchVideoModal({onProcess:async(r,i,s,n)=>{let o=[];for(let a of r){let l=await this.processYouTubeVideo({url:a,format:i,providerName:s,model:n});o.push(l)}return o},onOpenFile:this.openFileByPath.bind(this)}).open()}async processYouTubeVideo(e){if(!this.videoProcessor)throw new Error("Video processor not initialized");return this.videoProcessor.process(e)}async openFileByPath(e){try{await new Promise(s=>setTimeout(s,300));let r=e.startsWith("/")?e.substring(1):e,i=this.app.vault.getAbstractFileByPath(r);if(!i||!(i instanceof _.TFile))throw new Error(`File not found at path: ${r}`);await this.openFileInNewTab(i)}catch(r){throw w.handle(r,"Opening file by path"),r}}async openFileInNewTab(e){try{let r=this.app.workspace.getLeaf("tab");await r.openFile(e),this.app.workspace.setActiveLeaf(r),new _.Notice(`\u{1F4C2} Opened: ${e.name}`)}catch(r){try{await this.app.workspace.getLeaf(!1).openFile(e),new _.Notice(`\u{1F4C2} Opened: ${e.name}`)}catch(i){w.handle(i,"Opening file in current tab"),new _.Notice(`Note saved as "${e.name}" but could not auto-open. Please open manually.`)}}}async handleSettingsChange(e){var r,i,s;try{this._settings={...e},await this.saveSettings(),await((r=this.serviceContainer)==null?void 0:r.updateSettings(this._settings)),(i=this.urlHandler)==null||i.updateSettings(this._settings),(s=this.modalFactory)==null||s.updateSettings(this._settings)}catch(n){throw w.handle(n,"Settings update"),n}}async loadSettings(){let e=await this.loadData();h.debug("[YT-CLIPPER] Settings loaded from data.json:","Plugin",e),this._settings=Object.assign({},xt,e)}async saveSettings(){await this.saveData(this._settings)}async safeOperation(e,r){if(this.isUnloading)return h.warn(`Attempted ${r} during plugin unload - skipping`,"Plugin"),null;let i=++this.operationCount;h.info(`Starting operation ${i}: ${r}`,"Plugin");try{let s=await e();return h.info(`Completed operation ${i}: ${r}`,"Plugin"),s}catch(s){return h.error(`Failed operation ${i}: ${r}`,"Plugin",{error:s instanceof Error?s.message:String(s)}),w.handle(s,r),null}}getServiceContainer(){return this.serviceContainer}getUrlHandler(){return this.urlHandler}getModalManager(){return this.modalManager}getCurrentSettings(){return{...this._settings}}get settings(){return this._settings}};
