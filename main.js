/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Oe=Object.defineProperty;var at=Object.getOwnPropertyDescriptor;var nt=Object.getOwnPropertyNames;var lt=Object.prototype.hasOwnProperty;var $=(u,t)=>()=>(u&&(t=u(u=0)),t);var Le=(u,t)=>{for(var e in t)Oe(u,e,{get:t[e],enumerable:!0})},ct=(u,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of nt(t))!lt.call(u,i)&&i!==e&&Oe(u,i,{get:()=>t[i],enumerable:!(r=at(t,i))||r.enumerable});return u};var Fe=u=>ct(Oe({},"__esModule",{value:!0}),u);var D,re,z,Ye,ze,je,J,K=$(()=>{"use strict";D={GEMINI:"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-pro:generateContent",GROQ:"https://api.groq.com/openai/v1/chat/completions",HUGGINGFACE:"https://api-inference.huggingface.co/models",OPENROUTER:"https://openrouter.ai/api/v1/chat/completions",YOUTUBE_OEMBED:"https://www.youtube.com/oembed",CORS_PROXY:"https://api.allorigins.win/raw"},re={GEMINI:"gemini-2.5-pro",GROQ:"llama-3.3-70b-versatile",HUGGINGFACE:"Qwen/Qwen3-8B",OPENROUTER:"meta-llama/llama-3.1-8b-instruct:free"},z={"Google Gemini":[{name:"gemini-3-pro-preview",supportsAudioVideo:!0},{name:"gemini-3-pro-image-preview",supportsAudioVideo:!1},{name:"gemini-3-flash-preview",supportsAudioVideo:!0},{name:"gemini-2.5-pro",supportsAudioVideo:!0},{name:"gemini-2.5-pro-preview-tts",supportsAudioVideo:!1},{name:"gemini-2.5-flash",supportsAudioVideo:!0},{name:"gemini-2.5-flash-preview-09-2025",supportsAudioVideo:!0},{name:"gemini-2.5-flash-lite",supportsAudioVideo:!0},{name:"gemini-2.5-flash-lite-preview-09-2025",supportsAudioVideo:!0},{name:"gemini-2.5-flash-exp:free",supportsAudioVideo:!0},{name:"gemini-2.5-flash-image",supportsAudioVideo:!1},{name:"gemini-2.5-flash-native-audio-preview-12-2025",supportsAudioVideo:!0},{name:"gemini-2.5-flash-preview-tts",supportsAudioVideo:!1},{name:"gemini-2.0-flash",supportsAudioVideo:!0},{name:"gemini-2.0-flash-001",supportsAudioVideo:!0},{name:"gemini-2.0-flash-exp",supportsAudioVideo:!0},{name:"gemini-2.0-flash-lite",supportsAudioVideo:!0},{name:"gemini-2.0-flash-lite-001",supportsAudioVideo:!0},{name:"gemini-2.0-flash-thinking-exp:free",supportsAudioVideo:!0},{name:"gemini-2.0-flash-thinking-exp-01-21",supportsAudioVideo:!0},{name:"gemini-2.0-flash-preview-image-generation",supportsAudioVideo:!1},{name:"gemini-2.0-pro",supportsAudioVideo:!0},{name:"gemini-2.0-pro-exp",supportsAudioVideo:!0},{name:"gemini-1.5-pro",supportsAudioVideo:!0},{name:"gemini-1.5-pro-001",supportsAudioVideo:!0},{name:"gemini-1.5-pro-002",supportsAudioVideo:!0},{name:"gemini-1.5-flash",supportsAudioVideo:!0},{name:"gemini-1.5-flash-001",supportsAudioVideo:!0},{name:"gemini-1.5-flash-002",supportsAudioVideo:!0},{name:"gemini-1.5-flash-8b",supportsAudioVideo:!0},{name:"gemini-1.5-flash-exp:free",supportsAudioVideo:!0},{name:"gemini-exp-1206",supportsAudioVideo:!0},{name:"gemini-exp-latest",supportsAudioVideo:!0}],Groq:[{name:"llama-3.3-70b-versatile"},{name:"llama-3.3-8b-instant"},{name:"llama-3.1-8b-instant"},{name:"llama-3.1-70b-versatile"},{name:"deepseek-r1"},{name:"deepseek-r1-distill-llama-70b"},{name:"deepseek-r1-distill-qwen-32b"},{name:"mixtral-8x7b-32768"},{name:"gemma2-9b-it"},{name:"qwen-2.5-32b"},{name:"qwen-2.5-coder-32b"}],Ollama:[{name:"deepseek-v3.2",supportsAudioVideo:!0},{name:"deepseek-v3.2:latest",supportsAudioVideo:!0},{name:"deepseek-v3.2:32b",supportsAudioVideo:!0},{name:"deepseek-v3.2:70b",supportsAudioVideo:!0},{name:"deepseek-v3.2:instruct",supportsAudioVideo:!0},{name:"deepseek-v3.2:coder",supportsAudioVideo:!0},{name:"llama3.2",supportsAudioVideo:!0},{name:"llama3.2:3b",supportsAudioVideo:!0},{name:"llama3.2:1b",supportsAudioVideo:!0},{name:"llama3.2-vision",supportsAudioVideo:!0},{name:"llama3.2-vision:11b",supportsAudioVideo:!0},{name:"llama3.2-vision:90b",supportsAudioVideo:!0},{name:"llama3.1",supportsAudioVideo:!0},{name:"llama3.1:405b",supportsAudioVideo:!0},{name:"llama3.1:70b",supportsAudioVideo:!0},{name:"llama3.1:8b",supportsAudioVideo:!0},{name:"llama3.1-instant",supportsAudioVideo:!0},{name:"llama3",supportsAudioVideo:!0},{name:"llama3:70b",supportsAudioVideo:!0},{name:"llama3:8b",supportsAudioVideo:!0},{name:"llama2:70b",supportsAudioVideo:!0},{name:"llama2:13b",supportsAudioVideo:!0},{name:"llama2:7b",supportsAudioVideo:!0},{name:"mistral",supportsAudioVideo:!0},{name:"mistral:7b",supportsAudioVideo:!0},{name:"mistral:7b-instruct-v0.3",supportsAudioVideo:!0},{name:"mixtral",supportsAudioVideo:!0},{name:"mixtral:8x7b",supportsAudioVideo:!0},{name:"mixtral:8x22b",supportsAudioVideo:!0},{name:"mixtral:8x7b-instruct-v0.1",supportsAudioVideo:!0},{name:"qwen2",supportsAudioVideo:!0},{name:"qwen2:72b",supportsAudioVideo:!0},{name:"qwen2:7b",supportsAudioVideo:!0},{name:"qwen2:1.5b",supportsAudioVideo:!0},{name:"qwen2:0.5b",supportsAudioVideo:!0},{name:"qwen2-vl",supportsAudioVideo:!0},{name:"qwen2.5",supportsAudioVideo:!0},{name:"qwen2.5:72b",supportsAudioVideo:!0},{name:"qwen2.5:32b",supportsAudioVideo:!0},{name:"qwen2.5:14b",supportsAudioVideo:!0},{name:"qwen2.5:7b",supportsAudioVideo:!0},{name:"qwen2.5:3b",supportsAudioVideo:!0},{name:"qwen2.5-coder:32b",supportsAudioVideo:!0},{name:"qwen3",supportsAudioVideo:!0},{name:"qwen3:32b",supportsAudioVideo:!0},{name:"qwen3:14b",supportsAudioVideo:!0},{name:"qwen3:8b",supportsAudioVideo:!0},{name:"qwen3:4b",supportsAudioVideo:!0},{name:"qwen3-coder",supportsAudioVideo:!0},{name:"qwen3-coder:32b",supportsAudioVideo:!0},{name:"qwen3-coder:14b",supportsAudioVideo:!0},{name:"qwen3-coder:480b-cloud",supportsAudioVideo:!0},{name:"gemma2",supportsAudioVideo:!0},{name:"gemma2:27b",supportsAudioVideo:!0},{name:"gemma2:9b",supportsAudioVideo:!0},{name:"gemma",supportsAudioVideo:!0},{name:"gemma:7b",supportsAudioVideo:!0},{name:"gemma:2b",supportsAudioVideo:!0},{name:"phi3",supportsAudioVideo:!0},{name:"phi3:14b",supportsAudioVideo:!0},{name:"phi3:mini",supportsAudioVideo:!0},{name:"phi3:4k",supportsAudioVideo:!0},{name:"phi3-vision",supportsAudioVideo:!0},{name:"phi3.5",supportsAudioVideo:!0},{name:"phi3.5:3.8b",supportsAudioVideo:!0},{name:"phi3.5-instruct",supportsAudioVideo:!0},{name:"deepseek-r1",supportsAudioVideo:!0},{name:"deepseek-r1:32b",supportsAudioVideo:!0},{name:"deepseek-r1:14b",supportsAudioVideo:!0},{name:"deepseek-r1:8b",supportsAudioVideo:!0},{name:"deepseek-r1-distill-llama-70b",supportsAudioVideo:!0},{name:"deepseek-r1-distill-qwen-32b",supportsAudioVideo:!0},{name:"deepseek-coder-v2",supportsAudioVideo:!0},{name:"deepseek-coder",supportsAudioVideo:!0},{name:"deepseek-coder-v2:16b",supportsAudioVideo:!0},{name:"llava",supportsAudioVideo:!0},{name:"llava:13b",supportsAudioVideo:!0},{name:"llava:7b",supportsAudioVideo:!0},{name:"llava-llama3",supportsAudioVideo:!0},{name:"llava-llama3:8b",supportsAudioVideo:!0},{name:"bakllava",supportsAudioVideo:!0},{name:"moondream",supportsAudioVideo:!0},{name:"moondream:2b",supportsAudioVideo:!0},{name:"nvidia-llama3-1-vision",supportsAudioVideo:!0},{name:"minicpm-v",supportsAudioVideo:!0},{name:"minicpm-v:2.6",supportsAudioVideo:!0},{name:"minicpm-l",supportsAudioVideo:!0},{name:"codellama",supportsAudioVideo:!0},{name:"codellama:13b",supportsAudioVideo:!0},{name:"codellama:34b",supportsAudioVideo:!0},{name:"codellama:70b",supportsAudioVideo:!0},{name:"codegemma",supportsAudioVideo:!0},{name:"codegemma:7b",supportsAudioVideo:!0},{name:"starcoder2",supportsAudioVideo:!0},{name:"starcoder2:15b",supportsAudioVideo:!0},{name:"starcoder2:7b",supportsAudioVideo:!0},{name:"command-r",supportsAudioVideo:!0},{name:"command-r:35b",supportsAudioVideo:!0},{name:"command-r:7b",supportsAudioVideo:!0},{name:"command-r-plus",supportsAudioVideo:!0},{name:"command-r-zephyr",supportsAudioVideo:!0},{name:"neural-chat",supportsAudioVideo:!0},{name:"openchat",supportsAudioVideo:!0},{name:"openchat:7b",supportsAudioVideo:!0},{name:"openchat:8b",supportsAudioVideo:!0},{name:"wizardlm2",supportsAudioVideo:!0},{name:"wizardlm2:8x22b",supportsAudioVideo:!0},{name:"wizardlm2:7b",supportsAudioVideo:!0},{name:"yi",supportsAudioVideo:!0},{name:"yi:34b",supportsAudioVideo:!0},{name:"yi:6b",supportsAudioVideo:!0},{name:"yi:1.5-9b",supportsAudioVideo:!0}],"Ollama Cloud":[{name:"deepseek-v3.2",supportsAudioVideo:!0},{name:"deepseek-v3.2:latest",supportsAudioVideo:!0},{name:"deepseek-v3.2:32b",supportsAudioVideo:!0},{name:"deepseek-v3.2:70b",supportsAudioVideo:!0},{name:"deepseek-v3.2:instruct",supportsAudioVideo:!0},{name:"deepseek-v3.2:coder",supportsAudioVideo:!0},{name:"deepseek-r1",supportsAudioVideo:!0},{name:"deepseek-r1:32b",supportsAudioVideo:!0},{name:"deepseek-r1:70b",supportsAudioVideo:!0},{name:"deepseek-r1:distill-llama-70b",supportsAudioVideo:!0},{name:"deepseek-r1:distill-qwen-32b",supportsAudioVideo:!0},{name:"llama3.2",supportsAudioVideo:!0},{name:"llama3.2:3b",supportsAudioVideo:!0},{name:"llama3.2:1b",supportsAudioVideo:!0},{name:"llama3.2-vision",supportsAudioVideo:!0},{name:"llama3.2-vision:11b",supportsAudioVideo:!0},{name:"llama3.2-vision:90b",supportsAudioVideo:!0},{name:"qwen3:32b",supportsAudioVideo:!0},{name:"qwen3:14b",supportsAudioVideo:!0},{name:"qwen3:8b",supportsAudioVideo:!0},{name:"qwen3-coder:480b-cloud",supportsAudioVideo:!0},{name:"qwen3-coder:32b",supportsAudioVideo:!0},{name:"mixtral:8x7b",supportsAudioVideo:!0},{name:"mixtral:8x22b",supportsAudioVideo:!0},{name:"mixtral:8x7b-instruct-v0.1",supportsAudioVideo:!0}],"Hugging Face":[{name:"Qwen/Qwen2-VL-7B-Instruct",supportsAudioVideo:!0},{name:"Qwen/Qwen2-VL-2B-Instruct",supportsAudioVideo:!0},{name:"meta-llama/Llama-3.2-11B-Vision-Instruct",supportsAudioVideo:!0},{name:"meta-llama/Llama-3.2-90B-Vision-Instruct",supportsAudioVideo:!0},{name:"microsoft/Phi-3.5-vision-instruct",supportsAudioVideo:!0},{name:"google/paligemma-3b-mix-448",supportsAudioVideo:!0},{name:"HuggingFaceM4/idefics2-8b",supportsAudioVideo:!0},{name:"Qwen/Qwen3-8B"},{name:"Qwen/Qwen2.5-7B-Instruct"},{name:"Qwen/Qwen3-4B-Instruct-2507"},{name:"meta-llama/Llama-3.2-3B-Instruct"},{name:"meta-llama/Llama-3.2-1B-Instruct"},{name:"deepseek-ai/DeepSeek-R1-Distill-Qwen-1.5B"},{name:"mistralai/Mistral-7B-Instruct-v0.2"},{name:"llava-hf/llava-1.5-7b",supportsAudioVideo:!0},{name:"llava-hf/llava-1.5-13b",supportsAudioVideo:!0}],OpenRouter:[{name:"meta-llama/llama-3.1-8b-instruct:free"},{name:"google/gemma-2-9b-it:free"},{name:"qwen/qwen-2.5-7b-instruct:free"},{name:"anthropic/claude-3.5-sonnet",supportsAudioVideo:!0},{name:"anthropic/claude-3.5-sonnet:beta",supportsAudioVideo:!0},{name:"anthropic/claude-3.5-haiku",supportsAudioVideo:!0},{name:"anthropic/claude-3.5-haiku:beta",supportsAudioVideo:!0},{name:"openai/gpt-4o",supportsAudioVideo:!0},{name:"openai/gpt-4o-mini",supportsAudioVideo:!0},{name:"openai/o1-mini"},{name:"openai/o1-preview"},{name:"google/gemini-2.5-pro-exp:free",supportsAudioVideo:!0},{name:"google/gemini-2.5-flash-exp:free",supportsAudioVideo:!0},{name:"google/gemini-2.0-flash-exp:free",supportsAudioVideo:!0},{name:"meta-llama/llama-3.2-11b-vision-instruct",supportsAudioVideo:!0},{name:"meta-llama/llama-3.2-90b-vision-instruct",supportsAudioVideo:!0},{name:"qwen/qwen-2-vl-7b-instruct",supportsAudioVideo:!0},{name:"qwen/qwen-2-vl-72b-instruct",supportsAudioVideo:!0},{name:"qwen/qwen-2.5-72b-instruct"},{name:"qwen/qwq-32b-preview"},{name:"meta-llama/llama-3.3-70b-instruct"},{name:"meta-llama/llama-3.1-70b-instruct"},{name:"meta-llama/llama-3.1-8b-instruct"},{name:"mistralai/mistral-large"},{name:"deepseek/deepseek-r1"},{name:"deepseek/deepseek-chat"},{name:"cohere/command-r-plus"},{name:"cohere/command-r-08-2024"}]},Ye={"Google Gemini":"https://developers.generativeai.google/models",Groq:"https://groq.com",Ollama:"http://localhost:11434","Ollama Cloud":"https://ollama.com","Hugging Face":"https://huggingface.co/models",OpenRouter:"https://openrouter.ai/models"},ze={"Google Gemini":/gemini[-_\.]?\d+(?:\.\d+)?(?:-[a-z0-9\-]+)?/gi,Groq:/llama[-_\.]?\d+(?:\.\d+)?(?:-[a-z0-9\-]+)?/gi,Ollama:/[a-zA-Z0-9]+(?:[-_:][a-zA-Z0-9]+)*/g,"Ollama Cloud":/[a-zA-Z0-9]+(?:[-_:][a-zA-Z0-9]+)*/g,"Hugging Face":/[\w-]+\/[\w\-\.]+/g,OpenRouter:/[\w-]+\/[\w\-\.:]+/g},je={MAX_TOKENS:8e3,TEMPERATURE:.7,DESCRIPTION_MAX_LENGTH:1e3,TITLE_MAX_LENGTH:100},J={FILE_CREATION_WAIT:300,MODAL_DELAY:100,FALLBACK_MODAL_CHECK:500,FOCUS_DELAY:150,REPAINT_DELAY:50}});var f,We=$(()=>{"use strict";f={PROCESSING:"Processing YouTube video...",SUCCESS:u=>`Successfully processed: ${u}`,OPENED_FILE:u=>`Opened: ${u}`,ERRORS:{INVALID_URL:"Invalid YouTube URL. Please provide a valid YouTube video URL (e.g., https://www.youtube.com/watch?v=VIDEO_ID)",MISSING_API_KEYS:"No valid Gemini or Groq API key configured. Please set one in plugin settings.",GEMINI_INVALID_KEY:"Gemini API key is invalid or missing. Please check your key.",GROQ_MODEL_NOT_FOUND:"Groq API error: Model not found or you do not have access. Please check your API key and model name.",FETCH_VIDEO_DATA:u=>`Failed to fetch video metadata: ${u}`,SAVE_FILE:u=>`Failed to save file: ${u}`,AI_PROCESSING:u=>`AI processing failed: ${u}`,FILE_NOT_EXISTS:"File no longer exists",COULD_NOT_OPEN:u=>`Could not open file: ${u}`,ENTER_URL:"Please enter a YouTube URL",VIDEO_ID_EXTRACTION:"Could not extract video ID from URL. Please check the URL format.",NETWORK_ERROR:"Network error occurred. Please check your internet connection and try again.",TIMEOUT_ERROR:"Request timed out. The server may be overloaded. Please try again.",CONNECTION_REFUSED:"Could not connect to the AI service. Please check if the service is running.",INVALID_RESPONSE:"Received an invalid response from the AI service. Please try again.",TRANSCRIPT_UNAVAILABLE:"Video transcript is not available. This video may not have captions enabled.",VIDEO_PRIVATE:"This video is private or unavailable. Please check the URL.",VIDEO_REGION_BLOCKED:"This video is not available in your region.",QUOTA_EXCEEDED:u=>`${u} API quota exceeded. Please check your plan and billing details, or try again later.`,RATE_LIMITED:u=>`${u} API rate limit reached. Please wait a moment and try again.`,BILLING_REQUIRED:u=>`${u} requires a paid plan. Please check your billing settings.`,CREDIT_EXHAUSTED:u=>`${u} API credits exhausted. Please top up your account or upgrade your plan.`,PROVIDER_UNAVAILABLE:u=>`${u} is currently unavailable. Try a different provider.`,MODEL_ACCESS_DENIED:(u,t)=>`Access denied to model "${u}" on ${t}. Check your API tier.`,CONTEXT_TOO_LONG:u=>`Content too long for ${u}. Try a shorter video or use a different format.`},WARNINGS:{CORS_RESTRICTIONS:"Description not available due to CORS restrictions",EXTRACTION_FAILED:"Description extraction failed",AUTO_EXTRACTION:"Video description could not be extracted automatically.",SLOW_PROCESSING:"Processing is taking longer than expected. Please wait...",LARGE_TRANSCRIPT:"This video has a long transcript. Processing may take a while."},SUCCESS_MESSAGES:{NOTE_CREATED:"Note created successfully!",PROCESSING_COMPLETE:"Video processed successfully!",CLIPBOARD_COPIED:"Path copied to clipboard",SETTINGS_SAVED:"Settings saved"},MODALS:{YOUTUBE_PROCESSED:"YouTube Video Processed",CONFIRM_OPEN:u=>`Successfully processed YouTube video and saved as "${u}". Would you like to open the note now?`,CLOSE_CONFIRMATION:"Close without opening the note?",PROCESS_VIDEO:"YouTube Clipper",YES_OPEN:"Yes, open note",NO_THANKS:"No, thanks",CANCEL:"Cancel",PROCESS:"Process"},PLACEHOLDERS:{YOUTUBE_URL:"https://www.youtube.com/watch?v=...",GEMINI_KEY:"AIza...",GROQ_KEY:"gsk_...",OUTPUT_PATH:"YouTube/Processed Videos"},HELP:{API_KEY_HELP:"Get your API key from the provider's developer console",FORMAT_BRIEF:"A concise summary with key points",FORMAT_EXECUTIVE:"A comprehensive overview with main takeaways",FORMAT_DETAILED:"An in-depth guide with full details and examples",FORMAT_CUSTOM:"Use your own custom prompt template"}}});var Y,ie,Qe=$(()=>{"use strict";Y={zIndex:"10000",display:"flex",header:{marginBottom:"20px",color:"#ffa500",fontSize:"28px",fontWeight:"700",textAlign:"center"},message:{marginBottom:"20px",lineHeight:"1.5"},buttonContainer:{marginTop:"20px",display:"flex",gap:"10px",justifyContent:"flex-end"},button:{padding:"8px 16px",minWidth:"100px"}},ie={width:"100%",marginTop:"8px",padding:"8px",border:"1px solid var(--background-modifier-border)",borderRadius:"4px"}});var Je=$(()=>{"use strict"});var T=$(()=>{"use strict";K();We();Qe();Je()});var Ue={};Le(Ue,{DEFAULT_TIMEOUTS:()=>ut,PERFORMANCE_PRESETS:()=>dt});var dt,ut,Ve=$(()=>{"use strict";dt={fast:{name:"Fast",description:"Maximum speed with optimized models",timeouts:{geminiTimeout:15e3,groqTimeout:1e4,metadataTimeout:5e3},enableParallel:!0,preferMultimodal:!1,modelStrategy:{briefFormat:"llama-3.1-8b-instant",executiveSummary:"llama-3.3-70b-versatile",detailedGuide:"gemini-2.0-flash-lite",fallbackModel:"llama-3.1-8b-instant"}},balanced:{name:"Balanced",description:"Balanced speed and quality",timeouts:{geminiTimeout:3e4,groqTimeout:2e4,metadataTimeout:1e4},enableParallel:!0,preferMultimodal:!0,modelStrategy:{briefFormat:"llama-3.1-8b-instant",executiveSummary:"gemini-2.0-flash-lite",detailedGuide:"gemini-2.5-flash",fallbackModel:"llama-3.3-70b-versatile"}},quality:{name:"Quality",description:"Maximum quality with comprehensive analysis",timeouts:{geminiTimeout:6e4,groqTimeout:3e4,metadataTimeout:15e3},enableParallel:!1,preferMultimodal:!0,modelStrategy:{briefFormat:"gemini-2.0-flash-lite",executiveSummary:"gemini-2.5-flash",detailedGuide:"gemini-2.5-pro",fallbackModel:"gemini-2.0-flash"}}},ut={geminiTimeout:3e4,groqTimeout:2e4,metadataTimeout:1e4}});var R,et=$(()=>{"use strict";T();R=class u{static applyStyles(t,e){Object.assign(t.style,e)}static createButtonContainer(t){let e=t.createDiv();return this.applyStyles(e,Y.buttonContainer),e}static createStyledButton(t,e,r=!1,i){let s=t.createEl("button",{text:e});return r&&s.classList.add("mod-cta"),this.applyStyles(s,Y.button),i&&s.addEventListener("click",i),s}static createStyledInput(t,e,r,i=""){let s=t.createEl("input",{type:e,placeholder:r,value:i});return this.applyStyles(s,ie),s}static setupModalStyling(t){this.applyStyles(t,{zIndex:Y.zIndex,display:Y.display})}static createModalHeader(t,e){let r=t.createEl("h2",{text:e});return this.applyStyles(r,Y.header),r}static createModalMessage(t,e){let r=t.createEl("p");return r.setText(e),this.applyStyles(r,Y.message),r}static setupModalKeyHandlers(t,e,r){t.addEventListener("keydown",i=>{i.key==="Enter"&&(i.preventDefault(),i.stopPropagation(),e()),i.key==="Escape"&&r&&(i.preventDefault(),i.stopPropagation(),r())})}applyStyles(t,e){u.applyStyles(t,e)}createButtonContainer(t){return u.createButtonContainer(t)}createStyledButton(t,e,r=!1,i){return u.createStyledButton(t,e,r,i)}}});var tt={};Le(tt,{ConfirmationModal:()=>Be});var Be,He=$(()=>{"use strict";Z();Be=class extends q{constructor(e,r){super(e);this.options=r;this.result=!1}onOpen(){this.createModalContent(),this.setupEventHandlers(),this.focusConfirmButton()}createModalContent(){this.createHeader(this.options.title).setAttribute("id","confirmation-modal-title");let r=this.contentEl.createDiv("confirmation-message");r.setAttribute("id","confirmation-modal-description"),r.textContent=this.options.message;let i=this.createButtonContainer();i.style.marginTop="20px";let s=this.options.confirmText||"Confirm",o=this.options.cancelText||"Cancel";this.options.isDangerous||!1?(this.cancelButton=this.createButton(i,o,!1,()=>this.handleCancel()),this.cancelButton.setAttribute("aria-label",`Cancel: ${o}`),this.confirmButton=this.createButton(i,s,!0,()=>this.handleConfirm()),this.confirmButton.setAttribute("aria-label",`Confirm: ${s}`)):(this.confirmButton=this.createButton(i,s,!0,()=>this.handleConfirm()),this.confirmButton.setAttribute("aria-label",`Confirm: ${s}`),this.cancelButton=this.createButton(i,o,!1,()=>this.handleCancel()),this.cancelButton.setAttribute("aria-label",`Cancel: ${o}`)),this.contentEl.setAttribute("aria-labelledby","confirmation-modal-title"),this.contentEl.setAttribute("aria-describedby","confirmation-modal-description"),this.contentEl.setAttribute("role","alertdialog")}setupEventHandlers(){this.scope.register([],"Enter",()=>(this.handleConfirm(),!1)),this.scope.register([],"Escape",()=>(this.handleCancel(),!1))}focusConfirmButton(){this.confirmButton&&setTimeout(()=>{this.confirmButton.focus()},50)}handleConfirm(){this.result=!0,this.resolver&&this.resolver(!0),this.close()}handleCancel(){this.result=!1,this.resolver&&this.resolver(!1),this.close()}openAndWait(){return new Promise(e=>{this.resolver=e,this.open()})}getResult(){return this.result}}});var rt,W,q,Z=$(()=>{"use strict";et();T();T();rt=require("obsidian"),W={modal:"ytc-modal",header:"ytc-modal-header",content:"ytc-modal-content",button:"ytc-modal-button",input:"ytc-modal-input"},q=class extends rt.Modal{constructor(e){super(e);this.events={};this.isDisposed=!1;this.setupModalStyling(),this.setupConflictPrevention()}setupModalStyling(){R.setupModalStyling(this.modalEl),this.modalEl.addClass(W.modal),this.contentEl.addClass(W.content)}setupConflictPrevention(){this.modalEl.setAttribute("data-plugin","youtube-clipper"),this.modalEl.style.zIndex="9999"}createHeader(e){let r=R.createModalHeader(this.contentEl,e);return r.addClass(W.header),r}createMessage(e){return R.createModalMessage(this.contentEl,e)}createButtonContainer(){return R.createButtonContainer(this.contentEl)}createButton(e,r,i=!1,s){let o=R.createStyledButton(e,r,i,s);return o.addClass(W.button),o.setAttribute("data-plugin","youtube-clipper"),o.setAttribute("role","button"),o.getAttribute("aria-label")||o.setAttribute("aria-label",r),o}createInput(e,r,i){let s=e.createEl("input",{type:r,placeholder:i});return R.applyStyles(s,ie),s.addClass(W.input),s.setAttribute("data-plugin","youtube-clipper"),i&&s.setAttribute("aria-label",i),s}setupKeyHandlers(e,r){let i=async()=>{try{await e()}catch(o){}},s=r?async()=>{try{await r()}catch(o){}}:void 0;R.setupModalKeyHandlers(this.contentEl,i,s)}focusElement(e,r=J.FOCUS_DELAY){setTimeout(()=>{e.focus()},r)}setEvents(e){this.events=e}confirmClose(e){return confirm(e)}async showConfirmationModal(e,r,i="Confirm",s="Cancel",o=!1){let{ConfirmationModal:a}=await Promise.resolve().then(()=>(He(),tt));return new a(this.app,{title:e,message:r,confirmText:i,cancelText:s,isDangerous:o}).openAndWait()}forceVisible(){setTimeout(()=>{R.setupModalStyling(this.modalEl)},J.REPAINT_DELAY)}onClose(){if(this.isDisposed)return;this.isDisposed=!0;let{contentEl:e}=this;e.empty(),this.modalEl.removeClass(W.modal),this.modalEl.removeAttribute("data-plugin")}}});var bt={};Le(bt,{default:()=>Ie});module.exports=Fe(bt);var L=class{static checkForPotentialConflicts(){let t=[];return['div[data-plugin="web-clipper"]',".web-clipper-modal"].forEach(r=>{let i=document.querySelectorAll(r);Array.from(i).filter(o=>!o.hasAttribute("data-plugin")||o.getAttribute("data-plugin")!==this.PLUGIN_ID).length>0&&t.push(`Detected potential plugin conflict: ${r}`)}),t}static markElement(t,e){t.setAttribute("data-plugin",this.PLUGIN_ID),t.setAttribute("data-ytc-type",e),t.addClass(`${this.CSS_PREFIX}-${e}`)}static unmarkElement(t){t.removeAttribute("data-plugin"),t.removeAttribute("data-ytc-type"),Array.from(t.classList).forEach(r=>{r.startsWith(this.CSS_PREFIX)&&t.removeClass(r)})}static createUniqueId(t){return`${this.CSS_PREFIX}-${t}-${Date.now()}`}static cleanupAllElements(){document.querySelectorAll(`[data-plugin="${this.PLUGIN_ID}"]`).forEach(e=>{e instanceof HTMLElement&&this.unmarkElement(e)})}static getStorageKey(t){return`${this.PLUGIN_ID}-${t}`}static log(t,e="info"){let r=new Date().toISOString(),i=`[${this.PLUGIN_ID}] ${r} - ${t}`;switch(e){case"warn":console.warn(i);break;case"error":console.error(i);break;default:console.log(i)}}static isSafeToOperate(){let t=this.checkForPotentialConflicts();return t.length>0?(this.log(`Potential conflicts detected: ${t.join(", ")}`,"warn"),!1):!0}static async safeOperation(t,e){try{this.log(`Starting ${e}`);let r=await t();return this.log(`Completed ${e}`),r}catch(r){throw this.log(`Error in ${e}: ${r}`,"error"),r}}};L.PLUGIN_ID="youtube-clipper",L.CSS_PREFIX="ytc";T();var X=require("obsidian");var E=class u{static classifyError(t){let e=t.message.toLowerCase();if(e.includes("network")||e.includes("fetch")||e.includes("connection")||e.includes("timeout")||e.includes("econnrefused")||e.includes("enotfound"))return{category:"network",message:f.ERRORS.NETWORK_ERROR,retryable:!0,retryDelay:2e3,userGuidance:"Check your internet connection and try again."};if(this.isQuotaError(t)){let r=this.extractProviderName(t);return{category:"quota",message:e.includes("rate")?f.ERRORS.RATE_LIMITED(r):f.ERRORS.QUOTA_EXCEEDED(r),retryable:e.includes("rate"),retryDelay:e.includes("rate")?6e4:void 0,userGuidance:e.includes("rate")?"Wait a minute before trying again.":"Check your API plan or try a different provider."}}return e.includes("401")||e.includes("403")||e.includes("unauthorized")||e.includes("invalid key")||e.includes("invalid api key")||e.includes("authentication")?{category:"auth",message:"API key is invalid or expired. Please check your settings.",retryable:!1,userGuidance:"Verify your API key in the plugin settings."}:e.includes("invalid url")||e.includes("video id")||e.includes("not found")||e.includes("unavailable")?{category:"validation",message:t.message,retryable:!1,userGuidance:"Check the video URL and try again."}:e.includes("model")||e.includes("context length")||e.includes("too long")||e.includes("token")?{category:"provider",message:t.message,retryable:!1,userGuidance:"Try a different model or shorter video."}:{category:"unknown",message:t.message,retryable:!0,retryDelay:3e3,userGuidance:"An unexpected error occurred. Please try again."}}static handle(t,e,r=!0){let i=`${e}: ${t.message}`;r&&new X.Notice(`Error: ${t.message}`)}static handleWithGuidance(t,e){let r=this.classifyError(t),i=r.userGuidance?`${r.message}

\u{1F4A1} ${r.userGuidance}`:r.message,s=r.retryable?5e3:8e3;return new X.Notice(i,s),r}static async withErrorHandling(t,e,r=!0){try{return await t()}catch(i){return this.handle(i,e,r),null}}static withSyncErrorHandling(t,e,r=!0){try{return t()}catch(i){return this.handle(i,e,r),null}}static createAPIError(t,e,r,i){let s=`${t} API error: ${e} ${r}${i?`. ${i}`:""}`;return new Error(s)}static async handleAPIError(t,e,r){var s;let i=r||"";try{let o=await t.json();i=((s=o.error)==null?void 0:s.message)||o.message||r||""}catch(o){}throw this.createAPIError(e,t.status,t.statusText,i)}static validateConfiguration(t,e){let r=e.filter(i=>!t[i]);if(r.length>0)throw new Error(`Missing required configuration: ${r.join(", ")}`)}static createUserFriendlyError(t,e){let r=`Failed to ${e}: ${t.message}`;return new Error(r)}static handleQuotaError(t,e){let r=t.message.toLowerCase(),i="",s=!1;if(r.includes("quota")||r.includes("limit")||r.includes("exceeded")?r.includes("rate")||r.includes("too many requests")?(i=f.ERRORS.RATE_LIMITED(e),s=!0):r.includes("billing")||r.includes("payment")?i=f.ERRORS.BILLING_REQUIRED(e):r.includes("credit")||r.includes("balance")?i=f.ERRORS.CREDIT_EXHAUSTED(e):(i=f.ERRORS.QUOTA_EXCEEDED(e),s=!0):i=f.ERRORS.QUOTA_EXCEEDED(e),s){let o=new X.Notice(i,0);setTimeout(()=>{let n=o.noticeEl.createEl("button",{text:"Retry",cls:"mod-cta"});n.style.marginLeft="10px",n.onclick=()=>{o.hide(),window.dispatchEvent(new CustomEvent("yt-clipper-retry-processing"))}},100)}else new X.Notice(i,8e3)}static isQuotaError(t){let e=t.message.toLowerCase(),r=["quota exceeded","rate limit","rate_limit","too many requests","billing required","payment required","credit exhausted","insufficient credits","insufficient balance","usage limit","api limit exceeded","requests per minute","requests per second","resource_exhausted"];return e.includes("429")?!0:r.some(i=>e.includes(i))}static extractProviderName(t,e="AI Service"){let r=t.message.toLowerCase();return r.includes("gemini")||r.includes("google")?"Google Gemini":r.includes("groq")?"Groq":r.includes("openai")?"OpenAI":e}static handleEnhanced(t,e,r=!0){if(this.isQuotaError(t)){let i=this.extractProviderName(t);this.handleQuotaError(t,i);return}this.handle(t,e,r)}handle(t,e,r=!0){u.handle(t,e,r)}async withErrorHandling(t,e){return u.withErrorHandling(t,e)}};var $e=(s=>(s[s.DEBUG=0]="DEBUG",s[s.INFO=1]="INFO",s[s.WARN=2]="WARN",s[s.ERROR=3]="ERROR",s[s.SILENT=4]="SILENT",s))($e||{}),_e=class u{constructor(t={}){this.logs=[];this.config={level:1,enableConsole:!0,enableFile:!1,maxLogEntries:1e3,enableTimestamps:!0,...t}}static getInstance(t){return u.instance||(u.instance=new u(t)),u.instance}static resetInstance(){u.instance=void 0}shouldLog(t){return t>=this.config.level}formatMessage(t){let e=$e[t.level].padEnd(5),r=this.config.enableTimestamps?`[${t.timestamp.toISOString()}] `:"",i=t.context?` [${t.context}]`:"",s=t.data?` ${JSON.stringify(t.data)}`:"";return`${r}${e}${i} ${t.message}${s}`}addLogEntry(t,e,r,i){if(!this.shouldLog(t))return;let s={timestamp:new Date,level:t,message:e,context:r,data:i};if(this.logs.push(s),this.logs.length>this.config.maxLogEntries&&(this.logs=this.logs.slice(-this.config.maxLogEntries)),this.config.enableConsole){let o=this.formatMessage(s);switch(t){case 0:break;case 1:console.log(o);break;case 2:console.warn(o);break;case 3:console.error(o);break}}}debug(t,e,r){this.addLogEntry(0,t,e,r)}info(t,e,r){this.addLogEntry(1,t,e,r)}warn(t,e,r){this.addLogEntry(2,t,e,r)}error(t,e,r){this.addLogEntry(3,t,e,r)}getLogs(t,e){let r=this.logs;return t!==void 0&&(r=r.filter(i=>i.level===t)),e&&(r=r.filter(i=>i.context===e)),r}clearLogs(){this.logs=[]}setLevel(t){this.config.level=t}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t}}plugin(t,e){this.info(t,"Plugin",e)}aiService(t,e){this.info(t,"AIService",e)}videoService(t,e){this.info(t,"VideoService",e)}fileService(t,e){this.info(t,"FileService",e)}modal(t,e){this.info(t,"Modal",e)}performance(t,e){this.debug(t,"Performance",e)}},d=_e.getInstance();T();var se=class{constructor(){this.state={isModalOpen:!1}}canOpenModal(t){return this.state.isModalOpen?t&&t!==this.state.pendingModalUrl?{canOpen:!1,reason:"Modal already open with different URL"}:{canOpen:!1,reason:"Modal already open with same URL"}:{canOpen:!0}}async openModal(t,e,r){let i=Math.random().toString(36).substring(2,9);this.state.lastCallId=i,d.info("Modal opening requested","ModalManager",{callId:i,url:t,currentState:{...this.state}});let{canOpen:s,reason:o}=this.canOpenModal(t);if(!s)return d.warn(`Modal open rejected: ${o}`,"ModalManager",{callId:i,url:t,reason:o,pendingUrl:this.state.pendingModalUrl}),t&&t!==this.state.pendingModalUrl&&(d.info("Updating pending modal URL","ModalManager",{oldUrl:this.state.pendingModalUrl,newUrl:t}),this.state.pendingModalUrl=t),null;this.state.isModalOpen=!0,this.state.pendingModalUrl=t,d.info("Modal state set to open","ModalManager",{callId:i,url:t});try{let a=()=>{try{d.info("Modal onClose triggered","ModalManager",{callId:i,url:t}),this.resetModalState(),r&&r()}catch(c){d.error("Error in modal onClose handler","ModalManager",{callId:i,error:c instanceof Error?c.message:String(c)}),this.resetModalState()}};d.info("About to open modal","ModalManager",{callId:i,url:t});let n=await e(),l=setTimeout(()=>{this.state.isModalOpen&&this.state.pendingModalUrl===t&&(d.warn("Fallback modal state reset triggered","ModalManager",{callId:i,url:t}),this.resetModalState())},1e4);return n&&typeof n=="object"?n._fallbackTimeout=l:(d.debug("Modal result is not an object, clearing fallback timeout","ModalManager",{callId:i,url:t,resultType:typeof n}),clearTimeout(l)),setTimeout(()=>{d.debug("Modal state after 100ms","ModalManager",{callId:i,isModalOpen:this.state.isModalOpen})},100),n}catch(a){throw d.error("Error opening modal","ModalManager",{callId:i,url:t,error:a instanceof Error?a.message:String(a)}),this.resetModalState(),a}}resetModalState(){d.debug("Resetting modal state","ModalManager",{previousState:{...this.state}}),this.state.isModalOpen=!1,this.state.pendingModalUrl=void 0}forceResetModalState(){d.warn("Force resetting modal state","ModalManager",{previousState:{...this.state}}),this.state={isModalOpen:!1}}getState(){return{...this.state}}isModalOpen(){return this.state.isModalOpen}getPendingModalUrl(){return this.state.pendingModalUrl}clear(){this.forceResetModalState(),d.info("Modal manager cleared","ModalManager")}};T();var v=class{static cleanYouTubeUrl(t){if(!t||typeof t!="string")return"";let e=t.trim();return e=e.replace(/[\u200B-\u200D\uFEFF]/g,""),!e.startsWith("http://")&&!e.startsWith("https://")&&(e=`https://${e}`),(e.startsWith("http://youtube.com")||e.startsWith("http://www.youtube.com"))&&(e=e.replace("http://","https://")),e}static extractVideoId(t){if(!t||typeof t!="string")return null;if(this.URL_CACHE.has(t))return this.URL_CACHE.get(t);let e=this.cleanYouTubeUrl(t),r=null,i=this.URL_PATTERNS[0],s=i?e.match(i):null;if(s!=null&&s[1]&&this.VIDEO_ID_REGEX.test(s[1]))r=s[1];else for(let o=1;o<this.URL_PATTERNS.length&&!r;o++){let a=this.URL_PATTERNS[o];s=a?e.match(a):null,s!=null&&s[1]&&this.VIDEO_ID_REGEX.test(s[1])&&(r=s[1])}return this.URL_CACHE.size>100&&this.URL_CACHE.clear(),this.URL_CACHE.set(t,r),r}static isValidYouTubeUrl(t){return this.extractVideoId(t)!==null}static sanitizeFilename(t,e=100){return t.replace(/[<>:"/\\|?*]/g,"").replace(/\s+/g," ").trim().substring(0,e)}static isValidAPIKey(t,e){if(!t||typeof t!="string")return!1;switch(e){case"gemini":return t.startsWith("AIza")&&t.length>10;case"groq":return t.startsWith("gsk_")&&t.length>10;default:return!1}}static validateSettings(t){let e=[],r=!!t.useEnvironmentVariables;return!(this.isNonEmptyString(t.geminiApiKey)||this.isNonEmptyString(t.groqApiKey))&&!r&&e.push(f.ERRORS.MISSING_API_KEYS),this.isNonEmptyString(t.geminiApiKey)&&!this.isValidAPIKey(t.geminiApiKey,"gemini")&&e.push("Invalid Gemini API key format"),this.isNonEmptyString(t.groqApiKey)&&!this.isValidAPIKey(t.groqApiKey,"groq")&&e.push("Invalid Groq API key format"),r&&!this.isNonEmptyString(t.environmentPrefix)&&e.push("Environment variable prefix is required when using environment variables"),(!t.outputPath||typeof t.outputPath!="string")&&e.push("Output path is required"),{isValid:e.length===0,errors:e}}static isValidPath(t){return typeof t=="string"&&t.trim().length>0}static isNonEmptyString(t){return typeof t=="string"&&t.trim().length>0}static truncateText(t,e){return t.length<=e?t:`${t.substring(0,e-3)}...`}static cleanText(t){return t.replace(/\\n/g,`
`).replace(/\\"/g,'"').replace(/\\'/g,"'").replace(/\\u([0-9a-fA-F]{4})/g,(e,r)=>String.fromCharCode(parseInt(r,16)))}};v.URL_PATTERNS=[/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})(?:&.*)?$/,/(?:https?:\/\/)?(?:www\.)?youtu\.be\/([a-zA-Z0-9_-]{11})(?:\?.*)?$/,/(?:https?:\/\/)?(?:www\.)?youtube\.com\/embed\/([a-zA-Z0-9_-]{11})(?:\?.*)?$/,/(?:https?:\/\/)?(?:www\.)?youtube\.com\/v\/([a-zA-Z0-9_-]{11})(?:\?.*)?$/,/(?:https?:\/\/)?(?:m\.)?youtube\.com\/watch\?v=([a-zA-Z0-9_-]{11})(?:&.*)?$/],v.VIDEO_ID_REGEX=/^[a-zA-Z0-9_-]{11}$/,v.URL_CACHE=new Map;var H=class H{createAnalysisPrompt(t,e,r="detailed-guide",i,s,o="balanced"){let a;switch(o){case"fast":a=H.COMPACT_BASE_TEMPLATE;break;case"quality":a=H.COMPREHENSIVE_BASE_TEMPLATE;break;default:a=H.BALANCED_BASE_TEMPLATE}let n="";s!=null&&s.trim()&&(n=`VIDEO CONTENT/TRANSCRIPT:
${s.length>1e5?`${s.substring(0,1e5)}... [transcript truncated]`:s}`);let l=a.replace("{{TITLE}}",t.title).replace("{{URL}}",e).replace("{{DESCRIPTION}}",t.description).replace("{{TRANSCRIPT_SECTION}}",n);switch(r){case"executive-summary":return this.createExecutiveSummaryPrompt(l,e,o);case"brief":return this.createBriefPrompt(l,e,o);case"transcript":return this.createTranscriptPrompt(l,e,o);case"custom":return this.createCustomFormatPrompt(l,t,e,i,o);default:return this.createDetailedGuidePrompt(l,e,o)}}createBriefPrompt(t,e,r="balanced"){let i=v.extractVideoId(e),s=i?`https://www.youtube-nocookie.com/embed/${i}`:e;return`${t}

        OUTPUT FORMAT - BRIEF SUMMARY:

        Provide a two-part output following this EXACT structure:

        ---
        title: {{TITLE}}
        source: ${e}
        created: "${new Date().toISOString().split("T")[0]}"
        type: youtube-note
        format: brief
        tags: [youtube, brief]
        video_id: "${i||"unknown"}"
        ai_provider: "__AI_PROVIDER__"
        ai_model: "__AI_MODEL__"
        ---

        <div style="text-align: center; margin-bottom: 24px;">
        <iframe width="640" height="360" src="${s}" title="{{TITLE}}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>

        ---

        ## Summary
        [Under 250 words, distilling the core message and value of the video.]

        ## Key Takeaways
        - [Takeaway 1]
        - [Takeaway 2]
        - [Takeaway 3]
        - [Takeaway 4]
        - [Takeaway 5]

        **Formatting Rules:**
        - Remove time-stamps, filler words, and any unnecessary details.
        - Include external links and resources for further reading and viewing.`}createTranscriptPrompt(t,e,r="balanced"){let i=v.extractVideoId(e),s=i?`https://www.youtube-nocookie.com/embed/${i}`:e;return`${t}

        OUTPUT FORMAT - TRANSCRIPT NOTE:

        Provide a two-part output following this EXACT structure:

        ---
        title: {{TITLE}}
        source: ${e}
        created: "${new Date().toISOString().split("T")[0]}"
        type: youtube-transcript
        format: transcript
        tags: [youtube, transcript]
        video_id: "${i||"unknown"}"
        ai_provider: "__AI_PROVIDER__"
        ai_model: "__AI_MODEL__"
        ---

        <div style="text-align: center; margin-bottom: 24px;">
        <iframe width="640" height="360" src="${s}" title="{{TITLE}}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>

        ---

        ## 1. Summary
        [Under 250 words, distilling the core message and value of the video.]

        ## 2. Full Transcript
        [Cleaned up transcript content]

        **Formatting Rules:**
        - Remove time-stamps, filler words, and any unnecessary details.
        - Include external links and resources for further reading and viewing found in the content.
        - Use clear paragraph breaks for readability.`}createExecutiveSummaryPrompt(t,e,r="balanced"){let i=v.extractVideoId(e),s=i?`https://www.youtube-nocookie.com/embed/${i}`:e;return`${t}

You are an expert content analyst specializing in creating executive transcripts. Your task is to analyze video content and provide a comprehensive yet refined output.

**Your Analysis Process:**
1. Carefully review the entire video content, including spoken words, visual elements, and context
2. Identify the core message, key arguments, and primary value propositions
3. Extract 3-5 most impactful insights or takeaways
4. Identify concrete actionable items for the audience
5. Note all external resources, links, or references mentioned and suggest relevant additional resources

**Required Output Format:**

---
title: {{TITLE}}
source: ${e}
created: "${new Date().toISOString().split("T")[0]}"
modified: "${new Date().toISOString().split("T")[0]}"
type: youtube-note
format: executive-summary
tags:
  - youtube
  - executive-summary
video_id: "${i||"unknown"}"
ai_provider: "__AI_PROVIDER__"
ai_model: "__AI_MODEL__"
---

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
  <iframe src="${s}" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen title="{{TITLE}}"></iframe>
</div>

---

### \u{1F511} Key Takeaways
Present 3-5 bulleted insights that capture the most important points:
- **[Takeaway Title]**: Clear, specific insight with supporting detail or context
- Prioritize insights that are actionable or decision-enabling
- Include relevant data, quotes, or specific details when applicable
- Ensure each takeaway stands alone and provides immediate value

---

### \u{1F4CB} Summary
> **Core Message:** [The central thesis or main point of the content]

Provide a concise summary (under 250 words) covering:
- **Key Arguments**: Primary supporting points and reasoning presented
- **Value Proposition**: What viewers gain from this content and why it matters
- **Context**: Intended audience, use case, and relevance
- **Conclusion**: Overall significance or implications

---

### \u{1F680} Actionable Items
List concrete actions the audience can take based on this content:
- [ ] **[Action 1]**: Specific step, strategy, or implementation
- [ ] **[Action 2]**: Decision or change to consider
- [ ] **[Action 3]**: Next step for learning or implementation
- [ ] **[Action 4]**: Habit, practice, or framework to adopt

*(If no explicit actions mentioned, derive implied actions from the content)*


---

### \u{1F4DA} Resources

**Mentioned in Content:**
- URLs and websites referenced
- Books, articles, or papers cited
- Tools, software, or platforms discussed
- People, companies, or organizations named

**Suggested for Further Exploration:**
- Related content that expands on key topics
- Foundational resources for beginners
- Advanced materials for deeper understanding
- Community resources, forums, or documentation
- Complementary tools or alternatives

**Quality Standards:**
- Maintain the speaker's voice and intent while improving clarity
- Ensure accuracy in technical details and proper nouns
- Create a document that can be read independently without the video
- Preserve important context that might be lost in pure transcription
- Make actionable items specific and realistic`}createDetailedGuidePrompt(t,e,r="balanced"){let i=v.extractVideoId(e),s=i?`https://www.youtube-nocookie.com/embed/${i}`:e;return`${t}

        OUTPUT FORMAT - TUTORIAL / STEP-BY-STEP GUIDE:

        Provide a two-part output following this EXACT structure:

        ---
        title: {{TITLE}}
        source: ${e}
        created: "${new Date().toISOString().split("T")[0]}"
        type: youtube-tutorial
        format: tutorial
        tags: [youtube, tutorial]
        video_id: "${i||"unknown"}"
        ai_provider: "__AI_PROVIDER__"
        ai_model: "__AI_MODEL__"
        ---

        <div style="text-align: center; margin-bottom: 24px;">
        <iframe width="640" height="360" src="${s}" title="{{TITLE}}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        </div>

        ---

        ## 1. Summary
        [Under 250 words, distilling the core message and value of the video.]

        ## 2. Step-by-Step Guide
        [A sequential, detailed, and actionable tutorial that stands alone.]

        **Formatting Rules:**
        - Remove time-stamps, filler words, and any unnecessary details.
        - Include external links and resources for further reading and viewing.`}createCustomFormatPrompt(t,e,r,i,s="balanced"){let o=v.extractVideoId(r),a=o?`https://www.youtube-nocookie.com/embed/${o}`:r,n=i!=null&&i.trim()?`USER'S CUSTOM INSTRUCTIONS:
${i}

`:"";return`${t}

You are an adaptive content analyst capable of providing customized analysis based on specific user requirements. Your task is to analyze content according to the user's explicit instructions while maintaining high quality standards.

**Your Analysis Process:**
1. Carefully read and understand the custom requirements provided
2. Identify the specific analysis type, depth, and format needed
3. Determine appropriate structure and level of detail
4. Extract relevant information aligned with the custom objectives

**Default Output Format (if no custom format specified):**

### ANALYSIS OVERVIEW
- Purpose of this analysis
- Methodology or approach used
- Scope and limitations

### CUSTOM CONTENT
${n}
[Deliver analysis according to user specifications, which may include:]
- Summaries, transcripts, or distillations
- Specific sections or topic breakdowns
- Comparative analysis or synthesis
- Technical deep-dives or explanations
- Audience-specific adaptations
- Industry or domain-focused insights

### SUPPLEMENTARY INFORMATION
If relevant, include:
- External links and resources
- Related content or context
- Recommendations for further exploration
- Clarifications or caveats

**Adaptation Guidelines:**
- **Format Flexibility**: Adjust structure to match user needs (narrative, outline, Q&A, etc.)
- **Depth Control**: Scale detail level from high-level overview to comprehensive deep-dive
- **Audience Tuning**: Adapt language and complexity for specified audience
- **Purpose Alignment**: Optimize output for stated use case (learning, decision-making, reference, etc.)
- **Custom Filtering**: Include/exclude specific types of information as requested

**Quality Standards:**
- Confirm understanding of custom requirements if ambiguous
- Maintain accuracy and objectivity regardless of format
- Preserve citations and attributions
- Flag when custom requirements conflict with content availability
- Suggest alternative approaches if original request isn't feasible

**Usage Note:**
When using this template, provide clear custom instructions such as:
- Desired output format and structure
- Specific focus areas or exclusions
- Target audience and expertise level
- Intended use case or application
- Length constraints or expansion needs

---
title: {{TITLE}}
source: ${r}
created: "${new Date().toISOString().split("T")[0]}"
type: youtube-custom
format: custom
tags: [youtube, custom]
video_id: "${o||"unknown"}"
ai_provider: "__AI_PROVIDER__"
ai_model: "__AI_MODEL__"
---

<div style="text-align: center; margin-bottom: 24px;">
<iframe width="640" height="360" src="${a}" title="{{TITLE}}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
</div>

---
`}processAIResponse(t,e,r,i){if(!t)return t;let s=e||"unknown",o=r||"unknown",a=t.replace(/__AI_PROVIDER__/g,s).replace(/__AI_MODEL__/g,o);return a=this.ensureFrontMatterValue(a,"ai_provider",s),a=this.ensureFrontMatterValue(a,"ai_model",o),a}ensureFrontMatterValue(t,e,r){let i=new RegExp(`(${e}\\s*:\\s*)(["'])?([^"'\\n]*)(["'])?`,"i");return i.test(t)?t.replace(i,(s,o,a,n,l)=>{let c=a||l?'"':"";return`${o}${c}${r}${c}`}):t.startsWith("---")?t.replace(/^---\s*\n/,`---
${e}: "${r}"
`):t}createSummaryPrompt(t,e){return`Create a concise summary for this YouTube video:

        Title: ${t.title}
        URL: ${e}
        Description: ${t.description}

        Please provide:
        1. A 2-paragraph summary (max 250 words)
        2. 3-5 key takeaways
        3. Main actionable insights

        Format as markdown with clear headings.`}validatePrompt(t){return!!t&&typeof t=="string"&&t.trim().length>10&&t.length<5e4}};H.COMPACT_BASE_TEMPLATE=`Analyze this YouTube video:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}
{{TRANSCRIPT_SECTION}}

Focus on extracting the key information and insights.`,H.BALANCED_BASE_TEMPLATE=`Analyze this YouTube video:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}
{{TRANSCRIPT_SECTION}}

Extract insights from the content, focusing on practical information.`,H.COMPREHENSIVE_BASE_TEMPLATE=`Analyze this YouTube video comprehensively:
Title: {{TITLE}}
URL: {{URL}}
Description: {{DESCRIPTION}}
{{TRANSCRIPT_SECTION}}

ANALYSIS INSTRUCTIONS:
1. Analyze the transcript content thoroughly
2. Extract key insights, themes, and practical information
3. Focus on action-oriented information with specific examples
4. Maintain accuracy and cite specific examples from the content when relevant`;var oe=H;T();K();var De=class{constructor(t=!0){this.startTime=Date.now();this.serviceMetrics=new Map;this.isEnabled=!0;this.isEnabled=t}trackOperation(t,e,r,i=!0,s){if(!this.isEnabled)return;let o={service:t,operation:e,duration:r,success:i,timestamp:Date.now(),metadata:s};this.serviceMetrics.has(t)||this.serviceMetrics.set(t,[]);let a=this.serviceMetrics.get(t);a.push(o),a.length>1e3&&a.splice(0,a.length-1e3),r>1e4&&console.warn(`Slow operation detected: ${t}.${e} took ${r.toFixed(2)}ms`)}async measureOperation(t,e,r,i){if(!this.isEnabled)return r();let s=performance.now(),o={value:!0};try{let a=await r();return o.value=!0,a}catch(a){throw o.value=!1,a}finally{let a=performance.now()-s;this.trackOperation(t,e,a,o.value,i)}}getServiceMetrics(t){return this.serviceMetrics.get(t)||[]}getMetricsSummary(t){let e=this.serviceMetrics.get(t)||[];if(e.length===0)return{count:0,average:0,min:0,max:0,successRate:0};let r=e.map(s=>s.duration).sort((s,o)=>s-o),i=e.filter(s=>s.success).length;return{count:e.length,average:r.reduce((s,o)=>s+o,0)/r.length,min:Math.min(...r),max:Math.max(...r),successRate:i/e.length}}generateReport(){let t={timestamp:new Date().toISOString(),uptime:Date.now()-this.startTime,services:{},systemMetrics:{},recommendations:[]};return this.serviceMetrics.forEach((e,r)=>{if(e.length===0)return;let i=e.filter(n=>n.success),s=e.filter(n=>!n.success),o=e.map(n=>n.duration),a={totalOperations:e.length,averageResponseTime:o.reduce((n,l)=>n+l,0)/o.length,successRate:i.length/e.length,errorCount:s.length,slowestOperation:this.findExtremeOperation(e,"slowest"),fastestOperation:this.findExtremeOperation(e,"fastest")};t.services[r]=a}),t.systemMetrics={memoryUsage:this.getMemoryUsage(),cacheHitRate:this.getCacheHitRate(),httpMetrics:this.getHTTPMetrics()},t.recommendations=this.generateRecommendations(t),t}findExtremeOperation(t,e){if(t.length===0)return{name:"none",duration:0};let i=[...t].sort((s,o)=>e==="slowest"?o.duration-s.duration:s.duration-o.duration)[0];return i?{name:`${i.operation}${i.metadata?` (${JSON.stringify(i.metadata)})`:""}`,duration:i.duration}:{name:"N/A",duration:0}}getMemoryUsage(){if(performance.memory)return Math.round(performance.memory.usedJSHeapSize/1024/1024)}getCacheHitRate(){}getHTTPMetrics(){}generateRecommendations(t){let e=[];return Object.entries(t.services).forEach(([r,i])=>{var l,c,h,p;let s=(l=i.averageResponseTime)!=null?l:0,o=(c=i.successRate)!=null?c:1,a=(h=i.errorCount)!=null?h:0,n=(p=i.totalOperations)!=null?p:1;s>5e3&&e.push(`${r} average response time exceeds 5 seconds (${s.toFixed(0)}ms)`),o<.95&&e.push(`${r} success rate below 95% (${(o*100).toFixed(1)}%)`),a>n*.1&&e.push(`${r} error rate is high (${a}/${n})`)}),t.systemMetrics.memoryUsage&&t.systemMetrics.memoryUsage>100&&e.push("High memory usage detected - consider implementing more aggressive cleanup"),t.uptime>1440*60*1e3&&e.push("Plugin has been running for over 24 hours - consider restarting Obsidian"),e}exportMetrics(){return JSON.stringify({timestamp:new Date().toISOString(),uptime:Date.now()-this.startTime,services:Object.fromEntries(this.serviceMetrics),systemInfo:{userAgent:navigator.userAgent,platform:navigator.platform,memory:performance.memory?{used:performance.memory.usedJSHeapSize,total:performance.memory.totalJSHeapSize,limit:performance.memory.jsHeapSizeLimit}:void 0}},null,2)}clearMetrics(){this.serviceMetrics.clear()}setEnabled(t){this.isEnabled=t}isTrackingEnabled(){return this.isEnabled}getUptime(){let t=Date.now()-this.startTime,e=Math.floor(t/(1e3*60*60)),r=Math.floor(t%(1e3*60*60)/(1e3*60)),i=Math.floor(t%(1e3*60)/1e3);return e>0?`${e}h ${r}m ${i}s`:r>0?`${r}m ${i}s`:`${i}s`}},I=new De;var ae=class{constructor(t={}){this.activeRequests=new Set;this.requestMetrics=[];this.pendingQueue=[];this.config={timeout:3e4,retries:3,retryDelay:1e3,maxConcurrent:10,keepAlive:!0,enableMetrics:!0,...t},this.maxConcurrent=this.config.maxConcurrent}async request(t,e={}){await this.waitForSlot();let r=new AbortController,i=setTimeout(()=>r.abort(),this.config.timeout),s={controller:r,startTime:performance.now(),url:t,method:e.method||"GET"};this.activeRequests.add(s);try{let o=await this.executeWithRetry(t,{...e,signal:r.signal,headers:{Connection:this.config.keepAlive?"keep-alive":"close","Keep-Alive":`timeout=${this.config.timeout/1e3}`,"User-Agent":"YouTube-Clipper/1.3.5",...e.headers}});if(clearTimeout(i),this.config.enableMetrics&&this.recordRequestMetrics({url:t,method:e.method||"GET",duration:performance.now()-s.startTime,success:o.ok,statusCode:o.status,retryCount:0}),!o.ok)throw new Error(`HTTP ${o.status}: ${o.statusText}`);return o}finally{clearTimeout(i),this.activeRequests.delete(s),this.processQueue()}}async executeWithRetry(t,e){let r;for(let i=0;i<=this.config.retries;i++)try{return await fetch(t,e)}catch(s){if(r=s,i<this.config.retries){let o=this.config.retryDelay*Math.pow(2,i);await this.delay(o),this.config.enableMetrics&&(i+1,`${this.config.retries}${t}`)}}throw r}async post(t,e,r={}){return this.request(t,{method:"POST",headers:{"Content-Type":"application/json",...r.headers},body:JSON.stringify(e),...r})}async get(t,e={}){return this.request(t,{method:"GET",...e})}async put(t,e,r={}){return this.request(t,{method:"PUT",headers:{"Content-Type":"application/json",...r.headers},body:JSON.stringify(e),...r})}async delete(t,e={}){return this.request(t,{method:"DELETE",...e})}async waitForSlot(){if(!(this.activeRequests.size<this.maxConcurrent))return new Promise(t=>{this.pendingQueue.push(t)})}processQueue(){if(this.pendingQueue.length>0&&this.activeRequests.size<this.maxConcurrent){let t=this.pendingQueue.shift();t==null||t()}}delay(t){return new Promise(e=>setTimeout(e,t))}recordRequestMetrics(t){let e={retryCount:0,timestamp:Date.now(),...t};this.requestMetrics.push(e),this.requestMetrics.length>1e3&&(this.requestMetrics=this.requestMetrics.slice(-1e3))}getMetrics(){let t=this.requestMetrics.length,e=this.activeRequests.size,r=this.requestMetrics.filter(o=>o.success).length,i=this.requestMetrics.filter(o=>{var a,n;return((a=o.error)==null?void 0:a.includes("abort"))||((n=o.error)==null?void 0:n.includes("timeout"))}).length,s=this.requestMetrics.map(o=>o.duration).filter(o=>o>0);return{totalRequests:t,activeRequests:e,maxConcurrent:this.maxConcurrent,utilizationRate:e/this.maxConcurrent,averageResponseTime:s.length>0?s.reduce((o,a)=>o+a,0)/s.length:0,successRate:t>0?r/t:0,errorRate:t>0?(t-r)/t:0,timeouts:i}}getDetailedMetrics(){let t={};this.requestMetrics.forEach(i=>{if(i.statusCode){let s=Math.floor(i.statusCode/100)*100;t[s]=(t[s]||0)+1}});let e={},r=this.groupBy(this.requestMetrics,"method");return Object.entries(r).forEach(([i,s])=>{let o=this.analyzeMetrics(s);e[i]=o}),{requests:this.requestMetrics,performanceBreakdown:{byStatus:t,byMethod:e,byTimeRange:{lastHour:this.getMetricsByTimeRange(Date.now()-36e5),lastDay:this.getMetricsByTimeRange(Date.now()-864e5),lastWeek:this.getMetricsByTimeRange(Date.now()-6048e5)}}}}groupBy(t,e){let r={};return t.forEach(i=>{let s=String(i[e]);r[s]||(r[s]=[]),r[s].push(i)}),r}analyzeMetrics(t){let e=t.length,r=t.map(s=>s.duration),i=t.filter(s=>s.success);return{count:e,averageTime:r.length>0?r.reduce((s,o)=>s+o,0)/r.length:0,successRate:e>0?i.length/e:0}}getMetricsByTimeRange(t){return this.requestMetrics.filter(e=>e.timestamp>=t).length}setMaxConcurrent(t){this.maxConcurrent=Math.max(1,t)}abortAllRequests(){this.activeRequests.forEach(t=>{t.controller.abort()}),this.activeRequests.clear(),this.pendingQueue.length=0}cleanup(){this.abortAllRequests(),this.requestMetrics=[]}};K();var F=class{static async fetchModelsFromWeb(t){let e=Ye[t];if(!e)return d.warn(`No web URL configured for provider: ${t}`,"WebScraper"),[];try{return d.info(`Fetching models from web for ${t}: ${e}`,"WebScraper"),e.includes("api")||e.startsWith("http://localhost")?await this.fetchFromAPI(t,e):await this.fetchFromWebPage(t,e)}catch(r){return d.error(`Failed to fetch models from web for ${t}: ${r}`,"WebScraper"),[]}}static async fetchFromAPI(t,e){try{let r=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP ${r.status}: ${r.statusText}`);let i=await r.json();return(t==="Ollama"||t==="Ollama Cloud")&&i!=null&&i.models&&Array.isArray(i.models)?i.models.map(s=>s.name||s.model||s.id||"").filter(s=>s.length>0):t==="OpenRouter"&&i!=null&&i.data&&Array.isArray(i.data)?i.data.map(s=>s.id||"").filter(s=>s.length>0):(d.warn(`Unknown API response format for ${t}`,"WebScraper"),[])}catch(r){return d.error(`API fetch failed for ${t}: ${r}`,"WebScraper"),[]}}static async fetchFromWebPage(t,e){try{let r=await fetch(e);if(!r.ok)throw new Error(`HTTP ${r.status}`);let i=await r.text(),s=ze[t];if(!s)return d.warn(`No regex configured for provider: ${t}`,"WebScraper"),[];let o=i.match(s);if(!o)return d.warn(`No model matches found for ${t}`,"WebScraper"),[];let a=Array.from(new Set(o)).filter(n=>n.length>2&&n.length<100).sort();return d.info(`Found ${a.length} potential models for ${t}`,"WebScraper"),a.slice(0,100)}catch(r){return d.error(`Web page fetch failed for ${t}: ${r}`,"WebScraper"),[]}}static getCachedModels(){try{let t=localStorage.getItem(this.CACHE_KEY);if(!t)return new Map;let e=JSON.parse(t),r=Date.now(),i=new Map;for(let[s,o]of Object.entries(e))r-o.timestamp<this.CACHE_DURATION&&i.set(s,o);return i}catch(t){return d.error(`Failed to load cached models: ${t}`,"WebScraper"),new Map}}static saveCachedModels(t,e,r){try{let i=this.getCachedModels();i.set(t,{provider:t,models:e,timestamp:Date.now(),source:r});let s=Object.fromEntries(i);localStorage.setItem(this.CACHE_KEY,JSON.stringify(s))}catch(i){d.error(`Failed to save cached models: ${i}`,"WebScraper")}}static clearProviderCache(t){try{let e=this.getCachedModels();e.delete(t);let r=Object.fromEntries(e);localStorage.setItem(this.CACHE_KEY,JSON.stringify(r))}catch(e){d.error(`Failed to clear provider cache: ${e}`,"WebScraper")}}static isCacheFresh(t){let r=this.getCachedModels().get(t);return r?Date.now()-r.timestamp<this.CACHE_DURATION:!1}static getCacheAge(t){let r=this.getCachedModels().get(t);if(!r)return"Not cached";let i=Math.floor((Date.now()-r.timestamp)/6e4);return i<60?`${i}m ago`:i<1440?`${Math.floor(i/60)}h ago`:`${Math.floor(i/1440)}d ago`}};F.CACHE_KEY="yt-clipper-scraped-models",F.CACHE_DURATION=1440*60*1e3;var ne=1440*60*1e3,le=class{constructor(t){this.settings=t;this.providers=[];let{PERFORMANCE_PRESETS:e}=(Ve(),Fe(Ue)),r=e[t.performanceMode]||e.balanced;this.httpClient=new ae({timeout:r.timeouts.geminiTimeout,retries:2,retryDelay:1e3,maxConcurrent:t.enableParallelProcessing?5:3,keepAlive:!0,enableMetrics:!0})}registerProvider(t){this.providers.push(t)}registerProviders(t){this.providers.push(...t)}getProviders(){return[...this.providers]}getProvider(t){return this.providers.find(e=>e.name===t)}getProviderNames(){return this.providers.map(t=>t.name)}getProviderModels(t){return(z[t]||[]).map(r=>typeof r=="string"?r:r!=null&&r.name?r.name:String(r))}async fetchLatestModels(){let t={},e=this.getProviderNames();for(let r of e)try{let i=await this.fetchLatestModelsForProvider(r);t[r]=i.length>0?i:this.getProviderModels(r)}catch(i){d.error(`Error fetching models for ${r}`,"ProviderManager",{error:i instanceof Error?i.message:String(i)}),t[r]=this.getProviderModels(r)}return t}async fetchLatestModelsForProvider(t,e=!1){return await I.measureOperation("ai-service",`fetch-models-${t}`,async()=>{if(!e&&F.isCacheFresh(t)){let r=F.getCachedModels().get(t);if(r)return d.info(`Using cached models for ${t} (${F.getCacheAge(t)})`,"ProviderManager"),r.models}try{let r=await F.fetchModelsFromWeb(t);if(r.length>0){d.info(`Fetched ${r.length} models from web for ${t}`,"ProviderManager");let i=t==="Ollama"||t==="Ollama Cloud"||t==="OpenRouter"?"api":"web";return F.saveCachedModels(t,r,i),r}}catch(r){d.warn(`Web fetch failed for ${t}, falling back to API/static: ${r}`,"ProviderManager")}return t==="Ollama"?this.fetchOllamaModels(e):t==="Ollama Cloud"?this.fetchOllamaCloudModels(e):t==="OpenRouter"?this.fetchOpenRouterModels(e):t==="Hugging Face"?this.fetchHuggingFaceModels(e):t==="Groq"?this.fetchGroqModels(e):t==="Google Gemini"?this.fetchGeminiModels(e):this.getProviderModels(t)},{provider:t,operation:"fetchLatestModelsForProvider"})}async fetchOllamaModels(t=!1){var c,h;let e="Ollama",r=(c=this.settings.modelOptionsCache)==null?void 0:c[e],i=(h=this.settings.modelCacheTimestamps)==null?void 0:h[e],s=Date.now(),o=1800*1e3;if(!t&&r&&i&&s-i<o)return r;let a=this.settings.ollamaEndpoint||"http://localhost:11434",n=a.includes("ollama.com")||a.includes("cloud"),l=n?"https://ollama.com/api":a;try{let p={"Content-Type":"application/json"};n&&this.settings.ollamaApiKey&&(p.Authorization=`Bearer ${this.settings.ollamaApiKey}`);let g=await fetch(`${l}/tags`,{method:"GET",headers:p});if(g.ok){let y=await g.json();if(y!=null&&y.models&&Array.isArray(y.models))return y.models.map(x=>x.name||x.id||x.model||"").filter(x=>x!=="")}}catch(p){d.warn("Ollama fetch error","ProviderManager",{error:p instanceof Error?p.message:String(p)})}return r&&r.length>0?r:this.getProviderModels("Ollama")}async fetchOllamaCloudModels(t=!1){var n,l;let e="Ollama Cloud",r=(n=this.settings.modelOptionsCache)==null?void 0:n[e],i=(l=this.settings.modelCacheTimestamps)==null?void 0:l[e],s=Date.now(),o=1800*1e3;if(!t&&r&&i&&s-i<o)return r;let a="https://ollama.com/api";try{let c={"Content-Type":"application/json"};if(this.settings.ollamaApiKey)c.Authorization=`Bearer ${this.settings.ollamaApiKey}`;else return d.warn("Ollama Cloud requires API key","ProviderManager"),this.getProviderModels("Ollama Cloud");let h=await fetch(`${a}/tags`,{method:"GET",headers:c});if(h.ok){let p=await h.json();if(p!=null&&p.models&&Array.isArray(p.models))return p.models.map(y=>y.name||y.id||y.model||"").filter(y=>y!=="")}else(h.status===401||h.status===403)&&d.warn("Ollama Cloud authentication failed","ProviderManager",{status:h.status})}catch(c){d.warn("Ollama Cloud fetch error","ProviderManager",{error:c instanceof Error?c.message:String(c)})}return r&&r.length>0?r:this.getProviderModels("Ollama Cloud")}async fetchOpenRouterModels(t=!1){var o,a;let e="OpenRouter",r=(o=this.settings.modelOptionsCache)==null?void 0:o[e],i=(a=this.settings.modelCacheTimestamps)==null?void 0:a[e],s=Date.now();if(!t&&r&&i&&s-i<ne)return r;try{let n={"Content-Type":"application/json"};this.settings.openRouterApiKey&&(n.Authorization=`Bearer ${this.settings.openRouterApiKey}`);let l=await this.httpClient.get("https://openrouter.ai/api/v1/models",{headers:n});if(l.ok){let c=await l.json();if(c!=null&&c.data&&Array.isArray(c.data))return c.data.filter(p=>{let g=p.id||"";return!g.includes("-deprecated")&&!g.includes("-legacy")&&!g.includes("-old")}).sort((p,g)=>(g.context_length||0)-(p.context_length||0)).map(p=>p.id).filter(p=>p)}}catch(n){d.warn("OpenRouter API error","ProviderManager")}return r&&r.length>0?r:this.getProviderModels("OpenRouter")}async fetchHuggingFaceModels(t=!1){var o,a;let e="Hugging Face",r=(o=this.settings.modelOptionsCache)==null?void 0:o[e],i=(a=this.settings.modelCacheTimestamps)==null?void 0:a[e],s=Date.now();if(!t&&r&&i&&s-i<ne)return r;try{let n={"Content-Type":"application/json"};this.settings.huggingFaceApiKey&&(n.Authorization=`Bearer ${this.settings.huggingFaceApiKey}`);let l=await this.httpClient.get("https://huggingface.co/api/models?pipeline_tag=text-generation&inference=warm&sort=downloads&limit=500",{headers:n});if(l.ok){let c=await l.json();if(Array.isArray(c)){let h=c.filter(p=>{let g=p.id||"";return!p.disabled&&!p.private&&!g.includes("-legacy")&&!g.includes("-old")&&!g.includes("-deprecated")}).map(p=>p.id);if(h.length>0)return h}}}catch(n){d.warn("HuggingFace API error","ProviderManager")}return r&&r.length>0?r:this.getProviderModels("Hugging Face")}async fetchGroqModels(t=!1){var o,a;let e="Groq",r=(o=this.settings.modelOptionsCache)==null?void 0:o[e],i=(a=this.settings.modelCacheTimestamps)==null?void 0:a[e],s=Date.now();if(!t&&r&&i&&s-i<ne)return r;try{let n={"Content-Type":"application/json"};this.settings.groqApiKey&&(n.Authorization=`Bearer ${this.settings.groqApiKey}`);let l=await this.httpClient.get("https://api.groq.com/openai/v1/models",{headers:n});if(l.ok){let c=await l.json();if(c!=null&&c.data&&Array.isArray(c.data))return c.data.filter(p=>{let g=p.id||p.name||"";return!g.includes("-deprecated")&&!g.includes("-legacy")&&!g.includes("-old")}).map(p=>p.id||p.name).filter(p=>p)}}catch(n){d.warn("Groq API error","ProviderManager")}return r&&r.length>0?r:this.getProviderModels("Groq")}async fetchGeminiModels(t=!1){var o,a;let e="Google Gemini",r=(o=this.settings.modelOptionsCache)==null?void 0:o[e],i=(a=this.settings.modelCacheTimestamps)==null?void 0:a[e],s=Date.now();if(!t&&r&&i&&s-i<ne)return r;try{let n={"Content-Type":"application/json"};this.settings.geminiApiKey&&(n["x-goog-api-key"]=this.settings.geminiApiKey);let l=await this.httpClient.get("https://generativelanguage.googleapis.com/v1beta/models",{headers:n});if(l.ok){let c=await l.json();if(c!=null&&c.models&&Array.isArray(c.models))return c.models.filter(p=>(p.name||p.id||"").includes("gemini")).map(p=>(p.name||p.id||"").replace("models/",""))}}catch(n){d.warn("Gemini API error","ProviderManager",{error:n instanceof Error?n.message:String(n)})}return r&&r.length>0?r:this.getProviderModels("Google Gemini")}hasProviders(){return this.providers.length>0}updateSettings(t){this.settings=t}getMetrics(){return{httpMetrics:this.httpClient.getMetrics(),modelFetchMetrics:Object.fromEntries(this.providers.map(t=>[`fetch-models-${t.name}`,I.getMetricsSummary(`fetch-models-${t.name}`)]))}}cleanup(){var t;(t=this.httpClient)==null||t.cleanup()}};var j=class{static async withRetry(t,e,r=3,i=1e3){let s;for(let o=1;o<=r;o++)try{return await t()}catch(a){if(s=a,d.warn(`Operation failed: ${e}`,"RetryService",{attempt:o,error:s.message,willRetry:o<r}),o===r)break;let n=i*Math.pow(2,o-1)*(.75+Math.random()*.5);await new Promise(l=>setTimeout(l,n))}throw s||new Error("Operation failed after retries")}},Xt=j.withRetry;T();var ce=class{constructor(t,e={enableModelFallback:!0,enableProviderFallback:!0,maxFallbackAttempts:3}){this.providerManager=t;this.config=e}async executeWithFallback(t,e,r,i){var a;let s=this.providerManager.getProvider(t);if(!s)throw new Error(`AI provider not found: ${t}`);let o=(a=i==null?void 0:i.enableFallback)!=null?a:!0;try{let n=await this.tryProvider(s,e,r,i);if(n.success)return{content:n.content,provider:n.provider,model:n.model};throw new Error(n.error||"Primary provider failed")}catch(n){let l=n;if(!o)throw new Error(f.ERRORS.AI_PROCESSING(l.message));return await this.executeFallbackStrategies(s,l,e,r,i)}}async tryProvider(t,e,r,i){try{let s=t.model;i!=null&&i.overrideModel&&typeof t.setModel=="function"&&t.setModel(i.overrideModel);let o=await r(t,i==null?void 0:i.overrideModel);return i!=null&&i.overrideModel&&typeof t.setModel=="function"&&t.setModel(s),o&&o.trim().length>0?{success:!0,content:o,provider:t.name,model:t.model}:{success:!1,error:"Empty response from AI provider"}}catch(s){return{success:!1,error:s.message}}}async executeFallbackStrategies(t,e,r,i,s){if(this.config.enableModelFallback&&!this.isQuotaError(e)){d.info(`Primary model failed for ${t.name}, trying fallback models`,"FallbackStrategy",{error:e.message});let o=await this.tryModelFallback(t,r,i,s);if(o)return o}if(this.config.enableProviderFallback){d.warn(`${t.name} failed, trying fallback providers`,"FallbackStrategy",{error:e.message});let o=await this.tryProviderFallback(t,r,i,s);if(o)return o}throw new Error(`${e.message} (All fallback providers and models also failed)`)}async tryModelFallback(t,e,r,i){let o=this.providerManager.getProviderModels(t.name).filter(n=>n!==t.model);if(o.length===0)return d.info(`No fallback models available for ${t.name}`,"FallbackStrategy"),null;d.info(`Trying ${o.length} fallback models for ${t.name}`,"FallbackStrategy");let a=o.slice(0,this.config.maxFallbackAttempts);for(let n of a)try{d.info(`Trying fallback model ${n} for ${t.name}`,"FallbackStrategy");let l=t.model;typeof t.setModel=="function"&&t.setModel(n);let c=await r(t,n);if(c&&c.trim().length>0)return d.info(`Fallback to ${n} succeeded for ${t.name}`,"FallbackStrategy",{contentLength:c.length}),typeof t.setModel=="function"&&t.setModel(l),{content:c,provider:t.name,model:n}}catch(l){d.warn(`Fallback model ${n} failed for ${t.name}`,"FallbackStrategy",{error:l instanceof Error?l.message:String(l)})}finally{typeof t.setModel=="function"&&t.setModel(t.model)}return d.warn(`All fallback models failed for ${t.name}`,"FallbackStrategy"),null}async tryProviderFallback(t,e,r,i){let o=this.providerManager.getProviders().filter(a=>a.name!==t.name);if(o.length===0)return d.info("No fallback providers available","FallbackStrategy"),null;for(let a of o)try{d.info(`Trying fallback provider: ${a.name}`,"FallbackStrategy");let n=await this.tryProvider(a,e,r,i);if(n.success)return d.info(`Fallback to ${a.name} succeeded`,"FallbackStrategy"),{content:n.content,provider:n.provider,model:n.model};if(this.config.enableModelFallback){let l=await this.tryModelFallback(a,e,r,i);if(l)return l}}catch(n){d.warn(`Fallback provider ${a.name} also failed`,"FallbackStrategy",{error:n.message})}return null}isQuotaError(t){let e=t.message.toLowerCase();return e.includes("quota")||e.includes("rate limit")||e.includes("limit reached")||e.includes("limit exceeded")||e.includes("429")||e.includes("too many requests")||e.includes("exhausted")}async processWithRetry(t,e,r){return r&&r.length>0&&t.processWithImage?await j.withRetry(()=>t.processWithImage(e,r),`${t.name}-process-multimodal`,2,2e3):await j.withRetry(()=>t.process(e),`${t.name}-process`,2,2e3)}updateConfig(t){this.config={...this.config,...t}}getConfig(){return{...this.config}}};var de=class{constructor(t,e){var r,i;if(!t||t.length===0)throw new Error(f.ERRORS.MISSING_API_KEYS);this.providerManager=new le(e),this.providerManager.registerProviders(t),this.fallbackStrategy=new ce(this.providerManager,{enableModelFallback:(r=e.enableAutoFallback)!=null?r:!0,enableProviderFallback:(i=e.enableAutoFallback)!=null?i:!0,maxFallbackAttempts:3}),this.applyPerformanceSettings(e)}async process(t,e){if(!t||typeof t!="string")throw new Error("Valid prompt is required");return await I.measureOperation("ai-service","ai-process",async()=>{let r=this.providerManager.getProviders();if(r.length===0)throw new Error("No AI providers available");let i=r[0];return await this.processWith(i.name,t,void 0,e,!0)},{promptLength:t.length,hasImages:e&&e.length>0,processingMode:"sequential"})}async processWith(t,e,r,i,s=!0){return await this.fallbackStrategy.executeWithFallback(t,e,async(o,a)=>await this.fallbackStrategy.processWithRetry(o,e,i),{overrideModel:r,images:i,enableFallback:s})}applyPerformanceSettings(t){let{PERFORMANCE_PRESETS:e}=(Ve(),Fe(Ue)),r=e[t.performanceMode]||e.balanced,i=t.customTimeouts||r.timeouts;this.providerManager.getProviders().forEach(o=>{o.name==="Google Gemini"&&o.setTimeout?o.setTimeout(i.geminiTimeout):o.name==="Groq"&&o.setTimeout&&o.setTimeout(i.groqTimeout)})}updateSettings(t){var e,r;this.providerManager.updateSettings(t),this.applyPerformanceSettings(t),this.fallbackStrategy.updateConfig({enableModelFallback:(e=t.enableAutoFallback)!=null?e:!0,enableProviderFallback:(r=t.enableAutoFallback)!=null?r:!0})}getProviderModels(t){return this.providerManager.getProviderModels(t)}async fetchLatestModels(){return await this.providerManager.fetchLatestModels()}async fetchLatestModelsForProvider(t,e){return await this.providerManager.fetchLatestModelsForProvider(t,e)}hasAvailableProviders(){return this.providerManager.hasProviders()}getProviderNames(){return this.providerManager.getProviderNames()}addProvider(t){this.providerManager.registerProvider(t)}removeProvider(t){return!!this.providerManager.getProvider(t)}getPerformanceMetrics(){let t=this.providerManager.getMetrics(),e=I.getMetricsSummary("ai-service");return{httpMetrics:t.httpMetrics,aiProcessingMetrics:e,modelFetchMetrics:t.modelFetchMetrics}}cleanup(){this.providerManager.cleanup()}};var ue=class{constructor(t,e){this.orchestrator=new de(t,e)}async process(t,e){return await this.orchestrator.process(t,e)}async processWith(t,e,r,i,s=!0){return await this.orchestrator.processWith(t,e,r,i,s)}updateSettings(t){this.orchestrator.updateSettings(t)}getProviderModels(t){return this.orchestrator.getProviderModels(t)}async fetchLatestModels(){return await this.orchestrator.fetchLatestModels()}async fetchLatestModelsForProvider(t,e){return await this.orchestrator.fetchLatestModelsForProvider(t,e)}hasAvailableProviders(){return this.orchestrator.hasAvailableProviders()}getProviderNames(){return this.orchestrator.getProviderNames()}addProvider(t){this.orchestrator.addProvider(t)}removeProvider(t){return this.orchestrator.removeProvider(t)}getPerformanceMetrics(){return this.orchestrator.getPerformanceMetrics()}cleanup(){this.orchestrator.cleanup()}get internalOrchestrator(){return this.orchestrator}};T();var S=class{constructor(t,e,r){this.apiKey=t;this._timeout=3e4;this._maxTokens=2048;this._temperature=.7;this._model=e||"",r&&(this._timeout=r)}get model(){return this._model}get timeout(){return this._timeout}get maxTokens(){return this._maxTokens}get temperature(){return this._temperature}setModel(t){this._model=t}setTimeout(t){this._timeout=t}setMaxTokens(t){this._maxTokens=t}setTemperature(t){this._temperature=t}async processWithTimeout(t,e){let r=e||this._timeout,i=new Promise((o,a)=>{setTimeout(()=>{a(new Error(`${this.name} request timed out after ${r}ms`))},r)}),s=this.process(t);return Promise.race([s,i])}validateResponse(t,e){let r=t;for(let i of e){if(!r||typeof r!="object"||!(i in r))return!1;r=r[i]}return r!=null}async safeJsonParse(t){try{return await t.json()}catch(e){return null}}async handleAPIError(t){return E.handleAPIError(t,this.name)}};T();function Xe(u,t){let e=u.match(/retry in ([\d.]+)s/i),r=e?` Retry in ${Math.ceil(parseFloat(e[1]))}s.`:"";return u.includes("limit: 0")||u.includes("free_tier")?`${t} free tier quota exhausted.${r} Upgrade your plan or wait for quota reset.`:u.toLowerCase().includes("quota exceeded")?`${t} API quota exceeded.${r} Check your usage at https://ai.google.dev/usage`:`${t} API limit reached.${r}`}var pe=class extends S{constructor(e,r,i){super(e,r||re.GEMINI,i);this.name="Google Gemini"}async process(e){var r,i,s,o;try{if(!this.apiKey||this.apiKey.trim().length===0)throw new Error(f.ERRORS.GEMINI_INVALID_KEY);let a=await fetch(`${D.GEMINI}?key=${this.apiKey}`,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e))});if(a.status===400){let l=await this.safeJsonParse(a),c=((r=l==null?void 0:l.error)==null?void 0:r.message)||"Bad request";throw new Error(`Gemini API error: ${c}. Try checking the model configuration.`)}if(a.status===401)throw new Error(f.ERRORS.GEMINI_INVALID_KEY);if(a.status===403){let l=await this.safeJsonParse(a),c=((i=l==null?void 0:l.error)==null?void 0:i.message)||"";throw c.toLowerCase().includes("quota")||c.toLowerCase().includes("billing")?new Error(Xe(c,"Gemini")):new Error("Gemini API access denied. Please verify your API key has access to this model.")}if(a.status===429){let l=await this.safeJsonParse(a),c=((s=l==null?void 0:l.error)==null?void 0:s.message)||(l==null?void 0:l.message)||"";throw new Error(Xe(c,"Gemini"))}a.ok||await this.handleAPIError(a);let n=await a.json();if(!((o=n.candidates)!=null&&o.length))throw new Error("No response candidates returned from Gemini API");if(n.candidates[0].finishReason==="SAFETY")throw new Error("Response blocked by Gemini safety filters. Try rephrasing.");if(!this.validateResponse(n,["candidates","0","content","parts","0","text"]))throw new Error("Invalid response format from Gemini API");return this.extractContent(n)}catch(a){throw a instanceof Error?a:new Error(`Gemini processing failed: ${a}`)}}createHeaders(){return{"Content-Type":"application/json"}}createRequestBody(e){let r=e.toLowerCase(),i=r.includes("youtube video")||r.includes("youtu.be/")||r.includes("youtube.com/"),s={contents:[{parts:[{text:e}]}],generationConfig:{temperature:this._temperature,maxOutputTokens:this._maxTokens,candidateCount:1}};if(i){let o=z["Google Gemini"]||[],a=String(this.model||"").toLowerCase(),n=o.find(p=>{let g=typeof p=="string"?p:p!=null&&p.name?p.name:"";return String(g).toLowerCase()===a}),l=n&&n.supportsAudioVideo===!0,c={...s,systemInstruction:{parts:[{text:`You are an expert video content analyzer. Provide comprehensive, multimodal analysis using:
\u2022 AUDIO STREAM: Transcribe all spoken content, identify speakers, capture tone/emphasis/emotion
\u2022 VIDEO STREAM: Analyze visual elements, text overlays, diagrams, slides, gestures, scene changes, and visual demonstrations
\u2022 INTEGRATED INSIGHTS: Synthesize audio and visual data to provide complete understanding

For best results:
- Prioritize accuracy in transcription and speaker identification
- Extract and explain key concepts shown visually
- Note timing relationships between audio and visual elements
- Identify visual cues that reinforce or clarify spoken content`}]}},h=e.match(/(gs:\/\/[\w\-\.\/]+\.(?:mp4|mov|mkv|webm))/i);if(h!=null&&h[1]){let p=h[1];c.contents=c.contents||[],c.contents.push({parts:[{fileData:{fileUri:p,mimeType:"video/mp4"}}]})}return c}return s}extractContent(e){let r=e.candidates[0].content.parts[0].text;return r?r.trim():""}};T();T();function pt(u){let t=u.match(/retry in ([\d.]+)/i)||u.match(/(\d+)\s*seconds?/i),e=t?` Retry in ${Math.ceil(parseFloat(t[1]))}s.`:"";return u.toLowerCase().includes("tokens per minute")?`Groq token limit reached.${e} Try a shorter video or wait.`:u.toLowerCase().includes("requests per")?`Groq request limit reached.${e}`:u.toLowerCase().includes("quota")?`Groq quota exceeded.${e} Check your plan at console.groq.com`:`Groq API limit reached.${e}`}var me=class extends S{constructor(e,r,i){super(e,r||re.GROQ,i);this.name="Groq"}async process(e){var s;let r=await fetch(D.GROQ,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e))});if(r.status===401)throw new Error("Groq API key is invalid or missing. Please check your key.");if(r.status===402)throw new Error("Groq API requires a paid plan. Please check your billing settings.");if(r.status===404)throw new Error(f.ERRORS.GROQ_MODEL_NOT_FOUND);if(r.status===429){let o="";try{let a=await r.json();o=((s=a==null?void 0:a.error)==null?void 0:s.message)||(a==null?void 0:a.message)||""}catch(a){}throw new Error(pt(o))}r.ok||await this.handleAPIError(r);let i=await r.json();if(!this.validateResponse(i,["choices","0","message"]))throw new Error("Invalid response format from Groq API");return this.extractContent(i)}createHeaders(){return{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`}}createRequestBody(e){return{model:this.model,messages:[{role:"system",content:"You are an expert content analyzer specializing in extracting practical value and creating actionable guides from video content. Focus on clarity, practicality, and immediate implementability. Even with limited information, provide maximum value through structured analysis and practical recommendations."},{role:"user",content:e}],max_tokens:this._maxTokens,temperature:this._temperature}}extractContent(e){let r=e.choices[0].message.content;return r?r.trim():""}};var mt="https://router.huggingface.co/hf-inference/models";function Ze(u){let t=u.match(/retry in ([\d.]+)/i)||u.match(/(\d+)\s*seconds?/i),e=t?` Retry in ${Math.ceil(parseFloat(t[1]))}s.`:"";return u.toLowerCase().includes("rate limit")?`Hugging Face rate limit reached.${e}`:u.toLowerCase().includes("loading")?"Model is loading. Wait ~20s and try again.":u.toLowerCase().includes("paused")?"Model endpoint is paused. Try a different model like Qwen/Qwen3-8B":u.toLowerCase().includes("quota")?`Hugging Face quota exceeded.${e}`:u||"Hugging Face API error"}var he=class extends S{constructor(e,r,i){super(e,r||"Qwen/Qwen3-8B",i);this.name="Hugging Face"}async process(e){var r;try{if(!this.apiKey||this.apiKey.trim().length===0)throw new Error("Hugging Face API key is required. Get one at huggingface.co/settings/tokens");if(!((r=this._model)!=null&&r.includes("/")))throw new Error(`Invalid model format: ${this._model}. Use format: owner/model-name`);let i=new AbortController,s=setTimeout(()=>i.abort(),this._timeout||6e4),o=await fetch(`${mt}/${this._model}`,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e)),signal:i.signal});if(clearTimeout(s),(o.headers.get("content-type")||"").includes("text/html"))throw o.status===401?new Error("Hugging Face API key is invalid or expired."):new Error(`Hugging Face returned an error page (${o.status}). Check your API key.`);if(o.status===401)throw new Error("Hugging Face API key is invalid. Please check your token.");if(o.status===400){let l=await this.safeJsonParse(o),c=(l==null?void 0:l.error)||"";throw new Error(Ze(c))}if(o.status===403)throw new Error("Hugging Face access denied. Accept model terms at huggingface.co");if(o.status===404)throw new Error(`Model not found: ${this._model}. Check the model name at huggingface.co`);if(o.status===429){let l=await this.safeJsonParse(o),c=(l==null?void 0:l.error)||"";throw new Error(Ze(c))}if(o.status===503){let l=await this.safeJsonParse(o),c=(l==null?void 0:l.estimated_time)||20;throw new Error(`Model is loading. Wait ${Math.ceil(c)}s and try again.`)}if(!o.ok){let l=await this.safeJsonParse(o),c=(l==null?void 0:l.error)||o.statusText;throw typeof c=="string"&&c.includes("router.huggingface.co")?new Error("HuggingFace API endpoint changed. Please update the plugin."):new Error(`Hugging Face error (${o.status}): ${c}`)}let n=await o.json();return this.extractContent(n)}catch(i){throw i instanceof Error?i.name==="AbortError"?new Error("Hugging Face request timed out. Try a smaller model."):i:new Error(`Hugging Face processing failed: ${i}`)}}createHeaders(){return{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json"}}createRequestBody(e){return{inputs:e,parameters:{max_new_tokens:this._maxTokens,temperature:this._temperature,return_full_text:!1,do_sample:!0},options:{wait_for_model:!0,use_cache:!0}}}extractContent(e){var r;if(Array.isArray(e)){let i=(r=e[0])==null?void 0:r.generated_text;return i?i.trim():""}if(e!=null&&e.generated_text)return e.generated_text.trim();throw new Error("Invalid response format from Hugging Face API")}};var ht={maxSize:200,defaultTTL:3e5,cleanupInterval:6e4,enableMetrics:!0},ge=class{constructor(t={}){this.cache=new Map;this.accessOrder=[];this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0};this.lastCleanup=0;this.config={...ht,...t}}get(t){var i;this.cache.size>this.config.maxSize*.8&&this.cleanup();let e=this.cache.get(t);if(!e)return this.config.enableMetrics&&(this.metrics.misses++,this.updateHitRate()),null;let r=(i=e.ttl)!=null?i:this.config.defaultTTL;return Date.now()-e.timestamp>r?(this.cache.delete(t),this.removeFromAccessOrder(t),null):(this.updateAccessOrder(t),e.hits++,this.config.enableMetrics&&(this.metrics.hits++,this.updateHitRate()),e.data)}set(t,e,r){this.cache.size>=this.config.maxSize&&this.evictLRU();let i={data:e,timestamp:Date.now(),ttl:r||this.config.defaultTTL,hits:0,size:this.estimateSize(e)};this.cache.set(t,i),this.updateAccessOrder(t),this.metrics.size=this.cache.size}clear(){this.cache.clear(),this.accessOrder=[],this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0}}delete(t){let e=this.cache.delete(t);return e&&(this.removeFromAccessOrder(t),this.metrics.size=this.cache.size),e}has(t){var i;let e=this.cache.get(t);if(!e)return!1;let r=(i=e.ttl)!=null?i:this.config.defaultTTL;return Date.now()-e.timestamp>r?(this.cache.delete(t),this.removeFromAccessOrder(t),this.metrics.size=this.cache.size,!1):!0}size(){return this.cache.size}getMetrics(){return{...this.metrics}}updateAccessOrder(t){this.removeFromAccessOrder(t),this.accessOrder.push(t)}removeFromAccessOrder(t){let e=this.accessOrder.indexOf(t);e>-1&&this.accessOrder.splice(e,1)}evictLRU(){if(this.accessOrder.length===0)return;let t=this.accessOrder.shift();t&&this.cache.delete(t),this.metrics.evictions++,this.metrics.size=this.cache.size}estimateSize(t){if(t==null)return 8;if(typeof t=="string")return t.length*2;if(typeof t=="number")return 8;if(typeof t=="boolean")return 4;if(typeof t=="object")try{return JSON.stringify(t).length*2}catch(e){return 1024}return 64}updateHitRate(){let t=this.metrics.hits+this.metrics.misses;this.metrics.hitRate=t>0?this.metrics.hits/t:0}cleanup(){var r;let t=Date.now();if(t-this.lastCleanup<this.config.cleanupInterval)return;this.lastCleanup=t;let e=[];for(let[i,s]of this.cache.entries()){let o=(r=s.ttl)!=null?r:this.config.defaultTTL;t-s.timestamp>o&&e.push(i)}e.forEach(i=>{this.cache.delete(i),this.removeFromAccessOrder(i)}),this.metrics.size=this.cache.size}getHotItems(t=10){return Array.from(this.cache.entries()).map(([r,i])=>({key:r,hits:i.hits})).sort((r,i)=>i.hits-r.hits).slice(0,t)}getStats(){let t=Array.from(this.cache.values()).reduce((e,r)=>e+r.size,0);return{size:this.cache.size,maxSize:this.config.maxSize,hitRate:this.metrics.hitRate,totalHits:this.metrics.hits,totalMisses:this.metrics.misses,evictions:this.metrics.evictions,memoryUsage:t}}destroy(){this.clear(),this.accessOrder=[]}};Z();He();Z();var gt="A note with this title already exists. Choose how to proceed.",fe=class extends q{constructor(e,r){super(e);this.file=r;this.decision="cancel"}onOpen(){this.createHeader("Note Already Exists"),this.createMessage(`${gt}

Existing note: ${this.file.path}`),this.createButtons()}openAndWait(){return new Promise(e=>{this.resolve=e,this.forceVisible(),this.open()})}onClose(){this.resolve&&this.resolve(this.decision),super.onClose()}createButtons(){let e=this.createButtonContainer();this.createButton(e,"Cancel",!1,()=>{this.closeWithDecision("cancel")}),this.createButton(e,"Save as Numbered Copy",!1,()=>{this.closeWithDecision("new-name")}),this.createButton(e,"Overwrite Existing",!0,()=>{this.closeWithDecision("overwrite")})}closeWithDecision(e){this.decision=e,this.close()}};T();T();var ve=require("obsidian"),ye=class{constructor(t){this.app=t}async saveToFile(t,e,r){try{let i=this.createSafeFilename(t),s=this.normalizePath(r);await this.ensureDirectoryExists(s);let o=this.getDailyFolderPath(s);await this.ensureDirectoryExists(o);let a=`${o}/${i}`;return await this.handleFileConflicts(a,e)}catch(i){throw new Error(f.ERRORS.SAVE_FILE(i.message))}}async openFileWithConfirmation(t){await this.waitForFileCreation();try{let e=this.app.vault.getAbstractFileByPath(t.path);if(!(e instanceof ve.TFile))throw new Error(f.ERRORS.FILE_NOT_EXISTS);await this.app.workspace.getLeaf(!1).openFile(e)}catch(e){throw new Error(f.ERRORS.COULD_NOT_OPEN(e.message))}}createSafeFilename(t){return`${v.sanitizeFilename(t)}.md`}async ensureDirectoryExists(t){try{await this.app.vault.createFolder(t)}catch(e){}}getDailyFolderPath(t){let e=t.replace(/\/+$/,""),r=new Date().toISOString().split("T")[0];return`${e}/${r}`}async handleFileConflicts(t,e){let r=this.app.vault.getAbstractFileByPath(t);if(r instanceof ve.TFile)switch(await this.promptConflictResolution(r)){case"overwrite":return await this.app.vault.modify(r,e),r.path;case"new-name":return this.createVersionedCopy(r.path,e);default:throw new Error("Save cancelled by user")}return await this.app.vault.create(t,e),t}async waitForFileCreation(){return new Promise(t=>setTimeout(t,J.FILE_CREATION_WAIT))}getFileByPath(t){let e=this.app.vault.getAbstractFileByPath(t);return e instanceof ve.TFile?e:null}fileExists(t){return this.getFileByPath(t)!==null}async createUniqueFile(t,e){let r=1,i=t;for(;this.fileExists(i);){let s=t.split("/"),n=`${s.pop().replace(".md","")} (${r}).md`;i=[...s,n].join("/"),r++}return await this.app.vault.create(i,e),i}async promptConflictResolution(t){return await new fe(this.app,t).openAndWait()}async createVersionedCopy(t,e){let r=t.split("/"),s=r.pop().replace(".md",""),o=1,a;do a=[...r,`${s} (${o}).md`].join("/"),o++;while(this.fileExists(a));return await this.app.vault.create(a,e),a}normalizePath(t){if(!t)return"";let e=t.trim();for(e.startsWith("./")&&(e=e.slice(2));e.startsWith("/");)e=e.slice(1);return e=e.replace(/\/+/g,"/"),e}};var be=class extends S{constructor(e="",r,i,s){super(e,r||"llama3.2",i);this.name="Ollama";s?s.includes("ollama.com")||s.includes("cloud")?this.apiBaseUrl="https://ollama.com/api":s.endsWith("/api")?this.apiBaseUrl=s:this.apiBaseUrl=`${s}/api`:this.apiBaseUrl="http://localhost:11434/api"}getApiUrl(e){return`${this.apiBaseUrl}${e}`}async process(e){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");let r={model:this._model,prompt:e,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},i=await fetch(this.getApiUrl("/generate"),{method:"POST",headers:this.createHeaders(),body:JSON.stringify(r)});if(!i.ok){if(i.status===404)throw(this._model.includes("-cloud")||this._model.includes(":cloud"))&&!this.apiBaseUrl.includes("ollama.com")?new Error(`Cloud model "${this._model}" requires Ollama Cloud configuration. Either:
1. Switch to a local model (e.g., "llama3.2:latest")
2. Configure Ollama Cloud in settings with endpoint "https://ollama.com" and your API key`):new Error(`Ollama model not found: ${this._model}. Please make sure the model is pulled in Ollama using 'ollama pull ${this._model}'.`);if(i.status===401)throw this._model.includes("-cloud")||this._model.includes(":cloud")?new Error(`Cloud model "${this._model}" requires authentication. Please configure your Ollama Cloud API key in plugin settings (get it from https://ollama.com/settings)`):new Error("Ollama authentication failed. Check if your Ollama instance requires authentication.");if(i.status===500){let o=await this.safeJsonParse(i),a=(o==null?void 0:o.error)||"Ollama server error";throw new Error(`Ollama error: ${a}`)}throw new Error(`Ollama API error: ${i.status} - ${i.statusText}`)}let s=await i.json();if(!this.validateResponse(s,["response"]))throw new Error("Invalid response format from Ollama API");return this.extractContent(s)}catch(r){throw r instanceof Error?r.message.includes("fetch")||r.message.includes("network")||r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND")?new Error("Ollama server is not running or unreachable. Please ensure Ollama is installed and running on your system."):r:new Error(`Ollama processing failed: ${r}`)}}async processWithImage(e,r){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");let i=[{role:"user",content:e}];if(r&&r.length>0){let n=[];for(let l of r)if(typeof l=="string")n.push(l);else if(l instanceof ArrayBuffer){let c=new Uint8Array(l),h="";for(let g=0;g<c.length;g++)h+=String.fromCharCode(c[g]);let p=btoa(h);n.push(p)}n.length>0&&(i[0].images=n)}let s={model:this._model,messages:i,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},o=await fetch(this.getApiUrl("/chat"),{method:"POST",headers:this.createHeaders(),body:JSON.stringify(s)});if(!o.ok){if(o.status===404)throw(this._model.includes("-cloud")||this._model.includes(":cloud"))&&!this.apiBaseUrl.includes("ollama.com")?new Error(`Cloud model "${this._model}" requires Ollama Cloud configuration. Either:
1. Switch to a local model (e.g., "llama3.2:latest")
2. Configure Ollama Cloud in settings with endpoint "https://ollama.com" and your API key`):new Error(`Ollama model not found: ${this._model}. Please make sure the model is pulled in Ollama using 'ollama pull ${this._model}'.`);if(o.status===401)throw this._model.includes("-cloud")||this._model.includes(":cloud")?new Error(`Cloud model "${this._model}" requires authentication. Please configure your Ollama Cloud API key in plugin settings (get it from https://ollama.com/settings)`):new Error("Ollama authentication failed. Check if your Ollama instance requires authentication.");if(o.status===500){let n=await this.safeJsonParse(o),l=(n==null?void 0:n.error)||"Ollama server error";throw new Error(`Ollama error: ${l}`)}throw new Error(`Ollama API error: ${o.status} - ${o.statusText}`)}let a=await o.json();if(!this.validateResponse(a,["message","content"]))throw new Error("Invalid response format from Ollama API");return this.extractContentFromChat(a)}catch(i){throw i instanceof Error?i.message.includes("fetch")||i.message.includes("network")||i.message.includes("ECONNREFUSED")||i.message.includes("ENOTFOUND")?new Error("Ollama server is not running or unreachable. Please ensure Ollama is installed and running on your system."):i:new Error(`Ollama processing failed: ${i}`)}}async checkAvailability(){try{return(await fetch(this.getApiUrl("/tags"),{method:"GET",headers:this.createHeaders()})).ok}catch(e){return!1}}async checkModelAvailability(e){try{let r=await fetch(this.getApiUrl("/tags"),{method:"GET",headers:this.createHeaders()});if(!r.ok)return!1;let i=await r.json();return i!=null&&i.models?i.models.some(s=>{var o;return s.name===e||s.name.startsWith(`${e}:`)||((o=s.id)==null?void 0:o.includes(e))}):!1}catch(r){return!1}}createHeaders(){let e={"Content-Type":"application/json"};return this.apiKey&&(e.Authorization=`Bearer ${this.apiKey}`),e}createRequestBody(e){return{}}extractContent(e){return e&&typeof e=="object"&&"response"in e?e.response.trim():""}extractContentFromChat(e){return e&&typeof e=="object"&&e.message&&"content"in e.message?e.message.content.trim():""}};var we=class extends S{constructor(e,r,i){super(e,r||"deepseek-r1:32b",i);this.name="Ollama Cloud";this.apiBaseUrl="https://ollama.com/api"}getApiUrl(e){return`${this.apiBaseUrl}${e}`}async process(e){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");if(!this.apiKey||this.apiKey.trim().length===0)throw new Error("Ollama Cloud requires an API key. Please configure it in plugin settings (get it from https://ollama.com/settings)");let r={model:this._model,prompt:e,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},i=await fetch(this.getApiUrl("/generate"),{method:"POST",headers:this.createHeaders(),body:JSON.stringify(r)});if(!i.ok){if(i.status===404)throw new Error(`Ollama Cloud model not found: ${this._model}. Please check available models at https://ollama.com/library.`);if(i.status===401)throw new Error("Ollama Cloud authentication failed. Please check your API key in plugin settings (get it from https://ollama.com/settings)");if(i.status===403)throw new Error("Ollama Cloud access denied. Your API key may not have access to this model or the service.");if(i.status===429)throw new Error("Ollama Cloud rate limit exceeded. Please try again later or upgrade your plan.");if(i.status===500){let o=await this.safeJsonParse(i),a=(o==null?void 0:o.error)||"Ollama Cloud server error";throw new Error(`Ollama Cloud error: ${a}`)}throw new Error(`Ollama Cloud API error: ${i.status} - ${i.statusText}`)}let s=await i.json();if(!this.validateResponse(s,["response"]))throw new Error("Invalid response format from Ollama Cloud API");return this.extractContent(s)}catch(r){throw r instanceof Error?r.message.includes("fetch")||r.message.includes("network")||r.message.includes("ECONNREFUSED")||r.message.includes("ENOTFOUND")?new Error("Ollama Cloud is unreachable. Please check your internet connection and https://ollama.com status."):r:new Error(`Ollama Cloud processing failed: ${r}`)}}async processWithImage(e,r){try{if(!e||e.trim().length===0)throw new Error("Prompt cannot be empty");if(!this.apiKey||this.apiKey.trim().length===0)throw new Error("Ollama Cloud requires an API key. Please configure it in plugin settings (get it from https://ollama.com/settings)");let i=[{role:"user",content:e}];if(r&&r.length>0){let n=[];for(let l of r)if(typeof l=="string")n.push(l);else if(l instanceof ArrayBuffer){let c=new Uint8Array(l),h="";for(let g=0;g<c.length;g++)h+=String.fromCharCode(c[g]);let p=btoa(h);n.push(p)}n.length>0&&(i[0].images=n)}let s={model:this._model,messages:i,stream:!1,options:{temperature:this._temperature,num_predict:this._maxTokens}},o=await fetch(this.getApiUrl("/chat"),{method:"POST",headers:this.createHeaders(),body:JSON.stringify(s)});if(!o.ok){if(o.status===404)throw new Error(`Ollama Cloud model not found: ${this._model}. Please check available models at https://ollama.com/library.`);if(o.status===401)throw new Error("Ollama Cloud authentication failed. Please check your API key in plugin settings (get it from https://ollama.com/settings)");if(o.status===403)throw new Error("Ollama Cloud access denied. Your API key may not have access to this model or the service.");if(o.status===429)throw new Error("Ollama Cloud rate limit exceeded. Please try again later or upgrade your plan.");if(o.status===500){let n=await this.safeJsonParse(o),l=(n==null?void 0:n.error)||"Ollama Cloud server error";throw new Error(`Ollama Cloud error: ${l}`)}throw new Error(`Ollama Cloud API error: ${o.status} - ${o.statusText}`)}let a=await o.json();if(!this.validateResponse(a,["message","content"]))throw new Error("Invalid response format from Ollama Cloud API");return this.extractContentFromChat(a)}catch(i){throw i instanceof Error?i.message.includes("fetch")||i.message.includes("network")||i.message.includes("ECONNREFUSED")||i.message.includes("ENOTFOUND")?new Error("Ollama Cloud is unreachable. Please check your internet connection and https://ollama.com status."):i:new Error(`Ollama Cloud processing failed: ${i}`)}}async checkAvailability(){try{return(await fetch(this.getApiUrl("/tags"),{method:"GET",headers:this.createHeaders()})).ok}catch(e){return!1}}async checkModelAvailability(e){try{let r=await fetch(this.getApiUrl("/tags"),{method:"GET",headers:this.createHeaders()});if(!r.ok)return!1;let i=await r.json();return i!=null&&i.models?i.models.some(s=>{var o;return s.name===e||s.name.startsWith(`${e}:`)||((o=s.id)==null?void 0:o.includes(e))}):!1}catch(r){return!1}}createHeaders(){let e={"Content-Type":"application/json"};return this.apiKey&&(e.Authorization=`Bearer ${this.apiKey}`),e}createRequestBody(e){return{}}extractContent(e){return e&&typeof e=="object"&&"response"in e?e.response.trim():""}extractContentFromChat(e){return e&&typeof e=="object"&&e.message&&"content"in e.message?e.message.content.trim():""}};var ft="https://openrouter.ai/api/v1/chat/completions";function vt(u){let t=u.match(/retry in ([\d.]+)/i)||u.match(/(\d+)\s*seconds?/i),e=t?` Retry in ${Math.ceil(parseFloat(t[1]))}s.`:"";return u.toLowerCase().includes("rate limit")?`OpenRouter rate limit reached.${e}`:u.toLowerCase().includes("insufficient")||u.toLowerCase().includes("credits")?"OpenRouter credits exhausted. Add credits at openrouter.ai/credits":u.toLowerCase().includes("quota")?`OpenRouter quota exceeded.${e}`:`OpenRouter API error.${e}`}var Ee=class extends S{constructor(e,r,i){super(e,r||"meta-llama/llama-3.1-8b-instruct:free",i);this.name="OpenRouter";this.siteUrl="https://github.com/user/yt-clipper",this.siteName="YouTube Clipper Obsidian Plugin"}async process(e){var r;try{if(!this.apiKey||this.apiKey.trim().length===0)throw new Error("OpenRouter API key is required. Get one at openrouter.ai/keys");let i=await fetch(ft,{method:"POST",headers:this.createHeaders(),body:JSON.stringify(this.createRequestBody(e))});if(i.status===401)throw new Error("OpenRouter API key is invalid. Please check your key at openrouter.ai/keys");if(i.status===402)throw new Error("OpenRouter credits exhausted. Add credits at openrouter.ai/credits");if(i.status===403)throw new Error("OpenRouter access denied. Your key may not have access to this model.");if(i.status===429){let o=await this.safeJsonParse(i),a=((r=o==null?void 0:o.error)==null?void 0:r.message)||"";throw new Error(vt(a))}i.ok||await this.handleAPIError(i);let s=await i.json();if(!this.validateResponse(s,["choices","0","message","content"]))throw new Error("Invalid response format from OpenRouter API");return this.extractContent(s)}catch(i){throw i instanceof Error?i:new Error(`OpenRouter processing failed: ${i}`)}}createHeaders(){return{Authorization:`Bearer ${this.apiKey}`,"Content-Type":"application/json","HTTP-Referer":this.siteUrl,"X-Title":this.siteName}}createRequestBody(e){return{model:this._model,messages:[{role:"system",content:"You are an expert content analyzer specializing in extracting practical value and creating actionable guides from video content. Focus on clarity, practicality, and immediate implementability."},{role:"user",content:e}],max_tokens:this._maxTokens,temperature:this._temperature}}extractContent(e){let r=e.choices[0].message.content;return r?r.trim():""}};K();T();K();var yt={namespace:"ytc",maxItems:100,defaultTTL:864e5,version:1},Pe=class{constructor(t={}){this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0};this.config={...yt,...t},this.indexKey=`${this.config.namespace}-index`,this.initializeIndex(),this.cleanupExpired()}initializeIndex(){try{localStorage.getItem(this.indexKey)||localStorage.setItem(this.indexKey,JSON.stringify([])),this.metrics.size=this.getIndex().length}catch(t){}}getIndex(){try{let t=localStorage.getItem(this.indexKey);return t?JSON.parse(t):[]}catch(t){return[]}}updateIndex(t){try{localStorage.setItem(this.indexKey,JSON.stringify(t)),this.metrics.size=t.length}catch(e){}}getStorageKey(t){return`${this.config.namespace}-${t}`}get(t){try{let e=this.getStorageKey(t),r=localStorage.getItem(e);if(!r)return this.metrics.misses++,this.updateHitRate(),null;let i=JSON.parse(r);return i.version!==this.config.version?(this.delete(t),this.metrics.misses++,this.updateHitRate(),null):Date.now()-i.timestamp>i.ttl?(this.delete(t),this.metrics.misses++,this.updateHitRate(),null):(this.metrics.hits++,this.updateHitRate(),i.data)}catch(e){return this.metrics.misses++,this.updateHitRate(),null}}set(t,e,r){try{let i=this.getIndex();for(;i.length>=this.config.maxItems;){let a=i.shift();a&&(localStorage.removeItem(this.getStorageKey(a)),this.metrics.evictions++)}let s=this.getStorageKey(t),o={data:e,timestamp:Date.now(),ttl:r!=null?r:this.config.defaultTTL,version:this.config.version};localStorage.setItem(s,JSON.stringify(o)),i.includes(t)||i.push(t),this.updateIndex(i)}catch(i){if(i.name==="QuotaExceededError"){this.evictOldest(10);try{this.set(t,e,r)}catch(s){}}}}delete(t){try{let e=this.getStorageKey(t),r=localStorage.getItem(e)!==null;if(r){localStorage.removeItem(e);let i=this.getIndex().filter(s=>s!==t);this.updateIndex(i)}return r}catch(e){return!1}}has(t){return this.get(t)!==null}clear(){try{this.getIndex().forEach(e=>{localStorage.removeItem(this.getStorageKey(e))}),this.updateIndex([]),this.metrics={hits:0,misses:0,evictions:0,size:0,hitRate:0}}catch(t){}}size(){return this.getIndex().length}getMetrics(){return{...this.metrics}}evictOldest(t){let e=this.getIndex();e.slice(0,t).forEach(i=>{localStorage.removeItem(this.getStorageKey(i)),this.metrics.evictions++}),this.updateIndex(e.slice(t))}cleanupExpired(){try{let t=this.getIndex(),e=Date.now(),r=[];t.forEach(i=>{let s=this.getStorageKey(i),o=localStorage.getItem(s);if(o)try{let a=JSON.parse(o);e-a.timestamp<=a.ttl&&a.version===this.config.version?r.push(i):localStorage.removeItem(s)}catch(a){localStorage.removeItem(s)}}),this.updateIndex(r)}catch(t){}}updateHitRate(){let t=this.metrics.hits+this.metrics.misses;this.metrics.hitRate=t>0?this.metrics.hits/t:0}getStorageStats(){let t=this.getIndex(),e=0;try{t.forEach(r=>{let i=localStorage.getItem(this.getStorageKey(r));i&&(e+=i.length*2)})}catch(r){}return{itemCount:t.length,estimatedBytes:e,maxItems:this.config.maxItems}}getCachedVideoIds(){return this.getIndex().filter(t=>t.startsWith("transcript-")).map(t=>t.replace("transcript-",""))}},qe=new Pe({namespace:"ytc-transcript",maxItems:50,defaultTTL:10080*60*1e3}),ei=new Pe({namespace:"ytc-metadata",maxItems:200,defaultTTL:1440*60*1e3});var Te=class{constructor(t){this.cache=t;this.transcriptTTL=1e3*60*60*24*7}async getTranscript(t){var s,o,a;if(!t)throw new Error("Video ID is required");let e=`transcript-${t}`,r=(s=this.cache)==null?void 0:s.get(e);if(r)return r;let i=qe.get(t);if(i)return(o=this.cache)==null||o.set(e,i,this.transcriptTTL),i;try{let n=await this.fetchTranscriptWithFallback(t);return n?((a=this.cache)==null||a.set(e,n,this.transcriptTTL),qe.set(t,n,this.transcriptTTL),n):null}catch(n){return null}}async fetchTranscriptWithFallback(t){try{let e=await this.fetchFromYouTubeAPI(t);if(e)return e}catch(e){}try{let e=await this.scrapeTranscriptFromPage(t);if(e)return e}catch(e){}try{let e=await this.fetchFromThirdParty(t);if(e)return e}catch(e){}return null}async fetchFromYouTubeAPI(t){let e=`https://video.google.com/timedtext?lang=en&v=${t}`,r=await fetch(e);if(!r.ok)throw new Error(`Transcript API failed: ${r.status}`);let i=await r.text();return this.parseXMLTranscript(i,t)}async scrapeTranscriptFromPage(t){let e=`https://www.youtube.com/watch?v=${t}`,r=`${D.CORS_PROXY}?url=${encodeURIComponent(e)}`,i=await fetch(r);if(!i.ok)throw new Error("Failed to fetch video page");let s=await i.text(),o=await this.extractTranscriptFromHTML(s);return o?this.createTranscript(o,t,!0):null}async fetchFromThirdParty(t){return null}parseXMLTranscript(t,e){let s=new DOMParser().parseFromString(t,"text/xml").getElementsByTagName("text"),o=[],a="";for(let n=0;n<s.length;n++){let l=s[n];if(!l)continue;let c=l.textContent||"",h=parseFloat(l.getAttribute("start")||"0"),p=parseFloat(l.getAttribute("dur")||"0");c.trim()&&(o.push({text:c.trim(),start:h,duration:p}),a+=`${c.trim()} `)}return{segments:o,fullText:a.trim(),language:"en",autoGenerated:!0}}async extractTranscriptFromHTML(t){let e=/"captions":\s*{[^}]*"playerCaptionsTracklistRenderer":\s*{[^}]*"captionTracks":\s*\[([^\]]+)\]/,r=t.match(e);if(!(r!=null&&r[1]))return null;try{let i=r[1],o=JSON.parse(`[${i}]`).find(a=>{var n;return a.languageCode==="en"||((n=a.languageCode)==null?void 0:n.startsWith("en"))});return o!=null&&o.baseUrl?fetch(o.baseUrl).then(a=>{if(!a.ok)throw new Error("Failed to fetch caption track");return a.text()}).then(a=>this.parseXMLTranscript(a,"").segments).catch(a=>null):null}catch(i){return null}}createTranscript(t,e,r=!1){Array.isArray(t)||(t=[t]);let i=t.map(o=>({text:o.text,start:o.start,duration:o.duration||0})),s=i.map(o=>o.text).join(" ").trim();return{segments:i,fullText:s,language:"en",autoGenerated:r}}async getTranscriptSummary(t,e=2e3){let r=await this.getTranscript(t);if(!r)return null;if(r.fullText.length<=e)return r.fullText;let i=r.segments.filter(s=>s.text.length>20).slice(0,10).map(s=>s.text).join(" ");return i.length>e?`${i.substring(0,e)}...`:i}async extractKeyMoments(t,e=5){let r=await this.getTranscript(t);if(!r||r.segments.length===0)return null;let i=r.segments.filter(n=>n.text.length>30);if(i.length===0)return null;let s=i.length,o=Math.max(1,Math.floor(s/e)),a=[];for(let n=0;n<s&&a.length<e;n+=o){let l=i[n];l&&a.push({time:l.start,text:l.text})}return a}async isTranscriptAvailable(t){let e=await this.getTranscript(t);return e!==null&&e.segments.length>0}};var xe=class{constructor(t){this.cache=t;this.metadataTTL=1e3*60*30;this.descriptionTTL=1e3*60*30;this.transcriptService=new Te(t)}async getTranscript(t){try{let e=await this.transcriptService.getTranscript(t);return e?{fullText:e.fullText}:null}catch(e){return null}}extractVideoId(t){return v.extractVideoId(t)}async getVideoData(t){var i,s;if(!t)throw new Error("Video ID is required");let e=this.getCacheKey("video-data",t),r=(i=this.cache)==null?void 0:i.get(e);if(r)return r;try{let o=await this.getVideoMetadata(t),a={title:o.title||"Unknown Title",description:o.description||"No description available",duration:o.duration,thumbnail:o.thumbnail,channelName:o.channelName};return a.duration&&a.duration<1800&&this.checkTranscriptAvailability(t).then(n=>{var l;a.hasTranscript=n,(l=this.cache)==null||l.set(e,a,this.metadataTTL)}),(s=this.cache)==null||s.set(e,a,this.metadataTTL),a}catch(o){throw E.createUserFriendlyError(o,"fetch video data")}}async getVideoMetadata(t){var s,o;let e=this.getCacheKey("metadata",t),r=(s=this.cache)==null?void 0:s.get(e);if(r)return r;let i=`${D.YOUTUBE_OEMBED}?url=https://www.youtube.com/watch?v=${t}&format=json`;try{let a=new AbortController,n=setTimeout(()=>a.abort(),1e4),l=await fetch(i,{headers:{"User-Agent":"Obsidian YoutubeClipper Plugin"},signal:a.signal});if(clearTimeout(n),!l.ok){if(l.status===400)throw new Error(`Invalid YouTube video ID: ${t}. Please check the URL and try again.`);if(l.status===401){console.warn(`YouTube oEmbed returned 401 for ${t}, attempting fallback...`);try{let g=await this.scrapeAdditionalMetadata(t);if(g.description||g.duration)return{title:`YouTube Video (${t})`,description:g.description,duration:g.duration,thumbnail:`https://img.youtube.com/vi/${t}/maxresdefault.jpg`,channelName:void 0}}catch(g){}return{title:`YouTube Video (${t})`,description:`Video URL: https://www.youtube.com/watch?v=${t}`,duration:void 0,thumbnail:`https://img.youtube.com/vi/${t}/maxresdefault.jpg`,channelName:void 0}}else throw l.status===404?new Error(`YouTube video not found: ${t}. The video may be private, deleted, or the ID is incorrect.`):l.status===403?new Error(`Access denied to YouTube video: ${t}. The video may be private or restricted.`):new Error(f.ERRORS.FETCH_VIDEO_DATA(l.status))}let c=await l.json(),h={title:c.title||"Unknown Title",thumbnail:c.thumbnail_url,author_name:c.author_name};try{let g=await this.scrapeAdditionalMetadata(t);h={...h,...g}}catch(g){}let p={title:h.title,description:h.description,duration:h.duration,thumbnail:h.thumbnail,channelName:h.author_name};return(o=this.cache)==null||o.set(e,p,this.metadataTTL),p}catch(a){throw a instanceof DOMException&&a.name==="AbortError"?new Error("Request timed out. Please check your internet connection and try again."):a instanceof TypeError?new Error(f.ERRORS.NETWORK_ERROR):a instanceof Error&&a.message.includes("JSON")?new Error("Failed to parse YouTube response. The service may be temporarily unavailable."):a}}async scrapeAdditionalMetadata(t){try{let e=await this.fetchVideoPageHTML(t),r=e.match(/"lengthSeconds":"(\d+)"/),i=r!=null&&r[1]?parseInt(r[1]):void 0,s=e.match(/"shortDescription":"([^"]+)"/);return{description:s!=null&&s[1]?s[1].replace(/\\u0026/g,"&").replace(/\\n/g,`
`):void 0,duration:i}}catch(e){return{}}}async checkTranscriptAvailability(t){try{return await this.transcriptService.isTranscriptAvailable(t)}catch(e){return!1}}async getVideoDescription(t){var i,s,o;let e=this.getCacheKey("description",t),r=(i=this.cache)==null?void 0:i.get(e);if(r)return r;try{let a=await this.fetchVideoPageHTML(t),n=this.extractDescriptionFromHTML(a);return(s=this.cache)==null||s.set(e,n,this.descriptionTTL),n}catch(a){let n=f.WARNINGS.EXTRACTION_FAILED;return(o=this.cache)==null||o.set(e,n,this.descriptionTTL),n}}async fetchVideoPageHTML(t){let e=`https://www.youtube.com/watch?v=${t}`,r=`${D.CORS_PROXY}?url=${encodeURIComponent(e)}`,i=await fetch(r);if(!i.ok)throw new Error(f.WARNINGS.CORS_RESTRICTIONS);return i.text()}extractDescriptionFromHTML(t){let e=[/"shortDescription":"([^"]*?)"/,/"description":{"simpleText":"([^"]*?)"}/,/<meta name="description" content="([^"]*?)">/,/<meta property="og:description" content="([^"]*?)">/];for(let r of e){let i=t.match(r);if(i!=null&&i[1]){let s=v.cleanText(i[1]);return v.truncateText(s,je.DESCRIPTION_MAX_LENGTH)}}return f.WARNINGS.AUTO_EXTRACTION}validateAndExtractVideoId(t){if(!v.isValidYouTubeUrl(t))throw new Error(f.ERRORS.INVALID_URL);let e=this.extractVideoId(t);if(!e)throw new Error(f.ERRORS.INVALID_URL);return e}getCacheKey(t,e){return`youtube-video-service:${t}:${e}`}};var ee=class{constructor(t,e){this.settings=t;this.app=e;this.serviceMetrics=new Map;this.SERVICE_TTL=300*1e3;this.setupPeriodicCleanup(),this.trackMemoryUsage()}get aiService(){return this.getService("aiService",()=>{let t=performance.now(),e=[];this.settings.geminiApiKey&&e.push(new pe(this.settings.geminiApiKey)),this.settings.groqApiKey&&e.push(new me(this.settings.groqApiKey)),this.settings.huggingFaceApiKey&&e.push(new he(this.settings.huggingFaceApiKey)),this.settings.openRouterApiKey&&e.push(new Ee(this.settings.openRouterApiKey)),e.push(new be(this.settings.ollamaApiKey||"",void 0,void 0,this.settings.ollamaEndpoint||"http://localhost:11434")),this.settings.ollamaApiKey&&e.push(new we(this.settings.ollamaApiKey,"deepseek-r1:32b"));let r=new ue(e,this.settings);return this.recordServiceMetrics("aiService",performance.now()-t),r})}get videoService(){return this.getService("videoService",()=>{let t=performance.now(),e=new xe(this.cacheService);return this.recordServiceMetrics("videoService",performance.now()-t),e})}get fileService(){return this.getService("fileService",()=>{let t=performance.now(),e=new ye(this.app);return this.recordServiceMetrics("fileService",performance.now()-t),e})}get cacheService(){return this.getService("cacheService",()=>{let t=performance.now(),e=new ge;return this.recordServiceMetrics("cacheService",performance.now()-t),e})}get promptService(){return this.getService("promptService",()=>{let t=performance.now(),e=new oe;return this.recordServiceMetrics("promptService",performance.now()-t),e})}getService(t,e){let r=`_${t}`,i=this[r];if(i){let a=this.serviceMetrics.get(t);return a&&(a.lastUsed=Date.now(),a.usageCount++),i}let s=performance.now(),o=e();return this[r]=o,I.trackOperation("ServiceContainer",`getService-${t}`,performance.now()-s,!0,{serviceName:t}),o}recordServiceMetrics(t,e){this.serviceMetrics.set(t,{creationTime:e,lastUsed:Date.now(),usageCount:0})}setupPeriodicCleanup(){this.cleanupInterval=setInterval(()=>{this.performCleanup()},120*1e3)}performCleanup(){let t=Date.now(),e=[];this.serviceMetrics.forEach((r,i)=>{t-r.lastUsed>this.SERVICE_TTL&&e.push(i)}),e.forEach(r=>{this.clearService(r),this.serviceMetrics.delete(r)}),this.isMemoryUsageHigh()&&this.performAggressiveCleanup()}clearService(t){let e=`_${t}`,r=this[e];if(r&&typeof r.cleanup=="function")try{r.cleanup()}catch(i){d.warn(`Error during cleanup of ${t}:`,"ServiceContainer",i)}this[e]=void 0}isMemoryUsageHigh(){if(performance.memory){let t=performance.memory.usedJSHeapSize,e=performance.memory.jsHeapSizeLimit;return t/e>.8}return!1}performAggressiveCleanup(){d.warn("High memory usage detected, performing aggressive cleanup","ServiceContainer");let t=Array.from(this.serviceMetrics.entries()).sort((r,i)=>i[1].lastUsed-r[1].lastUsed),[e]=t;this.serviceMetrics.forEach((r,i)=>{i!==(e==null?void 0:e[0])&&this.clearService(i)}),this.serviceMetrics.clear(),e&&this.serviceMetrics.set(e[0],e[1]),window.gc&&window.gc()}trackMemoryUsage(){setInterval(()=>{if(performance.memory){let t=performance.memory,e=Math.round(t.usedJSHeapSize/1024/1024),r=Math.round(t.jsHeapSizeLimit/1024/1024);e>50&&d.debug(`Memory usage: ${e}MB / ${r}MB`,"ServiceContainer")}},60*1e3)}async updateSettings(t){this.settings=t,this.clearService("aiService"),this.serviceMetrics.delete("aiService"),this.clearService("videoService"),this.serviceMetrics.delete("videoService")}clearServices(){Object.keys(this.serviceMetrics).forEach(t=>{this.clearService(t)}),this._aiService=void 0,this._videoService=void 0,this._fileService=void 0,this._cacheService=void 0,this._promptService=void 0,this.serviceMetrics.clear()}getServiceMetrics(){let t={};return this.serviceMetrics.forEach((e,r)=>{t[r]={...e}}),t}getPerformanceReport(){let t=this.getServiceMetrics(),e=I.generateReport(),r=this._aiService;r&&typeof r.getPerformanceMetrics=="function"&&(e.services.aiService={...e.services.aiService,...r.getPerformanceMetrics()});let i=this._videoService;i&&typeof i.getPerformanceMetrics=="function"&&(e.services.videoService={...e.services.videoService,...i.getPerformanceMetrics()});let s=this._cacheService;return s&&typeof s.getMetrics=="function"&&(e.systemMetrics.cacheMetrics=s.getMetrics()),{...e,containerMetrics:{uptime:I.getUptime(),services:Object.keys(t),memoryUsage:this.isMemoryUsageHigh()}}}cleanup(){this.cleanupInterval&&clearInterval(this.cleanupInterval),this._aiService&&typeof this._aiService.cleanup=="function"&&this._aiService.cleanup(),this._videoService&&typeof this._videoService.cleanup=="function"&&this._videoService.cleanup(),this._cacheService&&typeof this._cacheService.destroy=="function"&&this._cacheService.destroy(),this.clearServices(),I.clearMetrics()}};var Se=class{constructor(t,e,r,i={noteMarker:"<!-- ytc-extension:youtube-clipper -->",urlHandlerDelay:500,maxHandledFiles:100,tempFileAgeThreshold:5e3}){this.app=t;this.settings=e;this.onUrlDetected=r;this.config=i;this.handledTempFiles=new Set;this.pendingUrls=new Map}isTempFile(t,e){var r;try{if(e&&e.includes(this.config.noteMarker))return d.debug("File identified as temp file via marker","UrlHandler",{filePath:t.path,hasMarker:!0}),!0;if(t.name&&t.name.startsWith("YouTube Clip -"))return d.debug("File identified as temp file via name","UrlHandler",{filePath:t.path,fileName:t.name}),!0;let s=e.trim().split(`
`).filter(n=>n.trim().length>0),o=(r=s[0])!=null?r:"";if(s.length===1&&v.isValidYouTubeUrl(o)&&e.length<200){let n=Date.now()-t.stat.ctime,l=t.path.includes(this.settings.outputPath);if(n<this.config.tempFileAgeThreshold&&!l)return d.debug("File identified as temp file via content analysis","UrlHandler",{filePath:t.path,fileAge:n,isInOutputPath:l,contentLength:e.length}),!0}return!1}catch(i){return d.error("Error checking if file is temp file","UrlHandler",{filePath:t.path,error:i instanceof Error?i.message:String(i)}),!1}}extractUrl(t){try{if(t&&t.includes(this.config.noteMarker)){let s=t.replace(this.config.noteMarker,"").trim();return v.isValidYouTubeUrl(s)?s:null}let e=t.trim(),r=/(https?:\/\/(?:www\.)?youtube\.com\/watch\?v=[A-Za-z0-9_-]{6,}|https?:\/\/(?:www\.)?youtu\.be\/[A-Za-z0-9_-]{6,})/i,i=e.match(r);if(i!=null&&i[1]){let s=i[1].trim();return v.isValidYouTubeUrl(s)?s:null}return null}catch(e){return d.error("Error extracting URL from content","UrlHandler",{error:e instanceof Error?e.message:String(e),contentLength:t.length}),null}}handleUrlSafely(t){if(d.info("URL detected, processing safely","UrlHandler",{url:t.url,source:t.source,filePath:t.filePath}),t.file&&t.content&&!this.isTempFile(t.file,t.content)){d.warn("URL rejected - not in temp file","UrlHandler",{url:t.url,filePath:t.filePath});return}if(this.handledTempFiles.has(t.url)){d.debug("URL already handled, skipping","UrlHandler",{url:t.url});return}this.pendingUrls.has(t.url)&&(d.debug("Cancelling pending handler for URL","UrlHandler",{url:t.url}),clearTimeout(this.pendingUrls.get(t.url))),this.handledTempFiles.add(t.url),t.filePath&&this.handledTempFiles.add(t.filePath);let e=setTimeout(()=>{d.info("Processing URL after debounce","UrlHandler",{url:t.url}),this.onUrlDetected(t),this.pendingUrls.delete(t.url),this.cleanupHandledFiles()},this.config.urlHandlerDelay);this.pendingUrls.set(t.url,e)}cleanupHandledFiles(){if(this.handledTempFiles.size>this.config.maxHandledFiles){let t=Array.from(this.handledTempFiles);this.handledTempFiles.clear(),t.slice(-Math.floor(this.config.maxHandledFiles/2)).forEach(e=>{this.handledTempFiles.add(e)}),d.debug("Cleaned up handled temp files","UrlHandler",{oldSize:t.length,newSize:this.handledTempFiles.size})}}async handleFileCreate(t){try{if(!(t!=null&&t.path)||!t.stat)return;let e=await this.app.vault.read(t);if(!this.isTempFile(t,e)){d.debug("Ignoring non-temp file in create handler","UrlHandler",{filePath:t.path});return}let r=this.extractUrl(e);if(!r){d.debug("No URL extracted from temp file","UrlHandler",{filePath:t.path});return}let i={url:r,source:"create",filePath:t.path,file:t,content:e};d.info("CREATE EVENT - detected temp note","UrlHandler",{...i}),this.handleUrlSafely(i)}catch(e){d.error("Error handling file create","UrlHandler",{filePath:t.path,error:e instanceof Error?e.message:String(e)})}}async handleActiveLeafChange(){try{let t=this.app.workspace.getActiveFile();if(!t||!("stat"in t)||!("basename"in t)||!("extension"in t)||this.handledTempFiles.has(t.path))return;let e=await this.app.vault.read(t);if(!this.isTempFile(t,e)){d.debug("Ignoring non-temp file in active leaf handler","UrlHandler",{filePath:t.path});return}let r=this.extractUrl(e);if(!r){d.debug("No URL extracted from temp file in active leaf","UrlHandler",{filePath:t.path});return}let i={url:r,source:"active-leaf",filePath:t.path,file:t,content:e};d.info("ACTIVE-LEAF-CHANGE EVENT - detected temp note","UrlHandler",{...i}),this.handleUrlSafely(i)}catch(t){d.error("Error handling active leaf change","UrlHandler",{error:t instanceof Error?t.message:String(t)})}}handleProtocol(t){try{let e=t.url||t.content||t.path||"";if(e&&v.isValidYouTubeUrl(e)){let r={url:e,source:"protocol"};d.info("Protocol handler received valid URL","UrlHandler",{...r}),setTimeout(()=>{this.onUrlDetected(r)},200)}else d.debug("Protocol handler received no valid URL","UrlHandler",{params:t})}catch(e){d.error("Error in protocol handler","UrlHandler",{params:t,error:e instanceof Error?e.message:String(e)})}}async handleClipboardUrl(){try{let t="";try{navigator&&navigator.clipboard&&navigator.clipboard.readText&&(t=await navigator.clipboard.readText()||"")}catch(e){d.debug("Could not read clipboard","UrlHandler",{error:e instanceof Error?e.message:String(e)}),t=""}if(t&&v.isValidYouTubeUrl(t.trim())){let e={url:t.trim(),source:"clipboard"};d.info("URL found in clipboard","UrlHandler",{...e}),this.onUrlDetected(e);return}d.debug("No valid YouTube URL in clipboard","UrlHandler")}catch(t){d.error("Error handling clipboard URL","UrlHandler",{error:t instanceof Error?t.message:String(t)})}}clear(){this.pendingUrls.forEach(t=>clearTimeout(t)),this.pendingUrls.clear(),this.handledTempFiles.clear(),d.info("URL handler cleared","UrlHandler")}updateSettings(t){this.settings=t,d.debug("URL handler settings updated","UrlHandler")}};var te=class{constructor(t){this.settings=t}getApiKey(t){return this.settings.useEnvironmentVariables?this.getFromEnvironment(t):t==="gemini"?this.settings.geminiApiKey:this.settings.groqApiKey}getFromEnvironment(t){let r=`${this.settings.environmentPrefix||"YTC"}_${t.toUpperCase()}_API_KEY`;return this.getSecureEnvVar(r)||""}getSecureEnvVar(t){return typeof process!="undefined"&&process.env?process.env[t]:this.getFromSecureStorage(t)}getFromSecureStorage(t){}validateSecurityConfiguration(){let t=[],e=!0;return this.settings.useEnvironmentVariables||(this.settings.geminiApiKey&&this.settings.geminiApiKey.length>0&&(t.push("Gemini API key is stored directly in configuration. Consider using environment variables."),e=!1),this.settings.groqApiKey&&this.settings.groqApiKey.length>0&&(t.push("Groq API key is stored directly in configuration. Consider using environment variables."),e=!1)),(this.settings.geminiApiKey==="your-api-key-here"||this.settings.groqApiKey==="your-api-key-here")&&(t.push("Default placeholder API keys detected. Please set real API keys."),e=!1),{isSecure:e,warnings:t}}getEnvironmentTemplate(){let t=this.settings.environmentPrefix||"YTC";return`# YouTubeClipper Environment Variables
# Set these in your environment for secure API key management

# Google Gemini API Key
${t}_GEMINI_API_KEY=your_gemini_api_key_here

# Groq API Key  
${t}_GROQ_API_KEY=your_groq_api_key_here

# Usage:
# 1. Set these variables in your shell profile (.bashrc, .zshrc, etc.)
# 2. Enable "Use Environment Variables" in plugin settings
# 3. Restart Obsidian to pick up the new environment variables
`}};var _=require("obsidian"),m="ytc-settings",Ae=class extends _.PluginSettingTab{constructor(e,r){super(e,r.plugin);this.options=r;this.validationErrors=[];this.drawerStates=new Map;this.DRAWER_STATES_KEY="ytc-settings-drawer-states";this.providerStatuses=new Map;this.settings={...r.plugin.settings},this.secureConfig=new te(this.settings),this.loadDrawerStates()}display(){let{containerEl:e}=this;e.empty(),e.addClass(`${m}-container`),this.settings={...this.options.plugin.settings},this.secureConfig=new te(this.settings),this.injectStyles(),this.createHeader(),this.createSearchBar(),this.createProviderStatusDashboard(),this.createQuickActions(),this.createAPISection(),this.createAISection(),this.createOutputSection(),this.createAdvancedSection()}injectStyles(){if(document.getElementById(`${m}-styles`))return;let e=document.createElement("style");e.id=`${m}-styles`,e.textContent=`
            .${m}-container {
                max-width: 800px;
                margin: 0 auto;
                padding-bottom: 40px;
            }

            /* Header */
            .${m}-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 24px;
                padding-bottom: 16px;
                border-bottom: 1px solid var(--background-modifier-border);
            }

            .${m}-title {
                margin: 0;
                font-size: 1.5em;
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 12px;
                color: var(--text-normal);
            }

            .${m}-badge {
                padding: 4px 10px;
                border-radius: 4px;
                font-size: 0.75rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.05em;
            }

            .${m}-badge-ready {
                background: rgba(var(--color-green-rgb), 0.15);
                color: var(--color-green);
            }

            .${m}-badge-setup {
                background: rgba(var(--color-orange-rgb), 0.15);
                color: var(--color-orange);
            }

            /* Search Bar */
            .${m}-search-bar {
                position: relative;
                margin-bottom: 20px;
            }

            .${m}-search-bar input {
                width: 100%;
                padding: 10px 12px 10px 36px;
                background: var(--background-primary);
                border: 1px solid var(--background-modifier-border);
                border-radius: 6px;
                font-size: 0.9rem;
                transition: all 0.2s ease;
            }

            .${m}-search-bar input:focus {
                border-color: var(--interactive-accent);
                box-shadow: 0 0 0 2px rgba(var(--interactive-accent-rgb), 0.1);
            }

            .${m}-search-icon {
                position: absolute;
                left: 12px;
                top: 50%;
                transform: translateY(-50%);
                color: var(--text-muted);
                font-size: 1rem;
                pointer-events: none;
            }

            /* Status Dashboard (Compact Row) */
            .${m}-status-dashboard {
                margin-bottom: 24px;
                background: var(--background-secondary);
                border-radius: 8px;
                padding: 12px 16px;
                display: flex;
                align-items: center;
                gap: 16px;
                overflow-x: auto;
                border: 1px solid var(--background-modifier-border);
            }

            .${m}-status-title {
                font-size: 0.8rem;
                font-weight: 600;
                color: var(--text-muted);
                text-transform: uppercase;
                white-space: nowrap;
                margin-right: 8px;
            }

            .${m}-status-grid {
                display: flex;
                gap: 8px;
                flex: 1;
            }

            .${m}-status-chip {
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 4px 10px;
                background: var(--background-primary);
                border: 1px solid var(--background-modifier-border);
                border-radius: 12px;
                font-size: 0.8rem;
                cursor: pointer;
                transition: all 0.15s ease;
                white-space: nowrap;
            }

            .${m}-status-chip:hover {
                transform: translateY(-1px);
                border-color: var(--text-muted);
            }

            .${m}-status-dot {
                width: 6px;
                height: 6px;
                border-radius: 50%;
            }

            .${m}-status-chip.valid .${m}-status-dot { background: var(--color-green); box-shadow: 0 0 4px var(--color-green); }
            .${m}-status-chip.invalid .${m}-status-dot { background: var(--color-red); }
            .${m}-status-chip.testing .${m}-status-dot { background: var(--color-yellow); animation: pulse 1s infinite; }
            .${m}-status-chip.untested .${m}-status-dot { background: var(--text-muted); }

            /* Drawers/Sections */
            .${m}-drawer {
                margin-bottom: 12px;
                border: 1px solid var(--background-modifier-border);
                border-radius: 6px;
                overflow: hidden;
                background: var(--background-primary);
            }

            .${m}-drawer-header {
                display: flex;
                align-items: center;
                gap: 12px;
                padding: 12px 16px;
                background: var(--background-primary);
                cursor: pointer;
                transition: background 0.15s ease;
            }

            .${m}-drawer-header:hover {
                background: var(--background-secondary);
            }

            .${m}-drawer-icon {
                color: var(--text-muted);
                font-size: 1.1rem;
            }

            .${m}-drawer-title {
                flex: 1;
                margin: 0;
                font-size: 0.95rem;
                font-weight: 600;
                color: var(--text-normal);
            }

            .${m}-drawer-arrow {
                color: var(--text-muted);
                font-size: 0.8rem;
                transition: transform 0.2s ease;
            }

            .${m}-drawer.is-open .${m}-drawer-arrow {
                transform: rotate(180deg);
            }

            .${m}-drawer-content {
                display: none;
                padding: 16px;
                border-top: 1px solid var(--background-modifier-border);
                background: var(--background-primary);
            }

            .${m}-drawer.is-open .${m}-drawer-content {
                display: block;
                animation: fadeIn 0.2s ease;
            }

            /* Controls */
            .${m}-password-toggle {
                background: transparent;
                border: none;
                color: var(--text-muted);
                cursor: pointer;
                padding: 4px;
            }
            
            .${m}-password-toggle:hover {
                color: var(--text-normal);
            }

            .${m}-validate-btn {
                padding: 4px 10px;
                border-radius: 4px;
                font-size: 0.8rem;
                font-weight: 500;
            }

            /* Quick Actions Toolbar */
            .${m}-quick-actions {
                display: flex;
                gap: 8px;
                margin-bottom: 24px;
                padding: 4px;
                background: var(--background-secondary);
                border-radius: 8px;
                border: 1px solid var(--background-modifier-border);
            }

            .${m}-action-btn {
                flex: 1;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
                padding: 8px 12px;
                border-radius: 6px;
                border: none;
                background: transparent;
                color: var(--text-muted);
                font-size: 0.85rem;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.15s ease;
            }

            .${m}-action-btn:hover {
                background: var(--background-modifier-hover);
                color: var(--text-normal);
            }

            .${m}-action-btn.primary {
                background: var(--interactive-accent);
                color: var(--text-on-accent);
            }
            
            .${m}-action-btn.primary:hover {
                opacity: 0.9;
            }

            .${m}-action-btn.danger {
                color: var(--color-red);
            }
            
            .${m}-action-btn.danger:hover {
                background: rgba(var(--color-red-rgb), 0.1);
            }

            /* Helpers */
            .${m}-hidden { display: none !important; }
            
            @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
            @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        `,document.head.appendChild(e)}createDrawer(e,r,i=!1){var h;let s=e,o=(h=this.drawerStates.get(s))!=null?h:i,a=this.containerEl.createDiv({cls:`${m}-drawer${o?" is-open":""}`}),n=a.createDiv({cls:`${m}-drawer-header`});n.createSpan({cls:`${m}-drawer-icon`,text:r}),n.createEl("h3",{cls:`${m}-drawer-title`,text:e}),n.createSpan({cls:`${m}-drawer-arrow`,text:"\u25BC"});let c=a.createDiv({cls:`${m}-drawer-content`}).createDiv({cls:`${m}-drawer-inner`});return n.addEventListener("click",()=>{let p=a.classList.toggle("is-open");this.drawerStates.set(s,p),this.saveDrawerStates()}),{drawer:a,content:c}}createSearchBar(){let e=this.containerEl.createDiv({cls:`${m}-search-bar`});e.createSpan({cls:`${m}-search-icon`,text:"\u{1F50D}"}),this.searchInput=e.createEl("input",{attr:{placeholder:"Search settings... (Ctrl+K)"}}),this.searchInput.addEventListener("input",()=>{this.filterSettings(this.searchInput.value)}),this.searchInput.addEventListener("keydown",r=>{var i;r.key==="k"&&r.ctrlKey&&(r.preventDefault(),(i=this.searchInput)==null||i.focus())})}filterSettings(e){let r=this.containerEl.querySelectorAll(`.${m}-drawer`),i=e.toLowerCase().trim();r.forEach(s=>{var n,l,c,h;if(!i){s.removeClass(`${m}-hidden`);return}let o=((l=(n=s.querySelector(`.${m}-drawer-title`))==null?void 0:n.textContent)==null?void 0:l.toLowerCase())||"",a=((h=(c=s.querySelector(`.${m}-drawer-inner}`))==null?void 0:c.textContent)==null?void 0:h.toLowerCase())||"";o.includes(i)||a.includes(i)?(s.removeClass(`${m}-hidden`),s.addClass("is-open")):s.addClass(`${m}-hidden`)})}createProviderStatusDashboard(){let e=this.containerEl.createDiv({cls:`${m}-status-dashboard`});e.createDiv({cls:`${m}-status-title`,text:"Providers"});let r=e.createDiv({cls:`${m}-status-grid`});[{id:"gemini",name:"Gemini",key:"geminiApiKey"},{id:"groq",name:"Groq",key:"groqApiKey"},{id:"huggingface",name:"HuggingFace",key:"huggingFaceApiKey"},{id:"openrouter",name:"OpenRouter",key:"openRouterApiKey"},{id:"ollama",name:"Ollama",key:"ollamaApiKey"},{id:"ollama-cloud",name:"Ollama Cloud",key:"ollamaApiKey"}].forEach(s=>{var l;let o=!!((l=this.settings[s.key])!=null&&l.trim()),a=this.providerStatuses.get(s.id)||"untested",n=r.createDiv({cls:`${m}-status-chip ${a}`});n.createDiv({cls:`${m}-status-dot ${a}`}),n.createDiv({cls:`${m}-status-name`,text:s.name}),n.addEventListener("click",()=>{o&&this.testProvider(s.id,s.name,s.key)}),o?n.title="Click to test connection":(n.style.opacity="0.5",n.style.cursor="default")})}async testProvider(e,r,i){var o;this.providerStatuses.set(e,"testing"),this.display();let s=(o=this.settings[i])==null?void 0:o.trim();if(!s){this.providerStatuses.set(e,"invalid"),this.display();return}try{switch(e){case"gemini":await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${s}`);break;case"groq":await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${s}`}});break;case"huggingface":await fetch("https://huggingface.co/api/whoami-v2",{headers:{Authorization:`Bearer ${s}`}});break;case"openrouter":await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${s}`}});break;case"ollama":let a=this.settings.ollamaEndpoint||"http://localhost:11434";await fetch(`${a}/api/tags`);break;case"ollama-cloud":if(!this.settings.ollamaApiKey)throw new Error("Ollama Cloud requires API key");await fetch("https://ollama.com/api/tags",{headers:{Authorization:`Bearer ${this.settings.ollamaApiKey}`}});break}this.providerStatuses.set(e,"valid"),this.showToast(`${r} API key is valid!`,"success")}catch(a){this.providerStatuses.set(e,"invalid"),this.showToast(`${r} API key validation failed`,"error")}this.display()}createQuickActions(){let e=this.containerEl.createDiv({cls:`${m}-quick-actions`}),r=e.createEl("button",{cls:`${m}-action-btn primary`});r.innerHTML="<span>\u{1F9EA}</span> Test Connections",r.addEventListener("click",()=>this.testAllProviders());let i=e.createEl("button",{cls:`${m}-action-btn`});i.innerHTML="<span>\u2699\uFE0F</span> Manage Settings",i.addEventListener("click",o=>{let a=document.createElement("div");a.className="ytc-settings-popup",a.style.cssText=`
                position: absolute;
                top: 100%;
                left: 0;
                margin-top: 8px;
                background: var(--background-secondary);
                border: 1px solid var(--background-modifier-border);
                border-radius: 8px;
                padding: 8px;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
                min-width: 160px;
                display: flex;
                flex-direction: column;
                gap: 4px;
            `;let n=i.getBoundingClientRect();a.style.top=`${n.bottom+5}px`,a.style.left=`${n.left}px`;let l=(h,p,g)=>{let y=document.createElement("button");return y.innerHTML=`<span>${p}</span> ${h}`,y.style.cssText=`
                    text-align: left;
                    background: transparent;
                    border: none;
                    padding: 8px 12px;
                    border-radius: 6px;
                    cursor: pointer;
                    color: var(--text-normal);
                    font-size: 0.9rem;
                    display: flex; gap: 8px; align-items: center;
                    width: 100%;
                `,y.onmouseenter=()=>y.style.background="var(--background-modifier-hover)",y.onmouseleave=()=>y.style.background="transparent",y.onclick=g,y};a.appendChild(l("Export Settings","\u{1F4E4}",()=>{this.exportSettings(),a.remove(),c.remove()})),a.appendChild(l("Import Settings","\u{1F4E5}",()=>{this.importSettings(),a.remove(),c.remove()}));let c=document.createElement("div");c.style.cssText=`
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                z-index: 999;
            `,c.onclick=()=>{a.remove(),c.remove()},document.body.appendChild(c),document.body.appendChild(a)});let s=e.createEl("button",{cls:`${m}-action-btn danger`});s.innerHTML="<span>\u{1F504}</span> Reset",s.addEventListener("click",()=>this.resetToDefaults())}async testAllProviders(){var r;let e=[{id:"gemini",name:"Google Gemini",key:"geminiApiKey"},{id:"groq",name:"Groq",key:"groqApiKey"},{id:"huggingface",name:"Hugging Face",key:"huggingFaceApiKey"},{id:"openrouter",name:"OpenRouter",key:"openRouterApiKey"},{id:"ollama",name:"Ollama",key:"ollamaApiKey"},{id:"ollama-cloud",name:"Ollama Cloud",key:"ollamaApiKey"}];for(let i of e)(r=this.settings[i.key])!=null&&r.trim()&&(await this.testProvider(i.id,i.name,i.key),await new Promise(s=>setTimeout(s,500)))}exportSettings(){let e=JSON.stringify(this.settings,null,2),r=new Blob([e],{type:"application/json"}),i=URL.createObjectURL(r),s=document.createElement("a");s.href=i,s.download=`yt-clipper-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i),this.showToast("Settings exported successfully!","success")}importSettings(){let e=document.createElement("input");e.type="file",e.accept="application/json",e.addEventListener("change",async r=>{var s;let i=(s=r.target.files)==null?void 0:s[0];if(i)try{let o=await i.text(),a=JSON.parse(o),n=v.validateSettings(a);if(!n.isValid){this.showToast(`Invalid settings file: ${n.errors.join(", ")}`,"error");return}confirm("Import settings? This will overwrite your current settings.")&&(await this.options.onSettingsChange(a),this.settings={...a},this.display(),this.showToast("Settings imported successfully!","success"))}catch(o){this.showToast("Failed to import settings. Check file format.","error")}}),e.click()}resetToDefaults(){if(confirm("Reset all settings to defaults? This action cannot be undone.")){let r={...{geminiApiKey:this.settings.geminiApiKey,groqApiKey:this.settings.groqApiKey,huggingFaceApiKey:this.settings.huggingFaceApiKey,openRouterApiKey:this.settings.openRouterApiKey,ollamaApiKey:this.settings.ollamaApiKey,ollamaEndpoint:this.settings.ollamaEndpoint},outputPath:"YouTube/Processed Videos",useEnvironmentVariables:!1,environmentPrefix:"YTC",performanceMode:"balanced",enableParallelProcessing:!0,enableAutoFallback:!0,preferMultimodal:!0,defaultMaxTokens:4096,defaultTemperature:.5};this.settings=r,this.options.onSettingsChange(r),this.display(),this.showToast("Settings reset to defaults","info")}}showToast(e,r){let i=document.createElement("div");i.className=`${m}-toast ${r}`,i.createSpan({text:r==="success"?"\u2705":r==="error"?"\u274C":"\u2139\uFE0F"}),i.createSpan({text:e}),document.body.appendChild(i),setTimeout(()=>{i.style.animation="slideIn 0.3s ease reverse",setTimeout(()=>i.remove(),300)},3e3)}createHeader(){let{containerEl:e}=this,r=e.createDiv({cls:`${m}-header`}),i=r.createDiv({cls:`${m}-title`});i.createSpan({text:"\u{1F3AC}"}),i.createSpan({text:"YT Clipper"});let s=this.validateConfiguration();this.headerBadge=r.createDiv({cls:`${m}-badge ${s?`${m}-badge-ready`:`${m}-badge-setup`}`}),this.headerBadge.textContent=s?"READY":"SETUP REQUIRED"}updateHeaderBadge(e){this.headerBadge&&(this.headerBadge.className=`${m}-badge ${e?`${m}-badge-ready`:`${m}-badge-setup`}`,this.headerBadge.textContent=e?"\u2713 Ready":"\u26A0 Setup Required")}createAPISection(){let{content:e}=this.createDrawer("API Keys","\u{1F511}",!1);this.createAPIKeySetting(e,{name:"Google Gemini API Key",desc:"Primary AI provider for video analysis. Get free key from Google AI Studio.",placeholder:"Enter your Gemini API key (AIzaSy...)",settingKey:"geminiApiKey",validateFn:async r=>{let i=await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${r}`);if(!i.ok)throw new Error(`HTTP ${i.status}`)}}),this.createAPIKeySetting(e,{name:"Groq API Key",desc:"Fast alternative AI provider. Get free key from Groq Console.",placeholder:"Enter your Groq API key (gsk_...)",settingKey:"groqApiKey",validateFn:async r=>{let i=await fetch("https://api.groq.com/openai/v1/models",{headers:{Authorization:`Bearer ${r}`}});if(!i.ok)throw new Error(`HTTP ${i.status}`)}}),this.createAPIKeySetting(e,{name:"Hugging Face API Key",desc:"Get from huggingface.co/settings/tokens (free tier available)",placeholder:"hf_...",settingKey:"huggingFaceApiKey",validateFn:async r=>{let i=await fetch("https://huggingface.co/api/whoami-v2",{headers:{Authorization:`Bearer ${r}`}});if(!i.ok)throw new Error(`HTTP ${i.status}`)}}),this.createAPIKeySetting(e,{name:"OpenRouter API Key",desc:"Get from openrouter.ai/keys (free models available)",placeholder:"sk-or-...",settingKey:"openRouterApiKey",validateFn:async r=>{let i=await fetch("https://openrouter.ai/api/v1/models",{headers:{Authorization:`Bearer ${r}`}});if(!i.ok)throw new Error(`HTTP ${i.status}`)}}),this.createAPIKeySetting(e,{name:"Ollama API Key",desc:"Required for Ollama Cloud (https://ollama.com). Get API key from ollama.com/settings. Not required for local instances.",placeholder:"Optional - required for cloud only",settingKey:"ollamaApiKey",validateFn:async r=>{let i=this.settings.ollamaEndpoint||"http://localhost:11434",s=i.includes("ollama.com")||i.includes("cloud"),o=s?"https://ollama.com/api":`${i}/api`,a={"Content-Type":"application/json"};s&&r&&(a.Authorization=`Bearer ${r}`);let n=await fetch(`${o}/tags`,{headers:a});if(!n.ok){let l=await n.text().catch(()=>"Unknown error");throw new Error(`HTTP ${n.status}: ${l}`)}}}),new _.Setting(e).setName("Ollama Endpoint").setDesc("Ollama API endpoint. Local: http://localhost:11434 | Cloud: https://ollama.com").addText(r=>{r.setPlaceholder("http://localhost:11434").setValue(this.settings.ollamaEndpoint||"http://localhost:11434").onChange(async i=>{await this.updateSetting("ollamaEndpoint",i.trim())})})}createAPIKeySetting(e,r){let s=new _.Setting(e).setName(r.name).setDesc(r.desc).addText(l=>{l.inputEl.type="password",l.inputEl.autocomplete="off",l.inputEl.style.width="300px",l.setPlaceholder(r.placeholder).setValue(this.settings[r.settingKey]||"").onChange(async c=>{await this.updateSetting(r.settingKey,c.trim())})}).controlEl,o=s.createEl("button",{cls:`${m}-password-toggle`,text:"\u{1F441}\uFE0F"});o.title="Toggle visibility";let a=!1;o.addEventListener("click",()=>{a=!a;let l=s.querySelector('input[type="password"], input[type="text"]');l&&(l.type=a?"text":"password",o.textContent=a?"\u{1F648}":"\u{1F441}\uFE0F",o.title=a?"Hide key":"Show key")});let n=s.createEl("button",{cls:`${m}-validate-btn`,text:"\u2713 Test"});n.addEventListener("click",async()=>{var h;let l=(h=this.settings[r.settingKey])==null?void 0:h.trim();if(!l&&r.settingKey!=="ollamaApiKey"){this.showToast(`No ${r.name} configured`,"info");return}n.disabled=!0,n.textContent="...",n.removeClass("is-success","is-error");let c=n.createEl("span",{cls:`${m}-spinner`});try{await r.validateFn(l),c.remove(),n.textContent="\u2713 Valid",n.addClass("is-success"),this.showToast(`${r.name} is valid!`,"success");let p=r.settingKey.replace("ApiKey","").toLowerCase();this.providerStatuses.set(p,"valid")}catch(p){c.remove(),n.textContent="\u2717 Invalid",n.addClass("is-error"),this.showToast(`${r.name} failed: ${p.message}`,"error");let g=r.settingKey.replace("ApiKey","").toLowerCase();this.providerStatuses.set(g,"invalid")}setTimeout(()=>{n.textContent="\u2713 Test",n.removeClass("is-success","is-error"),n.disabled=!1},3e3)})}createAISection(){var r;let{content:e}=this.createDrawer("AI Configuration","\u{1F916}",!1);this.createSlider(e,{label:"Maximum Output Tokens",desc:"Controls the length of generated notes. Higher values produce more detailed output.",min:512,max:8192,step:256,value:this.settings.defaultMaxTokens||4096,key:"defaultMaxTokens",format:i=>i.toLocaleString(),scale:["Short (512)","Long (8192)"]}),this.createSlider(e,{label:"Temperature",desc:"Controls AI creativity. Lower = more focused/factual, Higher = more creative.",min:0,max:1,step:.1,value:(r=this.settings.defaultTemperature)!=null?r:.5,key:"defaultTemperature",format:i=>i.toFixed(1),scale:["Precise (0)","Creative (1)"]}),new _.Setting(e).setName("Performance Mode").setDesc("Choose processing speed vs output quality tradeoff.").addDropdown(i=>i.addOption("fast","\u26A1 Fast \u2014 Quick results, basic analysis").addOption("balanced","\u2696\uFE0F Balanced \u2014 Good speed & quality").addOption("quality","\u2728 Quality \u2014 Best results, slower").setValue(this.settings.performanceMode||"balanced").onChange(async s=>{await this.updateSetting("performanceMode",s)}))}createOutputSection(){let{content:e}=this.createDrawer("Output Settings","\u{1F4C1}",!1);new _.Setting(e).setName("Output Folder").setDesc("Folder path where processed video notes will be saved.").addText(r=>r.setPlaceholder("YouTube/Processed Videos").setValue(this.settings.outputPath||"YouTube/Processed Videos").onChange(async i=>{await this.updateSetting("outputPath",i.trim()||"YouTube/Processed Videos")}))}createAdvancedSection(){let{content:e}=this.createDrawer("Advanced Settings","\u2699\uFE0F",!1);new _.Setting(e).setName("Parallel Processing").setDesc("Query multiple AI providers simultaneously for faster results.").addToggle(r=>{var i;return r.setValue((i=this.settings.enableParallelProcessing)!=null?i:!1).onChange(async s=>{await this.updateSetting("enableParallelProcessing",s)})}),new _.Setting(e).setName("Multimodal Video Analysis").setDesc("Enable audio + visual analysis for supported models (Gemini 2.5+).").addToggle(r=>{var i;return r.setValue((i=this.settings.preferMultimodal)!=null?i:!1).onChange(async s=>{await this.updateSetting("preferMultimodal",s)})}),new _.Setting(e).setName("Use Environment Variables").setDesc("Load API keys from environment variables (YTC_GEMINI_API_KEY, etc.).").addToggle(r=>{var i;return r.setValue((i=this.settings.useEnvironmentVariables)!=null?i:!1).onChange(async s=>{await this.updateSetting("useEnvironmentVariables",s)})})}createSlider(e,r){let i=e.createDiv({cls:`${m}-slider-wrap`}),s=i.createDiv({cls:`${m}-slider-top`});s.createSpan({cls:`${m}-slider-label`,text:r.label});let o=s.createSpan({cls:`${m}-slider-value`,text:r.format(r.value)}),a=i.createEl("input",{type:"range",cls:`${m}-slider`});a.min=String(r.min),a.max=String(r.max),a.step=String(r.step),a.value=String(r.value);let n=i.createDiv({cls:`${m}-slider-scale`});n.createSpan({text:r.scale[0]}),n.createSpan({text:r.scale[1]}),i.createDiv({cls:`${m}-slider-desc`,text:r.desc}),a.addEventListener("input",()=>{o.textContent=r.format(parseFloat(a.value))}),a.addEventListener("change",async()=>{let l=r.step<1?parseFloat(a.value):parseInt(a.value);await this.updateSetting(r.key,l)})}validateConfiguration(){var i,s;let e=((i=this.settings.geminiApiKey)==null?void 0:i.trim())||((s=this.settings.groqApiKey)==null?void 0:s.trim()),r=v.isValidPath(this.settings.outputPath);return!!(e&&r)}async updateSetting(e,r){try{this.settings[e]=r,await this.validateAndSaveSettings()}catch(i){E.handle(i,`Settings update: ${e}`)}}async validateAndSaveSettings(){let e=v.validateSettings(this.settings),r=this.validationErrors.length>0,i=e.errors.length>0;this.validationErrors=e.errors,e.isValid?(await this.options.onSettingsChange(this.settings),this.updateHeaderBadge(!0)):this.updateHeaderBadge(!1),r!==i&&this.display()}getSettings(){return{...this.settings}}updateSettings(e){this.settings={...e},this.display()}loadDrawerStates(){try{let e=localStorage.getItem(this.DRAWER_STATES_KEY);if(e){let r=JSON.parse(e);Object.entries(r).forEach(([i,s])=>{this.drawerStates.set(i,!!s)})}}catch(e){}}saveDrawerStates(){try{let e={};this.drawerStates.forEach((r,i)=>{e[i]=r}),localStorage.setItem(this.DRAWER_STATES_KEY,JSON.stringify(e))}catch(e){}}};Z();T();K();var P=class{static loadPreferences(){try{let t=localStorage.getItem(this.STORAGE_KEY);if(t){let e=JSON.parse(t);return{...this.DEFAULT_PREFERENCES,...e}}}catch(t){}return{...this.DEFAULT_PREFERENCES}}static savePreferences(t){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(t))}catch(e){}}static getPreference(t){return this.loadPreferences()[t]}static setPreference(t,e){let r=this.loadPreferences();r[t]=e,this.savePreferences(r)}static updateLastUsed(t){let e=this.loadPreferences();t.format&&(e.lastFormat=t.format,e.formatUsage[t.format]=(e.formatUsage[t.format]||0)+1),t.provider&&(e.lastProvider=t.provider,e.providerUsage[t.provider]=(e.providerUsage[t.provider]||0)+1),t.model&&(e.lastModel=t.model),t.maxTokens&&(e.lastMaxTokens=t.maxTokens),t.temperature&&(e.lastTemperature=t.temperature),t.performanceMode&&(e.lastPerformanceMode=t.performanceMode),t.parallelProcessing!==void 0&&(e.lastParallelProcessing=t.parallelProcessing),t.multimodal!==void 0&&(e.lastMultimodal=t.multimodal),t.autoFallback!==void 0&&(e.lastAutoFallback=t.autoFallback),e.lastUsed=new Date().toISOString(),e.totalProcessed=(e.totalProcessed||0)+1,this.savePreferences(e)}static getSmartDefaultFormat(){let t=this.loadPreferences();if(t.preferredFormat)return t.preferredFormat;let e=t.formatUsage||{},r=0,i="executive-summary";for(let[s,o]of Object.entries(e)){let a=typeof o=="number"?o:0;a>r&&(r=a,i=s)}return i}static getSmartDefaultProvider(){let t=this.loadPreferences();if(t.preferredProvider)return t.preferredProvider;let e=t.providerUsage||{},r=0,i;for(let[s,o]of Object.entries(e))o>r&&(r=o,i=s);return i}static getSmartDefaultModelParameters(){let t=this.loadPreferences();return{maxTokens:t.lastMaxTokens||4096,temperature:t.lastTemperature||.5}}static getSmartDefaultPerformanceSettings(){let t=this.loadPreferences();return{mode:t.lastPerformanceMode||"balanced",parallel:t.lastParallelProcessing||!1,multimodal:t.lastMultimodal||!0,autoFallback:t.lastAutoFallback!==void 0?t.lastAutoFallback:!0}}static getSmartDefaultAutoFallback(){let t=this.loadPreferences();return t.preferredAutoFallback!==void 0?t.preferredAutoFallback:t.lastAutoFallback!==void 0?t.lastAutoFallback:!0}static getUserInsights(){let t=this.loadPreferences(),e=t.formatUsage||{},r=t.providerUsage||{},i="executive-summary",s=0;for(let[h,p]of Object.entries(e)){let g=typeof p=="number"?p:0;g>s&&(s=g,i=h)}let o="",a=0;for(let[h,p]of Object.entries(r)){let g=typeof p=="number"?p:0;g>a&&(a=g,o=h)}let n=t.totalProcessed||0,l=n<5?"light":n<20?"moderate":"heavy",c=[];return l==="heavy"&&!t.showAdvancedSettings&&c.push("Consider enabling advanced settings for more control"),!t.autoSelectProvider&&Object.keys(r).length>1&&c.push("Enable auto-select provider to speed up your workflow"),!t.showPreview&&n>10&&c.push("Enable video preview for better context"),{favoriteFormat:i,favoriteProvider:o,averageTokens:t.lastMaxTokens||4096,averageTemperature:t.lastTemperature||.5,usageLevel:l,recommendations:c}}static resetPreferences(){localStorage.removeItem(this.STORAGE_KEY)}static exportPreferences(){let t=this.loadPreferences();return JSON.stringify(t,null,2)}static importPreferences(t){try{let e=JSON.parse(t);return this.savePreferences({...this.DEFAULT_PREFERENCES,...e}),!0}catch(e){return!1}}};P.STORAGE_KEY="yt-clipper-user-preferences",P.DEFAULT_PREFERENCES={autoSelectProvider:!0,showPreview:!0,enableKeyboardShortcuts:!0,enableAnimations:!0,autoFocusUrl:!0,showAdvancedSettings:!1,compactMode:!1,formatUsage:{brief:0,"executive-summary":0,"detailed-guide":0,custom:0},providerUsage:{}};var N=require("obsidian"),Me=class extends q{constructor(e,r){super(e);this.options=r;this.url="";this.format="executive-summary";this.fetchInProgress=!1;this.progressSteps=[];this.currentStepIndex=0;this.isProcessing=!1;this.isLightTheme=!1;this.autoFallbackEnabled=!0;this.customPrompt="";this.url=r.initialUrl||"";let i=localStorage.getItem("ytc-theme-mode");this.isLightTheme=i==="light";let s=P.getSmartDefaultPerformanceSettings(),o=P.getSmartDefaultModelParameters(),a=P.getSmartDefaultProvider(),n=P.getSmartDefaultFormat(),l=P.getSmartDefaultAutoFallback(),c=P.getPreference("preferredModel"),h=P.getPreference("lastModel");this.selectedProvider=a||"Google Gemini",this.selectedModel=c||h||"gemini-2.5-pro",this.format=n,this.autoFallbackEnabled=l,P.updateLastUsed({format:n,provider:this.selectedProvider,model:this.selectedModel,maxTokens:r.defaultMaxTokens||4096,temperature:r.defaultTemperature||.5,performanceMode:s.mode,parallelProcessing:s.parallel,multimodal:s.multimodal})}onOpen(){d.debug("[YT-CLIPPER] YouTubeUrlModal.onOpen called","Modal");try{if(this.createModalContent(),d.debug("[YT-CLIPPER] Modal content created","Modal"),this.setupEventHandlers(),d.debug("[YT-CLIPPER] Event handlers set up","Modal"),this.setupKeyboardShortcuts(),d.debug("[YT-CLIPPER] Keyboard shortcuts set up","Modal"),this.fetchModelsForCurrentProvider(),this.options.initialUrl&&(this.setUrl(this.options.initialUrl),this.updateProcessButtonState(),v.isValidYouTubeUrl((this.options.initialUrl||"").trim())&&this.processButton)){this.processButton.focus();return}this.focusUrlInput()}catch(e){throw d.error("[YT-CLIPPER] Error in onOpen:","Modal",e),e}}async fetchModelsForCurrentProvider(){if(!(!this.options.fetchModelsForProvider||!this.selectedProvider))try{d.debug("[YT-CLIPPER] Fetching models for provider:","Modal",this.selectedProvider);let e=await this.options.fetchModelsForProvider(this.selectedProvider,!0);if(d.debug("[YT-CLIPPER] Fetched models count:","Modal",(e==null?void 0:e.length)||0),e&&e.length>0){let r={...this.options.modelOptions,[this.selectedProvider]:e};this.options.modelOptions=r,this.updateModelDropdown(r),d.debug("[YT-CLIPPER] Updated dropdown with models","Modal",{count:e.length})}else d.warn("[YT-CLIPPER] No models returned from API, using fallback","Modal"),this.updateModelDropdown(this.options.modelOptions)}catch(e){d.error("[YT-CLIPPER] Auto-fetch models failed:","Modal",e),d.warn("[YT-CLIPPER] Falling back to cached or static models","Modal"),this.updateModelDropdown(this.options.modelOptions)}}createModalContent(){d.debug("[YT-CLIPPER] createModalContent starting","Modal");try{this.contentEl.empty(),this.contentEl.addClass("ytc-modal-content-wrapper"),this.createTopBar(),d.debug("[YT-CLIPPER] Top bar created","Modal"),this.createUrlSection(),d.debug("[YT-CLIPPER] URL section created","Modal"),this.createSettingsSection(),d.debug("[YT-CLIPPER] Settings section created","Modal"),this.createProgressSection(),d.debug("[YT-CLIPPER] Progress section created","Modal"),this.createActionButtons(),d.debug("[YT-CLIPPER] Action buttons created","Modal"),this.updateModelDropdown(this.options.modelOptions),this.applyTheme(this.isLightTheme),this.toggleCustomPromptVisibility(),d.debug("[YT-CLIPPER] Theme applied","Modal")}catch(e){throw d.error("[YT-CLIPPER] Error in createModalContent:","Modal",e),e}}createTopBar(){let e=this.contentEl.createDiv("ytc-top-bar");e.style.cssText=`
            display: flex;
            justify-content: space-between;
            align-items: center;
        `;let r=e.createDiv(),i=r.createEl("h2");i.textContent="YouTube to Note",this.headerEl=i;let s=r.createDiv("subtitle");s.textContent="Generate AI summaries & notes";let o=e.createDiv();o.style.cssText=`
            display: flex;
            gap: 6px;
            align-items: center;
        `;let a=o.createEl("button"),n=()=>{a.innerHTML='<span style="font-size: 1.1em">\u{1F504}</span>',a.style.opacity=this.autoFallbackEnabled?"1":"0.4",a.style.borderColor=this.autoFallbackEnabled?"var(--ytc-accent)":"var(--ytc-border)",a.title=`Auto Fallback: ${this.autoFallbackEnabled?"ON":"OFF"}`};a.setAttribute("aria-label","Toggle Auto Fallback"),a.style.cssText=`
            background: transparent;
            border: 1px solid var(--ytc-border);
            border-radius: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--ytc-text-secondary);
        `,n(),a.onclick=()=>{this.autoFallbackEnabled=!this.autoFallbackEnabled,n(),P.updateLastUsed({autoFallback:this.autoFallbackEnabled})},a.onmouseenter=()=>{a.style.background="var(--ytc-bg-tertiary)",a.style.color="var(--ytc-text-primary)"},a.onmouseleave=()=>{a.style.background="transparent",a.style.color="var(--ytc-text-secondary)"};let l=o.createEl("button");l.innerHTML='<span style="font-size: 1.1em">\u{1F4E6}</span>',l.setAttribute("aria-label","Batch Process"),l.title="Batch Process Multiple Videos",l.style.cssText=`
            background: transparent;
            border: 1px solid var(--ytc-border);
            border-radius: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--ytc-text-secondary);
        `,l.onclick=()=>{var h,p;return(p=(h=this.options).onOpenBatchModal)==null?void 0:p.call(h)},l.onmouseenter=()=>{l.style.background="var(--ytc-bg-tertiary)",l.style.color="var(--ytc-text-primary)"},l.onmouseleave=()=>{l.style.background="transparent",l.style.color="var(--ytc-text-secondary)"};let c=o.createEl("button");c.innerHTML=this.isLightTheme?"\u{1F319}":"\u2600\uFE0F",c.setAttribute("aria-label","Toggle Theme"),c.title="Toggle Light/Dark Mode",c.style.cssText=`
            background: transparent;
            border: 1px solid var(--ytc-border);
            border-radius: 6px;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1em;
            color: var(--ytc-text-secondary);
        `,c.onclick=()=>{this.isLightTheme=!this.isLightTheme,this.applyTheme(this.isLightTheme),localStorage.setItem("ytc-theme-mode",this.isLightTheme?"light":"dark"),c.innerHTML=this.isLightTheme?"\u{1F319}":"\u2600\uFE0F"},c.onmouseenter=()=>{c.style.background="var(--ytc-bg-tertiary)",c.style.color="var(--ytc-text-primary)"},c.onmouseleave=()=>{c.style.background="transparent",c.style.color="var(--ytc-text-secondary)"}}createUrlSection(){let e=this.contentEl.createDiv();e.style.cssText=`
            margin: 0 0 20px 0;
            position: relative;
        `;let r=e.createDiv("ytc-input-group");r.style.cssText=`
            position: relative;
            display: flex;
            align-items: center;
        `,this.urlInput=r.createEl("input"),this.urlInput.type="url",this.urlInput.placeholder="Paste YouTube URL here...",this.urlInput.setAttribute("aria-label","YouTube URL Input"),this.pasteButton=r.createEl("button",{cls:"ytc-paste-btn-integrated"}),this.pasteButton.innerHTML="\u{1F4CB} Paste",this.pasteButton.setAttribute("aria-label","Paste URL from clipboard"),this.pasteButton.title="Paste from clipboard",this.pasteButton.addEventListener("click",i=>{i.preventDefault(),this.handleSmartPaste()}),this.validationMessage=e.createDiv(),this.validationMessage.setAttribute("aria-live","polite"),this.validationMessage.style.cssText=`
            position: absolute;
            bottom: -20px;
            left: 2px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
            height: 20px;
            display: flex;
            align-items: center;
        `,this.createVideoPreviewSection(e)}createSettingsSection(){let e=this.contentEl.createDiv();e.addClass("ytc-settings-section"),e.style.cssText=`
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 24px;
        `;let r=e.createDiv();r.style.cssText=`
            display: flex;
            gap: 12px;
            align-items: flex-end;
        `;let i=r.createDiv();i.style.flex="1";let s=i.createEl("label");s.textContent="OUTPUT FORMAT",s.htmlFor="ytc-format-select",s.style.cssText=`
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--ytc-text-muted);
            margin-bottom: 6px;
            letter-spacing: 0.05em;
            display: block;
        `,this.formatSelect=i.createEl("select"),this.formatSelect.id="ytc-format-select",[{value:"executive-summary",text:"\u{1F4CA} Executive Summary"},{value:"detailed-guide",text:"\u{1F4D8} Tutorial / Guide"},{value:"brief",text:"\u26A1 Brief Summary"},{value:"transcript",text:"\u{1F4DD} Transcript Note"},{value:"custom",text:"\u270F\uFE0F Custom Format"}].forEach(b=>{let M=this.formatSelect.createEl("option");M.value=b.value,M.textContent=b.text}),this.formatSelect.value=this.format,this.formatSelect.addEventListener("change",()=>{var b,M;this.format=(M=(b=this.formatSelect)==null?void 0:b.value)!=null?M:"executive-summary",this.toggleCustomPromptVisibility(),P.setPreference("lastFormat",this.format)});let a=r.createDiv();a.style.flex="1";let n=a.createEl("label");n.textContent="AI CONFIGURATION",n.style.cssText=`
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--ytc-text-muted);
            margin-bottom: 6px;
            letter-spacing: 0.05em;
            display: block;
        `;let l=a.createDiv();l.addClass("ytc-ai-toggle-btn"),l.setAttribute("role","button"),l.setAttribute("tabindex","0"),l.style.cssText=`
            background: var(--ytc-bg-input);
            border: 1px solid var(--ytc-border);
            border-radius: 8px;
            height: 38px;
            padding: 0 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        `;let c=l.createDiv();c.style.cssText=`
            font-size: 0.9rem;
            color: var(--ytc-text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        `;let h=l.createDiv();h.innerHTML='<svg width="10" height="6" viewBox="0 0 10 6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 1L5 5L9 1"/></svg>',h.style.cssText=`
            transition: transform 0.2s ease;
            opacity: 0.5;
            margin-left: 8px;
            flex-shrink: 0;
            color: var(--ytc-text-secondary);
        `;let p=e.createDiv("ytc-ai-content");p.style.cssText=`
            background: var(--ytc-bg-secondary);
            border: 1px solid var(--ytc-border);
            border-radius: 8px;
            padding: 16px;
            display: none;
            margin-top: -4px;
            animation: fadeIn 0.15s ease-out;
        `,this.createCustomPromptSection(e);let g=!1,y=()=>{let b=this.selectedProvider||"Google Gemini",M=this.selectedModel||"Default";c.textContent=`${b}`,c.title=`${b} \u2022 ${this.formatModelName(M)}`},C=()=>{g=!g,p.style.display=g?"block":"none",l.classList.toggle("active",g),l.style.borderColor=g?"var(--ytc-accent)":"var(--ytc-border)",h.style.transform=g?"rotate(180deg)":"rotate(0deg)"};l.addEventListener("click",C),l.addEventListener("keydown",b=>{(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),C())});let x=p.createDiv(),Q=x.createEl("label");Q.textContent="AI PROVIDER",Q.htmlFor="ytc-provider-select",Q.style.cssText="font-size: 0.7rem; font-weight: 600; margin-bottom: 6px; color: var(--ytc-text-muted); letter-spacing: 0.05em; display: block;",this.providerSelect=x.createEl("select"),this.providerSelect.id="ytc-provider-select",[{value:"Google Gemini",text:"Google Gemini (Recommended)"},{value:"Groq",text:"Groq (Fastest)"},{value:"OpenRouter",text:"OpenRouter"},{value:"Hugging Face",text:"Hugging Face"},{value:"Ollama",text:"Ollama (Local)"},{value:"Ollama Cloud",text:"Ollama Cloud"}].forEach(b=>{let M=this.providerSelect.createEl("option");M.value=b.value,M.textContent=b.text}),this.providerSelect.value=this.selectedProvider||"Google Gemini";let k=p.createDiv();k.style.cssText="margin-top: 16px;";let V=k.createEl("label");V.textContent="MODEL",V.htmlFor="ytc-model-select",V.style.cssText="font-size: 0.7rem; font-weight: 600; color: var(--ytc-text-muted); letter-spacing: 0.05em; display: block; margin-bottom: 6px;";let B=k.createDiv();B.style.cssText="display: flex; gap: 8px; align-items: center;",this.modelSelect=B.createEl("select"),this.modelSelect.id="ytc-model-select",this.modelSelect.style.cssText=`
            flex: 1;
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 8px;
            font-size: 0.95rem;
            background: var(--background-primary);
            height: 42px;
            cursor: pointer;
        `;let O=B.createEl("button",{cls:"ytc-icon-btn"});O.innerHTML="\u{1F504}",O.title="Refresh Models",O.setAttribute("aria-label","Refresh Models"),O.onclick=async b=>{b.stopPropagation(),O.innerHTML="\u23F3",await this.fetchModelsForCurrentProvider(),O.innerHTML="\u{1F504}",y()};let G=B.createEl("button",{cls:"ytc-icon-btn"});G.innerHTML="\u2B50",G.title="Save as Default Preference",G.setAttribute("aria-label","Save as Default Preference"),G.onclick=b=>{b.stopPropagation(),this.selectedModel&&(P.setPreference("preferredModel",this.selectedModel),new N.Notice("\u2B50 Model saved as default!"))},this.providerSelect.addEventListener("change",async()=>{var b;this.selectedProvider=((b=this.providerSelect)==null?void 0:b.value)||"Google Gemini",await this.fetchModelsForCurrentProvider(),y()}),this.modelSelect.addEventListener("change",()=>{var b;this.selectedModel=(b=this.modelSelect)==null?void 0:b.value,y()}),y();let ke=this.updateModelDropdown.bind(this);this.updateModelDropdown=b=>{ke(b),y()}}createIconsRow(){}createVideoPreviewSection(e){this.videoPreviewContainer=e.createDiv(),this.videoPreviewContainer.style.cssText=`
            display: none;
            margin-top: 4px;
            padding: 6px;
            background: var(--background-secondary);
            border-radius: 4px;
            border: 1px solid var(--background-modifier-border);
        `;let r=this.videoPreviewContainer.createDiv();r.style.cssText=`
            display: flex;
            gap: 6px;
            align-items: center;
        `,this.thumbnailEl=r.createEl("img"),this.thumbnailEl.style.cssText=`
            width: 60px;
            height: 34px;
            border-radius: 3px;
            object-fit: cover;
            background: var(--background-modifier-border);
            flex-shrink: 0;
        `,this.thumbnailEl.alt="Video thumbnail";let i=r.createDiv();i.style.cssText=`
            flex: 1;
            min-width: 0;
        `,this.videoTitleEl=i.createDiv(),this.videoTitleEl.style.cssText=`
            font-weight: 500;
            font-size: 0.8rem;
            color: var(--text-normal);
            margin-bottom: 1px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        `;let s=i.createDiv();s.style.cssText=`
            display: flex;
            gap: 6px;
            font-size: 0.7rem;
            color: var(--text-muted);
        `,this.videoChannelEl=s.createSpan(),this.videoDurationEl=s.createSpan(),this.providerStatusEl=this.videoPreviewContainer.createDiv(),this.providerStatusEl.style.cssText=`
            margin-top: 3px;
            padding: 3px 6px;
            background: var(--background-primary);
            border-radius: 3px;
            font-size: 0.8rem;
            color: var(--text-muted);
            display: none;
        `}async showVideoPreview(e){if(!this.videoPreviewContainer||!this.thumbnailEl)return;this.videoPreviewContainer.style.display="block";let r=`
            @keyframes ytc-skeleton-pulse {
                0%, 100% { opacity: 0.4; }
                50% { opacity: 0.8; }
            }
        `;if(!document.getElementById("ytc-skeleton-styles")){let i=document.createElement("style");i.id="ytc-skeleton-styles",i.textContent=r,document.head.appendChild(i)}this.thumbnailEl.style.background="var(--background-modifier-border)",this.thumbnailEl.style.animation="ytc-skeleton-pulse 1.5s ease-in-out infinite",this.thumbnailEl.src="",this.videoTitleEl&&(this.videoTitleEl.textContent="\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588",this.videoTitleEl.style.color="var(--background-modifier-border)",this.videoTitleEl.style.animation="ytc-skeleton-pulse 1.5s ease-in-out infinite"),this.videoChannelEl&&(this.videoChannelEl.textContent="\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588",this.videoChannelEl.style.animation="ytc-skeleton-pulse 1.5s ease-in-out infinite"),this.videoDurationEl&&(this.videoDurationEl.textContent="\u2588\u2588:\u2588\u2588",this.videoDurationEl.style.animation="ytc-skeleton-pulse 1.5s ease-in-out infinite"),this.thumbnailEl.src=`https://img.youtube.com/vi/${e}/mqdefault.jpg`,this.thumbnailEl.onload=()=>{this.thumbnailEl&&(this.thumbnailEl.style.animation="none")};try{let i=await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${e}&format=json`);if(i.ok){let s=await i.json();this.videoTitleEl&&(this.videoTitleEl.textContent=s.title||"Unknown Title",this.videoTitleEl.style.color="var(--text-normal)",this.videoTitleEl.style.animation="none"),this.videoChannelEl&&(this.videoChannelEl.textContent=`\u{1F4FA} ${s.author_name||"Unknown Channel"}`,this.videoChannelEl.style.animation="none"),this.videoDurationEl&&(this.videoDurationEl.textContent="",this.videoDurationEl.style.animation="none")}}catch(i){this.videoTitleEl&&(this.videoTitleEl.textContent="Video Preview",this.videoTitleEl.style.color="var(--text-normal)",this.videoTitleEl.style.animation="none"),this.videoChannelEl&&(this.videoChannelEl.style.animation="none"),this.videoDurationEl&&(this.videoDurationEl.style.animation="none")}}hideVideoPreview(){this.videoPreviewContainer&&(this.videoPreviewContainer.style.display="none")}updateProviderStatus(e,r){this.providerStatusEl&&(this.providerStatusEl.style.display="block",this.providerStatusEl.innerHTML=`<span style="color: var(--ytc-accent);">\u{1F916} ${e}</span> \u2014 ${r}`)}createCustomPromptSection(e){if(this.customPromptContainer=e.createDiv(),this.customPromptContainer.style.cssText=`
            display: none;
            margin-top: 5px;
            padding: 8px;
            background: var(--background-secondary);
            border-radius: 4px;
            border: 1px solid var(--background-modifier-border);
            animation: ytc-slide-down 0.2s ease-out;
        `,!document.getElementById("ytc-custom-prompt-styles")){let n=document.createElement("style");n.id="ytc-custom-prompt-styles",n.textContent=`
                @keyframes ytc-slide-down {
                    from { opacity: 0; transform: translateY(-10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `,document.head.appendChild(n)}let r=this.customPromptContainer.createDiv();r.style.cssText=`
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        `;let i=r.createDiv();i.style.cssText=`
            display: flex;
            align-items: center;
            gap: 4px;
        `,i.createSpan({text:"\u270F\uFE0F"});let s=i.createSpan({text:"Custom Prompt"});s.style.cssText=`
            font-weight: 600;
            color: var(--text-normal);
            font-size: 0.8rem;
        `;let o=r.createSpan({text:"Describe your summary"});o.style.cssText=`
            color: var(--text-muted);
            font-size: 0.7rem;
        `,this.customPromptInput=this.customPromptContainer.createEl("textarea"),this.customPromptInput.placeholder='e.g., "Step-by-step tutorial with code examples"',this.customPromptInput.style.cssText=`
            width: 100%;
            min-height: 60px;
            padding: 6px 8px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 4px;
            font-size: 0.8rem;
            background: var(--background-primary);
            color: var(--text-normal);
            resize: vertical;
            outline: none;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            font-family: inherit;
            line-height: 1.4;
        `,this.customPromptInput.addEventListener("focus",()=>{this.customPromptInput.style.borderColor="var(--interactive-accent)",this.customPromptInput.style.boxShadow="0 0 0 2px rgba(99, 102, 241, 0.1)"}),this.customPromptInput.addEventListener("blur",()=>{this.customPromptInput.style.borderColor="var(--background-modifier-border)",this.customPromptInput.style.boxShadow="none"}),this.customPromptInput.addEventListener("input",()=>{var n,l;this.customPrompt=(l=(n=this.customPromptInput)==null?void 0:n.value)!=null?l:""});let a=this.customPromptContainer.createDiv();a.style.cssText=`
            text-align: right;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-top: 4px;
        `,a.textContent="0 characters",this.customPromptInput.addEventListener("input",()=>{var l,c;let n=(c=(l=this.customPromptInput)==null?void 0:l.value.length)!=null?c:0;a.textContent=`${n} character${n!==1?"s":""}`})}toggleCustomPromptVisibility(){this.customPromptContainer&&(this.format==="custom"?(this.customPromptContainer.style.display="block",setTimeout(()=>{var e;(e=this.customPromptInput)==null||e.focus()},100)):this.customPromptContainer.style.display="none")}createFallbackToggle(e){var h;let r=e.createDiv();r.style.cssText=`
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 5px;
            padding: 4px 8px;
            background: var(--background-secondary);
            border-radius: 4px;
            font-size: 0.75rem;
        `;let i=r.createDiv();i.style.cssText=`
            display: flex;
            align-items: center;
            gap: 4px;
        `,i.createSpan({text:"\u{1F504}"});let s=i.createSpan({text:"Auto Fallback"});s.style.cssText=`
            color: var(--text-normal);
            font-weight: 500;
            font-size: 0.75rem;
        `;let o=i.createSpan({text:"(err)"});o.style.cssText=`
            color: var(--text-muted);
            font-size: 0.7rem;
        `;let a=r.createDiv();a.style.cssText=`
            position: relative;
            width: 30px;
            height: 16px;
            flex-shrink: 0;
        `,this.fallbackToggle=a.createEl("input",{type:"checkbox"}),this.fallbackToggle.checked=(h=this.options.enableAutoFallback)!=null?h:!0,this.autoFallbackEnabled=this.fallbackToggle.checked,this.fallbackToggle.style.cssText=`
            position: absolute;
            width: 30px;
            height: 16px;
            appearance: none;
            -webkit-appearance: none;
            background: var(--background-modifier-border);
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s ease;
            outline: none;
        `;let n=()=>{var p;(p=this.fallbackToggle)!=null&&p.checked?(this.fallbackToggle.style.background="var(--ytc-accent)",this.fallbackToggle.style.boxShadow="0 0 10px rgba(45, 212, 191, 0.4)"):(this.fallbackToggle.style.background="var(--ytc-border)",this.fallbackToggle.style.boxShadow="none")},l=a.createDiv();l.style.cssText=`
            position: absolute;
            top: 2px;
            left: 2px;
            width: 12px;
            height: 12px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
            pointer-events: none;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        `;let c=()=>{var p;(p=this.fallbackToggle)!=null&&p.checked?l.style.transform="translateX(14px)":l.style.transform="translateX(0)"};n(),c(),this.fallbackToggle.addEventListener("change",()=>{var p,g;this.autoFallbackEnabled=(g=(p=this.fallbackToggle)==null?void 0:p.checked)!=null?g:!0,P.updateLastUsed({autoFallback:this.autoFallbackEnabled}),n(),c()})}updateModelDropdown(e){var h,p;if(!this.modelSelect||!this.providerSelect)return;let r=this.providerSelect.value,i=this.modelSelect.value;this.modelSelect.innerHTML='<option value="">Loading models...</option>',this.modelSelect.disabled=!0;let s=[],o="";if(e!=null&&e[r])s=(h=e[r])!=null?h:[],o=" (live)";else{let g=z[r];g?(s=g.map(y=>typeof y=="string"?y:y.name),o=" (cached)"):s=[]}if(this.modelSelect.innerHTML="",s.length>0){let g=this.modelSelect.createEl("option");g.value="",g.textContent=`\u{1F4CB} ${s.length} models${o}`,g.disabled=!0,g.style.cssText=`
                font-weight: 600;
                color: var(--text-muted);
                font-size: 12px;
                background: var(--background-secondary);
            `}s.forEach(g=>{let y=this.modelSelect.createEl("option");y.value=g;let C=this.formatModelName(g),x=this.isMultimodalModel(r,g);y.textContent=x?`\u{1F441}\uFE0F ${C}`:C,x&&(y.title=`${C} - Supports vision and multimodal analysis`),y.style.cssText=`
                color: var(--text-normal);
                background: var(--background-primary);
            `}),this.modelSelect.disabled=!1;let a="",n=P.loadPreferences(),l=`lastModel_${r.replace(/\s+/g,"")}`,c=n[l];c&&s.includes(c)?a=c:this.selectedModel&&s.includes(this.selectedModel)?a=this.selectedModel:s.length>0&&(a=(p=s[0])!=null?p:""),this.modelSelect.value=a,this.selectedModel=a,s.length>0&&(this.modelSelect.style.transition="background 0.3s ease",this.modelSelect.style.background="var(--background-modifier-hover)",setTimeout(()=>{this.modelSelect&&(this.modelSelect.style.background="")},300))}formatModelName(e){return e==="gemini-2.5-pro"?"Gemini Pro 2.5":e==="gemini-2.5-flash"?"Gemini Flash 2.5":e==="gemini-1.5-pro"?"Gemini Pro 1.5":e==="gemini-1.5-flash"?"Gemini Flash 1.5":e==="qwen3-coder:480b-cloud"?"Qwen3-Coder 480B Cloud":e==="deepseek-v3.2"?"DeepSeek v3.2":e==="deepseek-v3.2:latest"?"DeepSeek v3.2 (Latest)":e==="deepseek-v3.2:32b"?"DeepSeek v3.2 32B":e==="deepseek-v3.2:70b"?"DeepSeek v3.2 70B":e==="deepseek-v3.2:instruct"?"DeepSeek v3.2 Instruct":e==="deepseek-v3.2:coder"?"DeepSeek v3.2 Coder":e==="llama-3.1-8b-instant"?"Llama 3.1 8B Instant \u26A1":e==="llama-3.1-8b-instruct"?"Llama 3.1 8B":e==="llama-3.1-70b-instruct"?"Llama 3.1 70B":e==="llama-3.1-405b-instruct"?"Llama 3.1 405B":e==="mixtral-8x7b-instruct-v0.1"?"Mixtral 8x7B Instruct v0.1":e==="mixtral-8x22b-instruct-v0.1"?"Mixtral 8x22B Instruct v0.1":e==="gemma2-9b-it"?"Gemma 2 9B IT":e==="gemma-7b-it"?"Gemma 7B IT":e==="deepseek-r1-distill-llama-70b"?"DeepSeek R1 Distill 70B":e==="deepseek-coder-v2-lite-instruct"?"DeepSeek Coder V2 Lite":e==="llama-guard-3-8b"?"Llama Guard 3 8B":e==="code-llama-34b-instruct"?"Code Llama 34B":e==="mixtral-8x7b-32768"?"Mixtral 8x7B 32K":e==="mixtral-8x7b-instruct-v0.1"?"Mixtral 8x7B Instruct v0.1":e==="gemma-7b-it"?"Gemma 7B IT":e==="gemma2-9b-it"?"Gemma 2 9B IT":e==="llama2-70b-4096"?"Llama 2 70B 4K":e==="llama2-70b-chat"?"Llama 2 70B Chat":e==="llama2-13b-chat"?"Llama 2 13B Chat":e==="llama2-7b-chat"?"Llama 2 7B Chat":e==="llama-3.2-11b-vision-instruct"?"Llama 3.2 11B Vision \u{1F441}\uFE0F":e==="llama-3.2-90b-vision-instruct"?"Llama 3.2 90B Vision \u{1F441}\uFE0F":e==="llama3.2-vision"?"Llama 3.2 Vision \u{1F441}\uFE0F":e==="llava"?"LLaVA \u{1F441}\uFE0F":e==="llava-llama3"?"LLaVA Llama 3 \u{1F441}\uFE0F":e==="bakllava"?"BakLLaVA \u{1F441}\uFE0F":e==="moondream"?"MoonDream \u{1F441}\uFE0F":e==="nvidia-llama3-1-vision"?"NVIDIA Llama 3.1 Vision \u{1F441}\uFE0F":e==="qwen2-vl"?"Qwen 2 VL \u{1F441}\uFE0F":e==="phi3-vision"?"Phi 3 Vision \u{1F441}\uFE0F":e==="fuyu-8b"?"Fuyu 8B \u{1F441}\uFE0F":e==="pixtral-12b"?"Pixtral 12B \u{1F441}\uFE0F":e==="qwen/qwen2-vl-7b-instruct"?"Qwen 2 VL 7B \u{1F441}\uFE0F":e==="qwen/qwen2-vl-2b-instruct"?"Qwen 2 VL 2B \u{1F441}\uFE0F":e==="microsoft/phi-3.5-vision-instruct"?"Phi 3.5 Vision \u{1F441}\uFE0F":e==="google/paligemma-3b-mix-448"?"PaliGemma 3B \u{1F441}\uFE0F":e==="huggingfacem4/idefics2-8b"?"Idefics 2 8B \u{1F441}\uFE0F":e==="anthropic/claude-3.5-sonnet"?"Claude 3.5 Sonnet \u{1F441}\uFE0F":e==="anthropic/claude-3.5-haiku"?"Claude 3.5 Haiku \u{1F441}\uFE0F":e==="openai/gpt-4o"?"GPT-4o \u{1F441}\uFE0F":e==="openai/gpt-4o-mini"?"GPT-4o Mini \u{1F441}\uFE0F":e==="google/gemini-2.0-flash-exp"?"Gemini 2.0 Flash Experimental \u{1F441}\uFE0F":e.charAt(0).toUpperCase()+e.slice(1).replace(/[-_]/g," ")}createThemeToggle(){let e=this.contentEl.createDiv();e.style.cssText=`
            display: flex;
            justify-content: flex-end;
            margin: 4px 0 8px 0;
        `;let r=e.createDiv();r.style.cssText=`
            cursor: pointer;
            font-size: 1rem;
            opacity: 0.6;
            transition: opacity 0.2s ease;
            padding: 4px;
        `,r.innerHTML=this.isLightTheme?"\u2600\uFE0F":"\u{1F319}",r.title=this.isLightTheme?"Switch to dark mode":"Switch to light mode",r.addEventListener("mouseenter",()=>{r.style.opacity="1"}),r.addEventListener("mouseleave",()=>{r.style.opacity="0.6"});let i=s=>{this.isLightTheme=s,r.innerHTML=s?"\u2600\uFE0F":"\u{1F319}",r.title=s?"Switch to dark mode":"Switch to light mode",this.applyTheme(s),localStorage.setItem("ytc-theme-mode",s?"light":"dark")};r.addEventListener("click",()=>{i(!this.isLightTheme)}),this.themeElements={slider:r,knob:r,sunIcon:r,moonIcon:r,updateTheme:i}}applyTheme(e){var i,s,o;(i=this.modalEl)==null||i.classList.add("ytc-themed-modal"),(s=this.modalEl)==null||s.classList.toggle("ytc-modal-light",e),(o=this.modalEl)==null||o.classList.toggle("ytc-modal-dark",!e);let r=document.getElementById("ytc-theme-styles");r&&r.remove()}createProgressSection(){this.progressContainer=this.contentEl.createDiv(),this.progressContainer.setAttribute("role","region"),this.progressContainer.setAttribute("aria-label","Processing progress"),this.progressContainer.setAttribute("aria-live","polite"),this.progressContainer.style.marginTop="6px",this.progressContainer.style.display="none";let e=this.progressContainer.createDiv();e.style.cssText=`
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
        `,this.progressText=e.createDiv(),this.progressText.id="progress-text",this.progressText.style.fontWeight="500",this.progressText.style.fontSize="13px",this.progressText.style.color="#00b894",this.progressText.textContent="Processing...",this.timerEl=e.createSpan(),this.timerEl.style.cssText=`
            font-family: monospace;
            font-variant-numeric: tabular-nums;
            font-size: 12px;
            color: var(--ytc-text-muted);
        `,this.timerEl.textContent="0.0s";let r=this.progressContainer.createDiv();r.setAttribute("role","progressbar"),r.setAttribute("aria-valuenow","0"),r.setAttribute("aria-valuemin","0"),r.setAttribute("aria-valuemax","100"),r.setAttribute("aria-labelledby","progress-text"),r.style.cssText=`
            width: 100%;
            height: 6px;
            background-color: var(--ytc-bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            position: relative;
        `,this.progressBar=r.createDiv(),this.progressBar.style.cssText=`
            height: 100%;
            background: linear-gradient(90deg, var(--ytc-accent), #34d399);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
        `;let i=this.progressBar.createDiv();if(i.style.cssText=`
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background-image: linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.15) 25%,
                transparent 25%,
                transparent 50%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0.15) 75%,
                transparent 75%,
                transparent
            );
            background-size: 20px 20px;
            animation: ytc-progress-stripe 1s linear infinite;
            opacity: 0.6;
        `,!document.getElementById("ytc-progress-anim")){let s=document.createElement("style");s.id="ytc-progress-anim",s.textContent=`
                @keyframes ytc-progress-stripe {
                    0% { background-position: 0 0; }
                    100% { background-position: 20px 20px; }
                }
            `,document.head.appendChild(s)}}createActionButtons(){let e=this.contentEl.createDiv();e.style.cssText=`
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 12px;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--ytc-border);
        `;let r=e.createEl("button",{cls:"ytc-action-btn ytc-ghost-btn"});r.textContent="Cancel",r.addEventListener("click",()=>this.close());let i=e.createDiv();i.style.flex="1",this.secondaryActionsRow=e.createDiv(),this.secondaryActionsRow.style.cssText=`
            display: none;
            gap: 8px;
        `,this.copyPathButton=this.secondaryActionsRow.createEl("button",{cls:"ytc-action-btn ytc-secondary-btn"}),this.copyPathButton.innerHTML="\u{1F4CB}",this.copyPathButton.title="Copy Path",this.copyPathButton.style.width="40px",this.copyPathButton.style.padding="0",this.copyPathButton.addEventListener("click",()=>this.handleCopyPath()),this.openButton=this.secondaryActionsRow.createEl("button",{cls:"ytc-action-btn ytc-secondary-btn"}),this.openButton.innerHTML="\u{1F4C4} Open",this.openButton.addEventListener("click",()=>this.handleOpenFile());let s=this.secondaryActionsRow.createEl("button",{cls:"ytc-action-btn ytc-primary-btn"});s.innerHTML="\u{1F504} New",s.addEventListener("click",()=>{this.showInputState()}),this.processAnotherButton=s,this.processButton=e.createEl("button",{cls:"ytc-action-btn ytc-primary-btn"}),this.processButton.innerHTML=`<span>\u2728</span> ${f.MODALS.PROCESS}`,this.processButton.style.minWidth="120px",this.processButton.addEventListener("click",()=>this.handleProcess()),this.updateProcessButtonState()}showInputState(){this.processButton&&(this.processButton.style.display="flex",this.processButton.disabled=!1,this.processButton.innerHTML=`<span>\u2728</span> ${f.MODALS.PROCESS}`),this.secondaryActionsRow&&(this.secondaryActionsRow.style.display="none"),this.urlInput&&(this.urlInput.disabled=!1,this.urlInput.value="",this.url=""),this.headerEl&&(this.headerEl.textContent=f.MODALS.PROCESS_VIDEO),this.processedFilePath="",this.updateProcessButtonState(),this.focusUrlInput()}setupEventHandlers(){this.scope.register([],"Enter",()=>(this.processButton&&!this.processButton.disabled&&this.processButton.click(),!1)),this.scope.register([],"Escape",()=>(this.close(),!1)),this.scope.register(["Ctrl"],"o",()=>(this.openButton&&this.openButton.style.display!=="none"&&this.handleOpenFile(),!1)),this.scope.register(["Ctrl"],"c",()=>document.activeElement!==this.urlInput&&this.processedFilePath?(this.handleCopyPath(),!1):!0),this.scope.register(["Ctrl","Shift"],"v",async()=>{try{let e=await navigator.clipboard.readText();this.urlInput&&v.isValidYouTubeUrl(e)&&(this.urlInput.value=e,this.url=e,this.updateProcessButtonState(),this.processButton&&!this.processButton.disabled&&this.processButton.click())}catch(e){}return!1}),this.urlInput&&this.urlInput.addEventListener("input",()=>{var e,r;this.url=(r=(e=this.urlInput)==null?void 0:e.value)!=null?r:"",this.updateProcessButtonState()})}focusUrlInput(){this.urlInput&&this.urlInput.focus()}updateProcessButtonState(){if(!this.processButton)return;let e=this.url.trim(),r=v.isValidYouTubeUrl(e);if(this.processButton.disabled=!r||this.isProcessing,this.processButton.style.opacity=this.processButton.disabled?"0.5":"1",e.length===0)this.setValidationMessage("Paste a YouTube link to begin processing.","info"),this.hideVideoPreview();else if(r){this.setValidationMessage("Ready to process this video.","success");let i=v.extractVideoId(e);i&&this.showVideoPreview(i)}else this.setValidationMessage("Enter a valid YouTube video URL.","error"),this.hideVideoPreview()}setValidationMessage(e,r="info"){if(!this.validationMessage)return;this.validationMessage.textContent=e;let i="var(--ytc-text-muted)";r==="error"?i="var(--ytc-error)":r==="success"&&(i="var(--ytc-success)"),this.validationMessage.style.color=i}async handleProcess(){var r,i,s,o;let e=this.url.trim();if(!e){new N.Notice(f.ERRORS.ENTER_URL),this.focusUrlInput();return}if(!v.isValidYouTubeUrl(e)){new N.Notice(f.ERRORS.INVALID_URL),this.focusUrlInput();return}try{if(this.showProcessingState(),this.updateProgress(0,"Starting..."),this.updateProgress(25,"Validating URL..."),!v.extractVideoId(e))throw new Error("Could not extract YouTube video ID");this.updateProgress(50,"Fetching video data..."),this.format=(i=(r=this.formatSelect)==null?void 0:r.value)!=null?i:"executive-summary",this.selectedProvider=(s=this.providerSelect)==null?void 0:s.value,this.selectedModel=(o=this.modelSelect)==null?void 0:o.value;let n=this.selectedProvider?this.selectedProvider.charAt(0).toUpperCase()+this.selectedProvider.slice(1):"AI";this.updateProgress(75,`Processing with ${n}...`);let l=this.options.defaultMaxTokens||4096;this.format==="transcript"&&(l=Math.max(l,16384));let c=await this.options.onProcess(e,this.format,this.selectedProvider,this.selectedModel,this.format==="custom"?this.customPrompt:void 0,this.options.performanceMode||"balanced",this.options.enableParallelProcessing||!1,this.options.preferMultimodal||!1,l,this.options.defaultTemperature||.5,this.autoFallbackEnabled);this.updateProgress(100,"Complete!"),this.processedFilePath=c,this.showCompletionState()}catch(a){this.showErrorState(a),E.handle(a,"YouTube URL processing")}}showProcessingState(){this.isProcessing=!0,this.progressContainer&&(this.progressContainer.style.display="block"),this.urlInput&&(this.urlInput.disabled=!0),this.processButton&&(this.processButton.style.display="flex",this.processButton.disabled=!0,this.processButton.innerHTML="<span>\u23F3</span> Processing..."),this.secondaryActionsRow&&(this.secondaryActionsRow.style.display="none"),this.timerInterval&&window.clearInterval(this.timerInterval);let e=Date.now();this.timerEl&&(this.timerEl.textContent="0.0s"),this.timerInterval=window.setInterval(()=>{if(this.timerEl){let r=(Date.now()-e)/1e3;this.timerEl.textContent=`${r.toFixed(1)}s`}},100)}updateProgress(e,r){this.progressBar&&(this.progressBar.style.width=`${e}%`),this.progressText&&(this.progressText.textContent=r)}showCompletionState(){this.isProcessing=!1,this.timerInterval&&(window.clearInterval(this.timerInterval),this.timerInterval=void 0),this.urlInput&&(this.urlInput.disabled=!1,this.urlInput.value="",this.url=""),this.processButton&&(this.processButton.style.display="none"),this.secondaryActionsRow&&(this.secondaryActionsRow.style.display="flex"),this.headerEl&&(this.headerEl.textContent="\u2705 Video Processed Successfully!"),this.setValidationMessage("Note saved. You can open it now or process another video.","success"),this.focusUrlInput()}showErrorState(e){this.isProcessing=!1,this.timerInterval&&(window.clearInterval(this.timerInterval),this.timerInterval=void 0),this.urlInput&&(this.urlInput.disabled=!1),this.processButton&&(this.processButton.disabled=!1,this.processButton.textContent=f.MODALS.PROCESS),this.openButton&&(this.openButton.style.display="none"),this.copyPathButton&&(this.copyPathButton.style.display="none"),this.progressContainer&&(this.progressContainer.style.display="none"),this.headerEl&&(this.headerEl.textContent="\u274C Processing Failed"),this.setValidationMessage(e.message,"error")}async handleOpenFile(){if(this.processedFilePath&&this.options.onOpenFile)try{await this.options.onOpenFile(this.processedFilePath),this.close()}catch(e){E.handle(e,"Opening file")}}async handleCopyPath(){if(this.processedFilePath)try{if(await navigator.clipboard.writeText(this.processedFilePath),this.copyPathButton){let e=this.copyPathButton.textContent;this.copyPathButton.textContent="\u2705 Copied!",setTimeout(()=>{this.copyPathButton&&(this.copyPathButton.textContent=e)},1500)}}catch(e){E.handle(e,"Copying path to clipboard")}}setUrl(e){this.url=e,this.urlInput&&(this.urlInput.value=e),this.updateProcessButtonState()}async handleSmartPaste(){try{let r=(await navigator.clipboard.readText()).trim();if(v.isValidYouTubeUrl(r))this.setUrl(r),new N.Notice("YouTube URL detected and pasted!");else{let i=r.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/);if(i){let o=`https://www.youtube.com/watch?v=${i[1]}`;this.setUrl(o),new N.Notice("YouTube URL extracted from clipboard!")}else new N.Notice("No YouTube URL found in clipboard")}this.processButton&&!this.isProcessing&&v.isValidYouTubeUrl(r)?this.processButton.focus():this.focusUrlInput()}catch(e){new N.Notice("Could not access clipboard")}}setupKeyboardShortcuts(){let e=r=>{r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement||((r.ctrlKey||r.metaKey)&&r.key==="Enter"&&(r.preventDefault(),this.processButton&&!this.processButton.disabled&&this.processButton.click()),r.key==="Escape"&&this.close())};this.scope.register(["Ctrl"],"Enter",()=>(this.processButton&&!this.processButton.disabled&&this.processButton.click(),!1))}onClose(){this.validationTimer&&clearTimeout(this.validationTimer),super.onClose()}getCacheStatus(e){return["OpenRouter","Hugging Face","Ollama","Ollama Cloud"].includes(e)?{isCached:!0,ageMinutes:15}:{isCached:!1}}isMultimodalModel(e,r){return["vision","vl","v-","multimodal","pixtral","fuyu","llava","moondream","gemini-2.5","gemini-2.0","claude-3.5","gpt-4o","phi-3.5-vision","qwen2-vl"].some(s=>r.toLowerCase().includes(s.toLowerCase()))}isUsingCachedModels(e){return this.getCacheStatus(e).isCached}updateRefreshButtonTooltip(){if(this.refreshButton){let e=this.selectedProvider||"Google Gemini";["OpenRouter","Hugging Face","Ollama","Ollama Cloud"].includes(e)?this.refreshButton.title="Refresh models (Shift+Click to force refresh and bypass cache)":this.refreshButton.title="Refresh models (static list)"}}};var U=require("obsidian");var Ce=class extends U.Modal{constructor(e,r){super(e);this.options=r;this.urls=[];this.selectedFormat="executive-summary";this.isProcessing=!1;this.selectedProvider=r.defaultProvider,this.selectedModel=r.defaultModel}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("ytc-batch-modal"),this.addStyles(),e.createEl("h2",{text:"\u{1F4E6} Batch Video Processing",cls:"ytc-batch-title"}),e.createEl("p",{text:"Enter YouTube URLs (one per line) to process multiple videos at once.",cls:"ytc-batch-description"}),this.createUrlInput(),this.createOptions(),this.createItemsList(),this.createProgressSection(),this.createActionButtons()}addStyles(){let e=document.createElement("style");e.textContent=`
            .ytc-batch-modal {
                padding: 20px;
                min-width: 500px;
            }
            .ytc-batch-title {
                margin: 0 0 8px 0;
                font-size: 1.4em;
            }
            .ytc-batch-description {
                color: var(--text-muted);
                margin-bottom: 16px;
            }
            .ytc-batch-textarea {
                width: 100%;
                min-height: 120px;
                padding: 12px;
                border: 1px solid var(--background-modifier-border);
                border-radius: 8px;
                background: var(--background-secondary);
                color: var(--text-normal);
                font-family: var(--font-monospace);
                font-size: 13px;
                resize: vertical;
            }
            .ytc-batch-textarea:focus {
                border-color: var(--interactive-accent);
                outline: none;
            }
            .ytc-batch-items {
                max-height: 200px;
                overflow-y: auto;
                margin: 16px 0;
                border: 1px solid var(--background-modifier-border);
                border-radius: 8px;
            }
            .ytc-batch-item {
                display: flex;
                align-items: center;
                padding: 8px 12px;
                border-bottom: 1px solid var(--background-modifier-border);
                gap: 8px;
            }
            .ytc-batch-item:last-child {
                border-bottom: none;
            }
            .ytc-batch-item-status {
                width: 20px;
                text-align: center;
            }
            .ytc-batch-item-url {
                flex: 1;
                font-size: 12px;
                color: var(--text-muted);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .ytc-batch-item-remove {
                cursor: pointer;
                color: var(--text-muted);
                opacity: 0.6;
            }
            .ytc-batch-item-remove:hover {
                color: var(--text-error);
                opacity: 1;
            }
            .ytc-batch-progress {
                margin: 16px 0;
                display: none;
            }
            .ytc-batch-progress.visible {
                display: block;
            }
            .ytc-batch-progress-bar {
                height: 8px;
                background: var(--background-modifier-border);
                border-radius: 4px;
                overflow: hidden;
            }
            .ytc-batch-progress-fill {
                height: 100%;
                background: var(--interactive-accent);
                transition: width 0.3s ease;
            }
            .ytc-batch-progress-text {
                text-align: center;
                font-size: 12px;
                color: var(--text-muted);
                margin-top: 4px;
            }
            .ytc-batch-actions {
                display: flex;
                justify-content: flex-end;
                gap: 8px;
                margin-top: 16px;
            }
            .ytc-batch-btn {
                padding: 8px 16px;
                border-radius: 6px;
                cursor: pointer;
                font-size: 14px;
                border: none;
            }
            .ytc-batch-btn-primary {
                background: var(--interactive-accent);
                color: white;
            }
            .ytc-batch-btn-primary:disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            .ytc-batch-btn-secondary {
                background: var(--background-secondary);
                color: var(--text-normal);
                border: 1px solid var(--background-modifier-border);
            }
            .ytc-batch-options {
                margin: 16px 0;
            }
        `,this.contentEl.appendChild(e)}createUrlInput(){let e=this.contentEl.createDiv({cls:"ytc-batch-input-container"});this.urlInput=e.createEl("textarea",{cls:"ytc-batch-textarea",attr:{placeholder:`https://youtube.com/watch?v=video1
https://youtube.com/watch?v=video2
https://youtu.be/video3`}}),this.urlInput.addEventListener("input",()=>this.parseUrls()),this.urlInput.addEventListener("paste",()=>{setTimeout(()=>this.parseUrls(),0)})}createOptions(){let e=this.contentEl.createDiv({cls:"ytc-batch-options"});new U.Setting(e).setName("Output Format").addDropdown(r=>{r.addOption("executive-summary","Executive Summary").addOption("step-by-step-tutorial","Step-by-Step Tutorial").addOption("brief","Brief Overview").setValue(this.selectedFormat).onChange(i=>{this.selectedFormat=i})}),new U.Setting(e).setName("AI Provider").addDropdown(r=>{this.options.providers.forEach(i=>{r.addOption(i,i)}),r.setValue(this.selectedProvider).onChange(i=>{this.selectedProvider=i})})}createItemsList(){this.itemsContainer=this.contentEl.createDiv({cls:"ytc-batch-items"}),this.itemsContainer.style.display="none"}createProgressSection(){this.progressContainer=this.contentEl.createDiv({cls:"ytc-batch-progress"}),this.progressContainer.createDiv({cls:"ytc-batch-progress-bar"}).createDiv({cls:"ytc-batch-progress-fill"}),this.progressContainer.createDiv({cls:"ytc-batch-progress-text"})}createActionButtons(){let e=this.contentEl.createDiv({cls:"ytc-batch-actions"});e.createEl("button",{text:"Cancel",cls:"ytc-batch-btn ytc-batch-btn-secondary"}).addEventListener("click",()=>this.close()),this.processButton=e.createEl("button",{text:"Process All",cls:"ytc-batch-btn ytc-batch-btn-primary"}),this.processButton.disabled=!0,this.processButton.addEventListener("click",()=>this.processVideos())}parseUrls(){let r=this.urlInput.value.split(`
`).filter(i=>i.trim());this.urls=[];for(let i of r){let s=i.trim();v.isValidYouTubeUrl(s)&&this.urls.push({url:s,status:"pending"})}this.renderItems(),this.updateProcessButton()}renderItems(){if(this.itemsContainer.empty(),this.urls.length===0){this.itemsContainer.style.display="none";return}this.itemsContainer.style.display="block";for(let e=0;e<this.urls.length;e++){let r=this.urls[e],i=this.itemsContainer.createDiv({cls:"ytc-batch-item"}),s=i.createSpan({cls:"ytc-batch-item-status"});s.textContent=this.getStatusIcon(r.status);let o=i.createSpan({cls:"ytc-batch-item-url"});o.textContent=r.url,o.title=r.url,this.isProcessing||i.createSpan({cls:"ytc-batch-item-remove",text:"\u2715"}).addEventListener("click",()=>this.removeItem(e))}}getStatusIcon(e){switch(e){case"pending":return"\u23F3";case"processing":return"\u{1F504}";case"completed":return"\u2705";case"failed":return"\u274C"}}removeItem(e){this.urls.splice(e,1),this.renderItems(),this.updateProcessButton()}updateProcessButton(){this.processButton.disabled=this.urls.length===0||this.isProcessing,this.processButton.textContent=this.isProcessing?"Processing...":`Process ${this.urls.length} Video${this.urls.length!==1?"s":""}`}async processVideos(){if(this.urls.length===0||this.isProcessing)return;this.isProcessing=!0,this.updateProcessButton(),this.progressContainer.classList.add("visible");let e=this.progressContainer.querySelector(".ytc-batch-progress-fill"),r=this.progressContainer.querySelector(".ytc-batch-progress-text"),i=0,s=this.urls.length;try{let o=this.urls.map(a=>a.url);for(let a=0;a<this.urls.length;a++){this.urls[a].status="processing",this.renderItems(),r.textContent=`Processing ${a+1} of ${s}...`,e.style.width=`${a/s*100}%`;try{let n=await this.options.onProcess([this.urls[a].url],this.selectedFormat,this.selectedProvider,this.selectedModel);this.urls[a].status="completed",this.urls[a].result=n[0],i++}catch(n){this.urls[a].status="failed",this.urls[a].error=n instanceof Error?n.message:String(n)}this.renderItems(),e.style.width=`${(a+1)/s*100}%`}r.textContent=`Completed: ${i}/${s} videos processed`,i===s?new U.Notice(`\u2705 Successfully processed ${i} videos!`):new U.Notice(`\u26A0\uFE0F Processed ${i}/${s} videos. Some failed.`)}catch(o){new U.Notice(`\u274C Batch processing failed: ${o instanceof Error?o.message:String(o)}`)}finally{this.isProcessing=!1,this.updateProcessButton()}}onClose(){this.contentEl.empty()}};var A=require("obsidian"),Ne="ytp",it="1.3.5",st={geminiApiKey:"",groqApiKey:"",ollamaApiKey:"",ollamaEndpoint:"http://localhost:11434",huggingFaceApiKey:"",openRouterApiKey:"",outputPath:"YouTube/Processed Videos",useEnvironmentVariables:!1,environmentPrefix:"YTC",performanceMode:"balanced",enableParallelProcessing:!0,enableAutoFallback:!0,preferMultimodal:!0,defaultMaxTokens:4096,defaultTemperature:.5},Ie=class extends A.Plugin{constructor(){super(...arguments);this._settings=st;this.isUnloading=!1;this.operationCount=0}async onload(){this.manifest.version=it,d.info(`Initializing YoutubeClipper Plugin v${it}...`);try{await this.loadSettings(),this.setupLogger(),await this.initializeServices(),this.registerUIComponents(),this.setupUrlHandling(),this.setupProtocolHandler(),d.plugin("Plugin loaded successfully")}catch(e){d.error("Failed to load plugin","Plugin",{error:e instanceof Error?e.message:String(e)}),E.handle(e,"Plugin initialization"),new A.Notice("Failed to load YoutubeClipper Plugin. Check console for details.")}}onunload(){var e,r,i;d.plugin("Unloading YoutubeClipper Plugin..."),this.isUnloading=!0;try{(e=this.urlHandler)==null||e.clear(),(r=this.modalManager)==null||r.clear(),(i=this.serviceContainer)==null||i.clearServices(),this.cleanupUIElements(),L.cleanupAllElements(),d.plugin("Plugin unloaded successfully")}catch(s){d.error("Error during plugin unload","Plugin",{error:s instanceof Error?s.message:String(s)})}}setupLogger(){d.updateConfig({level:1,enableConsole:!0,enableFile:!1,maxLogEntries:1e3})}async initializeServices(){this.serviceContainer=new ee(this._settings,this.app),this.modalManager=new se,this.urlHandler=new Se(this.app,this._settings,this.handleUrlDetection.bind(this))}setupUrlHandling(){this.urlHandler&&(this.registerEvent(this.app.vault.on("create",e=>{e instanceof A.TFile&&this.safeOperation(()=>this.urlHandler.handleFileCreate(e),"Handle file create")})),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.safeOperation(()=>this.urlHandler.handleActiveLeafChange(),"Handle active leaf change")})))}setupProtocolHandler(){try{this.registerObsidianProtocolHandler("youtube-clipper",e=>{var r;d.info("[YT-Clipper] Protocol received:","Plugin",e),(r=this.urlHandler)==null||r.handleProtocol(e)}),d.info("[YT-Clipper] Protocol handler registered successfully","Plugin")}catch(e){d.error("[YT-Clipper] Protocol handler registration failed:","Plugin",e),d.debug("Protocol handler not available","Plugin")}}registerUIComponents(){this.ribbonIcon=this.addRibbonIcon("youtube","Process YouTube Video",()=>{d.info("[YT-CLIPPER] Ribbon icon clicked","Plugin"),this.safeShowUrlModal()}),d.plugin("Ribbon icon set successfully"),this.addCommand({id:`${Ne}-process-youtube-video`,name:"Process YouTube Video",callback:()=>{d.info("[YT-CLIPPER] Process command triggered","Plugin"),this.safeShowUrlModal()}}),this.addSettingTab(new Ae(this.app,{plugin:this,onSettingsChange:this.handleSettingsChange.bind(this)})),this.addCommand({id:`${Ne}-open-url-from-clipboard`,name:"YouTube Clipper: Open URL Modal (from clipboard)",callback:async()=>{await this.handleClipboardUrl()}}),this.addCommand({id:`${Ne}-batch-process`,name:"YouTube Clipper: Batch Process Videos",callback:()=>{this.openBatchModal()}})}cleanupUIElements(){this.ribbonIcon&&(this.ribbonIcon.remove(),this.ribbonIcon=null)}handleUrlDetection(e){d.info("URL detected, opening modal","Plugin",{url:e.url,source:e.source,filePath:e.filePath}),this.safeShowUrlModal(e.url)}async handleClipboardUrl(){try{if(!this.urlHandler)return;await this.urlHandler.handleClipboardUrl();let e=window.prompt("Paste YouTube URL to open in YouTube Clipper:");e&&v.isValidYouTubeUrl(e.trim())?this.safeShowUrlModal(e.trim()):new A.Notice("No valid YouTube URL provided.")}catch(e){E.handle(e,"Open URL from clipboard")}}async safeShowUrlModal(e){var r,i;if(d.debug("[YT-CLIPPER] safeShowUrlModal called","Plugin",{initialUrl:e,hasModalManager:!!this.modalManager,hasServiceContainer:!!this.serviceContainer,modalState:(i=(r=this.modalManager)==null?void 0:r.getState)==null?void 0:i.call(r)}),!this.modalManager||!this.serviceContainer){d.error("[YT-CLIPPER] Cannot show modal - missing services","Plugin");return}try{await this.openYouTubeUrlModal(e)}catch(s){d.error("[YT-CLIPPER] Failed to open modal:","Plugin",s)}}async openYouTubeUrlModal(e){if(d.debug("[YT-CLIPPER] openYouTubeUrlModal called","Plugin",{initialUrl:e}),this.isUnloading){L.log("Plugin is unloading, ignoring modal request");return}L.safeOperation(async()=>{var a;if(!this.serviceContainer)return;let r=this.serviceContainer.aiService,i=r?r.getProviderNames():[],s=this._settings.modelOptionsCache||{};new Me(this.app,{onProcess:this.processYouTubeVideo.bind(this),onOpenFile:this.openFileByPath.bind(this),...e&&{initialUrl:e},providers:i,defaultProvider:"Google Gemini",defaultModel:"gemini-2.5-pro",defaultMaxTokens:this._settings.defaultMaxTokens,defaultTemperature:this._settings.defaultTemperature,modelOptions:s,fetchModels:async()=>{try{let n=await this.serviceContainer.aiService.fetchLatestModels();this._settings.modelOptionsCache=n;let l=Date.now();return this._settings.modelCacheTimestamps={},Object.keys(n).forEach(c=>{this._settings.modelCacheTimestamps[c]=l}),await this.saveSettings(),n}catch(n){return s}},fetchModelsForProvider:async(n,l=!1)=>{try{let c=await this.serviceContainer.aiService.fetchLatestModelsForProvider(n,l);return c&&c.length>0&&(this._settings.modelOptionsCache={...this._settings.modelOptionsCache,[n]:c},this._settings.modelCacheTimestamps={...this._settings.modelCacheTimestamps,[n]:Date.now()},await this.saveSettings()),c}catch(c){return[]}},performanceMode:this._settings.performanceMode||"balanced",enableParallelProcessing:this._settings.enableParallelProcessing||!1,enableAutoFallback:(a=this._settings.enableAutoFallback)!=null?a:!0,preferMultimodal:this._settings.preferMultimodal||!1,onPerformanceSettingsChange:async(n,l,c)=>{this._settings.performanceMode=n,this._settings.enableParallelProcessing=l,this._settings.preferMultimodal=c,await this.saveSettings(),this.serviceContainer=new ee(this._settings,this.app)},onOpenBatchModal:this.openBatchModal.bind(this)}).open()},"YouTube URL Modal").catch(r=>{E.handle(r,"Opening YouTube URL modal")})}async openBatchModal(){if(this.isUnloading||!this.serviceContainer)return;let e=this.serviceContainer.aiService,r=e?e.getProviderNames():[],i=this._settings.modelOptionsCache||{};new Ce(this.app,{onProcess:this.processYouTubeVideo.bind(this),onOpenFile:this.openFileByPath.bind(this),providers:r,defaultProvider:"Google Gemini",defaultModel:"gemini-2.5-pro",modelOptions:i,defaultMaxTokens:this._settings.defaultMaxTokens,defaultTemperature:this._settings.defaultTemperature}).open()}async processYouTubeVideo(e,r="detailed-guide",i,s,o,a,n,l,c,h,p){if(this.isUnloading)throw L.log("Plugin is unloading, cancelling video processing"),new Error("Plugin is shutting down");let g=await L.safeOperation(async()=>{var Ge,Ke;new A.Notice(f.PROCESSING);let y=v.validateSettings(this._settings);if(!y.isValid)throw new Error(`Configuration invalid: ${y.errors.join(", ")}`);if(!this.serviceContainer)throw new Error("Service container not initialized");let C=this.serviceContainer.videoService,x=this.serviceContainer.aiService,Q=this.serviceContainer.fileService,Re=this.serviceContainer.promptService,k=C.extractVideoId(e);if(!k)throw new Error(f.ERRORS.VIDEO_ID_EXTRACTION);let V=await C.getVideoData(k),B;r==="custom"?B=o:B=(Ge=this._settings.customPrompts)==null?void 0:Ge[r];let O;try{let w=await C.getTranscript(k);w!=null&&w.fullText?(O=w.fullText,d.info("Transcript fetched successfully","Plugin",{videoId:k,transcriptLength:O.length})):d.debug("No transcript available for this video","Plugin",{videoId:k})}catch(w){d.debug("Could not fetch transcript, continuing without it","Plugin",{error:w instanceof Error?w.message:String(w)})}let G=Re.createAnalysisPrompt(V,e,r,B,O);d.aiService("Processing video",{videoId:k,format:r,provider:i||"Auto",model:s||"Default",maxTokens:c||2048,temperature:h||.7});let ke=x.providers||[];for(let w of ke)c&&w.setMaxTokens&&w.setMaxTokens(c),h!==void 0&&w.setTemperature&&w.setTemperature(h);let b;try{if(i){let w=p!=null?p:!0;b=await x.processWith(i,G,s,void 0,w)}else b=await x.process(G);d.aiService("AI Response received",{provider:b.provider,model:b.model,contentLength:((Ke=b.content)==null?void 0:Ke.length)||0})}catch(w){throw d.error("AI Processing failed","Plugin",{error:w instanceof Error?w.message:String(w)}),w instanceof Error&&E.handleEnhanced(w,"AI Processing"),w}let M=Re.processAIResponse(b.content,b.provider,b.model,r,V,e),ot=await Q.saveToFile(V.title,M,this._settings.outputPath);return new A.Notice(f.SUCCESS(V.title)),ot},"YouTube Video Processing");if(!g)throw new Error("Failed to process YouTube video");return g}async openFileByPath(e){try{await new Promise(s=>setTimeout(s,300));let r=e.startsWith("/")?e.substring(1):e,i=this.app.vault.getAbstractFileByPath(r);if(!i||!(i instanceof A.TFile))throw new Error(`File not found at path: ${r}`);await this.openFileInNewTab(i)}catch(r){throw E.handle(r,"Opening file by path"),r}}async openFileInNewTab(e){try{let r=this.app.workspace.getLeaf("tab");await r.openFile(e),this.app.workspace.setActiveLeaf(r),new A.Notice(`\u{1F4C2} Opened: ${e.name}`)}catch(r){try{await this.app.workspace.getLeaf(!1).openFile(e),new A.Notice(`\u{1F4C2} Opened: ${e.name}`)}catch(i){E.handle(i,"Opening file in current tab"),new A.Notice(`Note saved as "${e.name}" but could not auto-open. Please open manually.`)}}}async handleSettingsChange(e){var r,i;try{this._settings={...e},await this.saveSettings(),await((r=this.serviceContainer)==null?void 0:r.updateSettings(this._settings)),(i=this.urlHandler)==null||i.updateSettings(this._settings)}catch(s){throw E.handle(s,"Settings update"),s}}async loadSettings(){var r,i;let e=await this.loadData();d.debug("[YT-CLIPPER] Settings loaded from data.json:","Plugin",e),this._settings=Object.assign({},st,e),d.debug("[YT-CLIPPER] Final settings after merge:","Plugin",{hasGeminiKey:!!this._settings.geminiApiKey,geminiKeyLength:(r=this._settings.geminiApiKey)==null?void 0:r.length,hasGroqKey:!!this._settings.groqApiKey,groqKeyLength:(i=this._settings.groqApiKey)==null?void 0:i.length})}async saveSettings(){await this.saveData(this._settings)}async safeOperation(e,r){if(this.isUnloading)return d.warn(`Attempted ${r} during plugin unload - skipping`,"Plugin"),null;let i=++this.operationCount;d.info(`Starting operation ${i}: ${r}`,"Plugin");try{let s=await e();return d.info(`Completed operation ${i}: ${r}`,"Plugin"),s}catch(s){return d.error(`Failed operation ${i}: ${r}`,"Plugin",{error:s instanceof Error?s.message:String(s)}),E.handle(s,r),null}}getServiceContainer(){return this.serviceContainer}getUrlHandler(){return this.urlHandler}getModalManager(){return this.modalManager}getCurrentSettings(){return{...this._settings}}get settings(){return this._settings}};
